---
title: Centralizovaná konfigurace
description: Centralizace konfigurace pro cloudové aplikace s využitím konfigurace aplikací Azure a trezoru AzureKey.
ms.date: 04/19/2020
ms.openlocfilehash: 53bdc03370b04af4d830fe7abbd8aebad81e9650
ms.sourcegitcommit: 957c49696eaf048c284ef8f9f8ffeb562357ad95
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/07/2020
ms.locfileid: "82895657"
---
# <a name="centralized-configuration"></a><span data-ttu-id="a0cf6-103">Centralizovaná konfigurace</span><span class="sxs-lookup"><span data-stu-id="a0cf6-103">Centralized configuration</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="a0cf6-104">Na rozdíl od aplikace monolitické, ve které se všechno spouští v rámci jedné instance, se aplikace Cloud Native skládá z nezávislých služeb distribuovaných napříč virtuálními počítači, kontejnery a geografickými oblastmi.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-104">Unlike a monolithic app in which everything runs within a single instance, a cloud-native application consists of independent services distributed across virtual machines, containers, and geographic regions.</span></span> <span data-ttu-id="a0cf6-105">Správa nastavení konfigurace pro desítky vzájemně závislých služeb může být náročná.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-105">Managing configuration settings for dozens of interdependent services can be challenging.</span></span> <span data-ttu-id="a0cf6-106">Duplicitní kopie nastavení konfigurace v různých umístěních jsou náchylné k chybám a jsou obtížně spravované.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-106">Duplicate copies of configuration settings across different locations is error prone and difficult to manage.</span></span> <span data-ttu-id="a0cf6-107">Centralizovaná konfigurace je zásadním požadavkem pro distribuované aplikace nativní pro Cloud.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-107">Centralized configuration is a critical requirement for distributed cloud-native applications.</span></span>

<span data-ttu-id="a0cf6-108">Jak je popsáno v [kapitole 1](introduction.md), doporučení pro dvanácti s aplikacemi vyžadují striktní oddělení mezi kódem a konfigurací.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-108">As discussed in [Chapter 1](introduction.md), the Twelve-Factor App recommendations require strict separation between code and configuration.</span></span> <span data-ttu-id="a0cf6-109">Konfigurace musí být ukládána externě z aplikace a v případě potřeby je lze přečíst.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-109">Configuration must be stored externally from the application and read-in as needed.</span></span> <span data-ttu-id="a0cf6-110">Ukládání hodnot konfigurace jako konstanty nebo hodnoty literálů v kódu je porušení.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-110">Storing configuration values as constants or literal values in code is a violation.</span></span> <span data-ttu-id="a0cf6-111">Stejné hodnoty konfigurace často používá mnoho služeb ve stejné aplikaci.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-111">The same configuration values are often be used by many services in the same application.</span></span> <span data-ttu-id="a0cf6-112">Kromě toho je potřeba podporovat stejné hodnoty v různých prostředích, jako je vývoj, testování a produkce.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-112">Additionally, we must support the same values across multiple environments, such as dev, testing, and production.</span></span> <span data-ttu-id="a0cf6-113">Osvědčeným postupem je ukládat je do centralizovaného úložiště konfigurace.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-113">The best practice is store them in a centralized configuration store.</span></span>

<span data-ttu-id="a0cf6-114">Cloud Azure nabízí několik skvělých možností.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-114">The Azure cloud presents several great options.</span></span>

## <a name="azure-app-configuration"></a><span data-ttu-id="a0cf6-115">Azure App Configuration</span><span class="sxs-lookup"><span data-stu-id="a0cf6-115">Azure App Configuration</span></span>

<span data-ttu-id="a0cf6-116">[Konfigurace aplikací Azure](https://docs.microsoft.com/azure/azure-app-configuration/overview) je plně spravovaná služba Azure, která ukládá nastavení konfigurace bez tajných klíčů do zabezpečeného, centralizovaného umístění.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-116">[Azure App Configuration](https://docs.microsoft.com/azure/azure-app-configuration/overview) is a fully managed Azure service that stores non-secret configuration settings in a secure, centralized location.</span></span> <span data-ttu-id="a0cf6-117">Uložené hodnoty lze sdílet mezi více službami a aplikacemi.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-117">Stored values can be shared among multiple services and applications.</span></span>

<span data-ttu-id="a0cf6-118">Služba se snadno používá a přináší několik výhod:</span><span class="sxs-lookup"><span data-stu-id="a0cf6-118">The service is simple to use and provides several benefits:</span></span>

- <span data-ttu-id="a0cf6-119">Flexibilní reprezentace klíč/hodnota a mapování</span><span class="sxs-lookup"><span data-stu-id="a0cf6-119">Flexible key/value representations and mappings</span></span>
- <span data-ttu-id="a0cf6-120">Označování pomocí popisků Azure</span><span class="sxs-lookup"><span data-stu-id="a0cf6-120">Tagging with Azure labels</span></span>
- <span data-ttu-id="a0cf6-121">Vyhrazené uživatelské rozhraní pro správu</span><span class="sxs-lookup"><span data-stu-id="a0cf6-121">Dedicated UI for management</span></span>
- <span data-ttu-id="a0cf6-122">Šifrování citlivých informací</span><span class="sxs-lookup"><span data-stu-id="a0cf6-122">Encryption of sensitive information</span></span>
- <span data-ttu-id="a0cf6-123">Dotazování a dávkové načítání</span><span class="sxs-lookup"><span data-stu-id="a0cf6-123">Querying and batch retrieval</span></span>

<span data-ttu-id="a0cf6-124">Konfigurace aplikace Azure udržuje změny nastavení klíč-hodnota po dobu sedmi dnů.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-124">Azure App Configuration maintains changes made to key-value settings for seven days.</span></span> <span data-ttu-id="a0cf6-125">Funkce snímku v čase umožňuje rekonstruovat historii nastavení a dokonce i vrácení neúspěšného nasazení.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-125">The point-in-time snapshot feature enables you to reconstruct the history of a setting and even rollback for a failed deployment.</span></span>

<span data-ttu-id="a0cf6-126">Konfigurace aplikace automaticky ukládá do mezipaměti každé nastavení, aby nedocházelo k nadměrným voláním do úložiště konfigurace.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-126">App Configuration automatically caches each setting to avoid excessive calls to the configuration store.</span></span> <span data-ttu-id="a0cf6-127">Operace aktualizace počká, dokud nevyprší hodnota nastavení uložené v mezipaměti, a to i v případě, že se změní hodnota v úložišti konfigurace.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-127">The refresh operation waits until the cached value of a setting expires to update that setting, even when its value changes in the configuration store.</span></span> <span data-ttu-id="a0cf6-128">Výchozí doba vypršení platnosti mezipaměti je 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-128">The default cache expiration time is 30 seconds.</span></span> <span data-ttu-id="a0cf6-129">Můžete přepsat čas vypršení platnosti.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-129">You can override the expiration time.</span></span>

<span data-ttu-id="a0cf6-130">Konfigurace aplikace šifruje všechny hodnoty konfigurace v cestě a v klidovém režimu.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-130">App Configuration encrypts all configuration values in transit and at rest.</span></span> <span data-ttu-id="a0cf6-131">Názvy klíčů a popisky se používají jako indexy pro načítání konfiguračních dat a nejsou zašifrované.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-131">Key names and labels are used as indexes for retrieving configuration data and aren't encrypted.</span></span>

<span data-ttu-id="a0cf6-132">I když konfigurace aplikace poskytuje zesílené zabezpečení, Azure Key Vault je stále nejlepším místem pro ukládání tajných klíčů aplikací.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-132">Although App Configuration provides hardened security, Azure Key Vault is still the best place for storing application secrets.</span></span> <span data-ttu-id="a0cf6-133">Key Vault poskytuje šifrování na úrovni hardwaru, podrobné zásady přístupu a operace správy, jako je například rotace certifikátu.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-133">Key Vault provides hardware-level encryption, granular access policies, and management operations such as certificate rotation.</span></span> <span data-ttu-id="a0cf6-134">Můžete vytvořit konfigurační hodnoty aplikace, které odkazují na tajné kódy uložené v Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-134">You can create App Configuration values that reference secrets stored in a Key Vault.</span></span>

## <a name="azure-key-vault"></a><span data-ttu-id="a0cf6-135">Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="a0cf6-135">Azure Key Vault</span></span>

<span data-ttu-id="a0cf6-136">Key Vault je spravovaná služba pro bezpečné ukládání a přístup k tajným klíčům.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-136">Key Vault is a managed service for securely storing and accessing secrets.</span></span> <span data-ttu-id="a0cf6-137">Tajný klíč je cokoli, k čemu chcete pečlivě kontrolovat přístup, třeba klíče rozhraní API, hesla nebo certifikáty.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-137">A secret is anything that you want to tightly control access to, such as API keys, passwords, or certificates.</span></span> <span data-ttu-id="a0cf6-138">Trezor je logická skupina tajných kódů.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-138">A vault is a logical group of secrets.</span></span>

<span data-ttu-id="a0cf6-139">Key Vault výrazně snižuje riziko nechtěného úniku tajných klíčů.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-139">Key Vault greatly reduces the chances that secrets may be accidentally leaked.</span></span> <span data-ttu-id="a0cf6-140">Při použití služby Key Vault už vývojáři aplikací nemusejí ukládat informace o zabezpečení ve svých aplikacích.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-140">When using Key Vault, application developers no longer need to store security information in their application.</span></span> <span data-ttu-id="a0cf6-141">Tento postup eliminuje potřebu ukládat tyto informace ve vašem kódu.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-141">This practice eliminates the need to store this information inside your code.</span></span> <span data-ttu-id="a0cf6-142">Aplikace se například může potřebovat připojit k databázi.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-142">For example, an application may need to connect to a database.</span></span> <span data-ttu-id="a0cf6-143">Místo uložení připojovacího řetězce v kódu aplikace ho můžete bezpečně uložit do Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-143">Instead of storing the connection string in the app's code, you can store it securely in Key Vault.</span></span>

<span data-ttu-id="a0cf6-144">Vaše aplikace můžou zabezpečeně přistupovat k informacím, které potřebují, pomocí identifikátorů URI.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-144">Your applications can securely access the information they need by using URIs.</span></span> <span data-ttu-id="a0cf6-145">Tyto identifikátory URI umožňují aplikacím načíst konkrétní verze tajného kódu.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-145">These URIs allow the applications to retrieve specific versions of a secret.</span></span> <span data-ttu-id="a0cf6-146">Není nutné psát vlastní kód pro ochranu jakýchkoli tajných informací uložených v Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-146">There's no need to write custom code to protect any of the secret information stored in Key Vault.</span></span>

<span data-ttu-id="a0cf6-147">Přístup k Key Vault vyžaduje správné ověření volajícího a autorizaci.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-147">Access to Key Vault requires proper caller authentication and authorization.</span></span> <span data-ttu-id="a0cf6-148">Obvykle každá mikroslužba nativního cloudu používá kombinaci ClientId/ClientSecret.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-148">Typically, each cloud-native microservice uses a ClientId/ClientSecret combination.</span></span> <span data-ttu-id="a0cf6-149">Je důležité zachovat tyto přihlašovací údaje mimo správu zdrojového kódu.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-149">It's important to keep these credentials outside source control.</span></span> <span data-ttu-id="a0cf6-150">Osvědčeným postupem je nastavení v prostředí aplikace.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-150">A best practice is to set them in  the application's environment.</span></span> <span data-ttu-id="a0cf6-151">Přímý přístup k Key Vault z AKS lze dosáhnout pomocí [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span><span class="sxs-lookup"><span data-stu-id="a0cf6-151">Direct access to Key Vault from AKS can be achieved using [Key Vault FlexVolume](https://github.com/Azure/kubernetes-keyvault-flexvol).</span></span>

## <a name="configuration-in-eshop"></a><span data-ttu-id="a0cf6-152">Konfigurace v eShop</span><span class="sxs-lookup"><span data-stu-id="a0cf6-152">Configuration in eShop</span></span>

<span data-ttu-id="a0cf6-153">Aplikace eShopOnContainers zahrnuje místní soubory nastavení aplikace s každou mikroslužbou.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-153">The eShopOnContainers application includes local application settings files with each microservice.</span></span> <span data-ttu-id="a0cf6-154">Tyto soubory jsou zkontrolovány do správy zdrojového kódu, ale nezahrnují provozní tajemství, jako jsou připojovací řetězce nebo klíče rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-154">These files are checked into source control, but don't include production secrets such as connection strings or API keys.</span></span> <span data-ttu-id="a0cf6-155">V produkčním prostředí může být individuální nastavení přepsáno pomocí proměnných prostředí pro jednotlivé služby.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-155">In production, individual settings may be overwritten with per-service environment variables.</span></span> <span data-ttu-id="a0cf6-156">Vkládání tajných kódů v proměnných prostředí je běžné postupy pro hostované aplikace, ale neposkytuje centrální úložiště konfigurace.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-156">Injecting secrets in environment variables is a common practice for hosted applications, but doesn't provide a central configuration store.</span></span> <span data-ttu-id="a0cf6-157">V rámci podpory centralizované správy nastavení konfigurace každá mikroslužba obsahuje nastavení, které se přepíná mezi použitím místních nastavení nebo nastavení Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="a0cf6-157">To support centralized management of configuration settings, each microservice includes a setting to toggle between its use of local settings or Azure Key Vault settings.</span></span>

## <a name="references"></a><span data-ttu-id="a0cf6-158">Odkazy</span><span class="sxs-lookup"><span data-stu-id="a0cf6-158">References</span></span>

- [<span data-ttu-id="a0cf6-159">Architektura eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="a0cf6-159">The eShopOnContainers Architecture</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Architecture)
- [<span data-ttu-id="a0cf6-160">Orchestrace mikroslužeb a vícekontejnerových aplikací pro vysokou škálovatelnost a dostupnost</span><span class="sxs-lookup"><span data-stu-id="a0cf6-160">Orchestrating microservices and multi-container applications for high scalability and availability</span></span>](https://docs.microsoft.com/dotnet/architecture/microservices/architect-microservice-container-applications/scalable-available-multi-container-microservice-applications)
- [<span data-ttu-id="a0cf6-161">Azure API Management</span><span class="sxs-lookup"><span data-stu-id="a0cf6-161">Azure API Management</span></span>](https://docs.microsoft.com/azure/api-management/api-management-key-concepts)
- [<span data-ttu-id="a0cf6-162">Přehled Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="a0cf6-162">Azure SQL Database Overview</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-technical-overview)
- [<span data-ttu-id="a0cf6-163">Azure Cache for Redis</span><span class="sxs-lookup"><span data-stu-id="a0cf6-163">Azure Cache for Redis</span></span>](https://azure.microsoft.com/services/cache/)
- [<span data-ttu-id="a0cf6-164">Rozhraní API služby Azure Cosmos DB pro MongoDB</span><span class="sxs-lookup"><span data-stu-id="a0cf6-164">Azure Cosmos DB's API for MongoDB</span></span>](https://docs.microsoft.com/azure/cosmos-db/mongodb-introduction)
- [<span data-ttu-id="a0cf6-165">Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="a0cf6-165">Azure Service Bus</span></span>](https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview)
- [<span data-ttu-id="a0cf6-166">Přehled služby Azure Monitor</span><span class="sxs-lookup"><span data-stu-id="a0cf6-166">Azure Monitor overview</span></span>](https://docs.microsoft.com/azure/azure-monitor/overview)
- <span data-ttu-id="a0cf6-167">[eShopOnContainers: Vytvoření clusteru Kubernetes v AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span><span class="sxs-lookup"><span data-stu-id="a0cf6-167">[eShopOnContainers: Create Kubernetes cluster in AKS](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Deploy-to-Azure-Kubernetes-Service-(AKS)#create-kubernetes-cluster-in-aks)</span></span>
- [<span data-ttu-id="a0cf6-168">eShopOnContainers: Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="a0cf6-168">eShopOnContainers: Azure Dev Spaces</span></span>](https://github.com/dotnet-architecture/eShopOnContainers/wiki/Azure-Dev-Spaces)
- [<span data-ttu-id="a0cf6-169">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="a0cf6-169">Azure Dev Spaces</span></span>](https://docs.microsoft.com/azure/dev-spaces/about)

>[!div class="step-by-step"]
><span data-ttu-id="a0cf6-170">[Předchozí](deploy-eshoponcontainers-azure.md)
>[Další](scale-applications.md)</span><span class="sxs-lookup"><span data-stu-id="a0cf6-170">[Previous](deploy-eshoponcontainers-azure.md)
[Next](scale-applications.md)</span></span>
