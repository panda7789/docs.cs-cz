---
title: Odolnost platformy Azure
description: Architekt cloudových nativních aplikací .NET pro Azure | Odolnost cloudové infrastruktury s Azure
ms.date: 06/30/2019
ms.openlocfilehash: 7f148588be97fa6bf8a055f5f5bed8e23908277f
ms.sourcegitcommit: 56f1d1203d0075a461a10a301459d3aa452f4f47
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/24/2019
ms.locfileid: "71214199"
---
# <a name="azure-platform-resiliency"></a><span data-ttu-id="afb8e-103">Odolnost platformy Azure</span><span class="sxs-lookup"><span data-stu-id="afb8e-103">Azure platform resiliency</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="afb8e-104">Sestavování spolehlivé aplikace v cloudu se liší od tradičního vývoje místních aplikací.</span><span class="sxs-lookup"><span data-stu-id="afb8e-104">Building a reliable application in the cloud is different from traditional on-premises application development.</span></span> <span data-ttu-id="afb8e-105">I když jste si v minulosti koupili vyšší kapacitu hardwaru pro horizontální navýšení kapacity, v cloudovém prostředí, které nakonfigurujete. Místo toho, aby se zabránilo chybám, je cílem minimalizovat jejich účinky a zachovat stabilní systém.</span><span class="sxs-lookup"><span data-stu-id="afb8e-105">While historically you purchased higher-end hardware to scale up, in a cloud environment you scale out. Instead of trying to prevent failures, the goal is to minimize their effects and keep the system stable.</span></span>

<span data-ttu-id="afb8e-106">V takovém případě spolehlivé cloudové aplikace zobrazují různé charakteristiky:</span><span class="sxs-lookup"><span data-stu-id="afb8e-106">That said, reliable cloud applications display distinct characteristics:</span></span>

- <span data-ttu-id="afb8e-107">Jsou odolné proti chybám proti problémům a fungují i nadále.</span><span class="sxs-lookup"><span data-stu-id="afb8e-107">They're resilient, recover gracefully from problems, and continue to function.</span></span>
- <span data-ttu-id="afb8e-108">Jsou vysoce dostupné (HA) a běží tak, jak jsou navržené v dobrém stavu bez významného výpadku.</span><span class="sxs-lookup"><span data-stu-id="afb8e-108">They're highly available (HA) and run as designed in a healthy state with no significant downtime.</span></span>

<span data-ttu-id="afb8e-109">Porozumět tomu, jak tyto charakteristiky vzájemně spolupracují a jak ovlivňují náklady – je nezbytné pro vytvoření spolehlivé cloudové nativní aplikace.</span><span class="sxs-lookup"><span data-stu-id="afb8e-109">Understanding how these characteristics work together - and how they affect cost - is essential to building a reliable cloud-native application.</span></span> <span data-ttu-id="afb8e-110">Dál se podíváme na způsoby, jak můžete vytvořit odolnost a dostupnost v cloudových nativních aplikacích využívajících funkce z cloudu Azure.</span><span class="sxs-lookup"><span data-stu-id="afb8e-110">We'll next look at ways that you can build resiliency and availability into your cloud-native applications leveraging features from the Azure cloud.</span></span>

## <a name="design-with-redundancy"></a><span data-ttu-id="afb8e-111">Návrh s redundancí</span><span class="sxs-lookup"><span data-stu-id="afb8e-111">Design with redundancy</span></span>

<span data-ttu-id="afb8e-112">Selhání se liší v rozsahu dopadu.</span><span class="sxs-lookup"><span data-stu-id="afb8e-112">Failures vary in scope of impact.</span></span> <span data-ttu-id="afb8e-113">Selhání hardwaru, jako je například selhání disku, může ovlivnit jeden uzel v clusteru.</span><span class="sxs-lookup"><span data-stu-id="afb8e-113">A hardware failure, such as a failed disk, can affect a single node in a cluster.</span></span> <span data-ttu-id="afb8e-114">Neúspěšný síťový přepínač může mít vliv na celý stojan serveru.</span><span class="sxs-lookup"><span data-stu-id="afb8e-114">A failed network switch could affect an entire server rack.</span></span> <span data-ttu-id="afb8e-115">Méně běžné chyby, jako je například výpadek napájení, můžou rušit celé datové centrum.</span><span class="sxs-lookup"><span data-stu-id="afb8e-115">Less common failures, such as loss of power, could disrupt a whole datacenter.</span></span> <span data-ttu-id="afb8e-116">Jenom zřídka, celá oblast bude nedostupná.</span><span class="sxs-lookup"><span data-stu-id="afb8e-116">Rarely, an entire region becomes unavailable.</span></span>

<span data-ttu-id="afb8e-117">[Redundance](https://docs.microsoft.com/azure/architecture/guide/design-principles/redundancy) je jedním ze způsobů, jak zajistit odolnost aplikace.</span><span class="sxs-lookup"><span data-stu-id="afb8e-117">[Redundancy](https://docs.microsoft.com/azure/architecture/guide/design-principles/redundancy) is one way to provide application resilience.</span></span> <span data-ttu-id="afb8e-118">Přesná úroveň redundance závisí na vašich obchodních požadavcích a ovlivní jak náklady, tak i složitost vašeho systému.</span><span class="sxs-lookup"><span data-stu-id="afb8e-118">The exact level of redundancy needed depends on your business requirements and will affect both cost and complexity of your system.</span></span> <span data-ttu-id="afb8e-119">Nasazení ve více oblastech je například dražší a složitější pro správu než nasazení v jedné oblasti.</span><span class="sxs-lookup"><span data-stu-id="afb8e-119">For example, a multi-region deployment is more expensive and more complex to manage than a single-region deployment.</span></span> <span data-ttu-id="afb8e-120">Budete potřebovat provozní postupy pro správu převzetí služeb při selhání a navrácení služeb po obnovení.</span><span class="sxs-lookup"><span data-stu-id="afb8e-120">You'll need operational procedures to manage failover and failback.</span></span> <span data-ttu-id="afb8e-121">Dodatečné náklady a složitost můžou být odůvodněné u některých obchodních scénářů a ne u jiných.</span><span class="sxs-lookup"><span data-stu-id="afb8e-121">The additional cost and complexity might be justified for some business scenarios and not others.</span></span>

<span data-ttu-id="afb8e-122">Chcete-li architekt redundanci, je třeba určit kritické cesty v aplikaci a pak zjistit, jestli je v každé pozici v cestě redundance?</span><span class="sxs-lookup"><span data-stu-id="afb8e-122">To architect redundancy, you need to identify the critical paths in your application, and then determine if there's redundancy at each point in the path?</span></span> <span data-ttu-id="afb8e-123">Pokud by se podsystém nezdařil, aplikace převezme služby něco jiného?</span><span class="sxs-lookup"><span data-stu-id="afb8e-123">If a subsystem should fail, will the application fail over to something else?</span></span> <span data-ttu-id="afb8e-124">Nakonec budete potřebovat jasné porozumění funkcím integrovaným do cloudové platformy Azure, které můžete využít ke splnění požadavků na redundanci.</span><span class="sxs-lookup"><span data-stu-id="afb8e-124">Finally, you need a clear understanding of those features built into the Azure cloud platform that you can leverage to meet your redundancy requirements.</span></span> <span data-ttu-id="afb8e-125">Tady jsou doporučení pro redundanci architektury:</span><span class="sxs-lookup"><span data-stu-id="afb8e-125">Here are recommendations for architecting redundancy:</span></span>

- <span data-ttu-id="afb8e-126">*Nasaďte více instancí služeb.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-126">*Deploy multiple instances of services.*</span></span> <span data-ttu-id="afb8e-127">Pokud vaše aplikace závisí na jedné instanci služby, vytvoří se v jednom bodě selhání.</span><span class="sxs-lookup"><span data-stu-id="afb8e-127">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="afb8e-128">Zřizování více instancí vylepšuje odolnost a škálovatelnost.</span><span class="sxs-lookup"><span data-stu-id="afb8e-128">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="afb8e-129">Při hostování ve službě Azure Kubernetes můžete deklarativně nakonfigurovat redundantní instance (sady replik) v souboru manifestu Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="afb8e-129">When hosting in Azure Kubernetes Service, you can declaratively configure redundant instances (replica sets) in the Kubernetes manifest file.</span></span> <span data-ttu-id="afb8e-130">Hodnotu počtu replik lze spravovat programově, na portálu nebo prostřednictvím funkcí automatického škálování, které budou popsány později.</span><span class="sxs-lookup"><span data-stu-id="afb8e-130">The replica count value can be managed programmatically, in the portal or through autoscaling features, which will be discussed later on.</span></span>

- <span data-ttu-id="afb8e-131">*Využití nástroje pro vyrovnávání zatížení.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-131">*Leveraging a load balancer.*</span></span> <span data-ttu-id="afb8e-132">Vyrovnávání zatížení distribuuje požadavky vaší aplikace na funkční instance služby a automaticky odebere chybné instance z rotace.</span><span class="sxs-lookup"><span data-stu-id="afb8e-132">Load-balancing distributes your application's requests to healthy service instances and automatically removes unhealthy instances from rotation.</span></span> <span data-ttu-id="afb8e-133">Při nasazování do Kubernetes je možné vyrovnávání zatížení zadat v souboru manifestu Kubernetes v části služby.</span><span class="sxs-lookup"><span data-stu-id="afb8e-133">When deploying to Kubernetes, load balancing can be specified in the Kubernetes manifest file in the Services section.</span></span>

- <span data-ttu-id="afb8e-134">*Plánování nasazení ve více oblastech.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-134">*Plan for multiregion deployment.*</span></span> <span data-ttu-id="afb8e-135">Pokud je vaše aplikace nasazená v jedné oblasti a tato oblast nebude k dispozici, bude vaše aplikace také nedostupná.</span><span class="sxs-lookup"><span data-stu-id="afb8e-135">If your application is deployed to a single region, and the region becomes unavailable, your application will also become unavailable.</span></span> <span data-ttu-id="afb8e-136">To může být nepřijatelné pod podmínkami smluv o úrovni služeb vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="afb8e-136">This may be unacceptable under the terms of your application's service level agreements.</span></span> <span data-ttu-id="afb8e-137">Místo toho zvažte nasazení aplikace a jejích služeb napříč různými oblastmi.</span><span class="sxs-lookup"><span data-stu-id="afb8e-137">Instead, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="afb8e-138">Například cluster Azure Kubernetes Service (AKS) je nasazený do jedné oblasti.</span><span class="sxs-lookup"><span data-stu-id="afb8e-138">For example, an Azure Kubernetes Service (AKS) cluster is deployed to a single region.</span></span> <span data-ttu-id="afb8e-139">Pokud chcete systém ochránit před místním selháním, můžete nasadit aplikaci do několika clusterů AKS napříč různými oblastmi a pomocí funkce [spárované oblasti](https://buildazure.com/2017/01/06/azure-region-pairs-explained/) koordinovat aktualizace platforem a nastavit prioritu úsilí při obnovení.</span><span class="sxs-lookup"><span data-stu-id="afb8e-139">To protect your system from a regional failure, you might deploy your application to multiple AKS clusters across different regions and use the [Paired Regions](https://buildazure.com/2017/01/06/azure-region-pairs-explained/) feature to coordinate platform updates and prioritize recovery efforts.</span></span>

- <span data-ttu-id="afb8e-140">*Povolte [geografickou replikaci](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication).*</span><span class="sxs-lookup"><span data-stu-id="afb8e-140">*Enable [geo-replication](https://docs.microsoft.com/azure/sql-database/sql-database-active-geo-replication).*</span></span> <span data-ttu-id="afb8e-141">Geografická replikace pro služby, jako je Azure SQL Database a Cosmos DB, vytvoří sekundární repliky vašich dat napříč několika oblastmi.</span><span class="sxs-lookup"><span data-stu-id="afb8e-141">Geo-replication for services such as Azure SQL Database and Cosmos DB will create secondary replicas of your data across multiple regions.</span></span> <span data-ttu-id="afb8e-142">I když budou obě služby automaticky replikovat data ve stejné oblasti, geografická replikace vás chrání před oblastním výpadkem tím, že vám umožní převzít služby při selhání do sekundární oblasti.</span><span class="sxs-lookup"><span data-stu-id="afb8e-142">While both services will automatically replicate data within the same region, geo-replication protects you against a regional outage by enabling you to fail over to a secondary region.</span></span> <span data-ttu-id="afb8e-143">Dalším osvědčeným postupem pro geografickou replikaci na středech pro ukládání imagí kontejneru.</span><span class="sxs-lookup"><span data-stu-id="afb8e-143">Another best practice for geo-replication centers around storing container images.</span></span> <span data-ttu-id="afb8e-144">Pokud chcete nasadit službu v AKS, musíte image Uložit a načíst z úložiště.</span><span class="sxs-lookup"><span data-stu-id="afb8e-144">To deploy a service in AKS, you need to store and pull the image from a repository.</span></span> <span data-ttu-id="afb8e-145">Azure Container Registry se integruje s AKS a může bezpečně ukládat image kontejnerů.</span><span class="sxs-lookup"><span data-stu-id="afb8e-145">Azure Container Registry integrates with AKS and can securely store container images.</span></span> <span data-ttu-id="afb8e-146">Pro zlepšení výkonu a dostupnosti zvažte geografickou replikaci imagí do registru v každé oblasti, kde máte cluster AKS.</span><span class="sxs-lookup"><span data-stu-id="afb8e-146">To improve performance and availability, consider geo-replicating your images to a registry in each region where you have an AKS cluster.</span></span> <span data-ttu-id="afb8e-147">Každý cluster AKS pak vyžádá image kontejneru z místního registru kontejneru ve své oblasti, jak je znázorněno na obrázku 6-6:</span><span class="sxs-lookup"><span data-stu-id="afb8e-147">Each AKS cluster then pulls container images from the local container registry in its region as shown in Figure 6-6:</span></span>

![Replikované prostředky napříč oblastmi](./media/replicated-resources.png)

<span data-ttu-id="afb8e-149">**Obrázek 6-6**.</span><span class="sxs-lookup"><span data-stu-id="afb8e-149">**Figure 6-6**.</span></span> <span data-ttu-id="afb8e-150">Replikované prostředky napříč oblastmi</span><span class="sxs-lookup"><span data-stu-id="afb8e-150">Replicated resources across regions</span></span>

- <span data-ttu-id="afb8e-151">*Implementujte Nástroj pro vyrovnávání zatížení provozu DNS.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-151">*Implement a DNS traffic load balancer.*</span></span> <span data-ttu-id="afb8e-152">[Azure Traffic Manager](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) poskytuje vysokou dostupnost pro kritické aplikace vyrovnáváním zatížení na úrovni DNS.</span><span class="sxs-lookup"><span data-stu-id="afb8e-152">[Azure Traffic Manager](https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview) provides high-availability for critical applications by load-balancing at the DNS level.</span></span> <span data-ttu-id="afb8e-153">Může směrovat provoz do různých oblastí na základě geografické oblasti, doby odezvy clusteru a dokonce i stavu koncového bodu aplikace.</span><span class="sxs-lookup"><span data-stu-id="afb8e-153">It can route traffic to different regions based on geography, cluster response time, and even application endpoint health.</span></span> <span data-ttu-id="afb8e-154">Azure Traffic Manager může například směrovat zákazníky do nejbližšího clusteru AKS a instance aplikace.</span><span class="sxs-lookup"><span data-stu-id="afb8e-154">For example, Azure Traffic Manager can direct customers to the closest AKS cluster and application instance.</span></span> <span data-ttu-id="afb8e-155">Pokud máte více clusterů AKS v různých oblastech, použijte Traffic Manager k řízení způsobu, jakým přenos toků do aplikací spuštěných v jednotlivých clusterech.</span><span class="sxs-lookup"><span data-stu-id="afb8e-155">If you have multiple AKS clusters in different regions, use Traffic Manager to control how traffic flows to the applications that run in each cluster.</span></span> <span data-ttu-id="afb8e-156">Obrázek 6-7 ukazuje tento scénář.</span><span class="sxs-lookup"><span data-stu-id="afb8e-156">Figure 6-7 shows this scenario.</span></span>

![AKS a Azure Traffic Manager](./media/aks-traffic-manager.png)

<span data-ttu-id="afb8e-158">**Obrázek 6-7**.</span><span class="sxs-lookup"><span data-stu-id="afb8e-158">**Figure 6-7**.</span></span> <span data-ttu-id="afb8e-159">AKS a Azure Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="afb8e-159">AKS and Azure Traffic Manager</span></span>

## <a name="design-for-scalability"></a><span data-ttu-id="afb8e-160">Návrh pro škálovatelnost</span><span class="sxs-lookup"><span data-stu-id="afb8e-160">Design for scalability</span></span>

<span data-ttu-id="afb8e-161">Cloud Thrives při škálování.</span><span class="sxs-lookup"><span data-stu-id="afb8e-161">The cloud thrives on scaling.</span></span> <span data-ttu-id="afb8e-162">Schopnost zvýšit nebo snížit systémové prostředky na zvýšení nebo snížení zátěže systému je klíčovým principemem cloudu Azure.</span><span class="sxs-lookup"><span data-stu-id="afb8e-162">The ability to increase/decrease system resources to address increasing/decreasing system load is a key tenet of the Azure cloud.</span></span> <span data-ttu-id="afb8e-163">Abyste ale mohli efektivně škálovat aplikaci, potřebujete pochopit funkce škálování jednotlivých služeb Azure, které zahrnete do své aplikace.</span><span class="sxs-lookup"><span data-stu-id="afb8e-163">But, to effectively scale an application, you need an understanding of the scaling features of each Azure service that you include in your application.</span></span>  <span data-ttu-id="afb8e-164">Tady jsou doporučení pro efektivní implementaci škálování v systému.</span><span class="sxs-lookup"><span data-stu-id="afb8e-164">Here are recommendations for effectively implementing scaling in your system.</span></span>

- <span data-ttu-id="afb8e-165">*Návrh pro škálování.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-165">*Design for scaling.*</span></span> <span data-ttu-id="afb8e-166">Aplikace musí být navržena pro škálování.</span><span class="sxs-lookup"><span data-stu-id="afb8e-166">An application must be designed for scaling.</span></span> <span data-ttu-id="afb8e-167">Aby bylo možné začít, služby by měly být bezstavové, aby bylo možné směrovat požadavky do libovolné instance.</span><span class="sxs-lookup"><span data-stu-id="afb8e-167">To start, services should be stateless so that requests can be routed to any instance.</span></span> <span data-ttu-id="afb8e-168">Bezstavové služby také znamená, že přidání nebo odebrání instance nemá nepříznivý vliv na aktuální uživatele.</span><span class="sxs-lookup"><span data-stu-id="afb8e-168">Having stateless services also means that adding or removing an instance doesn't adversely impact current users.</span></span>

- <span data-ttu-id="afb8e-169">*Rozdělit úlohy na oddíly*.</span><span class="sxs-lookup"><span data-stu-id="afb8e-169">*Partition workloads*.</span></span> <span data-ttu-id="afb8e-170">Rozkládání domén na nezávislé, samostatné mikroslužby umožňují škálovat každou službu nezávisle na ostatních.</span><span class="sxs-lookup"><span data-stu-id="afb8e-170">Decomposing domains into independent, self-contained microservices enable each service to scale independently of others.</span></span> <span data-ttu-id="afb8e-171">Služby obvykle budou mít různé potřeby a požadavky na škálovatelnost.</span><span class="sxs-lookup"><span data-stu-id="afb8e-171">Typically, services will have different scalability needs and requirements.</span></span> <span data-ttu-id="afb8e-172">Dělení vám umožní škálovat jenom to, co je potřeba škálovat, aniž byste museli škálovat celou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="afb8e-172">Partitioning enables you to scale only what needs to be scaled without the unnecessary cost of scaling an entire application.</span></span>

- <span data-ttu-id="afb8e-173">*Upřednostnit škálování na více instancí.* Cloudové aplikace přikládají horizontální navýšení kapacity prostředků na rozdíl od škálování.</span><span class="sxs-lookup"><span data-stu-id="afb8e-173">*Favor scale-out.* Cloud-based applications favor scaling out resources as opposed to scaling up.</span></span> <span data-ttu-id="afb8e-174">Horizontální škálování (označuje se také jako horizontální škálování) zahrnuje přidání dalších prostředků služby do stávajícího systému, aby bylo možné splnit a sdílet požadovanou úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="afb8e-174">Scaling out (also known as horizontal scaling) involves adding more service resources to an existing system to meet and share a desired level of performance.</span></span> <span data-ttu-id="afb8e-175">Vertikální škálování (označuje se také jako vertikální škálování) zahrnuje nahrazení existujících prostředků výkonnějším hardwarem (více jader disku, paměti a zpracování).</span><span class="sxs-lookup"><span data-stu-id="afb8e-175">Scaling up (also known as vertical scaling) involves replacing existing resources with more powerful hardware (more disk, memory, and processing cores).</span></span> <span data-ttu-id="afb8e-176">Horizontální navýšení kapacity se dá vyvolávat automaticky funkcemi automatického škálování, které jsou dostupné v některých cloudových prostředcích Azure.</span><span class="sxs-lookup"><span data-stu-id="afb8e-176">Scaling out can be invoked automatically with the autoscaling features available in some Azure cloud resources.</span></span> <span data-ttu-id="afb8e-177">Horizontální navýšení kapacity mezi více prostředky také zvyšuje redundanci celého systému.</span><span class="sxs-lookup"><span data-stu-id="afb8e-177">Scaling out across multiple resources also adds redundancy to the overall system.</span></span> <span data-ttu-id="afb8e-178">Nakonec je škálování jednoho prostředku obvykle dražší než horizontální navýšení kapacity mezi mnoho menších prostředků.</span><span class="sxs-lookup"><span data-stu-id="afb8e-178">Finally scaling up a single resource is typically more expensive than scaling out across many smaller resources.</span></span> <span data-ttu-id="afb8e-179">Obrázek 6-8 ukazuje dva přístupy:</span><span class="sxs-lookup"><span data-stu-id="afb8e-179">Figure 6-8 shows the two approaches:</span></span>

![Horizontální navýšení kapacity oproti škálování](./media/scale-up-scale-out.png)

<span data-ttu-id="afb8e-181">**Obrázek 6-8.**</span><span class="sxs-lookup"><span data-stu-id="afb8e-181">**Figure 6-8.**</span></span> <span data-ttu-id="afb8e-182">Horizontální navýšení kapacity oproti škálování</span><span class="sxs-lookup"><span data-stu-id="afb8e-182">Scale up versus scale out</span></span>

- <span data-ttu-id="afb8e-183">*Škálujte proporcionálně.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-183">*Scale proportionally.*</span></span> <span data-ttu-id="afb8e-184">Při škálování služby Vezměte v úvahu *sady prostředků*.</span><span class="sxs-lookup"><span data-stu-id="afb8e-184">When scaling a service, think in terms of *resource sets*.</span></span> <span data-ttu-id="afb8e-185">Pokud byste chtěli významně škálovat konkrétní službu, což by mělo mít vliv na úložiště dat v back-endu, mezipaměti a závislé služby?</span><span class="sxs-lookup"><span data-stu-id="afb8e-185">If you were to dramatically scale out a specific service, what impact would that have on back-end data stores, caches and dependent services?</span></span> <span data-ttu-id="afb8e-186">Některé prostředky, jako Cosmos DB, se můžou škálovat proporcionálně, zatímco spousta dalších ne.</span><span class="sxs-lookup"><span data-stu-id="afb8e-186">Some resources such as Cosmos DB can scale out proportionally, while many others can't.</span></span> <span data-ttu-id="afb8e-187">Chcete zajistit, aby se prostředky nezměnily na místo, kde dojde k vyčerpání dalších přidružených prostředků.</span><span class="sxs-lookup"><span data-stu-id="afb8e-187">You want to ensure that you don't scale out a resource to a point where it will exhaust other associated resources.</span></span>

- <span data-ttu-id="afb8e-188">*Vyhněte se spřažení.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-188">*Avoid affinity.*</span></span> <span data-ttu-id="afb8e-189">Osvědčeným postupem je zajistit, aby uzel nevyžadoval místní spřažení, což se často označuje jako *relace v relaci Sticky*.</span><span class="sxs-lookup"><span data-stu-id="afb8e-189">A best practice is to ensure a node doesn't require local affinity, often referred to as a *sticky session*.</span></span> <span data-ttu-id="afb8e-190">Požadavek by měl být schopný směrovat do jakékoli instance.</span><span class="sxs-lookup"><span data-stu-id="afb8e-190">A request should be able to route to any instance.</span></span> <span data-ttu-id="afb8e-191">Pokud potřebujete zachovat stav, měl by se Uložit do distribuované mezipaměti, jako je například [Azure Redis Cache](https://azure.microsoft.com/services/cache/).</span><span class="sxs-lookup"><span data-stu-id="afb8e-191">If you need to persist state, it should be saved to a distributed cache, such as [Azure Redis cache](https://azure.microsoft.com/services/cache/).</span></span>

- <span data-ttu-id="afb8e-192">*Využijte výhod funkcí automatického škálování platformy.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-192">*Take advantage of platform autoscaling features.*</span></span> <span data-ttu-id="afb8e-193">Používejte integrované funkce automatického škálování, kdykoli je to možné, ale nemusíte používat vlastní mechanismy nebo mechanizmy třetích stran.</span><span class="sxs-lookup"><span data-stu-id="afb8e-193">Use built-in autoscaling features whenever possible, rather than custom or third-party mechanisms.</span></span> <span data-ttu-id="afb8e-194">Pokud je to možné, použijte plánovaná pravidla škálování k zajištění dostupnosti prostředků bez prodlevy při spuštění, ale podle potřeby přidejte do pravidel reaktivní automatické škálování, abyste se mohli vypořádat s neočekávanými změnami v poptávce.</span><span class="sxs-lookup"><span data-stu-id="afb8e-194">Where possible, use scheduled scaling rules to ensure that resources are available without a startup delay, but add reactive autoscaling to the rules as appropriate, to cope with unexpected changes in demand.</span></span> <span data-ttu-id="afb8e-195">Další informace najdete v tématu [pokyny](https://docs.microsoft.com/azure/architecture/best-practices/auto-scaling)k automatickému škálování.</span><span class="sxs-lookup"><span data-stu-id="afb8e-195">For more information, see [Autoscaling guidance](https://docs.microsoft.com/azure/architecture/best-practices/auto-scaling).</span></span>

- <span data-ttu-id="afb8e-196">*Horizontální navýšení kapacity*</span><span class="sxs-lookup"><span data-stu-id="afb8e-196">*Scale-up aggressively.*</span></span> <span data-ttu-id="afb8e-197">Konečným postupem je horizontální navýšení kapacity, aby bylo možné rychle vyhovět okamžitým špičkám v provozu bez ztráty podnikání.</span><span class="sxs-lookup"><span data-stu-id="afb8e-197">A final practice would be to scale up aggressively so that you can quickly meet immediate spikes in traffic without losing business.</span></span> <span data-ttu-id="afb8e-198">A potom Škálujte dolů (to znamená odebrání nepotřebných prostředků) uvážlivě, aby se zajistila stabilita systému.</span><span class="sxs-lookup"><span data-stu-id="afb8e-198">And, then scale down (that is, remove unneeded resources) conservatively to keep the system stable.</span></span> <span data-ttu-id="afb8e-199">Jednoduchým způsobem, jak to provést, je nastavit dobu chladnutí, což je čas, který se má čekat mezi operacemi škálování, na pět minut při přidávání prostředků a až 15 minut pro odebrání instancí.</span><span class="sxs-lookup"><span data-stu-id="afb8e-199">A simple way to implement this is to set the cool down period, which is the time to wait between scaling operations, to five minutes for adding resources and up to 15 minutes for removing instances.</span></span>

## <a name="built-in-retry-in-services"></a><span data-ttu-id="afb8e-200">Integrované opakování ve službách</span><span class="sxs-lookup"><span data-stu-id="afb8e-200">Built-in retry in services</span></span>

<span data-ttu-id="afb8e-201">Doporučujeme, abyste provedli osvědčené postupy implementace programových opakovaných operací v předchozí části.</span><span class="sxs-lookup"><span data-stu-id="afb8e-201">We encouraged the best practice of implementing programmatic retry operations in an earlier section.</span></span> <span data-ttu-id="afb8e-202">Mějte na paměti, že mnoho služeb Azure a jejich odpovídajících klientských SDK zahrnuje i mechanismy opakování.</span><span class="sxs-lookup"><span data-stu-id="afb8e-202">Keep in mind that many Azure services and their corresponding client SDKs also include retry mechanisms.</span></span> <span data-ttu-id="afb8e-203">Následující seznam shrnuje funkce opakování v řadě služeb Azure, které jsou popsány v této příručce:</span><span class="sxs-lookup"><span data-stu-id="afb8e-203">The following list summarizes retry features in the many of the Azure services that are discussed in this book:</span></span>

- <span data-ttu-id="afb8e-204">*Azure Cosmos DB.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-204">*Azure Cosmos DB.*</span></span> <span data-ttu-id="afb8e-205"><xref:Microsoft.Azure.Documents.Client.DocumentClient> Třída z rozhraní API klienta automaticky odřadí neúspěšné pokusy.</span><span class="sxs-lookup"><span data-stu-id="afb8e-205">The <xref:Microsoft.Azure.Documents.Client.DocumentClient> class from the client API automatically retires failed attempts.</span></span> <span data-ttu-id="afb8e-206">Počet opakovaných pokusů a maximální doba čekání je konfigurovatelná.</span><span class="sxs-lookup"><span data-stu-id="afb8e-206">The number of retries and maximum wait time are configurable.</span></span> <span data-ttu-id="afb8e-207">Výjimky vyvolané klientským rozhraním API jsou požadavky, které překračují zásady opakování nebo nepřechodné chyby.</span><span class="sxs-lookup"><span data-stu-id="afb8e-207">Exceptions thrown by the client API are either requests that exceed the retry policy or non-transient errors.</span></span>

- <span data-ttu-id="afb8e-208">*Azure Redis Cache.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-208">*Azure Redis Cache.*</span></span> <span data-ttu-id="afb8e-209">Klient Redis StackExchange používá třídu Správce připojení, která zahrnuje opakování při neúspěšných pokusech.</span><span class="sxs-lookup"><span data-stu-id="afb8e-209">The Redis StackExchange client uses a connection manager class that includes retries on failed attempts.</span></span> <span data-ttu-id="afb8e-210">Počet opakovaných pokusů, konkrétní zásady opakování a doba čekání jsou konfigurovatelné.</span><span class="sxs-lookup"><span data-stu-id="afb8e-210">The number of retries, specific retry policy and wait time are all configurable.</span></span>

- <span data-ttu-id="afb8e-211">*Azure Service Bus.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-211">*Azure Service Bus.*</span></span> <span data-ttu-id="afb8e-212">Klient Service Bus zpřístupňuje [třídu RetryPolicy](xref:Microsoft.ServiceBus.RetryPolicy) , která může být nakonfigurována s Back-off, počtem opakování a <xref:Microsoft.ServiceBus.RetryExponential.TerminationTimeBuffer>, což určuje maximální dobu, kterou může operace trvat.</span><span class="sxs-lookup"><span data-stu-id="afb8e-212">The Service Bus client exposes a [RetryPolicy class](xref:Microsoft.ServiceBus.RetryPolicy) that can be configured with a back-off interval, retry count, and <xref:Microsoft.ServiceBus.RetryExponential.TerminationTimeBuffer>, which specifies the maximum time an operation can take.</span></span> <span data-ttu-id="afb8e-213">Výchozí zásada má devět maximálních pokusů o opakování s omezení rychlosti obdobím 30 sekund mezi pokusy.</span><span class="sxs-lookup"><span data-stu-id="afb8e-213">The default policy is nine maximum retry attempts with a 30-second backoff period between attempts.</span></span>

- <span data-ttu-id="afb8e-214">*Azure SQL Database.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-214">*Azure SQL Database.*</span></span> <span data-ttu-id="afb8e-215">Při použití knihovny [Entity Framework Core](https://docs.microsoft.com/ef/core/miscellaneous/connection-resiliency) je k dispozici podpora opakování.</span><span class="sxs-lookup"><span data-stu-id="afb8e-215">Retry support is provided when using the [Entity Framework Core](https://docs.microsoft.com/ef/core/miscellaneous/connection-resiliency) library.</span></span>

- <span data-ttu-id="afb8e-216">*Azure Storage.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-216">*Azure Storage.*</span></span> <span data-ttu-id="afb8e-217">Klientská knihovna pro úložiště podporuje operace opakování.</span><span class="sxs-lookup"><span data-stu-id="afb8e-217">The storage client library support retry operations.</span></span> <span data-ttu-id="afb8e-218">Strategie se liší napříč tabulkami, objekty BLOB a frontami služby Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="afb8e-218">The strategies vary across Azure storage tables, blobs, and queues.</span></span> <span data-ttu-id="afb8e-219">I když je funkce geografické redundance povolená, alternativní pokusy se přepínají mezi primárními a sekundárními umístěními služby úložiště.</span><span class="sxs-lookup"><span data-stu-id="afb8e-219">As well, alternate retries switch between primary and secondary storage services locations when the geo-redundancy feature is enabled.</span></span>

- <span data-ttu-id="afb8e-220">*Event Hubs Azure.*</span><span class="sxs-lookup"><span data-stu-id="afb8e-220">*Azure Event Hubs.*</span></span> <span data-ttu-id="afb8e-221">Klientská knihovna pro centrum událostí obsahuje vlastnost RetryPolicy, která zahrnuje konfigurovatelnou omezení rychlosti funkci exponenciálního typu.</span><span class="sxs-lookup"><span data-stu-id="afb8e-221">The Event Hub client library features a RetryPolicy property, which includes a configurable exponential backoff feature.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="afb8e-222">[Předchozí](application-resiliency-patterns.md)
>[Další](resilient-communications.md)</span><span class="sxs-lookup"><span data-stu-id="afb8e-222">[Previous](application-resiliency-patterns.md)
[Next](resilient-communications.md)</span></span>
