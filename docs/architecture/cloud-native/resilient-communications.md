---
title: Odolná komunikace
description: Architekt cloudových nativních aplikací .NET pro Azure | Odolná komunikace
ms.date: 06/30/2019
ms.openlocfilehash: 324f5426af1c892db73aa6fc2336a19b7a8e499e
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/15/2019
ms.locfileid: "72315801"
---
# <a name="resilient-communications"></a><span data-ttu-id="983c5-103">Odolná komunikace</span><span class="sxs-lookup"><span data-stu-id="983c5-103">Resilient communications</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="983c5-104">V rámci této knihy jsme evangelizedi, že se přesouvají mimo tradiční návrh aplikací monolitické a přechodu architekturu založenou na mikroslužbách, kde se sada distribuovaných a samoobslužných služeb spouští nezávisle a komunikuje s nimi. jiné pomocí standardních komunikačních protokolů, jako jsou HTTP a HTTPS.</span><span class="sxs-lookup"><span data-stu-id="983c5-104">Throughout this book, we've evangelized the merits of moving beyond traditional monolithic application design and embracing a microservice-based architecture where a set of distributed, self-contained services run independently and communicate with each other using standard communication protocols such as HTTP and HTTPS.</span></span> <span data-ttu-id="983c5-105">I když taková architektura koupí mnoho důležitých výhod, prezentuje i mnoho výzev.</span><span class="sxs-lookup"><span data-stu-id="983c5-105">While such an architecture buys you many important benefits, it also presents many challenges.</span></span> <span data-ttu-id="983c5-106">Vezměte v úvahu například následující aspekty:</span><span class="sxs-lookup"><span data-stu-id="983c5-106">Consider, for example, the following concerns:</span></span>

- <span data-ttu-id="983c5-107">*Neprocesová síťová komunikace.*</span><span class="sxs-lookup"><span data-stu-id="983c5-107">*Out-of-process network communication.*</span></span> <span data-ttu-id="983c5-108">Každá služba komunikuje přes síťový protokol, který zavádí zahlcení sítě, latenci a přechodné chyby.</span><span class="sxs-lookup"><span data-stu-id="983c5-108">Each service communicates over a network protocol that introduces network congestion, latency, and transient faults.</span></span>
- <span data-ttu-id="983c5-109">*Zjišťování služby.*</span><span class="sxs-lookup"><span data-stu-id="983c5-109">*Service discovery.*</span></span> <span data-ttu-id="983c5-110">U každé služby spuštěné v clusteru počítačů s vlastní IP adresou a portem jak služby navzájem zjišťují a komunikují?</span><span class="sxs-lookup"><span data-stu-id="983c5-110">With each service running across a cluster of machines with its own IP address and port, how do services discover and communicate with each other?</span></span>
- <span data-ttu-id="983c5-111">*Odolnost.*</span><span class="sxs-lookup"><span data-stu-id="983c5-111">*Resiliency.*</span></span> <span data-ttu-id="983c5-112">Jak se spravují krátkodobé nenáročné chyby a systém udržuje stabilní?</span><span class="sxs-lookup"><span data-stu-id="983c5-112">How do you manage short-lived failures and keep the system stable?</span></span>
- <span data-ttu-id="983c5-113">*Vyrovnávání zatížení.*</span><span class="sxs-lookup"><span data-stu-id="983c5-113">*Load balancing.*</span></span> <span data-ttu-id="983c5-114">Jak se příchozí provoz rozděluje mezi více instancí služby?</span><span class="sxs-lookup"><span data-stu-id="983c5-114">How does inbound traffic get distributed across multiple instances of a service?</span></span>
- <span data-ttu-id="983c5-115">*Bezpečnost.*</span><span class="sxs-lookup"><span data-stu-id="983c5-115">*Security.*</span></span> <span data-ttu-id="983c5-116">Jak se týká zabezpečení, jako je šifrování na úrovni přenosu a Správa certifikátů?</span><span class="sxs-lookup"><span data-stu-id="983c5-116">How are security concerns such as transport-level encryption and certificate management enforced?</span></span>
- <span data-ttu-id="983c5-117">*Distribuované monitorování.*</span><span class="sxs-lookup"><span data-stu-id="983c5-117">*Distributed Monitoring.*</span></span> <span data-ttu-id="983c5-118">– Jak korelujete a zachytíte sledovatelnost a monitorování pro jednotlivé požadavky v rámci více využívání služeb?</span><span class="sxs-lookup"><span data-stu-id="983c5-118">- How do you correlate and capture traceability and monitoring for a single request across multiple consuming services?</span></span>

<span data-ttu-id="983c5-119">I když tyto otázky lze řešit pomocí různých knihoven a architektur, jejich implementace v rámci základu kódu mohou být nákladné, komplexní a časově náročné.</span><span class="sxs-lookup"><span data-stu-id="983c5-119">While these concerns can be addressed with various libraries and frameworks, implementing them inside your codebase can be expensive, complex, and time-consuming.</span></span> <span data-ttu-id="983c5-120">Kromě toho se ukončí řešení, ve kterém souvisí infrastruktura infrastruktury s obchodní logikou.</span><span class="sxs-lookup"><span data-stu-id="983c5-120">Moreover, you end up with a solution where infrastructure concerns are coupled to business logic.</span></span>

## <a name="service-mesh"></a><span data-ttu-id="983c5-121">Síť sítě</span><span class="sxs-lookup"><span data-stu-id="983c5-121">Service mesh</span></span>

<span data-ttu-id="983c5-122">Lepším řešením je uvažovat o nové a rychle se rozvíjející se technologie s názvem *sítě*.</span><span class="sxs-lookup"><span data-stu-id="983c5-122">A better approach is to consider a new and rapidly evolving technology entitled *Service Mesh*.</span></span> <span data-ttu-id="983c5-123">[Síť](https://www.nginx.com/blog/what-is-a-service-mesh/) je konfigurovatelná vrstva infrastruktury s integrovanými možnostmi pro zpracování komunikace služby a mnohé z výše uvedených výzev.</span><span class="sxs-lookup"><span data-stu-id="983c5-123">A [service mesh](https://www.nginx.com/blog/what-is-a-service-mesh/) is a configurable infrastructure layer with built-in capabilities to handle service communication and many of the challenges mentioned above.</span></span> <span data-ttu-id="983c5-124">Odděluje tyto obavy z vašeho podnikového kódu a přesouvá je do proxy služby, instance, která doprovází každou z vašich služeb.</span><span class="sxs-lookup"><span data-stu-id="983c5-124">It decouples these concerns from your business code and moves them into a service proxy, an instance of which accompanies each of your services.</span></span> <span data-ttu-id="983c5-125">Pro zajištění izolace a zapouzdření z vašeho podnikového kódu se často označuje jako [vzorek postranního vozíku](https://docs.microsoft.com/azure/architecture/patterns/sidecar). proxy síť služby se nasadí do samostatného procesu.</span><span class="sxs-lookup"><span data-stu-id="983c5-125">Often referred to as the [Sidecar pattern](https://docs.microsoft.com/azure/architecture/patterns/sidecar), the service mesh proxy is deployed into a separate process to provide isolation and encapsulation from your business code.</span></span> <span data-ttu-id="983c5-126">Proxy server se ale úzce odkazuje na službu, která se vytváří společně s IT a sdílí životní cyklus.</span><span class="sxs-lookup"><span data-stu-id="983c5-126">However, the proxy is closely linked to the service being created along with it and sharing its lifecycle.</span></span> <span data-ttu-id="983c5-127">Obrázek 6-9 ukazuje tento scénář.</span><span class="sxs-lookup"><span data-stu-id="983c5-127">Figure 6-9 shows this scenario.</span></span>

![Síť s postranním vozíkem](./media/service-mesh-with-side-car.png)

<span data-ttu-id="983c5-129">**Obrázek 6-9**.</span><span class="sxs-lookup"><span data-stu-id="983c5-129">**Figure 6-9**.</span></span> <span data-ttu-id="983c5-130">Síť s postranním vozíkem</span><span class="sxs-lookup"><span data-stu-id="983c5-130">Service mesh with a side car</span></span>

<span data-ttu-id="983c5-131">Na předchozím obrázku si všimněte, jak proxy zachytí a spravuje komunikaci mezi mikroslužbami a clusterem.</span><span class="sxs-lookup"><span data-stu-id="983c5-131">In the previous figure, note how the proxy intercepts and manages communication among the microservices and the cluster.</span></span>

<span data-ttu-id="983c5-132">Síť je logicky rozdělená na dvě různorodé komponenty: [rovina dat](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) a [rovina ovládacího prvku](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span><span class="sxs-lookup"><span data-stu-id="983c5-132">A service mesh is logically split into two disparate components: A [data plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) and [control plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span></span> <span data-ttu-id="983c5-133">Obrázek 6-10 ukazuje tyto komponenty a jejich zodpovědnosti.</span><span class="sxs-lookup"><span data-stu-id="983c5-133">Figure 6-10 shows these components and their responsibilities.</span></span>

![Ovládací prvek sítě a rovina dat](./media/istio-control-and-data-plane.png)

<span data-ttu-id="983c5-135">**Obrázek 6-10.**</span><span class="sxs-lookup"><span data-stu-id="983c5-135">**Figure 6-10.**</span></span> <span data-ttu-id="983c5-136">Ovládací prvek sítě a rovina dat</span><span class="sxs-lookup"><span data-stu-id="983c5-136">Service mesh control and data plane</span></span>

<span data-ttu-id="983c5-137">Po nakonfigurování je síť velmi funkční.</span><span class="sxs-lookup"><span data-stu-id="983c5-137">Once configured, a service mesh is highly functional.</span></span> <span data-ttu-id="983c5-138">Může načíst odpovídající fond instancí z koncového bodu zjišťování služby.</span><span class="sxs-lookup"><span data-stu-id="983c5-138">It can retrieve a corresponding pool of instances from a service discovery endpoint.</span></span> <span data-ttu-id="983c5-139">Pak může odeslat požadavek na konkrétní instanci a zaznamenat latenci a typ odpovědi výsledku.</span><span class="sxs-lookup"><span data-stu-id="983c5-139">It can then send a request to a specific instance, recording the latency and response type of the result.</span></span> <span data-ttu-id="983c5-140">Síť může zvolit instanci, která pravděpodobně vrátí rychlou odpověď na základě mnoha faktorů, včetně pozorované latence pro poslední požadavky.</span><span class="sxs-lookup"><span data-stu-id="983c5-140">A mesh can choose the instance most likely to return a fast response based on many factors, including its observed latency for recent requests.</span></span>

<span data-ttu-id="983c5-141">Pokud instance nereaguje nebo se nezdařila, síť může opakovat požadavek na jinou instanci.</span><span class="sxs-lookup"><span data-stu-id="983c5-141">If an instance is unresponsive or fails, the mesh can retry the request on another instance.</span></span> <span data-ttu-id="983c5-142">Pokud fond konzistentně vrátí chyby, síť ho může vyřadit z fondu vyrovnávání zatížení, aby bylo možné je pravidelně opakovat později po tom, co je zamění.</span><span class="sxs-lookup"><span data-stu-id="983c5-142">If a pool consistently returns errors, a mesh can evict it from the load-balancing pool to be retried periodically later after it heals.</span></span> <span data-ttu-id="983c5-143">Pokud vyprší časový limit požadavku, může dojít k selhání sítě a pak požadavek opakujte.</span><span class="sxs-lookup"><span data-stu-id="983c5-143">If a request times out, a mesh can fail and then retry the request.</span></span> <span data-ttu-id="983c5-144">Mřížka zachycuje chování ve formě metrik a distribuovaného trasování, které pak lze vygenerovat do centralizovaného systému metrik.</span><span class="sxs-lookup"><span data-stu-id="983c5-144">A mesh captures behavior in the form of metrics and distributed tracing, which then can be emitted to a centralized metrics system.</span></span>

## <a name="istio-and-envoy"></a><span data-ttu-id="983c5-145">Istio a zástupné</span><span class="sxs-lookup"><span data-stu-id="983c5-145">Istio and Envoy</span></span>

<span data-ttu-id="983c5-146">I když existuje několik možností sítě, které jsou aktuálně k dispozici, [Istio](https://istio.io/docs/concepts/what-is-istio/) je nejoblíbenější k době psaní.</span><span class="sxs-lookup"><span data-stu-id="983c5-146">While a few service mesh options currently exist, [Istio](https://istio.io/docs/concepts/what-is-istio/) is the most popular as of the time of this writing.</span></span> <span data-ttu-id="983c5-147">Společný podnik od IBM, Google a Lyft je open source nabídka, kterou je možné integrovat do nové nebo stávající distribuované aplikace.</span><span class="sxs-lookup"><span data-stu-id="983c5-147">A joint venture from IBM, Google, and Lyft, it's an open-source offering that can be integrated into a new or existing distributed application.</span></span> <span data-ttu-id="983c5-148">Poskytuje konzistentní a kompletní řešení pro zabezpečení, připojení a monitorování mikroslužeb.</span><span class="sxs-lookup"><span data-stu-id="983c5-148">It provides a consistent and complete solution to secure, connect, and monitor microservices.</span></span> <span data-ttu-id="983c5-149">Mezi tyto funkce patří:</span><span class="sxs-lookup"><span data-stu-id="983c5-149">Its features include:</span></span>

- <span data-ttu-id="983c5-150">Zabezpečená komunikace mezi službami v clusteru se silným ověřováním a autorizací na základě identity.</span><span class="sxs-lookup"><span data-stu-id="983c5-150">Secure service-to-service communication in a cluster with strong identity-based authentication and authorization.</span></span>
- <span data-ttu-id="983c5-151">Automatické vyrovnávání zatížení pro přenosy HTTP, [gRPC](https://grpc.io/), WebSocket a TCP.</span><span class="sxs-lookup"><span data-stu-id="983c5-151">Automatic load balancing for HTTP, [gRPC](https://grpc.io/), WebSocket, and TCP traffic.</span></span>
- <span data-ttu-id="983c5-152">Jemně odstupňovaná kontrola nad chováním provozu s bohatými pravidly směrování, opakovanými pokusy, převzetí služeb při selhání a vkládáním chyb.</span><span class="sxs-lookup"><span data-stu-id="983c5-152">Fine-grained control of traffic behavior with rich routing rules, retries, failovers, and fault injection.</span></span>
- <span data-ttu-id="983c5-153">Připojitelná vrstva zásad a konfigurační rozhraní API, které podporuje řízení přístupu, omezení přenosové rychlosti a kvóty.</span><span class="sxs-lookup"><span data-stu-id="983c5-153">A pluggable policy layer and configuration API supporting access controls, rate limits, and quotas.</span></span>
- <span data-ttu-id="983c5-154">Automatické metriky, protokoly a trasování pro veškerý provoz v rámci clusteru, včetně příchozího a odchozího clusteru.</span><span class="sxs-lookup"><span data-stu-id="983c5-154">Automatic metrics, logs, and traces for all traffic within a cluster, including cluster ingress and egress.</span></span>

<span data-ttu-id="983c5-155">Klíčovou komponentou pro implementaci Istio je proxy služba s oprávněním [proxy serveru zástupné](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span><span class="sxs-lookup"><span data-stu-id="983c5-155">A key component for an Istio implementation is a proxy service entitled the [Envoy proxy](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span></span> <span data-ttu-id="983c5-156">Pocházející z Lyft a následně přispěly ke [Cloud Native Computing Foundation](https://www.cncf.io/) (popsaný v kapitole 1) se proxy zástupné spouští spolu s každou službou a poskytuje platformu-nezávislá Foundation pro následující funkce:</span><span class="sxs-lookup"><span data-stu-id="983c5-156">Originating from Lyft and subsequently contributed to the [Cloud Native Computing Foundation](https://www.cncf.io/) (discussed in chapter 1), the Envoy proxy runs alongside each service and provides a platform-agnostic foundation for the following features:</span></span>

- <span data-ttu-id="983c5-157">Dynamické zjišťování služeb.</span><span class="sxs-lookup"><span data-stu-id="983c5-157">Dynamic service discovery.</span></span>
- <span data-ttu-id="983c5-158">Vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="983c5-158">Load balancing.</span></span>
- <span data-ttu-id="983c5-159">Ukončení protokolu TLS.</span><span class="sxs-lookup"><span data-stu-id="983c5-159">TLS termination.</span></span>
- <span data-ttu-id="983c5-160">Proxy servery HTTP a gRPC.</span><span class="sxs-lookup"><span data-stu-id="983c5-160">HTTP and gRPC proxies.</span></span>
- <span data-ttu-id="983c5-161">Odolnost přerušení okruhu.</span><span class="sxs-lookup"><span data-stu-id="983c5-161">Circuit breaker resiliency.</span></span>
- <span data-ttu-id="983c5-162">Kontroly stavu.</span><span class="sxs-lookup"><span data-stu-id="983c5-162">Health checks.</span></span>
- <span data-ttu-id="983c5-163">Aktualizace pro [Kanárské](https://martinfowler.com/bliki/CanaryRelease.html) nasazení.</span><span class="sxs-lookup"><span data-stu-id="983c5-163">Rolling updates with [canary](https://martinfowler.com/bliki/CanaryRelease.html) deployments.</span></span>

<span data-ttu-id="983c5-164">Jak je popsáno výše, zástupné se nasadí jako postranní vozík do každé mikroslužby v clusteru.</span><span class="sxs-lookup"><span data-stu-id="983c5-164">As previously discussed, Envoy is deployed as a sidecar to each microservice in the cluster.</span></span>

## <a name="integration-with-azure-kubernetes-services"></a><span data-ttu-id="983c5-165">Integrace se službami Azure Kubernetes</span><span class="sxs-lookup"><span data-stu-id="983c5-165">Integration with Azure Kubernetes Services</span></span>

<span data-ttu-id="983c5-166">Cloud Azure zahrnuje Istio a poskytuje přímou podporu pro IT v rámci služby Azure Kubernetes Services.</span><span class="sxs-lookup"><span data-stu-id="983c5-166">The Azure cloud embraces Istio and provides direct support for it within Azure Kubernetes Services.</span></span> <span data-ttu-id="983c5-167">Následující odkazy vám pomůžou začít:</span><span class="sxs-lookup"><span data-stu-id="983c5-167">The following links can help you get started:</span></span>

- [<span data-ttu-id="983c5-168">Instalace Istio v AKS</span><span class="sxs-lookup"><span data-stu-id="983c5-168">Installing Istio in AKS</span></span>](https://docs.microsoft.com/azure/aks/istio-install)
- [<span data-ttu-id="983c5-169">Použití AKS a Istio</span><span class="sxs-lookup"><span data-stu-id="983c5-169">Using AKS and Istio</span></span>](https://docs.microsoft.com/azure/aks/istio-scenario-routing)

>[!div class="step-by-step"]
><span data-ttu-id="983c5-170">[Předchozí](infrastructure-resiliency-azure.md)
>[Další](monitoring-health.md)</span><span class="sxs-lookup"><span data-stu-id="983c5-170">[Previous](infrastructure-resiliency-azure.md)
[Next](monitoring-health.md)</span></span>
