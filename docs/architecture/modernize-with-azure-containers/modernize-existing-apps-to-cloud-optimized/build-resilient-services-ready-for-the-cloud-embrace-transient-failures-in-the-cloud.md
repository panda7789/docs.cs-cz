---
title: Vytvářejte odolné služby připravené pro Cloud. Zpracování přechodných selhání v cloudu
description: Modernizovat stávající aplikace .NET pomocí cloudu Azure a kontejnerů Windows | Vytvářejte odolné služby připravené pro Cloud. Zpracování přechodných selhání v cloudu
ms.date: 04/30/2018
ms.openlocfilehash: 5d25fb0d15ff7b9f04b9491454d1368e4aa7f593
ms.sourcegitcommit: f20dd18dbcf2275513281f5d9ad7ece6a62644b4
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/30/2019
ms.locfileid: "68677039"
---
# <a name="build-resilient-services-ready-for-the-cloud-embrace-transient-failures-in-the-cloud"></a><span data-ttu-id="bf5aa-105">Vytváření odolných služeb připravených pro cloud: Zpracování přechodných selhání v cloudu</span><span class="sxs-lookup"><span data-stu-id="bf5aa-105">Build resilient services ready for the cloud: Embrace transient failures in the cloud</span></span>

<span data-ttu-id="bf5aa-106">Odolnost proti chybám je schopnost zotavení po selháních a nadále fungovat.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-106">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="bf5aa-107">Odolnost proti chybám nebrání, ale přijímá skutečnost, že dojde k selhání, a pak na ně reagovat způsobem, který brání výpadkům nebo ztrátě dat.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-107">Resiliency is not about avoiding failures, but accepting the fact that failures will occur, and then responding to them in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="bf5aa-108">Cílem odolnosti proti chybám je vrátit aplikaci do plně funkčního stavu po selhání.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-108">The goal of resiliency is to return the application to a fully functioning state after a failure.</span></span>

<span data-ttu-id="bf5aa-109">Vaše aplikace je připravená na Cloud, pokud má přinejmenším za to, že implementuje softwarový model odolnosti, spíše než model založený na hardwaru.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-109">Your application is ready for the cloud when, at a minimum, it implements a software-based model of resiliency, rather than a hardware-based model.</span></span> <span data-ttu-id="bf5aa-110">Vaše cloudová aplikace musí vycházet z částečně neúspěšných selhání.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-110">Your cloud application must embrace the partial failures that will certainly occur.</span></span> <span data-ttu-id="bf5aa-111">Navrhněte nebo částečně refaktorujte svoji aplikaci, aby se zajistila odolnost s očekávanými částečnými chybami.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-111">Design or partially refactor your application to achieve resiliency with expected partial failures.</span></span> <span data-ttu-id="bf5aa-112">Měla by být navržená tak, aby se vypořádat s částečnými chybami, jako jsou přechodné výpadky sítě a uzly, nebo dojde k selhání virtuálních počítačů v cloudu.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-112">It should be designed to cope with partial failures, like transient network outages and nodes, or VMs crashing in the cloud.</span></span> <span data-ttu-id="bf5aa-113">Dokonce i kontejnery, které se přesunou do jiného uzlu v rámci clusteru nástroje Orchestrator, můžou způsobit přerušované krátké chyby v rámci aplikace.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-113">Even containers being moved to a different node within an orchestrator cluster can cause intermittent short failures within the application.</span></span>

## <a name="handling-partial-failure"></a><span data-ttu-id="bf5aa-114">Zpracování částečného selhání</span><span class="sxs-lookup"><span data-stu-id="bf5aa-114">Handling partial failure</span></span>

<span data-ttu-id="bf5aa-115">V cloudové aplikaci existuje stále přítomné riziko částečného selhání.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-115">In a cloud-based application, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="bf5aa-116">Například jedna instance webu nebo kontejner může selhat nebo může být nedostupná nebo nereaguje na krátkou dobu.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-116">For instance, a single website instance or a container might fail, or it might be unavailable or unresponsive for a short time.</span></span> <span data-ttu-id="bf5aa-117">Nebo může dojít k selhání jednoho virtuálního počítače nebo serveru.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-117">Or, a single VM or server might crash.</span></span>

<span data-ttu-id="bf5aa-118">Vzhledem k tomu, že klienti a služby jsou samostatné procesy, nemusí být služba schopná reagovat včas na požadavky klienta.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-118">Because clients and services are separate processes, a service might not be able to respond in a timely manner to a client's request.</span></span> <span data-ttu-id="bf5aa-119">Služba může být přetížena a reagovat pomalu na požadavky nebo nemusí být k dispozici po krátkou dobu kvůli problémům se sítí.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-119">The service might be overloaded and respond slowly to requests, or it might not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="bf5aa-120">Zvažte například monolitické aplikaci .NET, která přistupuje k databázi v Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-120">For example, consider a monolithic .NET application that accesses a database in Azure SQL Database.</span></span> <span data-ttu-id="bf5aa-121">Pokud Azure SQL Database nebo jakákoli jiná služba třetí strany nereaguje na krátkou dobu (může se stát, že se Azure SQL Database přesune na jiný uzel nebo server a nereaguje na několik sekund), když se uživatel pokusí provést jakoukoli akci, může aplikace selhat a zobrazit s výjimkou ve stejný okamžik.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-121">If the Azure SQL database or any other third-party service is unresponsive for a brief time (an Azure SQL database might be moved to a different node or server, and be unresponsive for a few seconds), when the user tries to do any action, the application might crash and show an exception at the same moment.</span></span>

<span data-ttu-id="bf5aa-122">Podobný scénář může nastat v aplikaci, která používá služby HTTP.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-122">A similar scenario might occur in an app that consumes HTTP services.</span></span> <span data-ttu-id="bf5aa-123">Síť nebo samotná služba nemusí být v cloudu během krátkého přechodného selhání k dispozici.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-123">The network or the service itself might not be available in the cloud during a short, transient failure.</span></span>

<span data-ttu-id="bf5aa-124">Odolná aplikace jako ta, která je znázorněna na obrázku 4-9, by měla implementovat techniky, jako je "opakování s exponenciálním omezení rychlosti", aby aplikace mohla mít možnost zpracovávat přechodné chyby v prostředcích.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-124">A resilient application like the one shown in Figure 4-9 should implement techniques like "retries with exponential backoff" to give the application an opportunity to handle transient failures in resources.</span></span> <span data-ttu-id="bf5aa-125">V aplikacích byste také měli použít "okruhy okruhů".</span><span class="sxs-lookup"><span data-stu-id="bf5aa-125">You also should use "circuit breakers" in your applications.</span></span> <span data-ttu-id="bf5aa-126">Přepínací modul okruhů zastaví aplikaci, aby se pokusil o přístup k prostředku, když je skutečně dlouhodobá chyba.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-126">A circuit breaker stops an application from trying to access a resource when it's actually a long-term failure.</span></span> <span data-ttu-id="bf5aa-127">Když použijete přerušení obvodu, aplikace zabrání tomu, aby provoking odepření služby.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-127">By using a circuit breaker, the application avoids provoking a denial of service to itself.</span></span>

![Částečné chyby zpracovávané opakováním exponenciálního omezení rychlostiu](./media/image9.png)

> <span data-ttu-id="bf5aa-129">**Obrázek 4-9.**</span><span class="sxs-lookup"><span data-stu-id="bf5aa-129">**Figure 4-9.**</span></span> <span data-ttu-id="bf5aa-130">Částečné chyby zpracovávané opakováním exponenciálního omezení rychlostiu</span><span class="sxs-lookup"><span data-stu-id="bf5aa-130">Partial failures handled by retries with exponential backoff</span></span>

<span data-ttu-id="bf5aa-131">Tyto techniky můžete použít v prostředcích HTTP i v databázových prostředcích.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-131">You can use these techniques both in HTTP resources and in database resources.</span></span> <span data-ttu-id="bf5aa-132">Na obrázku 4-9 je aplikace založená na architektuře 3, takže tyto techniky budete potřebovat na úrovni služeb (HTTP) a na úrovni datové vrstvy (TCP).</span><span class="sxs-lookup"><span data-stu-id="bf5aa-132">In Figure 4-9, the application is based on a 3-tier architecture, so you need these techniques at the services level (HTTP) and at the data tier level (TCP).</span></span> <span data-ttu-id="bf5aa-133">V aplikaci monolitické, která kromě databáze nástroje používá jenom jednu vrstvu aplikace (žádné další služby ani mikroslužby), může být dostatečné pro zpracování přechodných chyb na úrovni připojení databáze.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-133">In a monolithic application that uses only a single app tier in addition to the database (no additional services or microservices), handling transient failures at the database connection level might be enough.</span></span> <span data-ttu-id="bf5aa-134">V takovém scénáři je vyžadována pouze určitá konfigurace připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-134">In that scenario, just a particular configuration of the database connection is required.</span></span>

<span data-ttu-id="bf5aa-135">Při implementaci odolné komunikace, která přistupuje k databázi, v závislosti na verzi rozhraní .NET, kterou používáte, může být jednoduchá (například [s Entity Framework 6 nebo novějším](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span><span class="sxs-lookup"><span data-stu-id="bf5aa-135">When implementing resilient communications that access the database, depending on the version of .NET you are using, it can be straightforward (for example, [with Entity Framework 6 or later](/ef/ef6/fundamentals/connection-resiliency/retry-logic).</span></span> <span data-ttu-id="bf5aa-136">Je to jenom ta konfigurace připojení k databázi).</span><span class="sxs-lookup"><span data-stu-id="bf5aa-136">It's just a matter of configuring the database connection).</span></span> <span data-ttu-id="bf5aa-137">Nebo může být nutné použít další knihovny, jako je například [přechodný blok aplikace pro zpracování chyb](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (pro starší verze rozhraní .NET), nebo dokonce implementovat vlastní knihovnu.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-137">Or, you might need to use additional libraries like the [Transient Fault Handling Application Block](https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)) (for earlier versions of .NET), or even implement your own library.</span></span>

<span data-ttu-id="bf5aa-138">Při implementaci opakování protokolu HTTP a přepínacích cyklů okruhu je doporučení pro .NET používat knihovnu [Polly](https://github.com/App-vNext/Polly) , která cílí na .NET Framework 4,0, .NET Framework 4,5 a .NET Standard 1,1, což zahrnuje podporu .NET Core.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-138">When implementing HTTP retries and circuit breakers, the recommendation for .NET is to use the [Polly](https://github.com/App-vNext/Polly) library, which targets .NET Framework 4.0, .NET Framework 4.5, and .NET Standard 1.1, which includes .NET Core support.</span></span>

<span data-ttu-id="bf5aa-139">Další informace o implementaci strategií pro zpracování částečných chyb v cloudu najdete v následujících odkazech.</span><span class="sxs-lookup"><span data-stu-id="bf5aa-139">To learn how to implement strategies for handling partial failures in the cloud, see the following references.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="bf5aa-140">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="bf5aa-140">Additional resources</span></span>

- <span data-ttu-id="bf5aa-141">**Implementace odolné komunikace pro zpracování částečného selhání**</span><span class="sxs-lookup"><span data-stu-id="bf5aa-141">**Implementing resilient communication to handle partial failure**</span></span>

    [https://docs.microsoft.com/dotnet/architecture/microservices/implement-resilient-applications/partial-failure-strategies](../../microservices/implement-resilient-applications/partial-failure-strategies.md)

- <span data-ttu-id="bf5aa-142">**Entity Framework odolnost připojení a opakování logiky (verze 6 a novější)**</span><span class="sxs-lookup"><span data-stu-id="bf5aa-142">**Entity Framework connection resiliency and retry logic (version 6 and later)**</span></span>

    [https://docs.microsoft.com/ef/ef6/fundamentals/connection-resiliency/retry-logic](/ef/ef6/fundamentals/connection-resiliency/retry-logic)

- <span data-ttu-id="bf5aa-143">**Blok aplikace pro zpracování přechodného selhání**</span><span class="sxs-lookup"><span data-stu-id="bf5aa-143">**The Transient Fault Handling Application Block**</span></span>

- <https://docs.microsoft.com/previous-versions/msp-n-p/hh680934(v=pandp.50)>

- <span data-ttu-id="bf5aa-144">**Polly Library pro odolnou komunikaci HTTP**</span><span class="sxs-lookup"><span data-stu-id="bf5aa-144">**Polly library for resilient HTTP communication**</span></span>

    https://github.com/App-vNext/Polly

>[!div class="step-by-step"]
><span data-ttu-id="bf5aa-145">[Předchozí](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)Další
>[](modernize-your-apps-with-monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="bf5aa-145">[Previous](when-to-deploy-windows-containers-to-azure-container-service-kubernetes.md)
[Next](modernize-your-apps-with-monitoring-and-telemetry.md)</span></span>
