---
title: Správa výkonu aplikací – gRPC pro vývojáře WCF
description: Protokolování, metriky a trasování pro aplikace ASP.NET Core gRPC.
ms.date: 09/02/2019
ms.openlocfilehash: 98da6c5391f021011e281a57e8f775709fa128ef
ms.sourcegitcommit: 9a97c76e141333394676bc5d264c6624b6f45bcf
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/08/2020
ms.locfileid: "75740972"
---
# <a name="application-performance-management"></a><span data-ttu-id="f5c62-103">Správa výkonu aplikace</span><span class="sxs-lookup"><span data-stu-id="f5c62-103">Application Performance Management</span></span>

<span data-ttu-id="f5c62-104">V produkčních prostředích, jako je Kubernetes, je důležité monitorovat aplikace, aby se zajistila optimální provoz.</span><span class="sxs-lookup"><span data-stu-id="f5c62-104">In production environments like Kubernetes, it's important to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="f5c62-105">Protokolování a metriky jsou obzvláště důležité.</span><span class="sxs-lookup"><span data-stu-id="f5c62-105">Logging and metrics are particularly important.</span></span> <span data-ttu-id="f5c62-106">ASP.NET Core, včetně gRPC, nabízí integrovanou podporu pro vytváření a správu zpráv protokolu a dat metrik a také *trasování* dat.</span><span class="sxs-lookup"><span data-stu-id="f5c62-106">ASP.NET Core, including gRPC, provides built-in support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span>

## <a name="the-difference-between-logging-and-metrics"></a><span data-ttu-id="f5c62-107">Rozdíl mezi protokolováním a metrikami</span><span class="sxs-lookup"><span data-stu-id="f5c62-107">The difference between logging and metrics</span></span>

<span data-ttu-id="f5c62-108">V souvislosti s textovými zprávami, které zaznamenávají podrobné informace o akcích, ke kterým došlo v systému, *se jedná o* protokol.</span><span class="sxs-lookup"><span data-stu-id="f5c62-108">*Logging* is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="f5c62-109">Zprávy protokolu mohou zahrnovat data výjimek, například trasování zásobníku nebo strukturovaná data, která poskytují kontext týkající se zprávy.</span><span class="sxs-lookup"><span data-stu-id="f5c62-109">Log messages might include exception data, like stack traces, or structured data that provides context about the message.</span></span> <span data-ttu-id="f5c62-110">Výstup protokolování se obvykle zapisuje do vyhledávacího úložiště textu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-110">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="f5c62-111">*Metriky* odkazují na číselná data, která jsou určená k agregaci a jsou prezentována pomocí grafů a grafů na řídicím panelu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-111">*Metrics* refers to numeric data designed to be aggregated and presented by using charts and graphs in a dashboard.</span></span> <span data-ttu-id="f5c62-112">Řídicí panel poskytuje přehled o celkovém stavu a výkonu aplikace.</span><span class="sxs-lookup"><span data-stu-id="f5c62-112">The dashboard provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="f5c62-113">Data metriky je také možné použít ke spuštění automatizovaných výstrah při překročení prahové hodnoty.</span><span class="sxs-lookup"><span data-stu-id="f5c62-113">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="f5c62-114">Tady je několik příkladů dat metrik:</span><span class="sxs-lookup"><span data-stu-id="f5c62-114">Here are some examples of metrics data:</span></span>

- <span data-ttu-id="f5c62-115">Doba potřebná pro zpracování požadavků.</span><span class="sxs-lookup"><span data-stu-id="f5c62-115">Time taken to process requests.</span></span>
- <span data-ttu-id="f5c62-116">Počet požadavků za sekundu, které jsou zpracovávány instancí služby.</span><span class="sxs-lookup"><span data-stu-id="f5c62-116">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="f5c62-117">Počet neúspěšných žádostí o instanci.</span><span class="sxs-lookup"><span data-stu-id="f5c62-117">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="f5c62-118">Přihlášení ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="f5c62-118">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="f5c62-119">ASP.NET Core poskytuje integrovanou podporu pro protokolování ve formě balíčku NuGet [Microsoft. Extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) .</span><span class="sxs-lookup"><span data-stu-id="f5c62-119">ASP.NET Core provides built-in support for logging, in the form of the [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="f5c62-120">Základní části této knihovny jsou součástí webové sady SDK, takže je není nutné instalovat ručně.</span><span class="sxs-lookup"><span data-stu-id="f5c62-120">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="f5c62-121">Ve výchozím nastavení se zprávy protokolu zapisují do standardního výstupu (konzola) a do libovolného připojeného ladicího programu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-121">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="f5c62-122">Chcete-li zapisovat protokoly do trvalých externích úložišť dat, může být nutné importovat [volitelné balíčky jímky protokolování](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span><span class="sxs-lookup"><span data-stu-id="f5c62-122">To write logs to persistent external data stores, you might need to import [optional logging sink packages](https://docs.microsoft.com/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="f5c62-123">Rozhraní ASP.NET Core gRPC zapisuje podrobné zprávy protokolování diagnostiky do tohoto protokolovacího rozhraní, takže je lze zpracovávat a ukládat společně s vlastními zprávami aplikace.</span><span class="sxs-lookup"><span data-stu-id="f5c62-123">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework, so they can be processed and stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="f5c62-124">Vytváření zpráv protokolu</span><span class="sxs-lookup"><span data-stu-id="f5c62-124">Produce log messages</span></span>

<span data-ttu-id="f5c62-125">Rozšíření protokolování je automaticky registrováno se systémem injektáže ASP.NET Core závislostí, takže můžete zadat protokolovací nástroje jako parametr konstruktoru v typech služeb gRPC.</span><span class="sxs-lookup"><span data-stu-id="f5c62-125">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="f5c62-126">Mnohé zprávy protokolu, jako jsou požadavky a výjimky, poskytují komponenty rozhraní ASP.NET Core a gRPC.</span><span class="sxs-lookup"><span data-stu-id="f5c62-126">Many log messages, such as requests and exceptions, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="f5c62-127">Přidejte vlastní zprávy protokolu k poskytnutí podrobností a kontextu o logice aplikace, nikoli k problémům nižší úrovně.</span><span class="sxs-lookup"><span data-stu-id="f5c62-127">Add your own log messages to provide detail and context about application logic, rather than lower-level concerns.</span></span>

<span data-ttu-id="f5c62-128">Další informace o psaní zpráv protokolu a dostupných umyvadel a cílů protokolování najdete [v tématu protokolování v .NET Core a ASP.NET Core](/aspnet/core/fundamentals/logging/).</span><span class="sxs-lookup"><span data-stu-id="f5c62-128">For more information about writing log messages and available logging sinks and targets, see  [Logging in .NET Core and ASP.NET Core](/aspnet/core/fundamentals/logging/).</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="f5c62-129">Metriky v ASP.NET Core gRPC</span><span class="sxs-lookup"><span data-stu-id="f5c62-129">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="f5c62-130">Modul runtime .NET Core poskytuje sadu komponent pro vygenerování a sledování metrik.</span><span class="sxs-lookup"><span data-stu-id="f5c62-130">The .NET Core runtime provides a set of components for emitting and observing metrics.</span></span> <span data-ttu-id="f5c62-131">Mezi ně patří rozhraní API, například <xref:System.Diagnostics.Tracing.EventSource> a <xref:System.Diagnostics.Tracing.EventCounter> třídy.</span><span class="sxs-lookup"><span data-stu-id="f5c62-131">These include APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="f5c62-132">Tato rozhraní API mohou vysílat základní číselná data, která mohou být spotřebována externími procesy, jako je [globální nástroj dotnet-Counters](../../core/diagnostics/dotnet-counters.md)nebo trasování událostí pro systém Windows.</span><span class="sxs-lookup"><span data-stu-id="f5c62-132">These APIs can emit basic numeric data that can be consumed by external processes, like the [dotnet-counters global tool](../../core/diagnostics/dotnet-counters.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="f5c62-133">Další informace o použití `EventCounter` ve vlastním kódu najdete v tématu [Úvod do EventCounter](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span><span class="sxs-lookup"><span data-stu-id="f5c62-133">For more information about using `EventCounter` in your own code, see [EventCounter introduction](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span></span>

<span data-ttu-id="f5c62-134">Pro pokročilejší metriky a pro zápis dat metrik do širší škály úložišť dat můžete zkusit open source projekt s názvem [metriky aplikace](https://www.app-metrics.io).</span><span class="sxs-lookup"><span data-stu-id="f5c62-134">For more advanced metrics and for writing metric data to a wider range of data stores, you might try an open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="f5c62-135">Tato sada knihoven poskytuje rozsáhlou sadu typů pro instrumentaci kódu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="f5c62-136">Nabízí také balíčky pro zápis metrik do různých druhů cílů, které obsahují databáze časových řad, například Prometheus a InfluxDB, a [Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview).</span><span class="sxs-lookup"><span data-stu-id="f5c62-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, and [Application Insights](https://docs.microsoft.com/azure/azure-monitor/app/app-insights-overview).</span></span> <span data-ttu-id="f5c62-137">Balíček NuGet [App. Metrics. AspNetCore. Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) dokonce přidá komplexní sadu základních metrik, které se automaticky generují prostřednictvím integrace s ASP.NET Core Framework.</span><span class="sxs-lookup"><span data-stu-id="f5c62-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework.</span></span> <span data-ttu-id="f5c62-138">Web projektu nabízí [šablony](https://www.app-metrics.io/samples/grafana/) pro zobrazení těchto metrik s platformou vizualizace [Grafana](https://grafana.com/) .</span><span class="sxs-lookup"><span data-stu-id="f5c62-138">The project website provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="f5c62-139">Vydávat metriky</span><span class="sxs-lookup"><span data-stu-id="f5c62-139">Produce metrics</span></span>

<span data-ttu-id="f5c62-140">Většina platforem metrik podporuje následující typy:</span><span class="sxs-lookup"><span data-stu-id="f5c62-140">Most metrics platforms support the following types:</span></span>

| <span data-ttu-id="f5c62-141">Typ metriky</span><span class="sxs-lookup"><span data-stu-id="f5c62-141">Metric type</span></span> | <span data-ttu-id="f5c62-142">Popis</span><span class="sxs-lookup"><span data-stu-id="f5c62-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="f5c62-143">Counter</span><span class="sxs-lookup"><span data-stu-id="f5c62-143">Counter</span></span>     | <span data-ttu-id="f5c62-144">Sleduje, jak často se něco stane, například žádosti a chyby.</span><span class="sxs-lookup"><span data-stu-id="f5c62-144">Tracks how often something happens, such as requests and errors.</span></span> |
| <span data-ttu-id="f5c62-145">Měřidla</span><span class="sxs-lookup"><span data-stu-id="f5c62-145">Gauge</span></span>       | <span data-ttu-id="f5c62-146">Zaznamenává jednu hodnotu, která se mění v průběhu času, například aktivních připojení.</span><span class="sxs-lookup"><span data-stu-id="f5c62-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="f5c62-147">Histogram</span><span class="sxs-lookup"><span data-stu-id="f5c62-147">Histogram</span></span>   | <span data-ttu-id="f5c62-148">Měří distribuci hodnot napříč libovolnými limity.</span><span class="sxs-lookup"><span data-stu-id="f5c62-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="f5c62-149">Například histogram může sledovat velikost datové sady, počítat počet obsažených < 10 záznamů, počet obsažených záznamů 11-100, počet obsažených záznamů v 101-1000 a počet obsažených záznamů > 1000.</span><span class="sxs-lookup"><span data-stu-id="f5c62-149">For example, a histogram can track dataset size, counting how many contained <10 records, how many contained 11-100 records, how many contained 101-1000 records, and how many contained >1000 records.</span></span> |
| <span data-ttu-id="f5c62-150">Měření</span><span class="sxs-lookup"><span data-stu-id="f5c62-150">Meter</span></span>       | <span data-ttu-id="f5c62-151">Měří rychlost, s jakou dojde k události v různých časových intervalech.</span><span class="sxs-lookup"><span data-stu-id="f5c62-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="f5c62-152">Časovač</span><span class="sxs-lookup"><span data-stu-id="f5c62-152">Timer</span></span>       | <span data-ttu-id="f5c62-153">Sleduje dobu trvání událostí a rychlost, s jakou se vyskytuje, a ukládá se jako histogram.</span><span class="sxs-lookup"><span data-stu-id="f5c62-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="f5c62-154">Pomocí *metriky aplikací*se dá rozhraní `IMetrics` získat prostřednictvím vkládání závislostí a používá se k záznamu kterékoli z těchto metrik pro službu gRPC.</span><span class="sxs-lookup"><span data-stu-id="f5c62-154">By using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection, and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="f5c62-155">Následující příklad ukazuje, jak spočítat počet `Get` požadavků provedených v čase:</span><span class="sxs-lookup"><span data-stu-id="f5c62-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="f5c62-156">Ukládání a vizualizace dat metrik</span><span class="sxs-lookup"><span data-stu-id="f5c62-156">Store and visualize metrics data</span></span>

<span data-ttu-id="f5c62-157">Nejlepším způsobem, jak ukládat data metrik, je *databáze časových řad*, specializované úložiště dat navržené pro záznam numerických datových řad označených časovými razítky.</span><span class="sxs-lookup"><span data-stu-id="f5c62-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="f5c62-158">Nejoblíbenější z těchto databází jsou [Prometheus](https://prometheus.io/) a [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="f5c62-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="f5c62-159">Microsoft Azure také poskytuje vyhrazené úložiště metrik prostřednictvím služby [Azure monitor](https://docs.microsoft.com/azure/azure-monitor/overview) .</span><span class="sxs-lookup"><span data-stu-id="f5c62-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="f5c62-160">Aktuální řešení pro vizualizaci dat metrik je [Grafana](https://grafana.com), které funguje s široké škálou poskytovatelů úložiště.</span><span class="sxs-lookup"><span data-stu-id="f5c62-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers.</span></span> <span data-ttu-id="f5c62-161">Následující obrázek ukazuje příklad řídicího panelu Grafana, který zobrazuje metriky z sítě Linkered Service, na které běží ukázka StockData:</span><span class="sxs-lookup"><span data-stu-id="f5c62-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Snímek obrazovky s řídicím panelem Grafana](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="f5c62-163">Výstrahy založené na metrikách</span><span class="sxs-lookup"><span data-stu-id="f5c62-163">Metrics-based alerting</span></span>

<span data-ttu-id="f5c62-164">Číselná povaha dat metrik znamená, že je ideálním řešením pro systémy upozornění, informování vývojářů a technikům podpory, když hodnota spadá mimo určitou definovanou toleranci.</span><span class="sxs-lookup"><span data-stu-id="f5c62-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="f5c62-165">Platformy, které jsou již zmíněny, poskytují podporu pro upozorňování prostřednictvím řady možností, včetně e-mailů, textových zpráv nebo vizualizací v řídicím panelu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="f5c62-166">Distribuované trasování</span><span class="sxs-lookup"><span data-stu-id="f5c62-166">Distributed tracing</span></span>

<span data-ttu-id="f5c62-167">Distribuované trasování je poměrně poslední vývoj v monitorování, který se objevil při rostoucím využití mikroslužeb a distribuovaných architektur.</span><span class="sxs-lookup"><span data-stu-id="f5c62-167">Distributed tracing is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="f5c62-168">Jedna žádost z klientského prohlížeče, aplikace nebo zařízení může být rozdělená na mnoho kroků a dílčích požadavků a zahrnovat používání mnoha služeb v síti.</span><span class="sxs-lookup"><span data-stu-id="f5c62-168">A single request from a client browser, application, or device can be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="f5c62-169">Díky tomu je obtížné sladit zprávy protokolu a metriky se specifickým požadavkem, který je vyvolal.</span><span class="sxs-lookup"><span data-stu-id="f5c62-169">This makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="f5c62-170">Distribuované trasování aplikuje identifikátory na požadavky a umožňuje, aby se protokoly a metriky korelují s konkrétní operací.</span><span class="sxs-lookup"><span data-stu-id="f5c62-170">Distributed tracing applies identifiers to requests, and this allows logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="f5c62-171">To se podobá [kompletnímu trasování služby WCF](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), ale používá se na různých platformách.</span><span class="sxs-lookup"><span data-stu-id="f5c62-171">This is similar to [WCF's end-to-end tracing](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), but it's applied across multiple platforms.</span></span>

<span data-ttu-id="f5c62-172">Distribuované trasování se rychle zvětšilo v oblíbenosti a začíná se standardizací.</span><span class="sxs-lookup"><span data-stu-id="f5c62-172">Distributed tracing has grown quickly in popularity and is beginning to standardize.</span></span> <span data-ttu-id="f5c62-173">Cloud Native Computing Foundation vytvořila [Open Tracing Standard](https://opentracing.io)a při práci s back-endy, jako je [Jaeger](https://www.jaegertracing.io/) a [elastické APM](https://www.elastic.co/products/apm), se snaží poskytnout neutrální knihovny nezávislé na dodavatelích.</span><span class="sxs-lookup"><span data-stu-id="f5c62-173">The Cloud Native Computing Foundation created the [the Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with back ends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="f5c62-174">Ve stejnou dobu vytvořil [projekt OpenCensus](https://opencensus.io/) pro řešení stejné sady problémů.</span><span class="sxs-lookup"><span data-stu-id="f5c62-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="f5c62-175">Tyto dva projekty jsou sloučeny do nového projektu [OpenTelemetry](https://opentelemetry.io), což se zaměřuje na oborovou Standard budoucího.</span><span class="sxs-lookup"><span data-stu-id="f5c62-175">These two projects are merging into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the industry standard of the future.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="f5c62-176">Jak funguje distribuované trasování</span><span class="sxs-lookup"><span data-stu-id="f5c62-176">How distributed tracing works</span></span>

<span data-ttu-id="f5c62-177">Distribuované trasování vychází z konceptu různých *rozsahů*: pojmenovaných, časovanéch operací, které jsou součástí jednoho *trasování*, což může zahrnovat zpracování na více uzlech systému.</span><span class="sxs-lookup"><span data-stu-id="f5c62-177">Distributed tracing is based on the concept of *spans*: named, timed operations that are part of a single *trace*, which can involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="f5c62-178">Při zahájení nové operace se vytvoří trasování s jedinečným identifikátorem.</span><span class="sxs-lookup"><span data-stu-id="f5c62-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="f5c62-179">Pro každou dílčí operaci je vytvořen rozsah s vlastním identifikátorem a identifikátorem trasování.</span><span class="sxs-lookup"><span data-stu-id="f5c62-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="f5c62-180">V případě, že požadavek projde do systému, mohou různé komponenty vytvořit *podřízené* rozsahy, které obsahují identifikátor své *nadřazené položky*.</span><span class="sxs-lookup"><span data-stu-id="f5c62-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="f5c62-181">Rozsah má *kontext*, který obsahuje identifikátory trasování a rozsahu a také užitečná data ve formě párů klíč-hodnota (tzv. *zavazadla*).</span><span class="sxs-lookup"><span data-stu-id="f5c62-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key and value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="f5c62-182">Distribuované trasování s `DiagnosticSource`</span><span class="sxs-lookup"><span data-stu-id="f5c62-182">Distributed tracing with `DiagnosticSource`</span></span>

<span data-ttu-id="f5c62-183">.NET Core má interní modul, který se mapuje dobře na distribuované trasování a zahrnuje: [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="f5c62-183">.NET Core has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="f5c62-184">A poskytuje jednoduchý způsob, jak vytvořit a využívat diagnostiku v rámci procesu, modul `DiagnosticSource` má koncept *aktivity*.</span><span class="sxs-lookup"><span data-stu-id="f5c62-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *activity*.</span></span> <span data-ttu-id="f5c62-185">Aktivita je efektivně implementace distribuovaného trasování nebo rozpětí v rámci trasování.</span><span class="sxs-lookup"><span data-stu-id="f5c62-185">An activity is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="f5c62-186">Interní moduly se postarou o aktivity nadřazené/podřízené, včetně přidělování identifikátorů.</span><span class="sxs-lookup"><span data-stu-id="f5c62-186">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="f5c62-187">Další informace o použití `Activity`ho typu najdete v [uživatelské příručce aktivity na GitHubu](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span><span class="sxs-lookup"><span data-stu-id="f5c62-187">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span></span>

<span data-ttu-id="f5c62-188">Vzhledem k tomu, že `DiagnosticSource` je součástí základní architektury, je podporována několika základními součástmi.</span><span class="sxs-lookup"><span data-stu-id="f5c62-188">Because `DiagnosticSource` is a part of the core framework, it's supported by several core components.</span></span> <span data-ttu-id="f5c62-189">Mezi ně patří <xref:System.Net.Http.HttpClient>, Entity Framework Core a ASP.NET Core, včetně explicitní podpory v gRPC Framework.</span><span class="sxs-lookup"><span data-stu-id="f5c62-189">These include <xref:System.Net.Http.HttpClient>, Entity Framework Core, and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="f5c62-190">Když ASP.NET Core obdrží požadavek, zkontroluje dvojici hlaviček HTTP, které odpovídají standardu [trasování W3C](https://www.w3.org/TR/trace-context) Standard.</span><span class="sxs-lookup"><span data-stu-id="f5c62-190">When ASP.NET Core receives a request, it checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="f5c62-191">Pokud jsou hlavičky nalezeny, aktivita se spustí pomocí hodnot identity a kontextu z hlaviček.</span><span class="sxs-lookup"><span data-stu-id="f5c62-191">If the headers are found, an activity is started by using the identity values and context from the headers.</span></span> <span data-ttu-id="f5c62-192">Pokud se nenajde žádná záhlaví, spustí se aktivita s generovanými hodnotami identity, které odpovídají standardnímu formátu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-192">If no headers are found, an activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="f5c62-193">Jakékoli diagnostiky vygenerované rozhraním nebo kódem aplikace během životnosti této aktivity lze označit pomocí identifikátorů trasování a rozpětí.</span><span class="sxs-lookup"><span data-stu-id="f5c62-193">Any diagnostics generated by the framework or by application code during the lifetime of this activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="f5c62-194">Podpora `HttpClient` tuto možnost dále rozšiřuje kontrolou aktuální aktivity pro každý požadavek a automatickým přidáním hlaviček trasování do odchozího požadavku.</span><span class="sxs-lookup"><span data-stu-id="f5c62-194">The `HttpClient` support extends this further by checking for a current activity on every request, and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="f5c62-195">Mezi klientské a serverové knihovny ASP.NET Core gRPC patří explicitní podpora `DiagnosticSource` a `Activity`a vytváření aktivit a použití a používání informací v hlavičce automaticky.</span><span class="sxs-lookup"><span data-stu-id="f5c62-195">The ASP.NET Core gRPC client and server libraries include explicit support for `DiagnosticSource` and `Activity`, and create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="f5c62-196">To vše nastane pouze v případě, že naslouchací proces spotřebovává diagnostické informace.</span><span class="sxs-lookup"><span data-stu-id="f5c62-196">All of this happens only if a listener is consuming the diagnostic information.</span></span> <span data-ttu-id="f5c62-197">Pokud žádný naslouchací proces neexistuje, nevytvoří se žádná Diagnostika a nevytvoří se žádné aktivity.</span><span class="sxs-lookup"><span data-stu-id="f5c62-197">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsource-and-activity"></a><span data-ttu-id="f5c62-198">Přidat vlastní `DiagnosticSource` a `Activity`</span><span class="sxs-lookup"><span data-stu-id="f5c62-198">Add your own `DiagnosticSource` and `Activity`</span></span>

<span data-ttu-id="f5c62-199">Chcete-li přidat vlastní diagnostiku nebo vytvořit explicitní rozsahy v rámci kódu aplikace, přečtěte si uživatelskou příručku [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) a uživatelská [Příručka aktivity](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span><span class="sxs-lookup"><span data-stu-id="f5c62-199">To add your own diagnostics or create explicit spans within your application code, see the [DiagnosticSource User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="f5c62-200">Ukládat data distribuovaného trasování</span><span class="sxs-lookup"><span data-stu-id="f5c62-200">Store distributed trace data</span></span>

<span data-ttu-id="f5c62-201">V době psaní je projekt OpenTelemetry stále v počátečních fázích a k dispozici jsou pouze balíčky s kvalitou alfa pro aplikace .NET.</span><span class="sxs-lookup"><span data-stu-id="f5c62-201">At the time of writing, the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="f5c62-202">Projekt OpenTracing v současné době nabízí více vyspělých knihoven.</span><span class="sxs-lookup"><span data-stu-id="f5c62-202">The OpenTracing project currently offers more mature libraries.</span></span>

<span data-ttu-id="f5c62-203">Rozhraní OpenTracing API je popsané v následující části.</span><span class="sxs-lookup"><span data-stu-id="f5c62-203">The OpenTracing API is described in the following section.</span></span> <span data-ttu-id="f5c62-204">Pokud chcete ve své aplikaci použít rozhraní API OpenTelemetry, podívejte se na [úložiště sady OpenTelemetry .NET SDK](https://github.com/open-telemetry/opentelemetry-dotnet) na GitHubu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-204">If you want to use the OpenTelemetry API in your application instead, refer to the [OpenTelemetry .NET SDK repository](https://github.com/open-telemetry/opentelemetry-dotnet) on GitHub.</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="f5c62-205">Použití balíčku OpenTracing k ukládání dat distribuovaných trasování</span><span class="sxs-lookup"><span data-stu-id="f5c62-205">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="f5c62-206">[Balíček NuGet OpenTracing](https://www.nuget.org/packages/OpenTracing/) podporuje všechny back-endy kompatibilní s OpenTracing (který se dá použít nezávisle na `DiagnosticSource`).</span><span class="sxs-lookup"><span data-stu-id="f5c62-206">The [OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) supports all OpenTracing-compliant back ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="f5c62-207">Existuje další balíček z projektu příspěvků OpenTracing API, [OpenTracing. contrib. Netcore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span><span class="sxs-lookup"><span data-stu-id="f5c62-207">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span></span> <span data-ttu-id="f5c62-208">Tento balíček přidá naslouchací proces `DiagnosticSource` a automaticky zapisuje události a aktivity do back-endu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-208">This package adds a `DiagnosticSource` listener, and writes events and activities to a back end automatically.</span></span> <span data-ttu-id="f5c62-209">Povolení tohoto balíčku je jednoduché, protože ho nainstalujete z NuGet a přidáte ho jako službu ve vaší třídě `Startup`.</span><span class="sxs-lookup"><span data-stu-id="f5c62-209">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="f5c62-210">Balíček OpenTracing je abstraktní vrstva a jako takový vyžaduje implementaci specifickou pro back-end.</span><span class="sxs-lookup"><span data-stu-id="f5c62-210">The OpenTracing package is an abstraction layer, and as such it requires implementation specific to the back end.</span></span> <span data-ttu-id="f5c62-211">Implementace rozhraní API OpenTracing jsou k dispozici pro následující back-endy open source.</span><span class="sxs-lookup"><span data-stu-id="f5c62-211">OpenTracing API implementations are available for the following open source back ends.</span></span>

| <span data-ttu-id="f5c62-212">Name</span><span class="sxs-lookup"><span data-stu-id="f5c62-212">Name</span></span> | <span data-ttu-id="f5c62-213">Balíček</span><span class="sxs-lookup"><span data-stu-id="f5c62-213">Package</span></span> | <span data-ttu-id="f5c62-214">Web</span><span class="sxs-lookup"><span data-stu-id="f5c62-214">Website</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="f5c62-215">Jaeger</span><span class="sxs-lookup"><span data-stu-id="f5c62-215">Jaeger</span></span> | [<span data-ttu-id="f5c62-216">Jaeger</span><span class="sxs-lookup"><span data-stu-id="f5c62-216">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="f5c62-217">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="f5c62-217">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="f5c62-218">Elastický APM</span><span class="sxs-lookup"><span data-stu-id="f5c62-218">Elastic APM</span></span> | [<span data-ttu-id="f5c62-219">Elastický. APM. NetCoreAll</span><span class="sxs-lookup"><span data-stu-id="f5c62-219">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="f5c62-220">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="f5c62-220">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="f5c62-221">Další informace o rozhraní OpenTracing API pro .NET najdete v tématu [OpenTracing for C# ](https://github.com/opentracing/opentracing-csharp) a [OpenTracing C#contrib/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) úložiště na GitHubu.</span><span class="sxs-lookup"><span data-stu-id="f5c62-221">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="f5c62-222">[Předchozí](load-balancing.md)
>[Další](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="f5c62-222">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>
