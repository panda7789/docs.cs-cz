---
title: Zpracování částečného selhání
description: Zjistěte, jak řádně zpracovat částečné chyby. Mikroslužba nemusí být plně funkční, ale stále může být schopen provést některé užitečné práce.
ms.date: 10/16/2018
ms.openlocfilehash: 0300719360e1a2500db0af8454c91fdfe2e5b09b
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/09/2020
ms.locfileid: "80988867"
---
# <a name="handle-partial-failure"></a><span data-ttu-id="ef68c-104">Zpracování částečné poruchy</span><span class="sxs-lookup"><span data-stu-id="ef68c-104">Handle partial failure</span></span>

<span data-ttu-id="ef68c-105">V distribuovaných systémech, jako jsou aplikace založené na mikroslužbách, existuje stále přítomné riziko částečného selhání.</span><span class="sxs-lookup"><span data-stu-id="ef68c-105">In distributed systems like microservices-based applications, there's an ever-present risk of partial failure.</span></span> <span data-ttu-id="ef68c-106">Například jeden mikroslužbu/kontejner může selhat nebo nemusí být k dispozici reagovat na krátkou dobu, nebo jeden virtuální počítač nebo server může dojít k chybě.</span><span class="sxs-lookup"><span data-stu-id="ef68c-106">For instance, a single microservice/container can fail or might not be available to respond for a short time, or a single VM or server can crash.</span></span> <span data-ttu-id="ef68c-107">Vzhledem k tomu, že klienti a služby jsou samostatné procesy, služba nemusí být schopna včas reagovat na požadavek klienta.</span><span class="sxs-lookup"><span data-stu-id="ef68c-107">Since clients and services are separate processes, a service might not be able to respond in a timely way to a client's request.</span></span> <span data-ttu-id="ef68c-108">Služba může být přetížena a reagovat velmi pomalu na požadavky nebo jednoduše není přístupná na krátkou dobu z důvodu problémů se sítí.</span><span class="sxs-lookup"><span data-stu-id="ef68c-108">The service might be overloaded and responding very slowly to requests or might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="ef68c-109">Zvažte například stránku Podrobnosti objednávky z ukázkové aplikace eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="ef68c-109">For example, consider the Order details page from the eShopOnContainers sample application.</span></span> <span data-ttu-id="ef68c-110">Pokud řazení mikroslužby nereaguje, když se uživatel pokusí odeslat objednávku, chybná implementace klientského procesu (webová aplikace MVC) – například pokud by kód klienta používal synchronní rpc bez časového omezení – by blokoval podprocesy neomezeně dlouho čekající na odpověď.</span><span class="sxs-lookup"><span data-stu-id="ef68c-110">If the ordering microservice is unresponsive when the user tries to submit an order, a bad implementation of the client process (the MVC web application)—for example, if the client code were to use synchronous RPCs with no timeout—would block threads indefinitely waiting for a response.</span></span> <span data-ttu-id="ef68c-111">Kromě vytvoření špatné uživatelské prostředí, každé nereagující čekání spotřebovává nebo blokuje vlákno a vlákna jsou velmi cenné ve vysoce škálovatelné aplikace.</span><span class="sxs-lookup"><span data-stu-id="ef68c-111">Besides creating a bad user experience, every unresponsive wait consumes or blocks a thread, and threads are extremely valuable in highly scalable applications.</span></span> <span data-ttu-id="ef68c-112">Pokud existuje mnoho blokovaných vláken, nakonec může dojít k běhu aplikace.</span><span class="sxs-lookup"><span data-stu-id="ef68c-112">If there are many blocked threads, eventually the application's runtime can run out of threads.</span></span> <span data-ttu-id="ef68c-113">V takovém případě aplikace může být globálně nereagující namísto jen částečně neodpovídá, jak je znázorněno na obrázku 8-1.</span><span class="sxs-lookup"><span data-stu-id="ef68c-113">In that case, the application can become globally unresponsive instead of just partially unresponsive, as shown in Figure 8-1.</span></span>

![Diagram zobrazující částečné chyby.](./media/handle-partial-failure/partial-failures-diagram.png)

<span data-ttu-id="ef68c-115">**Obrázek 8-1**.</span><span class="sxs-lookup"><span data-stu-id="ef68c-115">**Figure 8-1**.</span></span> <span data-ttu-id="ef68c-116">Částečné chyby z důvodu závislostí, které mají vliv na dostupnost vlákna služby</span><span class="sxs-lookup"><span data-stu-id="ef68c-116">Partial failures because of dependencies that impact service thread availability</span></span>

<span data-ttu-id="ef68c-117">Ve velké aplikace založené na mikroslužbách může být zesilována jakákoli částečná chyba, zejména pokud je většina interní interakce mikroslužeb založena na synchronních voláních HTTP (což je považováno za anti-pattern).</span><span class="sxs-lookup"><span data-stu-id="ef68c-117">In a large microservices-based application, any partial failure can be amplified, especially if most of the internal microservices interaction is based on synchronous HTTP calls (which is considered an anti-pattern).</span></span> <span data-ttu-id="ef68c-118">Zamyslete se nad systémem, který přijímá miliony příchozích hovorů denně.</span><span class="sxs-lookup"><span data-stu-id="ef68c-118">Think about a system that receives millions of incoming calls per day.</span></span> <span data-ttu-id="ef68c-119">Pokud váš systém má špatný návrh, který je založen na dlouhé řetězce synchronní volání HTTP, tyto příchozí volání může mít za následek mnoho dalších milionů odchozích volání (předpokládejme poměr 1:4) k desítkám interních mikroslužeb jako synchronní závislosti.</span><span class="sxs-lookup"><span data-stu-id="ef68c-119">If your system has a bad design that's based on long chains of synchronous HTTP calls, these incoming calls might result in many more millions of outgoing calls (let's suppose a ratio of 1:4) to dozens of internal microservices as synchronous dependencies.</span></span> <span data-ttu-id="ef68c-120">Tato situace je znázorněna na obrázku \#8-2, zejména závislost 3, která spustí řetěz, volání závislosti #4.</span><span class="sxs-lookup"><span data-stu-id="ef68c-120">This situation is shown in Figure 8-2, especially dependency \#3, that starts a chain, calling dependency #4.</span></span> <span data-ttu-id="ef68c-121">které #5 hovory.</span><span class="sxs-lookup"><span data-stu-id="ef68c-121">which the calls #5.</span></span>

![Diagram znázorňující více distribuovaných závislostí.](./media/handle-partial-failure/multiple-distributed-dependencies.png)

<span data-ttu-id="ef68c-123">**Obrázek 8-2**.</span><span class="sxs-lookup"><span data-stu-id="ef68c-123">**Figure 8-2**.</span></span> <span data-ttu-id="ef68c-124">Dopad nesprávného návrhu s dlouhými řetězci požadavků HTTP</span><span class="sxs-lookup"><span data-stu-id="ef68c-124">The impact of having an incorrect design featuring long chains of HTTP requests</span></span>

<span data-ttu-id="ef68c-125">Občasné selhání je zaručeno v distribuovaném a cloudovém systému, i když každá závislost sama o sobě má vynikající dostupnost.</span><span class="sxs-lookup"><span data-stu-id="ef68c-125">Intermittent failure is guaranteed in a distributed and cloud-based system, even if every dependency itself has excellent availability.</span></span> <span data-ttu-id="ef68c-126">Je to fakt, který musíš zvážit.</span><span class="sxs-lookup"><span data-stu-id="ef68c-126">It's a fact you need to consider.</span></span>

<span data-ttu-id="ef68c-127">Pokud nenavrhujete a neimplementujete techniky k zajištění odolnosti proti chybám, mohou být zesíleny i malé prostoje.</span><span class="sxs-lookup"><span data-stu-id="ef68c-127">If you do not design and implement techniques to ensure fault tolerance, even small downtimes can be amplified.</span></span> <span data-ttu-id="ef68c-128">Například 50 závislostí s 99,99 % dostupnosti by mělo za následek několik hodin prostojů každý měsíc z důvodu tohoto dominový efekt.</span><span class="sxs-lookup"><span data-stu-id="ef68c-128">As an example, 50 dependencies each with 99.99% of availability would result in several hours of downtime each month because of this ripple effect.</span></span> <span data-ttu-id="ef68c-129">Pokud závislost mikroslužeb selže při zpracování velkého objemu požadavků, tato chyba může rychle nasytit všechna dostupná vlákna požadavků v každé službě a selhání celé aplikace.</span><span class="sxs-lookup"><span data-stu-id="ef68c-129">When a microservice dependency fails while handling a high volume of requests, that failure can quickly saturate all available request threads in each service and crash the whole application.</span></span>

![Diagram znázorňující částečné selhání zesílené v mikroslužbách.](./media/handle-partial-failure/partial-failure-amplified-microservices.png)

<span data-ttu-id="ef68c-131">**Obrázek 8-3**.</span><span class="sxs-lookup"><span data-stu-id="ef68c-131">**Figure 8-3**.</span></span> <span data-ttu-id="ef68c-132">Částečné selhání zesílené mikroslužbami s dlouhými řetězci synchronních volání HTTP</span><span class="sxs-lookup"><span data-stu-id="ef68c-132">Partial failure amplified by microservices with long chains of synchronous HTTP calls</span></span>

<span data-ttu-id="ef68c-133">Chcete-li minimalizovat tento problém, v části [Asynchronní integrace mikroslužeb vynucují autonomii mikroslužeb](../architect-microservice-container-applications/communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy), tato příručka doporučuje používat asynchronní komunikaci napříč interní mikroslužby.</span><span class="sxs-lookup"><span data-stu-id="ef68c-133">To minimize this problem, in the section [Asynchronous microservice integration enforce microservice's autonomy](../architect-microservice-container-applications/communication-in-microservice-architecture.md#asynchronous-microservice-integration-enforces-microservices-autonomy), this guide encourages you to use asynchronous communication across the internal microservices.</span></span>

<span data-ttu-id="ef68c-134">Kromě toho je nezbytné, abyste navrhli mikroslužeb a klientské aplikace pro zpracování částečných selhání – to znamená vytvořit odolné mikroslužby a klientské aplikace.</span><span class="sxs-lookup"><span data-stu-id="ef68c-134">In addition, it's essential that you design your microservices and client applications to handle partial failures—that is, to build resilient microservices and client applications.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="ef68c-135">[Předchozí](index.md)
>[další](partial-failure-strategies.md)</span><span class="sxs-lookup"><span data-stu-id="ef68c-135">[Previous](index.md)
[Next](partial-failure-strategies.md)</span></span>
