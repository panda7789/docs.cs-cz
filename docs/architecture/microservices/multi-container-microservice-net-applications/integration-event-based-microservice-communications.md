---
title: Implementace komunikace mezi mikroslužbami založené na událostech (události integrace)
description: Architektura mikroslužeb .NET pro kontejnerizované aplikace .NET | Porozumět událostem integrace k implementaci komunikace založené na událostech mezi mikroslužbami.
ms.date: 10/02/2018
ms.openlocfilehash: 8a1d4950247d63e5684c85c029efccf8269e7435
ms.sourcegitcommit: e3cbf26d67f7e9286c7108a2752804050762d02d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/09/2020
ms.locfileid: "80988320"
---
# <a name="implementing-event-based-communication-between-microservices-integration-events"></a><span data-ttu-id="5f6be-103">Implementace komunikace mezi mikroslužbami založené na událostech (události integrace)</span><span class="sxs-lookup"><span data-stu-id="5f6be-103">Implementing event-based communication between microservices (integration events)</span></span>

<span data-ttu-id="5f6be-104">Jak je popsáno dříve, při použití komunikace založené na událostech, mikroslužba publikuje událost, když se stane něco pozoruhodného, například když aktualizuje obchodní entitu.</span><span class="sxs-lookup"><span data-stu-id="5f6be-104">As described earlier, when you use event-based communication, a microservice publishes an event when something notable happens, such as when it updates a business entity.</span></span> <span data-ttu-id="5f6be-105">Ostatní mikroslužby přihlásit k odběru těchto událostí.</span><span class="sxs-lookup"><span data-stu-id="5f6be-105">Other microservices subscribe to those events.</span></span> <span data-ttu-id="5f6be-106">Když mikroslužba obdrží událost, může aktualizovat své vlastní obchodní entity, což může vést k publikování dalších událostí.</span><span class="sxs-lookup"><span data-stu-id="5f6be-106">When a microservice receives an event, it can update its own business entities, which might lead to more events being published.</span></span> <span data-ttu-id="5f6be-107">To je podstata konečného konceptu konzistence.</span><span class="sxs-lookup"><span data-stu-id="5f6be-107">This is the essence of the eventual consistency concept.</span></span> <span data-ttu-id="5f6be-108">Tento systém publikování/odběru se obvykle provádí pomocí implementace sběrnice událostí.</span><span class="sxs-lookup"><span data-stu-id="5f6be-108">This publish/subscribe system is usually performed by using an implementation of an event bus.</span></span> <span data-ttu-id="5f6be-109">Sběrnice událostí může být navržena jako rozhraní s rozhraním API potřebným k přihlášení k odběru a odhlášení z odběru událostí a publikování událostí.</span><span class="sxs-lookup"><span data-stu-id="5f6be-109">The event bus can be designed as an interface with the API needed to subscribe and unsubscribe to events and to publish events.</span></span> <span data-ttu-id="5f6be-110">Může mít také jednu nebo více implementací založených na jakékoli komunikaci mezi procesy nebo zasílání zpráv, jako je například fronta zpráv nebo sběrnice služby, která podporuje asynchronní komunikaci a model publikování/odběru.</span><span class="sxs-lookup"><span data-stu-id="5f6be-110">It can also have one or more implementations based on any inter-process or messaging communication, such as a messaging queue or a service bus that supports asynchronous communication and a publish/subscribe model.</span></span>

<span data-ttu-id="5f6be-111">Události můžete použít k implementaci obchodních transakcí, které pokrývají více služeb, což vám dává konečnou konzistenci mezi těmito službami.</span><span class="sxs-lookup"><span data-stu-id="5f6be-111">You can use events to implement business transactions that span multiple services, which gives you eventual consistency between those services.</span></span> <span data-ttu-id="5f6be-112">Nakonec konzistentní transakce se skládá z řady distribuovaných akcí.</span><span class="sxs-lookup"><span data-stu-id="5f6be-112">An eventually consistent transaction consists of a series of distributed actions.</span></span> <span data-ttu-id="5f6be-113">Při každé akci mikroslužby aktualizuje obchodní entity a publikuje událost, která aktivuje další akci.</span><span class="sxs-lookup"><span data-stu-id="5f6be-113">At each action, the microservice updates a business entity and publishes an event that triggers the next action.</span></span> <span data-ttu-id="5f6be-114">Obrázek 6-18 níže, ukazuje PriceUpdated událost publikovaná prostřednictvím a sběrnice událostí, takže aktualizace ceny je rozšířena do košíku a dalších mikroslužeb.</span><span class="sxs-lookup"><span data-stu-id="5f6be-114">Figure 6-18 below, shows a PriceUpdated event published through and event bus, so the price update is propagated to the Basket and other microservices.</span></span>

![Diagram asynchronní komunikace řízené událostmi se sběrnicí událostí.](./media/integration-event-based-microservice-communications/event-driven-communication.png)

<span data-ttu-id="5f6be-116">**Obrázek 6-18**.</span><span class="sxs-lookup"><span data-stu-id="5f6be-116">**Figure 6-18**.</span></span> <span data-ttu-id="5f6be-117">Komunikace řízená událostmi na základě sběrnice událostí</span><span class="sxs-lookup"><span data-stu-id="5f6be-117">Event-driven communication based on an event bus</span></span>

<span data-ttu-id="5f6be-118">Tato část popisuje, jak můžete implementovat tento typ komunikace s rozhraním .NET pomocí obecného rozhraní sběrnice událostí, jak je znázorněno na obrázku 6-18.</span><span class="sxs-lookup"><span data-stu-id="5f6be-118">This section describes how you can implement this type of communication with .NET by using a generic event bus interface, as shown in Figure 6-18.</span></span> <span data-ttu-id="5f6be-119">Existuje několik potenciálních implementací, z nichž každá používá jinou technologii nebo infrastrukturu, jako je RabbitMQ, Azure Service Bus nebo jakákoli jiná open source nebo komerční sběrnice.</span><span class="sxs-lookup"><span data-stu-id="5f6be-119">There are multiple potential implementations, each using a different technology or infrastructure such as RabbitMQ, Azure Service Bus, or any other third-party open-source or commercial service bus.</span></span>

## <a name="using-message-brokers-and-services-buses-for-production-systems"></a><span data-ttu-id="5f6be-120">Použití zprostředkovatelů zpráv a sběrnic služeb pro výrobní systémy</span><span class="sxs-lookup"><span data-stu-id="5f6be-120">Using message brokers and services buses for production systems</span></span>

<span data-ttu-id="5f6be-121">Jak je uvedeno v části architektura, můžete si vybrat z více technologií zasílání zpráv pro implementaci sběrnice abstraktní události.</span><span class="sxs-lookup"><span data-stu-id="5f6be-121">As noted in the architecture section, you can choose from multiple messaging technologies for implementing your abstract event bus.</span></span> <span data-ttu-id="5f6be-122">Ale tyto technologie jsou na různých úrovních.</span><span class="sxs-lookup"><span data-stu-id="5f6be-122">But these technologies are at different levels.</span></span> <span data-ttu-id="5f6be-123">Například RabbitMQ, přenos zprostředkovatele zasílání zpráv, je na nižší úrovni než komerční produkty, jako je Azure Service Bus, NServiceBus, MassTransit nebo Brighter.</span><span class="sxs-lookup"><span data-stu-id="5f6be-123">For instance, RabbitMQ, a messaging broker transport, is at a lower level than commercial products like Azure Service Bus, NServiceBus, MassTransit, or Brighter.</span></span> <span data-ttu-id="5f6be-124">Většina těchto produktů může fungovat na webu RabbitMQ nebo Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="5f6be-124">Most of these products can work on top of either RabbitMQ or Azure Service Bus.</span></span> <span data-ttu-id="5f6be-125">Výběr produktu závisí na tom, kolik funkcí a kolik out-of-the-box škálovatelnost, kterou potřebujete pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="5f6be-125">Your choice of product depends on how many features and how much out-of-the-box scalability you need for your application.</span></span>

<span data-ttu-id="5f6be-126">Pro implementaci pouze sběrnice událostí proof-of-concept pro vývojové prostředí, jako v eShopOnContainers vzorku, jednoduchá implementace nad RabbitMQ běží jako kontejner může stačit.</span><span class="sxs-lookup"><span data-stu-id="5f6be-126">For implementing just an event bus proof-of-concept for your development environment, as in the eShopOnContainers sample, a simple implementation on top of RabbitMQ running as a container might be enough.</span></span> <span data-ttu-id="5f6be-127">Ale pro kritické a produkční systémy, které vyžadují vysokou škálovatelnost, můžete chtít vyhodnotit a používat Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="5f6be-127">But for mission-critical and production systems that need high scalability, you might want to evaluate and use Azure Service Bus.</span></span>

<span data-ttu-id="5f6be-128">Pokud požadujete abstrakce na vysoké úrovni a bohatší funkce, jako [je Sagas](https://docs.particular.net/nservicebus/sagas/) pro dlouhotrvající procesy, které usnadňují distribuovaný vývoj, stojí za to vyhodnotit další komerční a open source servisní autobusy, jako je NServiceBus, MassTransit a Brighter.</span><span class="sxs-lookup"><span data-stu-id="5f6be-128">If you require high-level abstractions and richer features like [Sagas](https://docs.particular.net/nservicebus/sagas/) for long-running processes that make distributed development easier, other commercial and open-source service buses like NServiceBus, MassTransit, and Brighter are worth evaluating.</span></span> <span data-ttu-id="5f6be-129">V tomto případě abstrakce a API k použití by obvykle přímo ty, které poskytují tyto vysoké úrovni servisní chrupnaté místo své vlastní abstrakce (jako [jednoduché abstrakce události sběrnice poskytované na eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span><span class="sxs-lookup"><span data-stu-id="5f6be-129">In this case, the abstractions and API to use would usually be directly the ones provided by those high-level service buses instead of your own abstractions (like the [simple event bus abstractions provided at eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers/blob/dev/src/BuildingBlocks/EventBus/EventBus/Abstractions/IEventBus.cs)).</span></span> <span data-ttu-id="5f6be-130">Když na to přijde, můžete zkoumat [rozlokka eShopOnContainers pomocí NServiceBus](https://go.particular.net/eShopOnContainers) (další odvozené ukázky implementované konkrétní software).</span><span class="sxs-lookup"><span data-stu-id="5f6be-130">For that matter, you can research the [forked eShopOnContainers using NServiceBus](https://go.particular.net/eShopOnContainers) (additional derived sample implemented by Particular Software).</span></span>

<span data-ttu-id="5f6be-131">Samozřejmě můžete vždy vytvořit vlastní funkce sběrnice na nižší úrovni technologií, jako je RabbitMQ a Docker, ale práce potřebná k "znovuobjevení kola" může být příliš nákladná pro vlastní podnikovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="5f6be-131">Of course, you could always build your own service bus features on top of lower-level technologies like RabbitMQ and Docker, but the work needed to "reinvent the wheel" might be too costly for a custom enterprise application.</span></span>

<span data-ttu-id="5f6be-132">Chcete-li zopakovat: ukázkové abstrakce sběrnice událostí a implementace uvedené v eShopOnContainers vzorku jsou určeny k použití pouze jako důkaz koncepce.</span><span class="sxs-lookup"><span data-stu-id="5f6be-132">To reiterate: the sample event bus abstractions and implementation showcased in the eShopOnContainers sample are intended to be used only as a proof of concept.</span></span> <span data-ttu-id="5f6be-133">Jakmile se rozhodnete, že chcete mít asynchronní a událostmi řízenou komunikaci, jak je vysvětleno v aktuální části, měli byste zvolit produkt sběrnice, který nejlépe vyhovuje vašim potřebám pro výrobu.</span><span class="sxs-lookup"><span data-stu-id="5f6be-133">Once you have decided that you want to have asynchronous and event-driven communication, as explained in the current section, you should choose the service bus product that best fits your needs for production.</span></span>

## <a name="integration-events"></a><span data-ttu-id="5f6be-134">Události integrace</span><span class="sxs-lookup"><span data-stu-id="5f6be-134">Integration events</span></span>

<span data-ttu-id="5f6be-135">Události integrace se používají pro synchronizaci stavu domény ve více mikroslužbách nebo externích systémech.</span><span class="sxs-lookup"><span data-stu-id="5f6be-135">Integration events are used for bringing domain state in sync across multiple microservices or external systems.</span></span> <span data-ttu-id="5f6be-136">To se provádí publikováním událostí integrace mimo mikroslužbu.</span><span class="sxs-lookup"><span data-stu-id="5f6be-136">This is done by publishing integration events outside the microservice.</span></span> <span data-ttu-id="5f6be-137">Při publikování události do více mikroslužeb příjemce (tolik mikroslužeb, jak jsou přihlášeni k odběru události integrace), příslušné obslužné rutiny události v každém mikroslužbě příjemce zpracovává událost.</span><span class="sxs-lookup"><span data-stu-id="5f6be-137">When an event is published to multiple receiver microservices (to as many microservices as are subscribed to the integration event), the appropriate event handler in each receiver microservice handles the event.</span></span>

<span data-ttu-id="5f6be-138">Událost integrace je v podstatě třída pro držení dat, jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="5f6be-138">An integration event is basically a data-holding class, as in the following example:</span></span>

```csharp
public class ProductPriceChangedIntegrationEvent : IntegrationEvent
{
    public int ProductId { get; private set; }
    public decimal NewPrice { get; private set; }
    public decimal OldPrice { get; private set; }

    public ProductPriceChangedIntegrationEvent(int productId, decimal newPrice,
        decimal oldPrice)
    {
        ProductId = productId;
        NewPrice = newPrice;
        OldPrice = oldPrice;
    }
}
```

<span data-ttu-id="5f6be-139">Události integrace lze definovat na úrovni aplikace každé mikroslužby, takže jsou odděleny od jiných mikroslužeb, způsobem srovnatelným s tím, jak Jsou definovány ViewModels v serveru a klienta.</span><span class="sxs-lookup"><span data-stu-id="5f6be-139">The integration events can be defined at the application level of each microservice, so they are decoupled from other microservices, in a way comparable to how ViewModels are defined in the server and client.</span></span> <span data-ttu-id="5f6be-140">Co se nedoporučuje, je sdílení společné knihovny událostí integrace mezi více mikroslužeb; přitom by bylo propojení těchto mikroslužeb s knihovnou dat definice jedné události.</span><span class="sxs-lookup"><span data-stu-id="5f6be-140">What is not recommended is sharing a common integration events library across multiple microservices; doing that would be coupling those microservices with a single event definition data library.</span></span> <span data-ttu-id="5f6be-141">Nechcete to provést ze stejných důvodů, proč nechcete sdílet společný model domény napříč více mikroslužeb: mikroslužeb musí být zcela autonomní.</span><span class="sxs-lookup"><span data-stu-id="5f6be-141">You do not want to do that for the same reasons that you do not want to share a common domain model across multiple microservices: microservices must be completely autonomous.</span></span>

<span data-ttu-id="5f6be-142">Existuje pouze několik druhů knihoven, které byste měli sdílet mezi mikroslužbami.</span><span class="sxs-lookup"><span data-stu-id="5f6be-142">There are only a few kinds of libraries you should share across microservices.</span></span> <span data-ttu-id="5f6be-143">Jedním z nich jsou knihovny, které jsou konečné bloky aplikace, jako [je rozhraní API klienta event bus](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), jako v eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="5f6be-143">One is libraries that are final application blocks, like the [Event Bus client API](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/BuildingBlocks/EventBus), as in eShopOnContainers.</span></span> <span data-ttu-id="5f6be-144">Dalším je knihovny, které představují nástroje, které by mohly být také sdíleny jako součásti NuGet, jako jsou serializátory JSON.</span><span class="sxs-lookup"><span data-stu-id="5f6be-144">Another is libraries that constitute tools that could also be shared as NuGet components, like JSON serializers.</span></span>

## <a name="the-event-bus"></a><span data-ttu-id="5f6be-145">Sběrnice událostí</span><span class="sxs-lookup"><span data-stu-id="5f6be-145">The event bus</span></span>

<span data-ttu-id="5f6be-146">Sběrnice událostí umožňuje publikovat/odebírat styl komunikace mezi mikroslužeb bez nutnosti komponenty explicitně znát navzájem, jak je znázorněno na obrázku 6-19.</span><span class="sxs-lookup"><span data-stu-id="5f6be-146">An event bus allows publish/subscribe-style communication between microservices without requiring the components to explicitly be aware of each other, as shown in Figure 6-19.</span></span>

![Diagram znázorňující základní vzor publikování/odběru.](./media/integration-event-based-microservice-communications/publish-subscribe-basics.png)

<span data-ttu-id="5f6be-148">**Obrázek 6-19**.</span><span class="sxs-lookup"><span data-stu-id="5f6be-148">**Figure 6-19**.</span></span> <span data-ttu-id="5f6be-149">Publikování/přihlášení k odběru základů pomocí sběrnice událostí</span><span class="sxs-lookup"><span data-stu-id="5f6be-149">Publish/subscribe basics with an event bus</span></span>

<span data-ttu-id="5f6be-150">Výše uvedený diagram ukazuje, že mikroslužeb A publikuje na Event Bus, který distribuuje k odběru mikroslužeb B a C, aniž by vydavatel potřebuje znát předplatitele.</span><span class="sxs-lookup"><span data-stu-id="5f6be-150">The above diagram shows that microservice A publishes to Event Bus, which distributes to subscribing microservices B and C, without the publisher needing to know the subscribers.</span></span> <span data-ttu-id="5f6be-151">Sběrnice událostí souvisí s Observer vzor a publikování odběru vzor.</span><span class="sxs-lookup"><span data-stu-id="5f6be-151">The event bus is related to the Observer pattern and the publish-subscribe pattern.</span></span>

### <a name="observer-pattern"></a><span data-ttu-id="5f6be-152">Vzor pozorovatele</span><span class="sxs-lookup"><span data-stu-id="5f6be-152">Observer pattern</span></span>

<span data-ttu-id="5f6be-153">Ve [vzoru Observer](https://en.wikipedia.org/wiki/Observer_pattern), primární objekt (označovaný jako pozorovatelné) upozorní další objekty zájem (označované jako Pozorovatelé) s relevantní informace (události).</span><span class="sxs-lookup"><span data-stu-id="5f6be-153">In the [Observer pattern](https://en.wikipedia.org/wiki/Observer_pattern), your primary object (known as the Observable) notifies other interested objects (known as Observers) with relevant information (events).</span></span>

### <a name="publishsubscribe-pubsub-pattern"></a><span data-ttu-id="5f6be-154">Vzor Publikovat/Přihlásit se k odběru (Pub/Sub)</span><span class="sxs-lookup"><span data-stu-id="5f6be-154">Publish/Subscribe (Pub/Sub) pattern</span></span>

<span data-ttu-id="5f6be-155">Účel [publikování/odběru vzor](https://docs.microsoft.com/previous-versions/msp-n-p/ff649664(v=pandp.10)) je stejný jako Observer vzor: chcete upozornit ostatní služby, když dojde k určité události.</span><span class="sxs-lookup"><span data-stu-id="5f6be-155">The purpose of the [Publish/Subscribe pattern](https://docs.microsoft.com/previous-versions/msp-n-p/ff649664(v=pandp.10)) is the same as the Observer pattern: you want to notify other services when certain events take place.</span></span> <span data-ttu-id="5f6be-156">Ale tam je důležitý rozdíl mezi Pozorovatel a Pub / Sub vzory.</span><span class="sxs-lookup"><span data-stu-id="5f6be-156">But there is an important difference between the Observer and Pub/Sub patterns.</span></span> <span data-ttu-id="5f6be-157">Ve vzoru pozorovatele se vysílání provádí přímo z pozorovatelných pozorovatelů, takže se navzájem "znají".</span><span class="sxs-lookup"><span data-stu-id="5f6be-157">In the observer pattern, the broadcast is performed directly from the observable to the observers, so they "know" each other.</span></span> <span data-ttu-id="5f6be-158">Ale při použití Pub / Sub vzor, je třetí součást, volal broker nebo zprávy broker nebo událost sběrnice, která je známa vydavatel i odběratel.</span><span class="sxs-lookup"><span data-stu-id="5f6be-158">But when using a Pub/Sub pattern, there is a third component, called broker or message broker or event bus, which is known by both the publisher and subscriber.</span></span> <span data-ttu-id="5f6be-159">Proto při použití Pub / Sub vzor vydavatel a odběratelé jsou přesně odděleny díky uvedené události sběrnice nebo zprávy broker.</span><span class="sxs-lookup"><span data-stu-id="5f6be-159">Therefore, when using the Pub/Sub pattern the publisher and the subscribers are precisely decoupled thanks to the mentioned event bus or message broker.</span></span>

### <a name="the-middleman-or-event-bus"></a><span data-ttu-id="5f6be-160">Prostředník nebo autobus událostí</span><span class="sxs-lookup"><span data-stu-id="5f6be-160">The middleman or event bus</span></span>

<span data-ttu-id="5f6be-161">Jak dosáhnout anonymity mezi vydavatelem a předplatitelem?</span><span class="sxs-lookup"><span data-stu-id="5f6be-161">How do you achieve anonymity between publisher and subscriber?</span></span> <span data-ttu-id="5f6be-162">Snadný způsob je nechat prostředníka, aby se postaral o veškerou komunikaci.</span><span class="sxs-lookup"><span data-stu-id="5f6be-162">An easy way is let a middleman take care of all the communication.</span></span> <span data-ttu-id="5f6be-163">Autobus událostí je jeden takový prostředník.</span><span class="sxs-lookup"><span data-stu-id="5f6be-163">An event bus is one such middleman.</span></span>

<span data-ttu-id="5f6be-164">Sběrnice událostí se obvykle skládá ze dvou částí:</span><span class="sxs-lookup"><span data-stu-id="5f6be-164">An event bus is typically composed of two parts:</span></span>

- <span data-ttu-id="5f6be-165">Abstrakce nebo rozhraní.</span><span class="sxs-lookup"><span data-stu-id="5f6be-165">The abstraction or interface.</span></span>

- <span data-ttu-id="5f6be-166">Jedna nebo více implementací.</span><span class="sxs-lookup"><span data-stu-id="5f6be-166">One or more implementations.</span></span>

<span data-ttu-id="5f6be-167">Na obrázku 6-19 můžete vidět, jak z hlediska aplikace není sběrnice událostí ničím jiným než kanálem Pub/Sub.</span><span class="sxs-lookup"><span data-stu-id="5f6be-167">In Figure 6-19 you can see how, from an application point of view, the event bus is nothing more than a Pub/Sub channel.</span></span> <span data-ttu-id="5f6be-168">Způsob implementace této asynchronní komunikace se může lišit.</span><span class="sxs-lookup"><span data-stu-id="5f6be-168">The way you implement this asynchronous communication can vary.</span></span> <span data-ttu-id="5f6be-169">Může mít více implementací, takže mezi nimi můžete přepínat v závislosti na požadavcích na prostředí (například produkční versus vývojová prostředí).</span><span class="sxs-lookup"><span data-stu-id="5f6be-169">It can have multiple implementations so that you can swap between them, depending on the environment requirements (for example, production versus development environments).</span></span>

<span data-ttu-id="5f6be-170">Na obrázku 6-20 můžete vidět abstrakci sběrnice událostí s více implementacemi na základě technologií zasílání zpráv infrastruktury, jako je RabbitMQ, Azure Service Bus nebo jiného zprostředkovatele událostí nebo zpráv.</span><span class="sxs-lookup"><span data-stu-id="5f6be-170">In Figure 6-20 you can see an abstraction of an event bus with multiple implementations based on infrastructure messaging technologies like RabbitMQ, Azure Service Bus, or another event/message broker.</span></span>

![Diagram znázorňující přidání vrstvy abstrakce sběrnice událostí.](./media/integration-event-based-microservice-communications/multiple-implementations-event-bus.png)

<span data-ttu-id="5f6be-172">**Obrázek 6- 20.**</span><span class="sxs-lookup"><span data-stu-id="5f6be-172">**Figure 6- 20.**</span></span> <span data-ttu-id="5f6be-173">Více implementací sběrnice událostí</span><span class="sxs-lookup"><span data-stu-id="5f6be-173">Multiple implementations of an event bus</span></span>

<span data-ttu-id="5f6be-174">Je dobré mít sběrnici událostí definovanou prostřednictvím rozhraní, aby ji bylo možné implementovat pomocí několika technologií, jako je sběrnice RabbitMQ Azure Service nebo jiné.</span><span class="sxs-lookup"><span data-stu-id="5f6be-174">It's good to have the event bus defined through an interface so it can be implemented with several technologies, like RabbitMQ Azure Service bus or others.</span></span> <span data-ttu-id="5f6be-175">Nicméně, a jak již bylo zmíněno dříve, pomocí vlastní abstrakce (rozhraní sběrnice událostí) je dobré pouze v případě, že potřebujete základní funkce sběrnice událostí podporované abstrakce.</span><span class="sxs-lookup"><span data-stu-id="5f6be-175">However, and as mentioned previously, using your own abstractions (the event bus interface) is good only if you need basic event bus features supported by your abstractions.</span></span> <span data-ttu-id="5f6be-176">Pokud potřebujete bohatší funkce služby Service Bus, měli byste pravděpodobně použít rozhraní API a abstrakce poskytované upřednostňovanou komerční sběrnicí služby namísto vlastních abstrakcí.</span><span class="sxs-lookup"><span data-stu-id="5f6be-176">If you need richer service bus features, you should probably use the API and abstractions provided by your preferred commercial service bus instead of your own abstractions.</span></span>

### <a name="defining-an-event-bus-interface"></a><span data-ttu-id="5f6be-177">Definování rozhraní sběrnice událostí</span><span class="sxs-lookup"><span data-stu-id="5f6be-177">Defining an event bus interface</span></span>

<span data-ttu-id="5f6be-178">Začněme s některými kódimplementace pro rozhraní sběrnice událostí a možné implementace pro účely průzkumu.</span><span class="sxs-lookup"><span data-stu-id="5f6be-178">Let's start with some implementation code for the event bus interface and possible implementations for exploration purposes.</span></span> <span data-ttu-id="5f6be-179">Rozhraní by mělo být obecné a jednoduché, jako v následujícím rozhraní.</span><span class="sxs-lookup"><span data-stu-id="5f6be-179">The interface should be generic and straightforward, as in the following interface.</span></span>

```csharp
public interface IEventBus
{
    void Publish(IntegrationEvent @event);

    void Subscribe<T, TH>()
        where T : IntegrationEvent
        where TH : IIntegrationEventHandler<T>;

    void SubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void UnsubscribeDynamic<TH>(string eventName)
        where TH : IDynamicIntegrationEventHandler;

    void Unsubscribe<T, TH>()
        where TH : IIntegrationEventHandler<T>
        where T : IntegrationEvent;
}
```

<span data-ttu-id="5f6be-180">Metoda `Publish` je přímočará.</span><span class="sxs-lookup"><span data-stu-id="5f6be-180">The `Publish` method is straightforward.</span></span> <span data-ttu-id="5f6be-181">Sběrnice událostí bude vysílat integrační událost, která jí byla předána jakékoli mikroslužbě nebo dokonce externí aplikaci, která se k této události přihlásila.</span><span class="sxs-lookup"><span data-stu-id="5f6be-181">The event bus will broadcast the integration event passed to it to any microservice, or even an external application, subscribed to that event.</span></span> <span data-ttu-id="5f6be-182">Tato metoda se používá mikroslužby, která publikuje událost.</span><span class="sxs-lookup"><span data-stu-id="5f6be-182">This method is used by the microservice that is publishing the event.</span></span>

<span data-ttu-id="5f6be-183">Metody `Subscribe` (můžete mít několik implementací v závislosti na argumenty) jsou používány mikroslužeb, které chcete přijímat události.</span><span class="sxs-lookup"><span data-stu-id="5f6be-183">The `Subscribe` methods (you can have several implementations depending on the arguments) are used by the microservices that want to receive events.</span></span> <span data-ttu-id="5f6be-184">Tato metoda má dva argumenty.</span><span class="sxs-lookup"><span data-stu-id="5f6be-184">This method has two arguments.</span></span> <span data-ttu-id="5f6be-185">První je integrační událost, k které se můžete přihlásit (`IntegrationEvent`).</span><span class="sxs-lookup"><span data-stu-id="5f6be-185">The first is the integration event to subscribe to (`IntegrationEvent`).</span></span> <span data-ttu-id="5f6be-186">Druhý argument je obslužná rutina `IIntegrationEventHandler<T>`události integrace (nebo metoda zpětného volání), s názvem , která má být provedena, když mikroslužba příjemce získá zprávu události integrace.</span><span class="sxs-lookup"><span data-stu-id="5f6be-186">The second argument is the integration event handler (or callback method), named `IIntegrationEventHandler<T>`, to be executed when the receiver microservice gets that integration event message.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="5f6be-187">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="5f6be-187">Additional resources</span></span>

<span data-ttu-id="5f6be-188">Některá řešení zasílání zpráv připravená pro produkční prostředí:</span><span class="sxs-lookup"><span data-stu-id="5f6be-188">Some production-ready messaging solutions:</span></span>

- <span data-ttu-id="5f6be-189">**Azure Service Bus** </span><span class="sxs-lookup"><span data-stu-id="5f6be-189">**Azure Service Bus** </span></span>\
  <https://docs.microsoft.com/azure/service-bus-messaging/>
  
- <span data-ttu-id="5f6be-190">**Sběrnice NServiceBus** </span><span class="sxs-lookup"><span data-stu-id="5f6be-190">**NServiceBus** </span></span>\
  <https://particular.net/nservicebus>
  
- <span data-ttu-id="5f6be-191">**Hromadná doprava** </span><span class="sxs-lookup"><span data-stu-id="5f6be-191">**MassTransit** </span></span>\
  <https://masstransit-project.com/>

> [!div class="step-by-step"]
> <span data-ttu-id="5f6be-192">[Předchozí](database-server-container.md)
> [další](rabbitmq-event-bus-development-test-environment.md)</span><span class="sxs-lookup"><span data-stu-id="5f6be-192">[Previous](database-server-container.md)
[Next](rabbitmq-event-bus-development-test-environment.md)</span></span>
