---
title: Použití zjednodušených vzorů CQRS a DDD v mikroslužbě
description: Architektura mikroslužeb .NET pro kontejnerizované aplikace .NET | Seznamte se s celkovým vztahem mezi vzory CQRS a DDD.
ms.date: 10/08/2018
ms.openlocfilehash: e4e36bafff39f5f30d6371ed7c113322a85c3362
ms.sourcegitcommit: f87ad41b8e62622da126aa928f7640108c4eff98
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/07/2020
ms.locfileid: "80805588"
---
# <a name="apply-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="3dee7-103">Použití zjednodušených vzorů CQRS a DDD v mikroslužbě</span><span class="sxs-lookup"><span data-stu-id="3dee7-103">Apply simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="3dee7-104">CQRS je architektonický vzor, který odděluje modely pro čtení a zápis dat.</span><span class="sxs-lookup"><span data-stu-id="3dee7-104">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="3dee7-105">Související termín [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) byl původně definován Bertrandmeyer ve své knize Object Oriented Software *Construction*.</span><span class="sxs-lookup"><span data-stu-id="3dee7-105">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="3dee7-106">Základní myšlenkou je, že operace systému můžete rozdělit do dvou ostře oddělených kategorií:</span><span class="sxs-lookup"><span data-stu-id="3dee7-106">The basic idea is that you can divide a system's operations into two sharply separated categories:</span></span>

- <span data-ttu-id="3dee7-107">Dotazy.</span><span class="sxs-lookup"><span data-stu-id="3dee7-107">Queries.</span></span> <span data-ttu-id="3dee7-108">Ty vrátí výsledek a nemění stav systému a jsou bez vedlejších účinků.</span><span class="sxs-lookup"><span data-stu-id="3dee7-108">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

- <span data-ttu-id="3dee7-109">Příkazy.</span><span class="sxs-lookup"><span data-stu-id="3dee7-109">Commands.</span></span> <span data-ttu-id="3dee7-110">Ty mění stav systému.</span><span class="sxs-lookup"><span data-stu-id="3dee7-110">These change the state of a system.</span></span>

<span data-ttu-id="3dee7-111">CQS je jednoduchý koncept: jedná se o metody v rámci stejného objektu jsou dotazy nebo příkazy.</span><span class="sxs-lookup"><span data-stu-id="3dee7-111">CQS is a simple concept: it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="3dee7-112">Každá metoda vrátí stav nebo mutuje stav, ale ne obojí.</span><span class="sxs-lookup"><span data-stu-id="3dee7-112">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="3dee7-113">Dokonce i jeden objekt vzoru úložiště může být v souladu s CQS.</span><span class="sxs-lookup"><span data-stu-id="3dee7-113">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="3dee7-114">CQS lze považovat za základní princip pro CQRS.</span><span class="sxs-lookup"><span data-stu-id="3dee7-114">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="3dee7-115">[Oddělení odpovědnosti za velení a dotazy (CQRS)](https://martinfowler.com/bliki/CQRS.html) byl zaveden Gregem Youngem a silně podporován Udi Dahanem a dalšími.</span><span class="sxs-lookup"><span data-stu-id="3dee7-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="3dee7-116">Je založen na principu CQS, i když je podrobnější.</span><span class="sxs-lookup"><span data-stu-id="3dee7-116">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="3dee7-117">Lze jej považovat za vzor založený na příkazy a události plus volitelně na asynchronní zprávy.</span><span class="sxs-lookup"><span data-stu-id="3dee7-117">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="3dee7-118">V mnoha případech CQRS souvisí s pokročilejší scénáře, jako je mít jinou fyzickou databázi pro čtení (dotazy) než pro zápisy (aktualizace).</span><span class="sxs-lookup"><span data-stu-id="3dee7-118">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="3dee7-119">Kromě toho více vyvinutý systém CQRS může implementovat [Event-Sourcing (ES)](https://martinfowler.com/eaaDev/EventSourcing.html) pro databázi aktualizací, takže by se místo ukládání dat aktuálního stavu ukládala pouze události v modelu domény.</span><span class="sxs-lookup"><span data-stu-id="3dee7-119">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](https://martinfowler.com/eaaDev/EventSourcing.html) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="3dee7-120">Tento přístup se však v této příručce nepoužívá.</span><span class="sxs-lookup"><span data-stu-id="3dee7-120">However, this approach is not used in this guide.</span></span> <span data-ttu-id="3dee7-121">Tato příručka používá nejjednodušší přístup CQRS, který se skládá pouze oddělení dotazů z příkazů.</span><span class="sxs-lookup"><span data-stu-id="3dee7-121">This guide uses the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="3dee7-122">Aspekt oddělení CQRS je dosaženo seskupením dotazů v jedné vrstvě a příkazy v jiné vrstvě.</span><span class="sxs-lookup"><span data-stu-id="3dee7-122">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="3dee7-123">Každá vrstva má svůj vlastní datový model (všimněte si, že říkáme model, ne nutně jiná databáze) a je sestaven a používá vlastní kombinaci vzorů a technologií.</span><span class="sxs-lookup"><span data-stu-id="3dee7-123">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="3dee7-124">Ještě důležitější je, že dvě vrstvy může být v rámci stejné vrstvy nebo mikroslužeb, jako v příkladu (řazení mikroslužeb) pro tuto příručku.</span><span class="sxs-lookup"><span data-stu-id="3dee7-124">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="3dee7-125">Nebo mohou být implementovány v různých mikroslužeb nebo procesů, takže mohou být optimalizovány a škálovat samostatně bez ovlivnění navzájem.</span><span class="sxs-lookup"><span data-stu-id="3dee7-125">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="3dee7-126">CQRS znamená mít dva objekty pro operaci čtení a zápisu, kde v jiných kontextech je jeden.</span><span class="sxs-lookup"><span data-stu-id="3dee7-126">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="3dee7-127">Existují důvody, proč mít nenormalizovanou databázi čtení, o které se můžete dozvědět v pokročilejší literatuře CQRS.</span><span class="sxs-lookup"><span data-stu-id="3dee7-127">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="3dee7-128">Ale nepoužíváme tento přístup zde, kde cílem je mít větší flexibilitu v dotazech namísto omezení dotazů s omezeními z DDD vzory, jako jsou agregace.</span><span class="sxs-lookup"><span data-stu-id="3dee7-128">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="3dee7-129">Příkladem tohoto druhu služby je řazení mikroslužby z referenční aplikace eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="3dee7-129">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="3dee7-130">Tato služba implementuje mikroslužbu založenou na zjednodušeném přístupu CQRS.</span><span class="sxs-lookup"><span data-stu-id="3dee7-130">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="3dee7-131">Používá jeden zdroj dat nebo databázi, ale dva logické modely plus DDD vzory pro transakční doménu, jak je znázorněno na obrázku 7-2.</span><span class="sxs-lookup"><span data-stu-id="3dee7-131">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 7-2.</span></span>

![Diagram znázorňující vysokou úroveň zjednodušené CQRS a DDD mikroslužby.](./media/apply-simplified-microservice-cqrs-ddd-patterns/simplified-cqrs-ddd-microservice.png)

<span data-ttu-id="3dee7-133">**Obrázek 7-2**.</span><span class="sxs-lookup"><span data-stu-id="3dee7-133">**Figure 7-2**.</span></span> <span data-ttu-id="3dee7-134">Zjednodušená mikroslužba založená na CQRS a DDD</span><span class="sxs-lookup"><span data-stu-id="3dee7-134">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="3dee7-135">Logické "Řazení" Mikroslužba zahrnuje jeho řazení databáze, která může být, ale nemusí být, stejný hostitel Dockeru.</span><span class="sxs-lookup"><span data-stu-id="3dee7-135">The Logical "Ordering" Microservice includes its Ordering database, which can be, but doesn't have to be, the same Docker host.</span></span> <span data-ttu-id="3dee7-136">Mít databázi ve stejném hostiteli Dockeru je vhodné pro vývoj, ale ne pro produkční prostředí.</span><span class="sxs-lookup"><span data-stu-id="3dee7-136">Having the database in the same Docker host is good for development, but not for production.</span></span>

<span data-ttu-id="3dee7-137">Aplikační vrstva může být samotné webové rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="3dee7-137">The application layer can be the Web API itself.</span></span> <span data-ttu-id="3dee7-138">Důležitým aspektem návrhu je, že mikroslužba rozdělila dotazy a ViewModels (datové modely vytvořené speciálně pro klientské aplikace) z příkazů, modelu domény a transakcí podle vzoru CQRS.</span><span class="sxs-lookup"><span data-stu-id="3dee7-138">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="3dee7-139">Tento přístup udržuje dotazy nezávislé na omezení a omezení pocházející ze vzorů DDD, které mají smysl pouze pro transakce a aktualizace, jak je vysvětleno v dalších částech.</span><span class="sxs-lookup"><span data-stu-id="3dee7-139">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="3dee7-140">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="3dee7-140">Additional resources</span></span>

- <span data-ttu-id="3dee7-141">**Greg young. Správa verzí v systému zdroje událostí** (zdarma ke čtení online e-knihy) </span><span class="sxs-lookup"><span data-stu-id="3dee7-141">**Greg Young. Versioning in an Event Sourced System** (Free to read online e-book) </span></span>\
   <https://leanpub.com/esversioning/read>

>[!div class="step-by-step"]
><span data-ttu-id="3dee7-142">[Předchozí](index.md)
>[další](eshoponcontainers-cqrs-ddd-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="3dee7-142">[Previous](index.md)
[Next](eshoponcontainers-cqrs-ddd-microservice.md)</span></span>
