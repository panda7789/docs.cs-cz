---
title: Kolekční sestavení pro generování dynamických typů
description: ''
ms.date: 08/29/2017
helpviewer_keywords:
- reflection, dynamic assembly
- assemblies, collectible
- collectible assemblies, retrieving
ms.openlocfilehash: 02c7048e0321282463aa3558287d1d13c5e4f8d2
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/12/2020
ms.locfileid: "79180548"
---
# <a name="collectible-assemblies-for-dynamic-type-generation"></a><span data-ttu-id="70860-102">Kolekční sestavení pro generování dynamických typů</span><span class="sxs-lookup"><span data-stu-id="70860-102">Collectible assemblies for dynamic type generation</span></span>

<span data-ttu-id="70860-103">*Sběratelská sestavení* jsou dynamická sestavení, která lze uvolnit bez uvolnění domény aplikace, ve které byla vytvořena.</span><span class="sxs-lookup"><span data-stu-id="70860-103">*Collectible assemblies* are dynamic assemblies that can be unloaded without unloading the application domain in which they were created.</span></span> <span data-ttu-id="70860-104">Všechny spravované a nespravované paměti používané sběratelské sestavení a typy, které obsahuje lze rekultivovat.</span><span class="sxs-lookup"><span data-stu-id="70860-104">All managed and unmanaged memory used by a collectible assembly and the types it contains can be reclaimed.</span></span> <span data-ttu-id="70860-105">Informace, jako je název sestavení, jsou odebrány z vnitřních tabulek.</span><span class="sxs-lookup"><span data-stu-id="70860-105">Information such as the assembly name is removed from internal tables.</span></span>

<span data-ttu-id="70860-106">Chcete-li povolit <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> uvolnění, použijte příznak při vytváření dynamické sestavy.</span><span class="sxs-lookup"><span data-stu-id="70860-106">To enable unloading, use the <xref:System.Reflection.Emit.AssemblyBuilderAccess.RunAndCollect?displayProperty=nameWithType> flag when you create a dynamic assembly.</span></span> <span data-ttu-id="70860-107">Sestava je přechodná (to znamená, že ji nelze uložit) a podléhá omezením popsaným v části [Omezení sběratelských sestavení.](#restrictions-on-collectible-assemblies)</span><span class="sxs-lookup"><span data-stu-id="70860-107">The assembly is transient (that is, it cannot be saved) and is subject to limitations described in the [Restrictions on Collectible Assemblies](#restrictions-on-collectible-assemblies) section.</span></span> <span data-ttu-id="70860-108">Běžný jazyk runtime (CLR) uvolní sběratelské sestavení automaticky při uvolnění všech objektů přidružených k sestavení.</span><span class="sxs-lookup"><span data-stu-id="70860-108">The common language runtime (CLR) unloads a collectible assembly automatically when you release all objects associated with the assembly.</span></span> <span data-ttu-id="70860-109">Ve všech ostatních ohledech jsou sběratelská sestavy vytvářena a používána stejným způsobem jako ostatní dynamické sestavy.</span><span class="sxs-lookup"><span data-stu-id="70860-109">In all other respects, collectible assemblies are created and used in the same way as other dynamic assemblies.</span></span>

## <a name="lifetime-of-collectible-assemblies"></a><span data-ttu-id="70860-110">Životnost sběratelských sestav</span><span class="sxs-lookup"><span data-stu-id="70860-110">Lifetime of collectible assemblies</span></span>

<span data-ttu-id="70860-111">Životnost sběratelské sestavení je řízena existencí odkazů na typy, které obsahuje, a objekty, které jsou vytvořeny z těchto typů.</span><span class="sxs-lookup"><span data-stu-id="70860-111">The lifetime of a collectible assembly is controlled by the existence of references to the types it contains and the objects that are created from those types.</span></span> <span data-ttu-id="70860-112">Běžný jazyk runtime neuvolní sestavení tak dlouho, dokud jeden`T` nebo více z následujících existují ( je libovolný typ, který je definován v sestavení):</span><span class="sxs-lookup"><span data-stu-id="70860-112">The common language runtime does not unload an assembly as long as one or more of the following exist (`T` is any type that is defined in the assembly):</span></span>

- <span data-ttu-id="70860-113">Instance `T`aplikace .</span><span class="sxs-lookup"><span data-stu-id="70860-113">An instance of `T`.</span></span>

- <span data-ttu-id="70860-114">Instance pole `T`.</span><span class="sxs-lookup"><span data-stu-id="70860-114">An instance of an array of `T`.</span></span>

- <span data-ttu-id="70860-115">Instance obecného typu, `T` který má jako jeden z jeho argumentů typu.</span><span class="sxs-lookup"><span data-stu-id="70860-115">An instance of a generic type that has `T` as one of its type arguments.</span></span> <span data-ttu-id="70860-116">To zahrnuje obecné `T`kolekce , i v případě, že kolekce je prázdný.</span><span class="sxs-lookup"><span data-stu-id="70860-116">This includes generic collections of `T`, even if that collection is empty.</span></span>

- <span data-ttu-id="70860-117">Instance <xref:System.Type> nebo <xref:System.Reflection.Emit.TypeBuilder> která `T`představuje .</span><span class="sxs-lookup"><span data-stu-id="70860-117">An instance of <xref:System.Type> or <xref:System.Reflection.Emit.TypeBuilder> that represents `T`.</span></span>

   > [!IMPORTANT]
   > <span data-ttu-id="70860-118">Je nutné uvolnit všechny objekty, které představují části sestavy.</span><span class="sxs-lookup"><span data-stu-id="70860-118">You must release all objects that represent parts of the assembly.</span></span> <span data-ttu-id="70860-119">Definuje, <xref:System.Reflection.Emit.ModuleBuilder> který `T` definuje udržuje <xref:System.Reflection.Emit.TypeBuilder>odkaz na <xref:System.Reflection.Emit.AssemblyBuilder> , a objekt <xref:System.Reflection.Emit.ModuleBuilder>udržuje odkaz na , takže odkazy na tyto objekty musí být uvolněna.</span><span class="sxs-lookup"><span data-stu-id="70860-119">The <xref:System.Reflection.Emit.ModuleBuilder> that defines `T` keeps a reference to the <xref:System.Reflection.Emit.TypeBuilder>, and the <xref:System.Reflection.Emit.AssemblyBuilder> object keeps a reference to the <xref:System.Reflection.Emit.ModuleBuilder>, so references to these objects must be released.</span></span> <span data-ttu-id="70860-120">Dokonce i existence <xref:System.Reflection.Emit.LocalBuilder> nebo <xref:System.Reflection.Emit.ILGenerator> použité při `T` stavbě brání vykládce.</span><span class="sxs-lookup"><span data-stu-id="70860-120">Even the existence of a <xref:System.Reflection.Emit.LocalBuilder> or an <xref:System.Reflection.Emit.ILGenerator> used in the construction of `T` prevents unloading.</span></span>

- <span data-ttu-id="70860-121">Statický odkaz `T` na jiný dynamicky `T1` definovaný typ, který je stále dosažitelný spuštěním kódu.</span><span class="sxs-lookup"><span data-stu-id="70860-121">A static reference to `T` by another dynamically defined type `T1` that is still reachable by executing code.</span></span> <span data-ttu-id="70860-122">`T1` Může například odvodit `T`z , nebo `T` může být `T1`typ parametru v metodě .</span><span class="sxs-lookup"><span data-stu-id="70860-122">For example, `T1` might derive from `T`, or `T` might be the type of a parameter in a method of `T1`.</span></span>

- <span data-ttu-id="70860-123">A **ByRef** na statické pole, které patří do `T`.</span><span class="sxs-lookup"><span data-stu-id="70860-123">A **ByRef** to a static field that belongs to `T`.</span></span>

- <span data-ttu-id="70860-124">A <xref:System.RuntimeTypeHandle> <xref:System.RuntimeFieldHandle>, <xref:System.RuntimeMethodHandle> nebo který `T` odkazuje na nebo `T`na složku .</span><span class="sxs-lookup"><span data-stu-id="70860-124">A <xref:System.RuntimeTypeHandle>, <xref:System.RuntimeFieldHandle>, or <xref:System.RuntimeMethodHandle> that refers to `T` or to a component of `T`.</span></span>

- <span data-ttu-id="70860-125">Instance jakékoli reflexe objektu, který by mohl <xref:System.Type> být použit `T`nepřímo nebo přímo pro přístup k objektu, který představuje .</span><span class="sxs-lookup"><span data-stu-id="70860-125">An instance of any reflection object that could be used indirectly or directly to access the <xref:System.Type> object that represents `T`.</span></span> <span data-ttu-id="70860-126"><xref:System.Type> Například objekt pro `T` lze získat z typu pole, `T`jehož typ prvku `T` je , nebo z obecného typu, který má jako argument typu.</span><span class="sxs-lookup"><span data-stu-id="70860-126">For example, the <xref:System.Type> object for `T` can be obtained from an array type whose element type is `T`, or from a generic type that has `T` as a type argument.</span></span>

- <span data-ttu-id="70860-127">Metoda `M` v zásobníku volání libovolného `M` vlákna, `T` kde je metoda nebo metoda na úrovni modulu, která je definována v sestavení.</span><span class="sxs-lookup"><span data-stu-id="70860-127">A method `M` on the call stack of any thread, where `M` is a method of `T` or a module-level method that is defined in the assembly.</span></span>

- <span data-ttu-id="70860-128">Delegát na statickou metodu, která je definována v modulu sestavení.</span><span class="sxs-lookup"><span data-stu-id="70860-128">A delegate to a static method that is defined in a module of the assembly.</span></span>

<span data-ttu-id="70860-129">Pokud existuje pouze jedna položka z tohoto seznamu pouze pro jeden typ nebo jednu metodu v sestavení, runtime nemůže uvolnit sestavení.</span><span class="sxs-lookup"><span data-stu-id="70860-129">If only one item from this list exists for only one type or one method in the assembly, the runtime cannot unload the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="70860-130">Runtime není ve skutečnosti uvolnit sestavení, dokud finalizační metody byly spuštěny pro všechny položky v seznamu.</span><span class="sxs-lookup"><span data-stu-id="70860-130">The runtime does not actually unload the assembly until finalizers have run for all items in the list.</span></span>

<span data-ttu-id="70860-131">Pro účely sledování životnosti je vytvořený `List<int>` obecný typ, například (v jazyce C#) nebo `List(Of Integer)` (v jazyce Visual Basic), který je vytvořen a používán při generování sběratelského sestavení, považován za definovaný buď v sestavení, které obsahuje definici obecného typu, nebo v sestavení, které obsahuje definici jednoho z jeho argumentů typu.</span><span class="sxs-lookup"><span data-stu-id="70860-131">For purposes of tracking lifetime, a constructed generic type such as `List<int>` (in C#) or `List(Of Integer)` (in Visual Basic) that is created and used in the generation of a collectible assembly is considered to have been defined either in the assembly that contains the generic type definition or in an assembly that contains the definition of one of its type arguments.</span></span> <span data-ttu-id="70860-132">Přesné sestavení, které se používá, je podrobnosti implementace a může změnit.</span><span class="sxs-lookup"><span data-stu-id="70860-132">The exact assembly that is used is an implementation detail and subject to change.</span></span>

## <a name="restrictions-on-collectible-assemblies"></a><span data-ttu-id="70860-133">Omezení sběratelských sestav</span><span class="sxs-lookup"><span data-stu-id="70860-133">Restrictions on collectible assemblies</span></span>

<span data-ttu-id="70860-134">Pro sběratelská sestavení platí následující omezení:</span><span class="sxs-lookup"><span data-stu-id="70860-134">The following restrictions apply to collectible assemblies:</span></span>

- <span data-ttu-id="70860-135">**Statické odkazy** Typy v běžné dynamické sestavení nemůže mít statické odkazy na typy, které jsou definovány ve sběratelské sestavení.</span><span class="sxs-lookup"><span data-stu-id="70860-135">**Static references** Types in an ordinary dynamic assembly cannot have static references to types that are defined in a collectible assembly.</span></span> <span data-ttu-id="70860-136">Například pokud definujete běžný typ, který dědí z typu <xref:System.NotSupportedException> ve sběratelském sestavení, je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="70860-136">For example, if you define an ordinary type that inherits from a type in a collectible assembly, a <xref:System.NotSupportedException> exception is thrown.</span></span> <span data-ttu-id="70860-137">Typ ve sběratelské sestavě může mít statické odkazy na typ v jiné sběratelské sestavě, ale to prodlužuje životnost odkazovaného sestavení na životnost odkazující sestavy.</span><span class="sxs-lookup"><span data-stu-id="70860-137">A type in a collectible assembly can have static references to a type in another collectible assembly, but this extends the lifetime of the referenced assembly to the lifetime of the referencing assembly.</span></span>

- <span data-ttu-id="70860-138">**KOM interop** V rámci sběratelského sestavení nelze definovat žádná rozhraní modelu COM a žádné instance typů v rámci sběratelského sestavení nelze převést na objekty COM.</span><span class="sxs-lookup"><span data-stu-id="70860-138">**COM interop** No COM interfaces can be defined within a collectible assembly, and no instances of types within a collectible assembly can be converted into COM objects.</span></span> <span data-ttu-id="70860-139">Typ ve sběratelské sestavě nemůže sloužit jako com volatelné obálky (CCW) nebo runtime volatelné obálky (RCW).</span><span class="sxs-lookup"><span data-stu-id="70860-139">A type in a collectible assembly cannot serve as a COM callable wrapper (CCW) or runtime callable wrapper (RCW).</span></span> <span data-ttu-id="70860-140">Typy ve sběratelských sestaveních však mohou používat objekty, které implementují rozhraní COM.</span><span class="sxs-lookup"><span data-stu-id="70860-140">However, types in collectible assemblies can use objects that implement COM interfaces.</span></span>

- <span data-ttu-id="70860-141">**Vyvolání platformy** Metody, které <xref:System.Runtime.InteropServices.DllImportAttribute> mají atribut nebude kompilovat, pokud jsou deklarovány ve sběratelské sestavení.</span><span class="sxs-lookup"><span data-stu-id="70860-141">**Platform invoke** Methods that have the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute will not compile when they are declared in a collectible assembly.</span></span> <span data-ttu-id="70860-142">Instrukce <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> nelze použít při implementaci typu ve sběratelské sestavení a tyto typy nelze zařazovat do nespravovaného kódu.</span><span class="sxs-lookup"><span data-stu-id="70860-142">The <xref:System.Reflection.Emit.OpCodes.Calli?displayProperty=nameWithType> instruction cannot be used in the implementation of a type in a collectible assembly, and such types cannot be marshaled to unmanaged code.</span></span> <span data-ttu-id="70860-143">Můžete však volat do nativního kódu pomocí vstupního bodu, který je deklarován v nesběratelském sestavení.</span><span class="sxs-lookup"><span data-stu-id="70860-143">However, you can call into native code by using an entry point that is declared in a non-collectible assembly.</span></span>

- <span data-ttu-id="70860-144">**Zařazování** Objekty (zejména delegáti), které jsou definovány ve sběratelských sestaveních, nelze zařadit.</span><span class="sxs-lookup"><span data-stu-id="70860-144">**Marshaling** Objects (in particular, delegates) that are defined in collectible assemblies cannot be marshaled.</span></span> <span data-ttu-id="70860-145">Toto je omezení pro všechny přechodné emitované typy.</span><span class="sxs-lookup"><span data-stu-id="70860-145">This is a restriction on all transient emitted types.</span></span>

- <span data-ttu-id="70860-146">**Montážní zatížení** Odraz emituje je jediný mechanismus, který je podporován pro načítání sběratelských sestav.</span><span class="sxs-lookup"><span data-stu-id="70860-146">**Assembly loading** Reflection emit is the only mechanism that is supported for loading collectible assemblies.</span></span> <span data-ttu-id="70860-147">Sestavení, která jsou načtena pomocí jiné formy nakládky sestavy, nelze uvolnit.</span><span class="sxs-lookup"><span data-stu-id="70860-147">Assemblies that are loaded by using any other form of assembly loading cannot be unloaded.</span></span>

- <span data-ttu-id="70860-148">**Kontextové objekty** Kontextové statické proměnné nejsou podporovány.</span><span class="sxs-lookup"><span data-stu-id="70860-148">**Context-bound objects** Context-static variables are not supported.</span></span> <span data-ttu-id="70860-149">Typy ve sběratelské sestavě nelze rozšířit <xref:System.ContextBoundObject>.</span><span class="sxs-lookup"><span data-stu-id="70860-149">Types in a collectible assembly cannot extend <xref:System.ContextBoundObject>.</span></span> <span data-ttu-id="70860-150">Kód ve sběratelských sestaveních však může používat kontextové objekty, které jsou definovány jinde.</span><span class="sxs-lookup"><span data-stu-id="70860-150">However, code in collectible assemblies can use context-bound objects that are defined elsewhere.</span></span>

- <span data-ttu-id="70860-151">**Statická data z vlákna** Proměnné statické podprocesy nejsou podporovány.</span><span class="sxs-lookup"><span data-stu-id="70860-151">**Thread-static data** Thread-static variables are not supported.</span></span>

## <a name="see-also"></a><span data-ttu-id="70860-152">Viz také</span><span class="sxs-lookup"><span data-stu-id="70860-152">See also</span></span>

- [<span data-ttu-id="70860-153">Generování dynamických metod a sestavení</span><span class="sxs-lookup"><span data-stu-id="70860-153">Emitting Dynamic Methods and Assemblies</span></span>](emitting-dynamic-methods-and-assemblies.md)
