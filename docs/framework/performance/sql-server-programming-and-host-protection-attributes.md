---
title: Programování serveru SQL Server a atributy ochrany hostitele
description: Začínáme s programováním SQL Server a atributy ochrany hostitele. Zkontrolujte, SQL Server sady oprávnění a programovacích modelů.
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
ms.openlocfilehash: 33db32897d2f49d2c10f94dc73aeae728c17db73
ms.sourcegitcommit: cf5a800a33de64d0aad6d115ffcc935f32375164
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/20/2020
ms.locfileid: "86474199"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>Programování serveru SQL Server a atributy ochrany hostitele
Možnost načtení a spuštění spravovaného kódu na SQL Server hostitele vyžaduje splnění požadavků hostitele jak pro zabezpečení přístupu kódu, tak pro ochranu prostředků hostitele.  Požadavky na zabezpečení přístupu kódu jsou určeny jednou ze tří SQL Server sad oprávnění: bezpečný, externí přístup nebo nebezpečná. Kód spuštěný v rámci sad oprávnění BEZPEČNÉho nebo externího přístupu se musí vyhnout určitým typům nebo členům, které mají <xref:System.Security.Permissions.HostProtectionAttribute> atribut použit. Nejedná se <xref:System.Security.Permissions.HostProtectionAttribute> o bezpečnostní oprávnění, které je v rámci záruky spolehlivosti v tom, že identifikuje konkrétní konstrukce kódu, a to buď typy, nebo metody, které může hostitel zakázat.  Použití <xref:System.Security.Permissions.HostProtectionAttribute> vynutilo programovací model, který pomáhá chránit stabilitu hostitele.  
  
## <a name="host-protection-attributes"></a>Atributy ochrany hostitele  
 Atributy ochrany hostitele identifikují typy nebo členy, které se nevejdou do programovacího modelu hostitele, a reprezentují následující zvýšení úrovně hrozby spolehlivosti:  
  
- Jsou jinak neškodné.  
  
- Může vést k destabilizaci kódu uživatele spravovaného serverem.  
  
- Může vést k destabilizaci samotného procesu serveru.  
  
 SQL Server nepovoluje použití typu nebo členu, který má typ <xref:System.Security.Permissions.HostProtectionAttribute> , který určuje <xref:System.Security.Permissions.HostProtectionResource> hodnotu <xref:System.Security.Permissions.HostProtectionResource.SharedState> , <xref:System.Security.Permissions.HostProtectionResource.Synchronization> , <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort> nebo <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt> . To brání sestavením v volání členů, které umožňují stav sdílení, provedení synchronizace, může způsobit nevracení prostředků při ukončení nebo ovlivnění integrity procesu SQL Server.  
  
### <a name="disallowed-types-and-members"></a>Nepovolené typy a členy  
 Následující tabulka uvádí typy a členy, jejichž <xref:System.Security.Permissions.HostProtectionResource> hodnoty nejsou zakázány SQL Server.  
  
|Obor názvů|Typ nebo člen|  
|---------------|--------------------|  
|`Microsoft.Win32`|Třída <xref:Microsoft.Win32.PowerModeChangedEventArgs><br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler>dostával<br /><br /> Třída <xref:Microsoft.Win32.SessionEndedEventArgs><br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler>dostával<br /><br /> Třída <xref:Microsoft.Win32.SessionEndingEventArgs><br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler>dostával<br /><br /> Třída <xref:Microsoft.Win32.SessionSwitchEventArgs><br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler>dostával<br /><br /> Třída <xref:Microsoft.Win32.SystemEvents><br /><br /> Třída <xref:Microsoft.Win32.TimerElapsedEventArgs><br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler>dostával<br /><br /> Třída <xref:Microsoft.Win32.UserPreferenceChangedEventArgs><br /><br /> Třída <xref:Microsoft.Win32.UserPreferenceChangingEventArgs>|  
|`System.Collections`|Metoda <xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType>|  
|`System.ComponentModel`|Třída <xref:System.ComponentModel.AddingNewEventArgs><br /><br /> <xref:System.ComponentModel.AddingNewEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.ArrayConverter><br /><br /> Třída <xref:System.ComponentModel.AsyncCompletedEventArgs><br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.AsyncOperation><br /><br /> Třída <xref:System.ComponentModel.AsyncOperationManager><br /><br /> Třída <xref:System.ComponentModel.AttributeCollection><br /><br /> Třída <xref:System.ComponentModel.BackgroundWorker><br /><br /> Třída <xref:System.ComponentModel.BaseNumberConverter><br /><br /> Třída <xref:System.ComponentModel.BindingList%601><br /><br /> Třída <xref:System.ComponentModel.BooleanConverter><br /><br /> Třída <xref:System.ComponentModel.ByteConverter><br /><br /> Třída <xref:System.ComponentModel.CancelEventArgs><br /><br /> <xref:System.ComponentModel.CancelEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.CharConverter><br /><br /> Třída <xref:System.ComponentModel.CollectionChangeEventArgs><br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.CollectionConverter><br /><br /> Třída <xref:System.ComponentModel.ComponentCollection><br /><br /> Třída <xref:System.ComponentModel.ComponentConverter><br /><br /> Třída <xref:System.ComponentModel.ComponentEditor><br /><br /> Třída <xref:System.ComponentModel.ComponentResourceManager><br /><br /> Třída <xref:System.ComponentModel.Container><br /><br /> Třída <xref:System.ComponentModel.ContainerFilterService><br /><br /> Třída <xref:System.ComponentModel.CultureInfoConverter><br /><br /> Třída <xref:System.ComponentModel.CustomTypeDescriptor><br /><br /> Třída <xref:System.ComponentModel.DateTimeConverter><br /><br /> Třída <xref:System.ComponentModel.DecimalConverter><br /><br /> Třída <xref:System.ComponentModel.Design.ActiveDesignerEventArgs><br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.CheckoutException><br /><br /> Třída <xref:System.ComponentModel.Design.CommandID><br /><br /> Třída <xref:System.ComponentModel.Design.ComponentChangedEventArgs><br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.ComponentChangingEventArgs><br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.ComponentEventArgs><br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.ComponentRenameEventArgs><br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.DesignerCollection><br /><br /> Třída <xref:System.ComponentModel.Design.DesignerEventArgs><br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.DesignerOptionService><br /><br /> Třída <xref:System.ComponentModel.Design.DesignerTransaction><br /><br /> Třída <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs><br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.DesignerVerb><br /><br /> Třída <xref:System.ComponentModel.Design.DesignerVerbCollection><br /><br /> Třída <xref:System.ComponentModel.Design.DesigntimeLicenseContext><br /><br /> Třída <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer><br /><br /> Třída <xref:System.ComponentModel.Design.MenuCommand><br /><br /> Třída <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService><br /><br /> Třída <xref:System.ComponentModel.Design.Serialization.ContextStack><br /><br /> Třída <xref:System.ComponentModel.Design.Serialization.DesignerLoader><br /><br /> Třída <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor><br /><br /> Třída <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService><br /><br /> Třída <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs><br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.Serialization.SerializationStore><br /><br /> Třída <xref:System.ComponentModel.Design.ServiceContainer><br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback>dostával<br /><br /> Třída <xref:System.ComponentModel.Design.StandardCommands><br /><br /> Třída <xref:System.ComponentModel.Design.StandardToolWindows><br /><br /> Třída <xref:System.ComponentModel.DoubleConverter><br /><br /> Třída <xref:System.ComponentModel.DoWorkEventArgs><br /><br /> <xref:System.ComponentModel.DoWorkEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.EnumConverter><br /><br /> Třída <xref:System.ComponentModel.EventDescriptor><br /><br /> Třída <xref:System.ComponentModel.EventDescriptorCollection><br /><br /> Třída <xref:System.ComponentModel.EventHandlerList><br /><br /> Třída <xref:System.ComponentModel.ExpandableObjectConverter><br /><br /> Třída <xref:System.ComponentModel.HandledEventArgs><br /><br /> <xref:System.ComponentModel.HandledEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.InstanceCreationEditor><br /><br /> Třída <xref:System.ComponentModel.Int16Converter><br /><br /> Třída <xref:System.ComponentModel.Int32Converter><br /><br /> Třída <xref:System.ComponentModel.Int64Converter><br /><br /> Třída <xref:System.ComponentModel.InvalidAsynchronousStateException><br /><br /> Třída <xref:System.ComponentModel.InvalidEnumArgumentException><br /><br /> Metoda <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A><br /><br /> Třída <xref:System.ComponentModel.License><br /><br /> Třída <xref:System.ComponentModel.LicenseContext><br /><br /> Třída <xref:System.ComponentModel.LicenseException><br /><br /> Třída <xref:System.ComponentModel.LicenseManager><br /><br /> Třída <xref:System.ComponentModel.LicenseProvider><br /><br /> Třída <xref:System.ComponentModel.LicFileLicenseProvider><br /><br /> Třída <xref:System.ComponentModel.ListChangedEventArgs><br /><br /> <xref:System.ComponentModel.ListChangedEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.ListSortDescription><br /><br /> Třída <xref:System.ComponentModel.ListSortDescriptionCollection><br /><br /> Třída <xref:System.ComponentModel.MaskedTextProvider><br /><br /> Třída <xref:System.ComponentModel.MemberDescriptor><br /><br /> Třída <xref:System.ComponentModel.MultilineStringConverter><br /><br /> Třída <xref:System.ComponentModel.NestedContainer><br /><br /> Třída <xref:System.ComponentModel.NullableConverter><br /><br /> Třída <xref:System.ComponentModel.ProgressChangedEventArgs><br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.PropertyChangedEventArgs><br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.PropertyDescriptor><br /><br /> Třída <xref:System.ComponentModel.PropertyDescriptorCollection><br /><br /> Třída <xref:System.ComponentModel.ReferenceConverter><br /><br /> Třída <xref:System.ComponentModel.RefreshEventArgs><br /><br /> <xref:System.ComponentModel.RefreshEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.RunWorkerCompletedEventArgs><br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler>dostával<br /><br /> Třída <xref:System.ComponentModel.SByteConverter><br /><br /> Třída <xref:System.ComponentModel.SingleConverter><br /><br /> Třída <xref:System.ComponentModel.StringConverter><br /><br /> Třída <xref:System.ComponentModel.SyntaxCheck><br /><br /> Třída <xref:System.ComponentModel.TimeSpanConverter><br /><br /> Třída <xref:System.ComponentModel.TypeConverter><br /><br /> Třída <xref:System.ComponentModel.TypeDescriptionProvider><br /><br /> Třída <xref:System.ComponentModel.TypeDescriptor><br /><br /> Třída <xref:System.ComponentModel.TypeListConverter><br /><br /> Třída <xref:System.ComponentModel.UInt16Converter><br /><br /> Třída <xref:System.ComponentModel.UInt32Converter><br /><br /> Třída <xref:System.ComponentModel.UInt64Converter><br /><br /> Třída <xref:System.ComponentModel.WarningException><br /><br /> Třída <xref:System.ComponentModel.Win32Exception>|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType>majetek<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType>majetek<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType>majetek<br /><br /> Třída <xref:System.Diagnostics.ConsoleTraceListener><br /><br /> Třída <xref:System.Diagnostics.DefaultTraceListener><br /><br /> Třída <xref:System.Diagnostics.DelimitedListTraceListener><br /><br /> Třída <xref:System.Diagnostics.EventLogTraceListener><br /><br /> Třída <xref:System.Diagnostics.PerformanceCounter><br /><br /> Třída <xref:System.Diagnostics.PerformanceCounterCategory><br /><br /> Třída <xref:System.Diagnostics.Process><br /><br /> Třída <xref:System.Diagnostics.ProcessStartInfo><br /><br /> Třída <xref:System.Diagnostics.TextWriterTraceListener><br /><br /> Třída <xref:System.Diagnostics.TraceListener><br /><br /> Třída <xref:System.Diagnostics.XmlWriterTraceListener><br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType>majetek|  
|`System.IO`|Metoda <xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType>|  
|`System.Reflection.Emit`|Třída <xref:System.Reflection.Emit.ConstructorBuilder><br /><br /> Třída <xref:System.Reflection.Emit.EventBuilder><br /><br /> Třída <xref:System.Reflection.Emit.FieldBuilder><br /><br /> Třída <xref:System.Reflection.Emit.MethodBuilder><br /><br /> Třída <xref:System.Reflection.Emit.CustomAttributeBuilder><br /><br /> Třída <xref:System.Reflection.Emit.MethodRental><br /><br /> Třída <xref:System.Reflection.Emit.ModuleBuilder><br /><br /> Třída <xref:System.Reflection.Emit.PropertyBuilder><br /><br /> Třída <xref:System.Reflection.Emit.TypeBuilder><br /><br /> Třída <xref:System.Reflection.Emit.UnmanagedMarshal>|  
|`System.Text`|Metoda <xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType>|  
|`System.Threading`|Třída <xref:System.Threading.AutoResetEvent><br /><br /> Třída <xref:System.Threading.EventWaitHandle><br /><br /> Třída <xref:System.Threading.ManualResetEvent><br /><br /> Třída <xref:System.Threading.Monitor><br /><br /> Třída <xref:System.Threading.Mutex><br /><br /> Třída <xref:System.Threading.ReaderWriterLock><br /><br /> Třída <xref:System.Threading.Semaphore><br /><br /> Metoda <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType><br /><br /> Metoda <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType><br /><br /> Třída <xref:System.Threading.ThreadPool><br /><br /> Třída <xref:System.Threading.Timer>|  
|`System.Timers`|Třída <xref:System.Timers.Timer>|  
|`System.Web.Configuration`|Třída <xref:System.Web.Configuration.MachineKeyValidationConverter>|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType>majetek|  
  
## <a name="sql-server-permission-sets"></a>SQL Server sady oprávnění  
 SQL Server umožňuje uživatelům zadat požadavky na spolehlivost pro kód nasazený do databáze. Když jsou sestavení uložena do databáze, autor sestavení může určit jednu ze tří sad oprávnění pro toto sestavení: bezpečný, externí přístup nebo nebezpečné.  
  
|Sada oprávnění|ODVOD|EXTERNÍ PŘÍSTUP|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Zabezpečení přístupu kódu|Pouze spustit|Spouštění a přístup k externím prostředkům|Neomezené|  
|Omezení programovacího modelu|Ano|Ano|Žádná omezení|  
|Požadavek na ověření|Ano|Ano|No|  
|Možnost volání nativního kódu|No|No|Ano|  
  
 BEZPEČNÁ je nejspolehlivější a zabezpečený režim s přidruženými omezeními z hlediska povoleného programovacího modelu. BEZPEČNÝ kód má funkce s vysokou spolehlivostí a zabezpečením. BEZPEČNÁ sestavení mají dostatečná oprávnění ke spuštění, provádění výpočtů a přístup k místní databázi. BEZPEČNÁ sestavení musí být ověřitelný typově bezpečná a nejsou povolena volání nespravovaného kódu.  
  
 EXTERNÍ přístup poskytuje možnost zprostředkujícího zabezpečení, která umožňuje kódu přistupovat k prostředkům, které jsou externí v databázi, ale stále mají spolehlivost a bezpečnost v bezpečí.  
  
 Nezabezpečené je pro vysoce důvěryhodný kód, který může vytvořit pouze správce databáze. Tento důvěryhodný kód nemá žádná omezení přístupu ke kódu a může volat nespravovaný (nativní) kód.  
  
 SQL Server použije vrstvu zásad zabezpečení přístupu kódu na úrovni hostitele k nastavení zásady hostitele, která uděluje jednu ze tří sad oprávnění na základě sady oprávnění uložené v katalogu SQL Server. Spravovaný kód spuštěný v databázi vždycky získá jednu z těchto sad oprávnění pro přístup ke kódu.  
  
## <a name="programming-model-restrictions"></a>Omezení programovacího modelu  
 Programovací model pro spravovaný kód v SQL Server vyžaduje funkce, procedury a typy, které nevyžadují použití státu v různých voláních nebo sdílení stavu napříč několika uživatelskými relacemi. Jak je popsáno výše, přítomnost sdíleného stavu může způsobit kritické výjimky, které mají vliv na škálovatelnost a spolehlivost aplikace.  
  
 Vzhledem k těmto hlediskům SQL Server nepovoluje použití statických proměnných a statických datových členů. V případě sestavení BEZPEČNÝch a externích PŘÍSTUPŮ SQL Server kontroluje metadata sestavení při vytváření sestavení a v případě, že najde použití statických datových členů a proměnných, nedokáže vytvořit taková sestavení.  
  
## <a name="see-also"></a>Viz také

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
