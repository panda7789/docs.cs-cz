---
title: Trasování data v ADO.NET
ms.date: 03/30/2017
ms.assetid: a6a752a5-d2a9-4335-a382-b58690ccb79f
ms.openlocfilehash: be82500920ce9d5f8bc7ee979cf8ec5006f4f12b
ms.sourcegitcommit: 30a558d23e3ac5a52071121a52c305c85fe15726
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/25/2019
ms.locfileid: "75347791"
---
# <a name="data-tracing-in-adonet"></a><span data-ttu-id="492ac-102">Trasování data v ADO.NET</span><span class="sxs-lookup"><span data-stu-id="492ac-102">Data Tracing in ADO.NET</span></span>

<span data-ttu-id="492ac-103">Služba ADO.NET nabízí integrované funkce pro trasování dat, které podporují poskytovatelé dat .NET pro SQL Server, Oracle, OLE DB a rozhraní ODBC, a také <xref:System.Data.DataSet>ADO.NET a síťové protokoly SQL Server.</span><span class="sxs-lookup"><span data-stu-id="492ac-103">ADO.NET features built-in data tracing functionality that is supported by the .NET data providers for SQL Server, Oracle, OLE DB and ODBC, as well as the ADO.NET <xref:System.Data.DataSet>, and the SQL Server network protocols.</span></span>

<span data-ttu-id="492ac-104">Trasování volání rozhraní API pro přístup k datům může pomáhat diagnostikovat následující problémy:</span><span class="sxs-lookup"><span data-stu-id="492ac-104">Tracing data access API calls can help diagnose the following problems:</span></span>

- <span data-ttu-id="492ac-105">Neshoda schémat mezi klientským programem a databází.</span><span class="sxs-lookup"><span data-stu-id="492ac-105">Schema mismatch between client program and the database.</span></span>

- <span data-ttu-id="492ac-106">Problémy nedostupnosti databáze nebo síťové knihovny.</span><span class="sxs-lookup"><span data-stu-id="492ac-106">Database unavailability or network library problems.</span></span>

- <span data-ttu-id="492ac-107">Nesprávný kód SQL, ať už pevně kódovaný nebo generovaný aplikací.</span><span class="sxs-lookup"><span data-stu-id="492ac-107">Incorrect SQL whether hard coded or generated by an application.</span></span>

- <span data-ttu-id="492ac-108">Nesprávná programovací logika</span><span class="sxs-lookup"><span data-stu-id="492ac-108">Incorrect programming logic.</span></span>

- <span data-ttu-id="492ac-109">Problémy vyplývající z interakce mezi několika komponentami ADO.NET nebo mezi ADO.NET a vašimi vlastními komponentami</span><span class="sxs-lookup"><span data-stu-id="492ac-109">Issues resulting from the interaction between multiple ADO.NET components or between ADO.NET and your own components.</span></span>

<span data-ttu-id="492ac-110">Pro podporu různých trasovacích technologií je trasování rozšiřitelné, takže vývojář může sledovat problém na libovolné úrovni aplikačního zásobníku.</span><span class="sxs-lookup"><span data-stu-id="492ac-110">To support different trace technologies, tracing is extensible, so a developer can trace a problem at any level of the application stack.</span></span> <span data-ttu-id="492ac-111">I když trasování není funkce jenom ADO.NET, poskytovatelé Microsoftu využívají zobecněná rozhraní API pro sledování a instrumentaci.</span><span class="sxs-lookup"><span data-stu-id="492ac-111">Although tracing is not an ADO.NET-only feature, Microsoft providers take advantage of generalized tracing and instrumentation APIs.</span></span>

<span data-ttu-id="492ac-112">Další informace o nastavení a konfiguraci spravovaného trasování v ADO.NET najdete v tématu věnovaném [trasování přístupových dat](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="492ac-112">For more information about setting and configuring managed tracing in ADO.NET, see [Tracing Data Access](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10)).</span></span>

## <a name="accessing-diagnostic-information-in-the-extended-events-log"></a><span data-ttu-id="492ac-113">Přístup k diagnostickým informacím v protokolu rozšířených událostí</span><span class="sxs-lookup"><span data-stu-id="492ac-113">Accessing Diagnostic Information in the Extended Events Log</span></span>

<span data-ttu-id="492ac-114">V .NET Framework Zprostředkovatel dat pro SQL Server bylo aktualizováno trasování přístupu k datům ([trasování přístupu k datům](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))), aby bylo snazší korelovat události klienta s diagnostickými informacemi, jako jsou například chyby připojení, z vyrovnávací paměti ring serveru a z informací o výkonu aplikace v protokolu rozšířených událostí.</span><span class="sxs-lookup"><span data-stu-id="492ac-114">In the .NET Framework Data Provider for SQL Server, data access tracing ([Data Access Tracing](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh880086(v=msdn.10))) has been updated to make it easier to correlate client events with diagnostic information, such as connection failures, from the server's connectivity ring buffer and application performance information in the extended events log.</span></span> <span data-ttu-id="492ac-115">Informace o čtení protokolu rozšířených událostí najdete v tématu [zobrazení dat relace události](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span><span class="sxs-lookup"><span data-stu-id="492ac-115">For information about reading the extended events log, see [View Event Session Data](https://docs.microsoft.com/previous-versions/sql/sql-server-2012/hh710068(v=sql.110)).</span></span>

<span data-ttu-id="492ac-116">Pro operace připojení pošle ADO.NET ID připojení klienta.</span><span class="sxs-lookup"><span data-stu-id="492ac-116">For connection operations, ADO.NET will send a client connection ID.</span></span> <span data-ttu-id="492ac-117">Pokud připojení selže, můžete získat přístup k vyrovnávací paměti vyzvánění připojení ([řešení potíží s připojením v SQL Server 2008 s cyklickou vyrovnávací pamětí připojení](https://blogs.msdn.microsoft.com/sql_protocols/2008/05/20/connectivity-troubleshooting-in-sql-server-2008-with-the-connectivity-ring-buffer/)) a najít `ClientConnectionID` pole a získat diagnostické informace o selhání připojení.</span><span class="sxs-lookup"><span data-stu-id="492ac-117">If the connection fails, you can access the connectivity ring buffer ([Connectivity troubleshooting in SQL Server 2008 with the Connectivity Ring Buffer](https://blogs.msdn.microsoft.com/sql_protocols/2008/05/20/connectivity-troubleshooting-in-sql-server-2008-with-the-connectivity-ring-buffer/)) and find the `ClientConnectionID` field and get diagnostic information about the connection failure.</span></span> <span data-ttu-id="492ac-118">ID připojení klienta se zaznamenávají do vyrovnávací paměti prstence pouze v případě, že dojde k chybě.</span><span class="sxs-lookup"><span data-stu-id="492ac-118">Client connection IDs are logged in the ring buffer only if an error occurs.</span></span> <span data-ttu-id="492ac-119">(Pokud připojení selže před odesláním paketu před přihlášením, nebude vygenerováno ID připojení klienta.) ID připojení klienta je 16bitový identifikátor GUID.</span><span class="sxs-lookup"><span data-stu-id="492ac-119">(If a connection fails before sending the prelogin packet, a client connection ID will not be generated.) The client connection ID is a 16-byte GUID.</span></span> <span data-ttu-id="492ac-120">Pokud je akce `client_connection_id` přidána do událostí v relaci rozšířené události, můžete také vyhledat ID připojení klienta ve výstupu rozšířené události.</span><span class="sxs-lookup"><span data-stu-id="492ac-120">You can also find the client connection ID in the extended events target output, if the `client_connection_id` action is added to events in an extended events session.</span></span> <span data-ttu-id="492ac-121">Pokud potřebujete další diagnostickou pomoc klientského ovladače, můžete povolit trasování přístupu k datům a znovu spustit příkaz pro připojení a sledovat pole `ClientConnectionID` v trasování přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="492ac-121">You can enable data access tracing and rerun the connection command and observe the `ClientConnectionID` field in the data access trace, if you need further client driver diagnostic assistance.</span></span>

<span data-ttu-id="492ac-122">ID připojení klienta můžete získat programově pomocí vlastnosti `SqlConnection.ClientConnectionID`.</span><span class="sxs-lookup"><span data-stu-id="492ac-122">You can get the client connection ID programmatically by using the `SqlConnection.ClientConnectionID` property.</span></span>

<span data-ttu-id="492ac-123">`ClientConnectionID` je k dispozici pro objekt <xref:System.Data.SqlClient.SqlConnection>, který úspěšně naváže připojení.</span><span class="sxs-lookup"><span data-stu-id="492ac-123">The `ClientConnectionID` is available for a <xref:System.Data.SqlClient.SqlConnection> object that successfully establishes  a connection.</span></span> <span data-ttu-id="492ac-124">Pokud se pokus o připojení nezdaří, `ClientConnectionID` mohou být k dispozici prostřednictvím `SqlException.ToString`.</span><span class="sxs-lookup"><span data-stu-id="492ac-124">If a connection attempt fails, `ClientConnectionID` may be available via `SqlException.ToString`.</span></span>

<span data-ttu-id="492ac-125">ADO.NET také odesílá ID aktivity specifické pro vlákno.</span><span class="sxs-lookup"><span data-stu-id="492ac-125">ADO.NET also sends a thread-specific activity ID.</span></span> <span data-ttu-id="492ac-126">ID aktivity se zachycuje v relacích rozšířených událostí, pokud jsou relace spuštěné s povolenou možností TRACK_CAUSALITY.</span><span class="sxs-lookup"><span data-stu-id="492ac-126">The activity ID is captured in the extended events sessions if the sessions are started with the TRACK_CAUSALITY option enabled.</span></span> <span data-ttu-id="492ac-127">V případě problémů s výkonem s aktivním připojením můžete ID aktivity získat z trasování přístupu k datům klienta (`ActivityID` pole) a potom najít ID aktivity ve výstupu rozšířených událostí.</span><span class="sxs-lookup"><span data-stu-id="492ac-127">For performance issues with an active connection, you can get the activity ID from the client's data access trace (`ActivityID` field) and then locate the activity ID in the extended events output.</span></span> <span data-ttu-id="492ac-128">ID aktivity v rozšířených událostech je 16bitový identifikátor GUID (nejedná se o stejný identifikátor GUID pro ID připojení klienta) připojený pomocí čísla sekvence se čtyřmi bajty.</span><span class="sxs-lookup"><span data-stu-id="492ac-128">The activity ID in extended events is a 16-byte GUID (not the same as the GUID for the client connection ID) appended with a four-byte sequence number.</span></span> <span data-ttu-id="492ac-129">Pořadové číslo představuje pořadí žádosti v rámci vlákna a označuje relativní pořadí příkazů Batch a RPC pro vlákno.</span><span class="sxs-lookup"><span data-stu-id="492ac-129">The sequence number represents the order of a request within a thread and indicates the relative ordering of batch and RPC statements for the thread.</span></span> <span data-ttu-id="492ac-130">`ActivityID` se aktuálně posílá pro příkazy SQL Batch a žádosti RPC, když je zapnuté trasování přístupu k datům, a 18 bit v konfiguraci trasování přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="492ac-130">The `ActivityID` is currently optionally sent for SQL batch statements and RPC requests when data access tracing is enabled on and the 18th bit in the data access tracing configuration word is turned ON.</span></span>

<span data-ttu-id="492ac-131">Následuje ukázka, který pomocí jazyka Transact-SQL spustí relaci rozšířených událostí, která bude uložená v kruhové vyrovnávací paměti, a poznamenejte si ID aktivity odeslané z klienta na RPC a dávkové operace.</span><span class="sxs-lookup"><span data-stu-id="492ac-131">The following is a sample that uses Transact-SQL to start an extended events session that will be stored in a ring buffer and will record the activity ID sent from a client on RPC and batch operations.</span></span>

```sql
create event session MySession on server
add event connectivity_ring_buffer_recorded,
add event sql_statement_starting (action (client_connection_id)),
add event sql_statement_completed (action (client_connection_id)),
add event rpc_starting (action (client_connection_id)),
add event rpc_completed (action (client_connection_id))
add target ring_buffer with (track_causality=on)
```

## <a name="see-also"></a><span data-ttu-id="492ac-132">Viz také:</span><span class="sxs-lookup"><span data-stu-id="492ac-132">See also</span></span>

- [<span data-ttu-id="492ac-133">Trasování sítě v rozhraní .NET Framework</span><span class="sxs-lookup"><span data-stu-id="492ac-133">Network Tracing in the .NET Framework</span></span>](../../network-programming/network-tracing.md)
- [<span data-ttu-id="492ac-134">Trasování a instrumentace aplikací</span><span class="sxs-lookup"><span data-stu-id="492ac-134">Tracing and Instrumenting Applications</span></span>](../../debug-trace-profile/tracing-and-instrumenting-applications.md)
- [<span data-ttu-id="492ac-135">Přehled ADO.NET</span><span class="sxs-lookup"><span data-stu-id="492ac-135">ADO.NET Overview</span></span>](ado-net-overview.md)
