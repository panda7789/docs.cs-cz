---
title: Kompilované dotazy (LINQ to Entities)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 8025ba1d-29c7-4407-841b-d5a3bed40b7a
ms.openlocfilehash: d4101eae755ac698d4cef5b2e1334d01e02c3e35
ms.sourcegitcommit: 957c49696eaf048c284ef8f9f8ffeb562357ad95
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/07/2020
ms.locfileid: "82895419"
---
# <a name="compiled-queries--linq-to-entities"></a><span data-ttu-id="53060-102">Kompilované dotazy (LINQ to Entities)</span><span class="sxs-lookup"><span data-stu-id="53060-102">Compiled Queries  (LINQ to Entities)</span></span>
<span data-ttu-id="53060-103">Máte-li aplikaci, která provádí v Entity Framework strukturované podobné dotazy, můžete často zvýšit výkon kompilováním dotazu jednou a jeho spuštěním několikrát s různými parametry.</span><span class="sxs-lookup"><span data-stu-id="53060-103">When you have an application that executes structurally similar queries many times in the Entity Framework, you can frequently increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="53060-104">Aplikace může například potřebovat načíst všechny zákazníky v určitém městě; Město je určeno za běhu uživatelem ve formuláři.</span><span class="sxs-lookup"><span data-stu-id="53060-104">For example, an application might have to retrieve all the customers in a particular city; the city is specified at runtime by the user in a form.</span></span> <span data-ttu-id="53060-105">LINQ to Entities podporuje pro tento účel použití kompilovaných dotazů.</span><span class="sxs-lookup"><span data-stu-id="53060-105">LINQ to Entities supports using compiled queries for this purpose.</span></span>  
  
 <span data-ttu-id="53060-106">Počínaje .NET Framework 4,5 jsou dotazy LINQ ukládány do mezipaměti automaticky.</span><span class="sxs-lookup"><span data-stu-id="53060-106">Starting with the .NET Framework 4.5, LINQ queries are cached automatically.</span></span> <span data-ttu-id="53060-107">Přesto však můžete použít zkompilované dotazy LINQ k omezení těchto nákladů v pozdějším spuštění a zkompilované dotazy mohou být efektivnější než dotazy LINQ, které jsou automaticky uloženy v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="53060-107">However, you can still use compiled LINQ queries to reduce this cost in later executions and compiled queries can be more efficient than LINQ queries that are automatically cached.</span></span> <span data-ttu-id="53060-108">Všimněte si, že LINQ to Entities dotazů, `Enumerable.Contains` které používají operátor na kolekce v paměti, nejsou automaticky ukládány do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="53060-108">Note that LINQ to Entities queries that apply the `Enumerable.Contains` operator to in-memory collections are not automatically cached.</span></span> <span data-ttu-id="53060-109">V kompilovaných dotazech LINQ se taky Parametrizace kolekce v paměti, které se nepovolují.</span><span class="sxs-lookup"><span data-stu-id="53060-109">Also parameterizing in-memory collections in compiled LINQ queries is not allowed.</span></span>  
  
 <span data-ttu-id="53060-110"><xref:System.Data.Objects.CompiledQuery> Třída poskytuje kompilaci a ukládání dotazů do mezipaměti pro opakované použití.</span><span class="sxs-lookup"><span data-stu-id="53060-110">The <xref:System.Data.Objects.CompiledQuery> class provides compilation and caching of queries for reuse.</span></span> <span data-ttu-id="53060-111">V koncepčních případech tato třída obsahuje <xref:System.Data.Objects.CompiledQuery> `Compile` metodu s několika přetíženími.</span><span class="sxs-lookup"><span data-stu-id="53060-111">Conceptually, this class contains a <xref:System.Data.Objects.CompiledQuery>'s `Compile` method with several overloads.</span></span> <span data-ttu-id="53060-112">Zavolejte `Compile` metodu pro vytvoření nového delegáta, který bude reprezentovat kompilovaný dotaz.</span><span class="sxs-lookup"><span data-stu-id="53060-112">Call the `Compile` method to create a new delegate to represent the compiled query.</span></span> <span data-ttu-id="53060-113">`Compile` Metody, které jsou k dispozici s hodnotami parametrů <xref:System.Data.Objects.ObjectContext> a, vrátí delegáta, který vytváří nějaký výsledek ( <xref:System.Linq.IQueryable%601> například instance).</span><span class="sxs-lookup"><span data-stu-id="53060-113">The `Compile` methods, provided with a <xref:System.Data.Objects.ObjectContext> and parameter values, return a delegate that produces some result (such as an <xref:System.Linq.IQueryable%601> instance).</span></span> <span data-ttu-id="53060-114">Dotaz se zkompiluje jenom při prvním spuštění.</span><span class="sxs-lookup"><span data-stu-id="53060-114">The query compiles once during only the first execution.</span></span> <span data-ttu-id="53060-115">Nastavení možností sloučení pro dotaz v době kompilace nelze později změnit.</span><span class="sxs-lookup"><span data-stu-id="53060-115">The merge options set for the query at the time of the compilation cannot be changed later.</span></span> <span data-ttu-id="53060-116">Jakmile je dotaz zkompilován, lze zadat pouze parametry primitivního typu, ale nemůžete nahradit části dotazu, které by změnily vygenerované SQL.</span><span class="sxs-lookup"><span data-stu-id="53060-116">Once the query is compiled you can only supply parameters of primitive type but you cannot replace parts of the query that would change the generated SQL.</span></span> <span data-ttu-id="53060-117">Další informace naleznete v tématu [možnosti sloučení EF a zkompilované dotazy](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span><span class="sxs-lookup"><span data-stu-id="53060-117">For more information, see [EF Merge Options and Compiled Queries](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries).</span></span>
  
 <span data-ttu-id="53060-118">Výraz dotazu LINQ to Entities, který je <xref:System.Data.Objects.CompiledQuery>zkompilován `Compile` metodou, je reprezentován jedním z generických `Func` delegátů, jako je například <xref:System.Func%605>.</span><span class="sxs-lookup"><span data-stu-id="53060-118">The LINQ to Entities query expression that the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method compiles is represented by one of the generic `Func` delegates, such as <xref:System.Func%605>.</span></span> <span data-ttu-id="53060-119">Ve většině případů výraz dotazu může zapouzdřit `ObjectContext` parametr, návratový parametr a 16 parametrů dotazu.</span><span class="sxs-lookup"><span data-stu-id="53060-119">At most, the query expression can encapsulate an `ObjectContext` parameter, a return parameter, and 16 query parameters.</span></span> <span data-ttu-id="53060-120">Pokud jsou vyžadovány více než 16 parametrů dotazu, můžete vytvořit strukturu, jejíž vlastnosti představují parametry dotazu.</span><span class="sxs-lookup"><span data-stu-id="53060-120">If more than 16 query parameters are required, you can create a structure whose properties represent query parameters.</span></span> <span data-ttu-id="53060-121">Po nastavení vlastností pak můžete použít vlastnosti struktury ve výrazu dotazu.</span><span class="sxs-lookup"><span data-stu-id="53060-121">You can then use the properties on the structure in the query expression after you set the properties.</span></span>  
  
## <a name="example-1"></a><span data-ttu-id="53060-122">Příklad 1</span><span class="sxs-lookup"><span data-stu-id="53060-122">Example 1</span></span>  
 <span data-ttu-id="53060-123">Následující příklad zkompiluje a poté vyvolá dotaz, který přijímá <xref:System.Decimal> vstupní parametr a vrací sekvenci objednávek, kde celková hodnota splatnosti je větší než nebo rovna $200,00:</span><span class="sxs-lookup"><span data-stu-id="53060-123">The following example compiles and then invokes a query that accepts a <xref:System.Decimal> input parameter and returns a sequence of orders where the total due is greater than or equal to $200.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery2)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery2)]  
  
## <a name="example-2"></a><span data-ttu-id="53060-124">Příklad 2</span><span class="sxs-lookup"><span data-stu-id="53060-124">Example 2</span></span>  
 <span data-ttu-id="53060-125">Následující příklad zkompiluje a poté vyvolá dotaz, který vrací <xref:System.Data.Objects.ObjectQuery%601> instanci:</span><span class="sxs-lookup"><span data-stu-id="53060-125">The following example compiles and then invokes a query that returns an <xref:System.Data.Objects.ObjectQuery%601> instance:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery1_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery1_mq)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery1_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery1_mq)]  
  
## <a name="example-3"></a><span data-ttu-id="53060-126">Příklad 3</span><span class="sxs-lookup"><span data-stu-id="53060-126">Example 3</span></span>  
 <span data-ttu-id="53060-127">Následující příklad zkompiluje a potom vyvolá dotaz, který vrací průměr cen seznamu produktů jako <xref:System.Decimal> hodnotu:</span><span class="sxs-lookup"><span data-stu-id="53060-127">The following example compiles and then invokes a query that returns the average of the product list prices as a <xref:System.Decimal> value:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery3_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery3_mq)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery3_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery3_mq)]  
  
## <a name="example-4"></a><span data-ttu-id="53060-128">Příklad 4</span><span class="sxs-lookup"><span data-stu-id="53060-128">Example 4</span></span>  
 <span data-ttu-id="53060-129">Následující příklad zkompiluje a poté vyvolá dotaz, který přijímá <xref:System.String> vstupní parametr, a potom vrátí, `Contact` jehož e-mailová adresa začíná zadaným řetězcem:</span><span class="sxs-lookup"><span data-stu-id="53060-129">The following example compiles and then invokes a query that accepts a <xref:System.String> input parameter and then returns a `Contact` whose email address starts with the specified string:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery4_MQ](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery4_mq)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery4_MQ](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery4_mq)]  
  
## <a name="example-5"></a><span data-ttu-id="53060-130">Příklad 5</span><span class="sxs-lookup"><span data-stu-id="53060-130">Example 5</span></span>  
 <span data-ttu-id="53060-131">Následující příklad zkompiluje a poté vyvolá dotaz, který přijímá <xref:System.DateTime> a <xref:System.Decimal> vstupní parametry a vrací sekvenci objednávek, kde je datum objednávky pozdější než 8. března 2003 a celková hodnota je menší než $300,00:</span><span class="sxs-lookup"><span data-stu-id="53060-131">The following example compiles and then invokes a query that accepts <xref:System.DateTime> and <xref:System.Decimal> input parameters and returns a sequence of orders where the order date is later than March 8, 2003, and the total due is less than $300.00:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery5)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery5)]  
  
## <a name="example-6"></a><span data-ttu-id="53060-132">Příklad 6</span><span class="sxs-lookup"><span data-stu-id="53060-132">Example 6</span></span>  
 <span data-ttu-id="53060-133">Následující příklad zkompiluje a poté vyvolá dotaz, který přijímá <xref:System.DateTime> vstupní parametr a vrátí sekvenci objednávek, kde je datum objednávky pozdější než 8. března 2004.</span><span class="sxs-lookup"><span data-stu-id="53060-133">The following example compiles and then invokes a query that accepts a <xref:System.DateTime> input parameter and returns a sequence of orders where the order date is later than March 8, 2004.</span></span> <span data-ttu-id="53060-134">Tento dotaz vrátí informace o objednávce jako posloupnost anonymních typů.</span><span class="sxs-lookup"><span data-stu-id="53060-134">This query returns the order information as a sequence of anonymous types.</span></span> <span data-ttu-id="53060-135">Anonymní typy jsou odvozeny kompilátorem, takže nelze zadat parametry typu v <xref:System.Data.Objects.CompiledQuery> `Compile` metodě a typ je definován v samotném dotazu.</span><span class="sxs-lookup"><span data-stu-id="53060-135">Anonymous types are inferred by the compiler, so you cannot specify type parameters in the <xref:System.Data.Objects.CompiledQuery>'s `Compile` method and the type is defined in the query itself.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery6)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery6)]  
  
## <a name="example-7"></a><span data-ttu-id="53060-136">Příklad 7</span><span class="sxs-lookup"><span data-stu-id="53060-136">Example 7</span></span>  
 <span data-ttu-id="53060-137">Následující příklad zkompiluje a poté vyvolá dotaz, který přijímá vstupní parametr struktury definované uživatelem a vrací sekvenci Orders.</span><span class="sxs-lookup"><span data-stu-id="53060-137">The following example compiles and then invokes a query that accepts a user-defined structure input parameter and returns a sequence of orders.</span></span> <span data-ttu-id="53060-138">Struktura definuje počáteční a koncové datum a celkový počet parametrů dotazu a dotaz vrátí objednávky dodávané do 3. března 2003 s celkovým termínem větším než $700,00.</span><span class="sxs-lookup"><span data-stu-id="53060-138">The structure defines start date, end date, and total due query parameters, and the query returns orders shipped between March 3 and March 8, 2003 with a total due greater than $700.00.</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#CompiledQuery7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#compiledquery7)]
 [!code-vb[DP L2E Conceptual Examples#CompiledQuery7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#compiledquery7)]  
  
 <span data-ttu-id="53060-139">Struktura definující parametry dotazu:</span><span class="sxs-lookup"><span data-stu-id="53060-139">The structure that defines the query parameters:</span></span>  
  
 [!code-csharp[DP L2E Conceptual Examples#MyParamsStruct](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DP L2E Conceptual Examples/CS/Program.cs#myparamsstruct)]
 [!code-vb[DP L2E Conceptual Examples#MyParamsStruct](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DP L2E Conceptual Examples/VB/Module1.vb#myparamsstruct)]  
  
## <a name="see-also"></a><span data-ttu-id="53060-140">Viz také</span><span class="sxs-lookup"><span data-stu-id="53060-140">See also</span></span>

- [<span data-ttu-id="53060-141">ADO.NET Entity Framework</span><span class="sxs-lookup"><span data-stu-id="53060-141">ADO.NET Entity Framework</span></span>](../index.md)
- [<span data-ttu-id="53060-142">LINQ to Entities</span><span class="sxs-lookup"><span data-stu-id="53060-142">LINQ to Entities</span></span>](linq-to-entities.md)
- [<span data-ttu-id="53060-143">Možnosti sloučení EF a zkompilované dotazy</span><span class="sxs-lookup"><span data-stu-id="53060-143">EF Merge Options and Compiled Queries</span></span>](https://docs.microsoft.com/archive/blogs/dsimmons/ef-merge-options-and-compiled-queries)
