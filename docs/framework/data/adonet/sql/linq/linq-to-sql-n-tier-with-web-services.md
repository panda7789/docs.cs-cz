---
title: N-vrstvé nastavení LINQ to SQL s webovými službami
ms.date: 03/30/2017
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
ms.openlocfilehash: 7a52c17c58df24235a5691c84df159dbea3a8d25
ms.sourcegitcommit: 7bc6887ab658550baa78f1520ea735838249345e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/03/2020
ms.locfileid: "75634583"
---
# <a name="linq-to-sql-n-tier-with-web-services"></a><span data-ttu-id="9203b-102">N-vrstvé nastavení LINQ to SQL s webovými službami</span><span class="sxs-lookup"><span data-stu-id="9203b-102">LINQ to SQL N-Tier with Web Services</span></span>
[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="9203b-103">je navržený hlavně pro použití na střední úrovni v volně oddělené vrstvě pro přístup k datům (DAL), jako je například webová služba.</span><span class="sxs-lookup"><span data-stu-id="9203b-103">is designed especially for use on the middle tier in a loosely-coupled data access layer (DAL) such as a Web service.</span></span> <span data-ttu-id="9203b-104">Pokud je prezentační vrstva webová stránka ASP.NET, použijete ovládací prvek webového serveru <xref:System.Web.UI.WebControls.LinqDataSource> ke správě přenosu dat mezi uživatelským rozhraním a [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] na střední vrstvě.</span><span class="sxs-lookup"><span data-stu-id="9203b-104">If the presentation tier is an ASP.NET Web page, then you use the <xref:System.Web.UI.WebControls.LinqDataSource> Web server control to manage the data transfer between the user interface and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] on the middle-tier.</span></span> <span data-ttu-id="9203b-105">Pokud prezentační vrstva není stránkou ASP.NET, pak musí být obě vrstvy i prezentační vrstva pro správu serializace a deserializace dat potřeba udělat ještě nějakou další práci.</span><span class="sxs-lookup"><span data-stu-id="9203b-105">If the presentation tier is not an ASP.NET page, then both the middle-tier and the presentation tier must do some additional work to manage the serialization and deserialization of data.</span></span>  
  
## <a name="setting-up-linq-to-sql-on-the-middle-tier"></a><span data-ttu-id="9203b-106">Nastavení LINQ to SQL na střední úrovni</span><span class="sxs-lookup"><span data-stu-id="9203b-106">Setting up LINQ to SQL on the Middle Tier</span></span>  
 <span data-ttu-id="9203b-107">V rámci webové služby nebo n-vrstvé aplikace obsahuje střední vrstva kontext dat a třídy entit.</span><span class="sxs-lookup"><span data-stu-id="9203b-107">In a Web service or n-tier application, the middle tier contains the data context and the entity classes.</span></span> <span data-ttu-id="9203b-108">Tyto třídy můžete vytvořit ručně nebo buď pomocí SQLMetal. exe, nebo Návrhář relací objektů, jak je popsáno jinde v dokumentaci.</span><span class="sxs-lookup"><span data-stu-id="9203b-108">You can create these classes manually, or by using either SQLMetal.exe or the Object Relational Designer as described elsewhere in the documentation.</span></span> <span data-ttu-id="9203b-109">V době návrhu máte možnost nastavit, aby třídy entit byly serializovatelné.</span><span class="sxs-lookup"><span data-stu-id="9203b-109">At design time, you have the option to make the entity classes serializable.</span></span> <span data-ttu-id="9203b-110">Další informace najdete v tématu [Postupy: vytváření entit serializovatelných](how-to-make-entities-serializable.md).</span><span class="sxs-lookup"><span data-stu-id="9203b-110">For more information, see [How to: Make Entities Serializable](how-to-make-entities-serializable.md).</span></span> <span data-ttu-id="9203b-111">Další možností je vytvořit samostatnou sadu tříd, které zapouzdřují data, která mají být serializována, a pak projektovat do těchto serializovatelných typů při vracení dat v dotazech LINQ.</span><span class="sxs-lookup"><span data-stu-id="9203b-111">Another option is to create a separate set of classes that encapsulate the data to be serialized, and then project into those serializable types when you return data in your LINQ queries.</span></span>  
  
 <span data-ttu-id="9203b-112">Pak definujete rozhraní s metodami, které budou klienti volat, aby načetli, vložili a aktualizovali data.</span><span class="sxs-lookup"><span data-stu-id="9203b-112">You then define the interface with the methods that the clients will call to retrieve, insert and update data.</span></span> <span data-ttu-id="9203b-113">Metody rozhraní zabalí dotazy LINQ.</span><span class="sxs-lookup"><span data-stu-id="9203b-113">The interface methods wrap your LINQ queries.</span></span> <span data-ttu-id="9203b-114">Pro zpracování volání vzdálených metod a serializace dat lze použít libovolný druh serializace mechanismu.</span><span class="sxs-lookup"><span data-stu-id="9203b-114">You can use any kind of serialization mechanism to handle the remote method calls and the serialization of data.</span></span> <span data-ttu-id="9203b-115">Jediným požadavkem je, že pokud máte v objektovém modelu cyklické nebo obousměrné relace, například to, že mezi zákazníky a objednávkami v modelu standardního objektu Northwind, je nutné použít serializátor, který ho podporuje.</span><span class="sxs-lookup"><span data-stu-id="9203b-115">The only requirement is that if you have cyclic or bi-directional relationships in your object model, such as that between Customers and Orders in the standard Northwind object model, then you must use a serializer that supports it.</span></span> <span data-ttu-id="9203b-116">Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> podporuje obousměrné relace, ale XmlSerializer, který se používá s webovými službami non-WCF, ne.</span><span class="sxs-lookup"><span data-stu-id="9203b-116">The Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> supports bi-directional relationships but the XmlSerializer that is used with non-WCF Web services does not.</span></span> <span data-ttu-id="9203b-117">Pokud se rozhodnete použít XmlSerializer, je nutné zajistit, aby objektový model nemá žádné cyklické relace.</span><span class="sxs-lookup"><span data-stu-id="9203b-117">If you select to use the XmlSerializer, then you must make sure that your object model has no cyclic relationships.</span></span>  
  
 <span data-ttu-id="9203b-118">Další informace o Windows Communication Foundation naleznete v tématu [Windows Communication Foundation Services a WCF Data Services v aplikaci Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="9203b-118">For more information about Windows Communication Foundation, see [Windows Communication Foundation Services and WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span></span>  
  
 <span data-ttu-id="9203b-119">Implementujte obchodní pravidla nebo jinou logiku specifickou pro doménu pomocí dílčích tříd a metod <xref:System.Data.Linq.DataContext> a tříd entit, které se připojí do [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] běhových událostí.</span><span class="sxs-lookup"><span data-stu-id="9203b-119">Implement your business rules or other domain-specific logic by using the partial classes and methods on the <xref:System.Data.Linq.DataContext> and entity classes to hook into [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] runtime events.</span></span> <span data-ttu-id="9203b-120">Další informace najdete v tématu [implementace N-vrstvé obchodní logiky](implementing-business-logic-linq-to-sql.md).</span><span class="sxs-lookup"><span data-stu-id="9203b-120">For more information, see [Implementing N-Tier Business Logic](implementing-business-logic-linq-to-sql.md).</span></span>  
  
## <a name="defining-the-serializable-types"></a><span data-ttu-id="9203b-121">Definování serializovatelných typů</span><span class="sxs-lookup"><span data-stu-id="9203b-121">Defining the Serializable Types</span></span>  
 <span data-ttu-id="9203b-122">Úroveň klienta nebo prezentace musí mít definice typu pro třídy, které bude přijímat ze střední vrstvy.</span><span class="sxs-lookup"><span data-stu-id="9203b-122">The client or presentation tier must have type definitions for the classes that it will be receiving from the middle tier.</span></span> <span data-ttu-id="9203b-123">Tyto typy mohou být samotné třídy entit nebo speciální třídy, které zabalí pouze určitá pole z tříd entit pro vzdálenou komunikaci.</span><span class="sxs-lookup"><span data-stu-id="9203b-123">Those types may be the entity classes themselves, or special classes that wrap only certain fields from the entity classes for remoting.</span></span> <span data-ttu-id="9203b-124">V každém případě je [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] zcela nedotčeno, jak prezentační vrstva získává tyto definice typů.</span><span class="sxs-lookup"><span data-stu-id="9203b-124">In any case, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] is completely unconcerned about how the presentation tier acquires those type definitions.</span></span> <span data-ttu-id="9203b-125">Prezentační vrstva může například použít WCF k automatickému vygenerování typů nebo může mít kopii knihovny DLL, ve které jsou tyto typy definovány, nebo může pouze definovat vlastní verze typů.</span><span class="sxs-lookup"><span data-stu-id="9203b-125">For example, the presentation tier could use WCF to generate the types automatically, or it could have a copy of a DLL in which those types are defined, or it could just define its own versions of the types.</span></span>  
  
## <a name="retrieving-and-inserting-data"></a><span data-ttu-id="9203b-126">Načítání a vkládání dat</span><span class="sxs-lookup"><span data-stu-id="9203b-126">Retrieving and Inserting Data</span></span>  
 <span data-ttu-id="9203b-127">Střední vrstva definuje rozhraní, které určuje, jak prezentační vrstva přistupuje k datům.</span><span class="sxs-lookup"><span data-stu-id="9203b-127">The middle tier defines an interface that specifies how the presentation tier accesses the data.</span></span> <span data-ttu-id="9203b-128">Například `GetProductByID(int productID)`nebo `GetCustomers()`.</span><span class="sxs-lookup"><span data-stu-id="9203b-128">For example `GetProductByID(int productID)`, or `GetCustomers()`.</span></span> <span data-ttu-id="9203b-129">Na střední úrovni tělo metody většinou vytvoří novou instanci <xref:System.Data.Linq.DataContext>, provede dotaz na jednu nebo více jeho tabulek.</span><span class="sxs-lookup"><span data-stu-id="9203b-129">On the middle tier, the method body typically creates a new instance of the <xref:System.Data.Linq.DataContext>, executes a query against one or more of its table.</span></span> <span data-ttu-id="9203b-130">Střední vrstva potom vrátí výsledek jako <xref:System.Collections.Generic.IEnumerable%601>, kde `T` je buď Třída entity, nebo jiný typ, který se používá pro serializaci.</span><span class="sxs-lookup"><span data-stu-id="9203b-130">The middle tier then returns the result as an <xref:System.Collections.Generic.IEnumerable%601>, where `T` is either an entity class or another type that is used for serialization.</span></span> <span data-ttu-id="9203b-131">Prezentační vrstva nikdy neodesílá ani nepřijímá proměnné dotazu přímo do nebo ze střední vrstvy.</span><span class="sxs-lookup"><span data-stu-id="9203b-131">The presentation tier never sends or receives query variables directly to or from the middle tier.</span></span> <span data-ttu-id="9203b-132">Tyto dvě úrovně vyměňují hodnoty, objekty a kolekce konkrétních dat.</span><span class="sxs-lookup"><span data-stu-id="9203b-132">The two tiers exchange values, objects, and collections of concrete data.</span></span> <span data-ttu-id="9203b-133">Po přijetí kolekce může prezentační vrstva použít LINQ to Objects k jejímu dotazování v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="9203b-133">After it has received a collection, the presentation tier can use LINQ to Objects to query it if necessary.</span></span>  
  
 <span data-ttu-id="9203b-134">Při vkládání dat může prezentační vrstva vytvořit nový objekt a odeslat ho do prostřední vrstvy, nebo může mít prostřední vrstvu vytvořit objekt na základě hodnot, které poskytuje.</span><span class="sxs-lookup"><span data-stu-id="9203b-134">When inserting data, the presentation tier can construct a new object and send it to the middle tier, or it can have the middle tier construct the object based on values that it provides.</span></span> <span data-ttu-id="9203b-135">Obecně platí, že načtení a vložení dat do n-vrstvých aplikací se neliší od procesu ve dvou vícevrstvých aplikacích.</span><span class="sxs-lookup"><span data-stu-id="9203b-135">In general, retrieving and inserting data in n-tier applications does not differ much from the process in 2-tier applications.</span></span> <span data-ttu-id="9203b-136">Další informace najdete v tématu [dotazování databáze](querying-the-database.md) a [provádění a odesílání změn dat](making-and-submitting-data-changes.md).</span><span class="sxs-lookup"><span data-stu-id="9203b-136">For more information, see [Querying the Database](querying-the-database.md) and [Making and Submitting Data Changes](making-and-submitting-data-changes.md).</span></span>  
  
## <a name="tracking-changes-for-updates-and-deletes"></a><span data-ttu-id="9203b-137">Sledování změn aktualizací a odstranění</span><span class="sxs-lookup"><span data-stu-id="9203b-137">Tracking Changes for Updates and Deletes</span></span>  
 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="9203b-138">podporuje optimistickou souběžnost na základě časových razítek (také s názvem RowVersions) a na původní hodnoty.</span><span class="sxs-lookup"><span data-stu-id="9203b-138">supports optimistic concurrency based on timestamps (also named RowVersions) and on original values.</span></span> <span data-ttu-id="9203b-139">Pokud jsou v databázových tabulkách časová razítka, pak aktualizace a odstranění vyžadují poněkud další práci na úrovni střední vrstvy nebo prezentační vrstvy.</span><span class="sxs-lookup"><span data-stu-id="9203b-139">If the database tables have timestamps, then updates and deletions require little extra work on either the middle-tier or presentation tier.</span></span> <span data-ttu-id="9203b-140">Nicméně pokud je nutné použít původní hodnoty pro kontroly optimistického řízení souběžnosti, pak je prezentační vrstva zodpovědná za sledování těchto hodnot a jejich odeslání zpět, když provádí aktualizace.</span><span class="sxs-lookup"><span data-stu-id="9203b-140">However, if you must use original values for optimistic concurrency checks, then the presentation tier is responsible for tracking those values and sending them back when it makes updates.</span></span> <span data-ttu-id="9203b-141">Důvodem je to, že změny provedené v entitách v prezentační vrstvě nejsou sledovány na střední úrovni.</span><span class="sxs-lookup"><span data-stu-id="9203b-141">This is because changes that were made to entities on the presentation tier are not tracked on the middle tier.</span></span> <span data-ttu-id="9203b-142">Ve skutečnosti se původní načtení entity a její případná aktualizace obvykle provádí dvěma zcela oddělenými instancemi <xref:System.Data.Linq.DataContext>.</span><span class="sxs-lookup"><span data-stu-id="9203b-142">In fact, the original retrieval of an entity, and the eventual update made to it are typically performed by two completely separate instances of the <xref:System.Data.Linq.DataContext>.</span></span>  
  
 <span data-ttu-id="9203b-143">Čím větší je počet změn, které prezentační vrstva dělá, tím složitější je sledovat tyto změny a zabalit je zpátky do střední vrstvy.</span><span class="sxs-lookup"><span data-stu-id="9203b-143">The greater the number of changes that the presentation tier makes, the more complex it becomes to track those changes and package them back to the middle tier.</span></span> <span data-ttu-id="9203b-144">Implementace mechanismu pro sdělování změn je zcela až do aplikace.</span><span class="sxs-lookup"><span data-stu-id="9203b-144">The implementation of a mechanism for communicating changes is completely up to the application.</span></span> <span data-ttu-id="9203b-145">Jediným požadavkem je, aby [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] musí předávat původní hodnoty, které jsou požadovány pro kontroly optimistického řízení souběžnosti.</span><span class="sxs-lookup"><span data-stu-id="9203b-145">The only requirement is that [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] must be given those original values that are required for optimistic concurrency checks.</span></span>  
  
 <span data-ttu-id="9203b-146">Další informace najdete v tématu [načtení dat a operace CUD v N-vrstvých aplikacích (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span><span class="sxs-lookup"><span data-stu-id="9203b-146">For more information, see [Data Retrieval and CUD Operations in N-Tier Applications (LINQ to SQL)](data-retrieval-and-cud-operations-in-n-tier-applications.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9203b-147">Viz také:</span><span class="sxs-lookup"><span data-stu-id="9203b-147">See also</span></span>

- [<span data-ttu-id="9203b-148">N-vrstvé a vzdálené aplikace s LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="9203b-148">N-Tier and Remote Applications with LINQ to SQL</span></span>](n-tier-and-remote-applications-with-linq-to-sql.md)
- <span data-ttu-id="9203b-149">[Přehled ovládacího prvku webového serveru LinqDataSource](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="9203b-149">[LinqDataSource Web Server Control Overview](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))</span></span>
