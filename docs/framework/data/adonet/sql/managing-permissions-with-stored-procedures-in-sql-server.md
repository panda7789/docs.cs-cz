---
title: Správa oprávnění pomocí uložených procedur na SQL Serveru
ms.date: 03/30/2017
ms.assetid: 08fa34e8-2ffa-470d-ba62-e511a5f8558e
ms.openlocfilehash: 85383c46dd029db825d24d2f67d2dbda00f3bc95
ms.sourcegitcommit: 700ea803fb06c5ce98de017c7f76463ba33ff4a9
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/19/2020
ms.locfileid: "77452380"
---
# <a name="managing-permissions-with-stored-procedures-in-sql-server"></a><span data-ttu-id="d471d-102">Správa oprávnění pomocí uložených procedur na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="d471d-102">Managing Permissions with Stored Procedures in SQL Server</span></span>
<span data-ttu-id="d471d-103">Jednou z metod vytvoření více řádků obrany v databázi je implementace veškerého přístupu k datům pomocí uložených procedur nebo uživatelsky definovaných funkcí.</span><span class="sxs-lookup"><span data-stu-id="d471d-103">One method of creating multiple lines of defense around your database is to implement all data access using stored procedures or user-defined functions.</span></span> <span data-ttu-id="d471d-104">Odvoláte nebo odepřete všechna oprávnění k podkladovým objektům, jako jsou tabulky, a udělte oprávnění k provádění uložených procedur.</span><span class="sxs-lookup"><span data-stu-id="d471d-104">You revoke or deny all permissions to underlying objects, such as tables, and grant EXECUTE permissions on stored procedures.</span></span> <span data-ttu-id="d471d-105">Tím se efektivně vytvoří hraniční zabezpečení kolem vašich dat a databázových objektů.</span><span class="sxs-lookup"><span data-stu-id="d471d-105">This effectively creates a security perimeter around your data and database objects.</span></span>  
  
## <a name="stored-procedure-benefits"></a><span data-ttu-id="d471d-106">Výhody uložených procedur</span><span class="sxs-lookup"><span data-stu-id="d471d-106">Stored Procedure Benefits</span></span>  
 <span data-ttu-id="d471d-107">Uložené procedury mají následující výhody:</span><span class="sxs-lookup"><span data-stu-id="d471d-107">Stored procedures have the following benefits:</span></span>  
  
- <span data-ttu-id="d471d-108">Data logiky a podnikových pravidel je možné zapouzdřit, aby uživatelé měli přístup k datům a objektům pouze způsobem, který mají vývojáři a správci databází v úmyslu.</span><span class="sxs-lookup"><span data-stu-id="d471d-108">Data logic and business rules can be encapsulated so that users can access data and objects only in ways that developers and database administrators intend.</span></span>  
  
- <span data-ttu-id="d471d-109">Parametrizované uložené procedury, které ověřují všechny vstupy uživatelů, se dají použít k vzdoruje útoku prostřednictvím injektáže SQL.</span><span class="sxs-lookup"><span data-stu-id="d471d-109">Parameterized stored procedures that validate all user input can be used to thwart SQL injection attacks.</span></span> <span data-ttu-id="d471d-110">Použijete-li Dynamic SQL, nezapomeňte příkazy parametrizovat a nikdy Nezahrnovat hodnoty parametrů přímo do řetězce dotazu.</span><span class="sxs-lookup"><span data-stu-id="d471d-110">If you use dynamic SQL, be sure to parameterize your commands, and never include parameter values directly into a query string.</span></span>  
  
- <span data-ttu-id="d471d-111">Je možné, že se nepovolí ad hoc dotazy a změny dat.</span><span class="sxs-lookup"><span data-stu-id="d471d-111">Ad hoc queries and data modifications can be disallowed.</span></span> <span data-ttu-id="d471d-112">To zabrání uživatelům v škodlivých nebo neúmyslném zničení dat nebo provádění dotazů, které mají vliv na výkon serveru nebo sítě.</span><span class="sxs-lookup"><span data-stu-id="d471d-112">This prevents users from maliciously or inadvertently destroying data or executing queries that impair performance on the server or the network.</span></span>  
  
- <span data-ttu-id="d471d-113">Chyby lze zpracovat v kódu procedury bez předání přímo klientským aplikacím.</span><span class="sxs-lookup"><span data-stu-id="d471d-113">Errors can be handled in procedure code without being passed directly to client applications.</span></span> <span data-ttu-id="d471d-114">To brání tomu, aby se vracely chybové zprávy, které by mohly pomoci při útoku na zjišťování.</span><span class="sxs-lookup"><span data-stu-id="d471d-114">This prevents error messages from being returned that could aid in a probing attack.</span></span> <span data-ttu-id="d471d-115">Protokoluje chyby a zpracuje je na serveru.</span><span class="sxs-lookup"><span data-stu-id="d471d-115">Log errors and handle them on the server.</span></span>  
  
- <span data-ttu-id="d471d-116">Uložené procedury lze zapsat jednou a k nim mají pøístup mnoho aplikací.</span><span class="sxs-lookup"><span data-stu-id="d471d-116">Stored procedures can be written once, and accessed by many applications.</span></span>  
  
- <span data-ttu-id="d471d-117">Klientské aplikace nepotřebují znát žádné informace o podkladových datových strukturách.</span><span class="sxs-lookup"><span data-stu-id="d471d-117">Client applications do not need to know anything about the underlying data structures.</span></span> <span data-ttu-id="d471d-118">Uložený kód procedury lze změnit bez nutnosti změny v klientských aplikacích, pokud změny neovlivňují seznamy parametrů ani vrácené datové typy.</span><span class="sxs-lookup"><span data-stu-id="d471d-118">Stored procedure code can be changed without requiring changes in client applications as long as the changes do not affect parameter lists or returned data types.</span></span>  
  
- <span data-ttu-id="d471d-119">Uložené procedury mohou snížit zatížení sítě kombinací více operací do jednoho volání procedury.</span><span class="sxs-lookup"><span data-stu-id="d471d-119">Stored procedures can reduce network traffic by combining multiple operations into one procedure call.</span></span>  
  
## <a name="stored-procedure-execution"></a><span data-ttu-id="d471d-120">Spuštění uložené procedury</span><span class="sxs-lookup"><span data-stu-id="d471d-120">Stored Procedure Execution</span></span>  
 <span data-ttu-id="d471d-121">Uložené procedury využívají výhod zřetězení vlastnictví k poskytnutí přístupu k datům, aby uživatelé nemuseli mít explicitní oprávnění k přístupu k databázovým objektům.</span><span class="sxs-lookup"><span data-stu-id="d471d-121">Stored procedures take advantage of ownership chaining to provide access to data so that users do not need to have explicit permission to access database objects.</span></span> <span data-ttu-id="d471d-122">Řetěz vlastnictví existuje, pokud objekty, které jsou na sobě navzájemně přistupují, jsou vlastněny stejným uživatelem.</span><span class="sxs-lookup"><span data-stu-id="d471d-122">An ownership chain exists when objects that access each other sequentially are owned by the same user.</span></span> <span data-ttu-id="d471d-123">Například uložená procedura může volat jiné uložené procedury nebo uložená procedura může získat přístup k několika tabulkám.</span><span class="sxs-lookup"><span data-stu-id="d471d-123">For example, a stored procedure can call other stored procedures, or a stored procedure can access multiple tables.</span></span> <span data-ttu-id="d471d-124">Pokud mají všechny objekty v řetězci spuštění stejný vlastník, pak SQL Server pouze kontroluje oprávnění EXECUTE pro volajícího, nikoli oprávnění volajícího pro jiné objekty.</span><span class="sxs-lookup"><span data-stu-id="d471d-124">If all objects in the chain of execution have the same owner, then SQL Server only checks the EXECUTE permission for the caller, not the caller's permissions on other objects.</span></span> <span data-ttu-id="d471d-125">Proto musíte pro uložené procedury udělit pouze oprávnění ke spouštění. v podkladových tabulkách můžete odvolat nebo odepřít všechna oprávnění.</span><span class="sxs-lookup"><span data-stu-id="d471d-125">Therefore you need to grant only EXECUTE permissions on stored procedures; you can revoke or deny all permissions on the underlying tables.</span></span>  
  
## <a name="best-practices"></a><span data-ttu-id="d471d-126">Osvědčené postupy</span><span class="sxs-lookup"><span data-stu-id="d471d-126">Best Practices</span></span>  
 <span data-ttu-id="d471d-127">Pouhým zápisem uložených procedur nestačí dostatečně zabezpečit svoji aplikaci.</span><span class="sxs-lookup"><span data-stu-id="d471d-127">Simply writing stored procedures isn't enough to adequately secure your application.</span></span> <span data-ttu-id="d471d-128">Měli byste také zvážit následující potenciální bezpečnostní otvory.</span><span class="sxs-lookup"><span data-stu-id="d471d-128">You should also consider the following potential security holes.</span></span>  
  
- <span data-ttu-id="d471d-129">Udělte oprávnění EXECUTE pro uložené procedury databázových rolí, které chcete mít přístup k datům.</span><span class="sxs-lookup"><span data-stu-id="d471d-129">Grant EXECUTE permissions on the stored procedures for database roles you want to be able to access the data.</span></span>  
  
- <span data-ttu-id="d471d-130">Odvolat nebo odepřít všechna oprávnění k podkladovým tabulkám pro všechny role a uživatele v databázi, včetně role `public`.</span><span class="sxs-lookup"><span data-stu-id="d471d-130">Revoke or deny all permissions to the underlying tables for all roles and users in the database, including the `public` role.</span></span> <span data-ttu-id="d471d-131">Všichni uživatelé dědí oprávnění z veřejného.</span><span class="sxs-lookup"><span data-stu-id="d471d-131">All users inherit permissions from public.</span></span> <span data-ttu-id="d471d-132">Proto odepření oprávnění `public` znamená, že přístup mají pouze vlastníci a `sysadmin` členové. Všichni ostatní uživatelé nebudou moct dědit oprávnění z členství v jiných rolích.</span><span class="sxs-lookup"><span data-stu-id="d471d-132">Therefore denying permissions to `public` means that only owners and `sysadmin` members have access; all other users will be unable to inherit permissions from membership in other roles.</span></span>  
  
- <span data-ttu-id="d471d-133">Nepřidávejte do rolí `sysadmin` ani `db_owner` role uživatelů ani rolí.</span><span class="sxs-lookup"><span data-stu-id="d471d-133">Do not add users or roles to the `sysadmin` or `db_owner` roles.</span></span> <span data-ttu-id="d471d-134">Správci systému a vlastníci databází mají přístup ke všem databázovým objektům.</span><span class="sxs-lookup"><span data-stu-id="d471d-134">System administrators and database owners can access all database objects.</span></span>  
  
- <span data-ttu-id="d471d-135">Zakažte účet `guest`.</span><span class="sxs-lookup"><span data-stu-id="d471d-135">Disable the `guest` account.</span></span> <span data-ttu-id="d471d-136">Tato akce zabrání anonymním uživatelům v připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="d471d-136">This will prevent anonymous users from connecting to the database.</span></span> <span data-ttu-id="d471d-137">Účet hosta je ve výchozím nastavení v nových databázích zakázán.</span><span class="sxs-lookup"><span data-stu-id="d471d-137">The guest account is disabled by default in new databases.</span></span>  
  
- <span data-ttu-id="d471d-138">Implementuje zpracování chyb a protokolování chyb.</span><span class="sxs-lookup"><span data-stu-id="d471d-138">Implement error handling and log errors.</span></span>  
  
- <span data-ttu-id="d471d-139">Vytvořte parametrizované uložené procedury, které ověřují všechny vstupy uživatele.</span><span class="sxs-lookup"><span data-stu-id="d471d-139">Create parameterized stored procedures that validate all user input.</span></span> <span data-ttu-id="d471d-140">Považovat všechny vstupy uživatelů za nedůvěryhodné.</span><span class="sxs-lookup"><span data-stu-id="d471d-140">Treat all user input as untrusted.</span></span>  
  
- <span data-ttu-id="d471d-141">Vyhněte se dynamickému SQL, pokud není nezbytně nutné.</span><span class="sxs-lookup"><span data-stu-id="d471d-141">Avoid dynamic SQL unless absolutely necessary.</span></span> <span data-ttu-id="d471d-142">Použijte funkci Transact-SQL QUOTa () k vymezení řetězcové hodnoty a řídicího znaku ve vstupním řetězci.</span><span class="sxs-lookup"><span data-stu-id="d471d-142">Use the Transact-SQL QUOTENAME() function to delimit a string value and escape any occurrence of the delimiter in the input string.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="d471d-143">Externí zdroje</span><span class="sxs-lookup"><span data-stu-id="d471d-143">External Resources</span></span>  
 <span data-ttu-id="d471d-144">Další informace najdete v následujících materiálech.</span><span class="sxs-lookup"><span data-stu-id="d471d-144">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="d471d-145">Prostředek</span><span class="sxs-lookup"><span data-stu-id="d471d-145">Resource</span></span>|<span data-ttu-id="d471d-146">Popis</span><span class="sxs-lookup"><span data-stu-id="d471d-146">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="d471d-147">[Uložené procedury](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) a [injektáže SQL](/sql/relational-databases/security/sql-injection)</span><span class="sxs-lookup"><span data-stu-id="d471d-147">[Stored Procedures](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) and [SQL Injection](/sql/relational-databases/security/sql-injection)</span></span>|<span data-ttu-id="d471d-148">Články popisují, jak vytvořit uložené procedury a jak funguje injektáže SQL.</span><span class="sxs-lookup"><span data-stu-id="d471d-148">Articles describe how to create stored procedures and how SQL Injection works.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="d471d-149">Viz také</span><span class="sxs-lookup"><span data-stu-id="d471d-149">See also</span></span>

- [<span data-ttu-id="d471d-150">Zabezpečení aplikací ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d471d-150">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="d471d-151">Přehled zabezpečení SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="d471d-151">Overview of SQL Server Security</span></span>](overview-of-sql-server-security.md)
- [<span data-ttu-id="d471d-152">Scénáře zabezpečení aplikací na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="d471d-152">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="d471d-153">Zápis zabezpečené dynamické SQL na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="d471d-153">Writing Secure Dynamic SQL in SQL Server</span></span>](writing-secure-dynamic-sql-in-sql-server.md)
- [<span data-ttu-id="d471d-154">Podepisování uložených procedur na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="d471d-154">Signing Stored Procedures in SQL Server</span></span>](signing-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="d471d-155">Přizpůsobení oprávnění se zosobněním na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="d471d-155">Customizing Permissions with Impersonation in SQL Server</span></span>](customizing-permissions-with-impersonation-in-sql-server.md)
- [<span data-ttu-id="d471d-156">Úpravy dat pomocí uložených procedur</span><span class="sxs-lookup"><span data-stu-id="d471d-156">Modifying Data with Stored Procedures</span></span>](../modifying-data-with-stored-procedures.md)
- [<span data-ttu-id="d471d-157">Přehled ADO.NET</span><span class="sxs-lookup"><span data-stu-id="d471d-157">ADO.NET Overview</span></span>](../ado-net-overview.md)
