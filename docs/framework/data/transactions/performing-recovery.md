---
title: "Obnovení"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 6dd17bf6-ba42-460a-a44b-8046f52b10d0
caps.latest.revision: "3"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 044d702c05d644e0eb11d3eb6ca291ebfc4dcf17
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/02/2017
---
# <a name="performing-recovery"></a><span data-ttu-id="decfc-102">Obnovení</span><span class="sxs-lookup"><span data-stu-id="decfc-102">Performing Recovery</span></span>
<span data-ttu-id="decfc-103">Správce prostředků usnadňuje řešení trvalý zařazení v transakci tím, že reenlisting účastník transakce po selhání prostředku.</span><span class="sxs-lookup"><span data-stu-id="decfc-103">A resource manager facilitates resolution of durable enlistments in a transaction by reenlisting the transaction participant after resource failure.</span></span>  
  
## <a name="the-recovery-process"></a><span data-ttu-id="decfc-104">Proces obnovení</span><span class="sxs-lookup"><span data-stu-id="decfc-104">The Recovery Process</span></span>  
 <span data-ttu-id="decfc-105">Trvale zařazení prostředek do (popsaného implementace <xref:System.Transactions.IEnlistmentNotification> rozhraní), může být později oprávněné pro obnovení, měli byste zavolat <xref:System.Transactions.Transaction.EnlistDurable%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="decfc-105">To durably enlist a resource (described by an implementation of the <xref:System.Transactions.IEnlistmentNotification> interface) that can later be eligible for recovery, you should call the <xref:System.Transactions.Transaction.EnlistDurable%2A> method.</span></span> <span data-ttu-id="decfc-106">Kromě toho je třeba zadat <xref:System.Transactions.Transaction.EnlistDurable%2A> metodu se identifikátor správce prostředků ( <xref:System.Guid>) používané při konzistentně popisek účastník transakce v případě selhání prostředku.</span><span class="sxs-lookup"><span data-stu-id="decfc-106">In addition, you must provide the <xref:System.Transactions.Transaction.EnlistDurable%2A> method with a resource manager identifier (a <xref:System.Guid>) that is used to consistently label the participant of the transaction in the event of a resource failure.</span></span> <span data-ttu-id="decfc-107">Z tohoto důvodu <xref:System.Guid> , je zadané pro počáteční Enlist volání by měl být stejný jako *resourceManagerIdentifier* parametr ve <xref:System.Transactions.TransactionManager.Reenlist%2A> volání během obnovení.</span><span class="sxs-lookup"><span data-stu-id="decfc-107">For this reason, the <xref:System.Guid> that is provided to the initial Enlist call should be identical to the *resourceManagerIdentifier* parameter in the <xref:System.Transactions.TransactionManager.Reenlist%2A> call during recovery.</span></span> <span data-ttu-id="decfc-108">V opačném <xref:System.Transactions.TransactionException> je vyvolána.</span><span class="sxs-lookup"><span data-stu-id="decfc-108">Otherwise, <xref:System.Transactions.TransactionException> is thrown.</span></span> <span data-ttu-id="decfc-109">Další informace o trvanlivý zařazení, najdete v části [uvedení prostředky jako účastníky v transakci](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) .</span><span class="sxs-lookup"><span data-stu-id="decfc-109">For more information on durable enlistments, see [Enlisting Resources as Participants in a Transaction](../../../../docs/framework/data/transactions/enlisting-resources-as-participants-in-a-transaction.md) .</span></span>  
  
 <span data-ttu-id="decfc-110">Ve fázi prepare (fáze 1) protokolu 2PC, jakmile obdrží implementace správce trvalý prostředků <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> oznámení, jeho záznam připravit ji by měl protokolu v průběhu této fáze.</span><span class="sxs-lookup"><span data-stu-id="decfc-110">In the prepare phase (phase 1) of the 2PC protocol, when your implementation of a durable resource manager receives the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification, it should log its prepare record during this phase.</span></span> <span data-ttu-id="decfc-111">Záznam by měl obsahovat všechny informace, které jsou nezbytné pro dokončení transakce na potvrzení.</span><span class="sxs-lookup"><span data-stu-id="decfc-111">The record should contain all the information that is necessary to complete the transaction on commit.</span></span> <span data-ttu-id="decfc-112">Příprava záznam můžete později přístupné během obnovení načtením <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> vlastnost *preparingEnlistment* zpětného volání.</span><span class="sxs-lookup"><span data-stu-id="decfc-112">The prepare record can later be accessed during recovery by retrieving the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the *preparingEnlistment* callback.</span></span> <span data-ttu-id="decfc-113">Není třeba provádět v rámci záznamu protokolování <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> jako správce prostředků metodu to lze provést v pracovní podproces.</span><span class="sxs-lookup"><span data-stu-id="decfc-113">The record logging does not need to be performed within the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> method as the RM can do this on a worker thread.</span></span>  
  
 <span data-ttu-id="decfc-114">Proces obnovení se skládá ze dvou kroků:</span><span class="sxs-lookup"><span data-stu-id="decfc-114">The recovery process consists of the following two steps:</span></span>  
  
### <a name="step-1---reenlist"></a><span data-ttu-id="decfc-115">Krok 1 – ReEnlist</span><span class="sxs-lookup"><span data-stu-id="decfc-115">Step 1 - ReEnlist</span></span>  
 <span data-ttu-id="decfc-116">Správce prostředků prozkoumá záznamu Příprava informací pro každou zařazení, který je nejistoty.</span><span class="sxs-lookup"><span data-stu-id="decfc-116">The resource manager examines the prepare information record for each enlistment that is in-doubt.</span></span> <span data-ttu-id="decfc-117">To lze provést prostřednictvím zkoušení <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> vlastnost <xref:System.Transactions.PreparingEnlistment> zpětné volání, které je předán správce prostředků v <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> oznámení během fáze 1.</span><span class="sxs-lookup"><span data-stu-id="decfc-117">This is done by examining the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the <xref:System.Transactions.PreparingEnlistment> callback, which is passed to the resource manager in the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification during phase 1.</span></span>  
  
 <span data-ttu-id="decfc-118">Pro každou takové zařazení zkontroluje, vyvolá <xref:System.Transactions.TransactionManager.Reenlist%2A> na správce transakcí.</span><span class="sxs-lookup"><span data-stu-id="decfc-118">For each such enlistment it examines, it invokes <xref:System.Transactions.TransactionManager.Reenlist%2A> on the transaction manager.</span></span> <span data-ttu-id="decfc-119">Tato metoda předává na jedinečné <xref:System.Guid> který identifikuje správce prostředků, stejně jako informace zařazení v bajtové pole.</span><span class="sxs-lookup"><span data-stu-id="decfc-119">This method passes on a unique <xref:System.Guid> that identifies the resource manager, as well as the enlistment's information in a byte array.</span></span> <span data-ttu-id="decfc-120">Nový <xref:System.Transactions.Enlistment> je vrácen objekt.</span><span class="sxs-lookup"><span data-stu-id="decfc-120">A new <xref:System.Transactions.Enlistment> object is returned.</span></span> <span data-ttu-id="decfc-121">Pokud reenlistment selže s výjimku, bude nutné správce prostředků se zkuste připojit znovu později.</span><span class="sxs-lookup"><span data-stu-id="decfc-121">If the reenlistment fails with an exception, the resource manager will need to retry at a later time.</span></span>  
  
 <span data-ttu-id="decfc-122">By měla volat pouze <xref:System.Transactions.TransactionManager.Reenlist%2A> metodu po restartování správce prostředků z selhání.</span><span class="sxs-lookup"><span data-stu-id="decfc-122">You should only call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method when a resource manager restarts from failure.</span></span> <span data-ttu-id="decfc-123">Kromě toho by měla pouze reenlist nepřeloženého transakce zapsané podle správce prostředků během počátečního Prepare fáze dvoufázového potvrzení.</span><span class="sxs-lookup"><span data-stu-id="decfc-123">In addition, you should only reenlist unresolved transactions logged by a resource manager during the initial Prepare phase of a two-phase commit.</span></span> <span data-ttu-id="decfc-124">Jakékoli pokusy o tuto metodu lze volat v neplatný časech může chybné výsledkům.</span><span class="sxs-lookup"><span data-stu-id="decfc-124">Any attempt to call this method at invalid times can produce erroneous results.</span></span>  
  
 <span data-ttu-id="decfc-125">Když je účastník reenlisted pomocí této metody metody fáze 2 <xref:System.Transactions.IEnlistmentNotification> která odpovídají výstup transakce (to znamená, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> nebo <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) se nazývají podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="decfc-125">When a participant is reenlisted using this method, the phase 2 methods of <xref:System.Transactions.IEnlistmentNotification> that correspond to the transaction's outcome (that is, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> or <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) are called as appropriate.</span></span>  
  
### <a name="step-2---completing-the-recovery"></a><span data-ttu-id="decfc-126">Krok 2 – dokončení obnovení</span><span class="sxs-lookup"><span data-stu-id="decfc-126">Step 2 - Completing the recovery</span></span>  
 <span data-ttu-id="decfc-127">Po dokončení všech reenlistments volá správce prostředků <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="decfc-127">When all the reenlistments are finished, the resource manager calls the <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> method.</span></span> <span data-ttu-id="decfc-128">Tato metoda se dokončí obnovení a informuje správce transakcí, aby správce prostředků nemá žádné další transakce nejistoty.</span><span class="sxs-lookup"><span data-stu-id="decfc-128">This method completes the recovery and informs the transaction manager that the resource manager has no more in-doubt transactions.</span></span> <span data-ttu-id="decfc-129">Tímto způsobem správce prostředků zaručuje, že nebude volat <xref:System.Transactions.TransactionManager.Reenlist%2A> metoda znovu.</span><span class="sxs-lookup"><span data-stu-id="decfc-129">By doing so, the resource manager guarantees that it will not invoke the <xref:System.Transactions.TransactionManager.Reenlist%2A> method again.</span></span>  
  
 <span data-ttu-id="decfc-130">Správce prostředků není nutné před zapsání v nové transakce vyřešit všechny transakce nejistoty.</span><span class="sxs-lookup"><span data-stu-id="decfc-130">A resource manager is not required to resolve all in-doubt transactions before enlisting in new transactions.</span></span> <span data-ttu-id="decfc-131">První krok lze provést kdykoli po správce prostředků vytváří vztah s správce transakcí, ale po <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> byla vyvolána (krok 2); krok 1 nelze provést znovu.</span><span class="sxs-lookup"><span data-stu-id="decfc-131">The first step can be performed at any time after the resource manager establishes a relationship with the transaction manager, but after <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> has been invoked (step 2); step 1 cannot be performed again.</span></span> <span data-ttu-id="decfc-132">Krok 2 lze opakovat bez dopadu výsledku transakcí více než jednou.</span><span class="sxs-lookup"><span data-stu-id="decfc-132">Step 2 can be repeated multiple times without affecting the outcome of transactions.</span></span>
