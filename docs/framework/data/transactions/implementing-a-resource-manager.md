---
title: Implementace správce prostředků
description: Implementace správce prostředků v rozhraní .NET. Správce prostředků spravuje prostředky používané v transakcích. Správce transakcí koordinuje akce správce prostředků.
ms.date: 03/30/2017
ms.assetid: d5c153f6-4419-49e3-a5f1-a50ae4c81bf3
ms.openlocfilehash: bf40c6eaee35a5a548c6de4a286e46c4d4a66aca
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141846"
---
# <a name="implementing-a-resource-manager"></a><span data-ttu-id="92bce-105">Implementace správce prostředků</span><span class="sxs-lookup"><span data-stu-id="92bce-105">Implementing a Resource Manager</span></span>
<span data-ttu-id="92bce-106">Každý prostředek, který používá v transakci spravuje správce prostředků, jejichž akce jsou koordinovaný správcem transakcí.</span><span class="sxs-lookup"><span data-stu-id="92bce-106">Each resource used in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="92bce-107">Správci prostředků pracují ve spolupráci se správcem transakcí k poskytování aplikací s zárukou atomicitu a izolaci.</span><span class="sxs-lookup"><span data-stu-id="92bce-107">Resource managers work in cooperation with the transaction manager to provide the application with a guarantee of atomicity and isolation.</span></span> <span data-ttu-id="92bce-108">Microsoft SQL Server, fronty zpráv trvalý, tabulky hodnot hash v paměti jsou všechny příklady správci prostředků.</span><span class="sxs-lookup"><span data-stu-id="92bce-108">Microsoft SQL Server, durable message queues, in-memory hash tables are all examples of resource managers.</span></span>  
  
 <span data-ttu-id="92bce-109">Správce prostředků spravuje trvalé nebo přechodné data.</span><span class="sxs-lookup"><span data-stu-id="92bce-109">A resource manager manages either durable or volatile data.</span></span> <span data-ttu-id="92bce-110">Životnost (nebo naopak nestálosti) materiálu manager odkazuje na tom, zda správce prostředků podporuje obnovení po selhání.</span><span class="sxs-lookup"><span data-stu-id="92bce-110">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="92bce-111">Pokud správce prostředků podporuje obnovení po selhání, přenese data do trvalého úložiště během fáze 1 (připravit) tak, pokud správce prostředků nebude fungovat, můžete zařadit do transakce při obnovení, znovu a správné činnostem podle oznámení obdržená z správce transakcí.</span><span class="sxs-lookup"><span data-stu-id="92bce-111">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the transaction manager.</span></span> <span data-ttu-id="92bce-112">Obecně platí správci těkavých prostředků spravovat těkavých prostředků, jako jsou například struktury dat v paměti (například v paměti zpracováván jako transakce hashtable) a správci trvalý prostředků spravovat prostředky, které mají více trvalé záložní úložiště (například databáze jehož záložní úložiště je disku).</span><span class="sxs-lookup"><span data-stu-id="92bce-112">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>  
  
 <span data-ttu-id="92bce-113">Chcete-li, aby zdroj k účasti v transakci musí zařadit do transakce.</span><span class="sxs-lookup"><span data-stu-id="92bce-113">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="92bce-114"><xref:System.Transactions.Transaction>Třída definuje sadu metod, jejichž názvy začínají na **zařazení** , které tuto funkci poskytují.</span><span class="sxs-lookup"><span data-stu-id="92bce-114">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="92bce-115">Různé metody **zařazení** odpovídají různým typům zařazení, které může mít správce prostředků.</span><span class="sxs-lookup"><span data-stu-id="92bce-115">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="92bce-116">Konkrétně používají <xref:System.Transactions.Transaction.EnlistVolatile%2A> metody pro těkavých materiály a <xref:System.Transactions.Transaction.EnlistDurable%2A> metody pro trvalý zdroje.</span><span class="sxs-lookup"><span data-stu-id="92bce-116">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="92bce-117">Pro jednoduchost, jakmile se rozhodnete, zda se má použít <xref:System.Transactions.Transaction.EnlistDurable%2A> nebo <xref:System.Transactions.Transaction.EnlistVolatile%2A> metoda založená na podporu své prostředků životnost, by měl zařazení materiálu k účasti na dvě fáze potvrzení (2PC) implementací <xref:System.Transactions.IEnlistmentNotification> rozhraní pro váš správce prostředků.</span><span class="sxs-lookup"><span data-stu-id="92bce-117">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="92bce-118">Další informace o 2PC naleznete v tématu [potvrzení transakce v jedné fázi a několika fázích](committing-a-transaction-in-single-phase-and-multi-phase.md).</span><span class="sxs-lookup"><span data-stu-id="92bce-118">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>  
  
 <span data-ttu-id="92bce-119">Pomocí zapsání správce prostředků zajišťuje, že ji zpětná volání získá ze Správce transakcí při potvrzení nebo přerušení transakce.</span><span class="sxs-lookup"><span data-stu-id="92bce-119">By enlisting, the resource manager ensures that it gets callbacks from the transaction manager when the transaction commits or aborts.</span></span> <span data-ttu-id="92bce-120">Existuje jedna instance <xref:System.Transactions.IEnlistmentNotification> za zařazení.</span><span class="sxs-lookup"><span data-stu-id="92bce-120">There is one instance of <xref:System.Transactions.IEnlistmentNotification> per enlistment.</span></span> <span data-ttu-id="92bce-121">Obvykle je jeden zařazení na transakci, ale můžete zvolit správce prostředků k zařazení vícekrát v rámci jedné transakce.</span><span class="sxs-lookup"><span data-stu-id="92bce-121">Typically, there is one enlistment per transaction, but a resource manager can choose to enlist multiple times in the same transaction.</span></span>  
  
 <span data-ttu-id="92bce-122">Po zařazení správce prostředků reaguje na požadavky transakci.</span><span class="sxs-lookup"><span data-stu-id="92bce-122">After enlistment, the resource manager responds to the transaction's requests.</span></span> <span data-ttu-id="92bce-123">Správce prostředků trvalý ukládá dostatek informací, aby mohla vrátit zpět nebo znovu provést transakci práci na prostředky, že spravuje.</span><span class="sxs-lookup"><span data-stu-id="92bce-123">A durable resource manager stores enough information to allow it to either undo or redo the transaction's work on resources it manages.</span></span> <span data-ttu-id="92bce-124">Existuje mnoho způsobů, jak provést; uchování verzí dat nebo udržování protokolu změn jsou dvě společné techniky.</span><span class="sxs-lookup"><span data-stu-id="92bce-124">There are many ways to do this; keeping versions of data or keeping a log of the changes are two common techniques.</span></span>  
  
 <span data-ttu-id="92bce-125">Když aplikace potvrdí transakce, správce transakcí spustí protokol dvoufázového potvrzení.</span><span class="sxs-lookup"><span data-stu-id="92bce-125">When the application commits the transaction, the transaction manager initiates the two-phase commit protocol.</span></span> <span data-ttu-id="92bce-126">Správce transakcí žádá nejprve každého správce prostředků zařazených, pokud je připraven k potvrzení transakce.</span><span class="sxs-lookup"><span data-stu-id="92bce-126">The transaction manager first asks each enlisted resource manager if it is prepared to commit the transaction.</span></span> <span data-ttu-id="92bce-127">Správce prostředků musí přípravu k potvrzení akce – ji připravíte sám o potvrzení nebo přerušení transakce.</span><span class="sxs-lookup"><span data-stu-id="92bce-127">The resource manager must prepare to commit—it readies itself to either commit or abort the transaction.</span></span>  
  
 <span data-ttu-id="92bce-128">Během fáze Příprava správce prostředků trvalý zaznamenává stará a nová data v úložišti stabilní tak, aby správce prostředků můžete obnovit jej i v případě selhání systému.</span><span class="sxs-lookup"><span data-stu-id="92bce-128">During the prepare phase, the durable resource manager records the old and new data in stable storage so that the resource manager can recover it even if the system fails.</span></span> <span data-ttu-id="92bce-129">Pokud správce prostředků můžete připravit, informuje správce transakcí jeho hlasovat na tom, zda se potvrzení nebo přerušení transakce.</span><span class="sxs-lookup"><span data-stu-id="92bce-129">If the resource manager can prepare, it informs the transaction manager its vote on whether to commit or abort the transaction.</span></span> <span data-ttu-id="92bce-130">Pokud některý správce prostředků hlásí selhání při přípravě, správce transakcí odešle příkaz vrátit zpět do každého správce prostředků a určuje selhání potvrzení do aplikace.</span><span class="sxs-lookup"><span data-stu-id="92bce-130">If any resource manager reports a failure to prepare, the transaction manager sends a rollback command to each resource manager and indicates the failure of the commit to the application.</span></span>  
  
 <span data-ttu-id="92bce-131">Jakmile připraven, musí správce prostředků čekat potvrzení nebo zrušení zpětného volání z správce transakcí ve fázi 2.</span><span class="sxs-lookup"><span data-stu-id="92bce-131">Once prepared, a resource manager must wait until it gets a commit or abort callback from the transaction manager in phase 2.</span></span> <span data-ttu-id="92bce-132">Obvykle celý protokol prepare a potvrzení dokončí za zlomek sekundy.</span><span class="sxs-lookup"><span data-stu-id="92bce-132">Typically, the entire prepare and commit protocol completes in a fraction of a second.</span></span> <span data-ttu-id="92bce-133">Pokud dochází k selhání systému nebo komunikace, nemusí přijetí oznámení potvrzení nebo přerušení pro minut nebo hodin.</span><span class="sxs-lookup"><span data-stu-id="92bce-133">If there are system or communication failures, the commit or abort notification may not arrive for minutes or hours.</span></span> <span data-ttu-id="92bce-134">Během této doby je správce prostředků za výsledek transakce.</span><span class="sxs-lookup"><span data-stu-id="92bce-134">During this period, the resource manager is in doubt about the outcome of the transaction.</span></span> <span data-ttu-id="92bce-135">Nemůže určit, zda byla transakce potvrzena nebo bylo přerušeno.</span><span class="sxs-lookup"><span data-stu-id="92bce-135">It does not know whether the transaction committed or aborted.</span></span> <span data-ttu-id="92bce-136">Správce prostředků v době vyskytne transakcí, zachová data změněná udržováním transakce zamknuta, a tím izolace tyto změny od všech ostatních transakcí.</span><span class="sxs-lookup"><span data-stu-id="92bce-136">While the resource manager is in doubt about a transaction, it keeps the data modified by keeping the transaction locked, thereby isolating these changes from any other transactions.</span></span>  
  
 <span data-ttu-id="92bce-137">Pokud se nezdaří správce prostředků, jsou všechny její provedení transakcí bylo přerušeno kromě těch, které jsou připravených nebo potvrzených před selhání.</span><span class="sxs-lookup"><span data-stu-id="92bce-137">When a resource manager fails, all of its enlisted transactions are aborted except for those that are prepared or committed prior to the failure.</span></span> <span data-ttu-id="92bce-138">Po restartování správce prostředků trvalý rekonstruuje potvrzeny stav prostředků, které spravuje načtením Příprava informací, zapsán ve fázi prepare a potvrzení nebo přerušení tyto transakce odpovídajícím způsobem.</span><span class="sxs-lookup"><span data-stu-id="92bce-138">When a durable resource manager restarts, it reconstructs the committed state of the resources it manages by retrieving the prepare information written in the prepare phase, and commits or aborts these transactions accordingly.</span></span>  
  
 <span data-ttu-id="92bce-139">V souhrnu protokol dvoufázového potvrzení a správci prostředků spojují k provádění transakcí, atomické a trvalý.</span><span class="sxs-lookup"><span data-stu-id="92bce-139">In summary, the two-phase commit protocol and the resource managers combine to make transactions atomic and durable.</span></span>  
  
 <span data-ttu-id="92bce-140"><xref:System.Transactions.Transaction> Třída rovněž poskytuje <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> metodu k zařazení možné zařazení pro jedné fáze (PSPE).</span><span class="sxs-lookup"><span data-stu-id="92bce-140">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="92bce-141">To umožňuje trvalý prostředku manager (SV) pro hostování a "vlastní" transakce, který lze později eskalován jej lze spravovat pomocí příkaz MSDTC v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="92bce-141">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="92bce-142">Další informace o této části najdete v tématu [optimalizace pomocí potvrzení jedné fáze a jediné fáze s jedním fází](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="92bce-142">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="92bce-143">V tomto oddílu</span><span class="sxs-lookup"><span data-stu-id="92bce-143">In This Section</span></span>  
 <span data-ttu-id="92bce-144">Postup, který je obecně následován správcem prostředků, je popsaný v následujících tématech.</span><span class="sxs-lookup"><span data-stu-id="92bce-144">The steps generally followed by a resource manager are outlined in the following topics.</span></span>  
  
 [<span data-ttu-id="92bce-145">Uvedení prostředků jako účastníků v transakci</span><span class="sxs-lookup"><span data-stu-id="92bce-145">Enlisting Resources as Participants in a Transaction</span></span>](enlisting-resources-as-participants-in-a-transaction.md)  
  
 <span data-ttu-id="92bce-146">Popisuje, jak lze prostředek trvalé nebo přechodné zařazení v transakci.</span><span class="sxs-lookup"><span data-stu-id="92bce-146">Describes how a durable or volatile resource can enlist in a transaction.</span></span>  
  
 [<span data-ttu-id="92bce-147">Potvrzení transakce v jedné fázi a více fázích</span><span class="sxs-lookup"><span data-stu-id="92bce-147">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](committing-a-transaction-in-single-phase-and-multi-phase.md)  
  
 <span data-ttu-id="92bce-148">Popisuje, jak správce prostředků reaguje na potvrzení oznámení a připravit potvrzení.</span><span class="sxs-lookup"><span data-stu-id="92bce-148">Describes how a resource manager responds to commit notification and prepare the commit.</span></span>  
  
 [<span data-ttu-id="92bce-149">Provedení obnovení</span><span class="sxs-lookup"><span data-stu-id="92bce-149">Performing Recovery</span></span>](performing-recovery.md)  
  
 <span data-ttu-id="92bce-150">Popisuje, jak obnoví správce trvalý prostředků z selhání.</span><span class="sxs-lookup"><span data-stu-id="92bce-150">Describes how a durable resource manager recovers from failure.</span></span>  
  
 [<span data-ttu-id="92bce-151">Úrovně důvěryhodnosti zabezpečení v přístupu k prostředkům</span><span class="sxs-lookup"><span data-stu-id="92bce-151">Security Trust Levels in Accessing Resources</span></span>](security-trust-levels-in-accessing-resources.md)  
  
 <span data-ttu-id="92bce-152">Popisuje, jak tři úrovně důvěryhodnosti pro System.Transactions omezit přístup k studijních materiálech, které <xref:System.Transactions> zveřejňuje.</span><span class="sxs-lookup"><span data-stu-id="92bce-152">Describes how the three levels of trust for System.Transactions restrict access on the types of resources that <xref:System.Transactions> exposes.</span></span>  
  
 [<span data-ttu-id="92bce-153">Optimalizace pomocí jednofázového potvrzení a možné zařazení jednofázového oznámení</span><span class="sxs-lookup"><span data-stu-id="92bce-153">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](optimization-spc-and-promotable-spn.md)  
  
 <span data-ttu-id="92bce-154">Popisuje postupy pro optimalizaci implementace správce prostředků k dispozici.</span><span class="sxs-lookup"><span data-stu-id="92bce-154">Describes optimization practices available to implementations of resource managers.</span></span>
