---
title: Problémy s migrací rozhraní .NET Framework 4
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
ms.openlocfilehash: c1c3298d87ad0f481fa30182e40cd5edcd535d6a
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/12/2019
ms.locfileid: "73975620"
---
# <a name="net-framework-4-migration-issues"></a>Problémy s migrací rozhraní .NET Framework 4

Toto téma popisuje problémy při migraci mezi .NET Framework verze 3,5 Service Pack 1 a .NET Framework verze 4, včetně oprav, dodržování předpisů a zabezpečení standardů a změn na základě zpětné vazby od zákazníků. Většina těchto změn nevyžaduje žádné programové změny v aplikacích. Pro ty, které mohou zahrnovat změny, se podívejte na sloupec doporučené změny v tabulce. Významné změny jsou rozdělené podle oblasti, například ASP.NET a Windows Presentation Foundation (WPF).

Podrobný přehled problémů v tomto tématu najdete v [Průvodci migrací na .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29).

Informace o nových funkcích najdete v článku [novinky v .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29).

## <a name="aspnet-and-web"></a>ASP.NET a Web

Obory názvů: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>; Assembly: System. Web (v System. Web. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Soubory definic prohlížeče** | Soubory definic prohlížeče byly aktualizovány tak, aby obsahovaly informace o nových a aktualizovaných prohlížečích a zařízeních. Odebraly se starší prohlížeče a zařízení, jako je například Netscape Navigator, a přidaly se novější prohlížeče a zařízení, jako je Google Chrome a Apple iPhone.<br><br>Pokud vaše aplikace obsahuje vlastní definice prohlížečů, které dědí z jedné z odebraných definic prohlížeče, zobrazí se chyba.<br><br>Objekt <xref:System.Web.HttpBrowserCapabilities> (který je vystavený vlastností `Request.Browse` stránky) je řízen definičními soubory prohlížeče. Proto se informace vracené přístupem k vlastnosti tohoto objektu v ASP.NET 4 mohou lišit od informací, které byly vráceny v dřívější verzi ASP.NET. | Pokud vaše aplikace spoléhá na staré soubory definice prohlížeče, můžete je zkopírovat z následující složky:<br><br>*Windows\\Microsoft.NET\\Framework\\v 2.0.50727\\CONFIG\\Browser*<br><br>Zkopírujte soubory do odpovídající složky *\\konfigurace\\prohlížeče* pro ASP.NET 4. Po zkopírování souborů spusťte nástroj příkazového řádku [Aspnet_regbrowsers. exe](https://docs.microsoft.com/previous-versions/dotnet/netframework-3.5/ms229858(v=vs.90)) . Další informace najdete na webu [https://www.asp.net/mobile](/aspnet/mobile/overview) . |
| **Podřízené aplikace běžící v rámci smíšených verzí ASP.NET** | ASP.NET 4 aplikace, které jsou nakonfigurované jako podřízené položky aplikací, které používají starší verze ASP.NET, se nemusí podařit spustit kvůli chybám konfigurace nebo kompilace. Konkrétní chyba, ke které dojde, závisí na tom, jestli je aplikace spuštěná ve službě IIS 6,0 nebo v části IIS 7 nebo IIS 7,5. | Můžete provádět změny v konfiguračních souborech ovlivněných aplikací, aby systém konfigurace správně rozpoznal aplikaci ASP.NET 4. Informace o změnách, které je třeba provést, naleznete v části "podřízené aplikace ASP.NET 4 se nepodaří spustit, když v části ASP.NET 2,0 nebo ASP.NET 3,5 aplikace" v dokumentu [ASP.NET 4 nejnovější změny](/aspnet/whitepapers/aspnet4/breaking-changes) na webu ASP.NET. |
| **Změny ClientID** | Nové nastavení `clientIDMode` v ASP.NET 4 umožňuje určit, jak ASP.NET generuje atribut `id` pro prvky jazyka HTML. V předchozích verzích ASP.NET byl výchozí chování stejný jako nastavení `clientIDMode``AutoID`. Výchozí nastavení je nyní `Predictable`. Další informace naleznete v tématu [Identifikace ovládacího prvku webového serveru ASP.NET](https://docs.microsoft.com/previous-versions/aspnet/1d04y8ss%28v=vs.100%29). | Použijete-li sadu Visual Studio k upgradu aplikace z ASP.NET 2,0 nebo ASP.NET 3,5, nástroj automaticky přidá nastavení do souboru Web. config, který zachovává chování dřívějších verzí .NET Framework. Pokud však provedete upgrade aplikace tím, že změníte fond aplikací ve službě IIS tak, aby byl cílen na .NET Framework 4, ASP.NET ve výchozím nastavení použije nový režim. Chcete-li zakázat nový režim ID klienta, přidejte do souboru Web. config následující nastavení:<br><br>`<pages clientIDMode="AutoID" />` |
| **Zabezpečení přístupu kódu (CAS)** | ASP.NET 2,0 – funkce sítě přidané v ASP.NET 3,5 používají model CAS (.NET Framework 1,1 a .NET Framework 2,0 Code Access Security). Implementace certifikačních autorit v ASP.NET 4 se ale podstatně převedla. V důsledku toho mohou ASP.NET aplikace s částečným vztahem důvěryhodnosti, které spoléhají na důvěryhodný kód spuštěný v globální mezipaměti sestavení, selhat s různými výjimkami zabezpečení. Aplikace s částečným vztahem důvěryhodnosti, které spoléhají na rozsáhlé změny v zásadách CAS počítače, můžou selhat i vyvolat výjimky zabezpečení. | Můžete vrátit částečně důvěryhodné aplikace ASP.NET 4 k chování ASP.NET 1,1 a 2,0 pomocí nového atributu `legacyCasModel` v konfiguračním prvku `trust`, jak je znázorněno v následujícím příkladu:<br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br>Důležité: návrat ke staršímu modelu CAS může představovat nižší zabezpečení.<br><br>Další informace o novém modelu zabezpečení přístupu kódu ASP.NET 4 najdete v tématu [zabezpečení přístupu kódu v aplikacích ASP.NET 4](https://docs.microsoft.com/previous-versions/dd984947(v=vs.100)). |
| **Konfigurační soubory** | Kořenové konfigurační soubory (soubor Machine. config a kořenový soubor Web. config) pro .NET Framework a ASP.NET 4 byly aktualizovány tak, aby obsahovaly většinu často se konfiguračních informací, které byly nalezeny v souborech Web. config aplikace v ASP.NET 3,5. Vzhledem ke složitosti spravovaných systémů konfigurace služby IIS 7 a IIS 7,5, které spouštějí aplikace ASP.NET 3,5 v ASP.NET 4 a v části IIS 7 a služba IIS 7,5 můžou způsobit chyby ASP.NET nebo chyby služby IIS. | Upgradujte aplikace ASP.NET 3,5 na ASP.NET 4 pomocí nástrojů pro upgrade projektu v aplikaci Visual Studio. Visual Studio 2010 automaticky upraví soubor Web. config aplikace ASP.NET 3,5 tak, aby obsahoval vhodné nastavení pro ASP.NET 4.<br><br>Aplikace ASP.NET 3,5 však můžete spouštět pomocí .NET Framework 4 bez nutnosti rekompilace. V takovém případě může být nutné ručně upravit soubor Web. config aplikace před spuštěním aplikace v rámci .NET Framework 4 a v části IIS 7 nebo IIS 7,5. Konkrétní změna, kterou je třeba provést, závisí na kombinaci softwaru, se kterým pracujete, včetně vydání aktualizace Service Pack (SP). Informace o možných kombinacích softwaru, které jsou ovlivněné touto změnou a jak řešit problémy s konkrétními kombinacemi, najdete v části "chyby konfigurace související s novou kořenovou konfigurací ASP.NET 4" v dokumentu [ASP.NET 4. Rušení změn](/aspnet/whitepapers/aspnet4/breaking-changes) na webu ASP.NET. |
| **Vykreslování ovládacího prvku** | V předchozích verzích ASP.NET byly některé ovládací prvky vygenerovány značkou, kterou nemůžete zakázat. Ve výchozím nastavení se tento typ značky už negeneruje v ASP.NET 4. Změny vykreslování mají vliv na následující ovládací prvky:<br><br>* Ovládací prvky `Image` a `ImageButton` již nevykreslují atribut `border="0"`.<br>* Třída `BaseValidator` a ověřovací ovládací prvky, které jsou z něho odvozené, již ve výchozím nastavení nevykresluje červený text.<br>* Ovládací prvek `HtmlForm` nevykresluje atribut `name`.<br>* Ovládací prvek `Table` již nevykresluje atribut `border="0"`.<br><br>Ovládací prvky, které nejsou určeny pro vstup uživatele (například `Label` ovládací prvek), již nevykreslují atribut `disabled="disabled"`, pokud je jeho vlastnost `Enabled` nastavena na `false` (nebo pokud dědí toto nastavení z ovládacího prvku kontejneru). | Použijete-li aplikaci Visual Studio k upgradu aplikace z ASP.NET 2,0 nebo ASP.NET 3,5, nástroj automaticky přidá nastavení do souboru Web. config, který zachovává starší vykreslování. Pokud však provedete upgrade aplikace tím, že změníte fond aplikací ve službě IIS tak, aby byl cílen na .NET Framework 4, ASP.NET ve výchozím nastavení použije nový režim vykreslování. Chcete-li zakázat nový režim vykreslování, přidejte do souboru Web. config následující nastavení:<br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| **Obslužné rutiny událostí ve výchozích dokumentech** | ASP.NET 4 vykreslí hodnotu atributu `action` elementu `form` HTML jako prázdný řetězec, když se požadavek provede na rozšiřující adresu URL, která má namapovanou výchozí dokument. V dřívějších verzích ASP.NET by požadavek na `http://contoso.com` způsobil požadavek na Default. aspx. V tomto dokumentu se otevírací `form` značka vykreslí jako v následujícím příkladu:<br><br>`<form action="Default.aspx" />`<br><br>V ASP.NET 4 má žádost o `http://contoso.com` taky požadavek na Default. aspx, ale ASP.NET teď vykresluje značku HTML Open `form` jako v následujícím příkladu:<br><br>`<form action="" />`<br><br>Když je atribut `action` prázdným řetězcem, objekt služby IIS `DefaultDocumentModule` vytvoří podřízený požadavek na Default. aspx. Ve většině podmínek je tato podřízená žádost transparentní pro kód aplikace a stránka default. aspx se spouští normálně. Potenciální interakce mezi spravovaným kódem a integrovaným režimem služby IIS 7 nebo IIS 7,5 může ale způsobit, že spravované stránky. aspx v rámci podřízeného požadavku přestanou fungovat správně. Pokud dojde k následujícím podmínkám, podřízené žádosti na výchozí dokument. aspx budou mít za následek chybu nebo neočekávané chování:<br><br>* Do prohlížeče se pošle stránka. aspx s atributem `action` elementu `form` nastaveným na hodnotu "".<br>* Formulář se publikuje zpátky na ASP.NET.<br>* Spravovaný modul HTTP čte část těla entity, například `Request.Form` nebo `Request.Params`. To způsobí, že tělo entity požadavku POST bude načteno do spravované paměti. V důsledku toho již není tělo entity k dispozici pro žádné moduly nativního kódu, které jsou spuštěny v integrovaném režimu služby IIS 7 nebo IIS 7,5.<br>* Objekt služby IIS `DefaultDocumentModule` nakonec spustí a vytvoří podřízený požadavek na dokument default. aspx. Vzhledem k tomu, že tělo entity již bylo přečteno částí spravovaného kódu, není k dispozici žádný obsah entity k odeslání podřízené žádosti.<br>* Když se kanál HTTP spustí pro podřízenou žádost, obslužná rutina souborů. aspx se spustí během fáze spuštění obslužné rutiny.<br><br>Vzhledem k tomu, že není k dispozici žádné tělo entity, neexistují žádné proměnné formuláře ani stav zobrazení. Proto nejsou k dispozici žádné informace pro obslužnou rutinu stránky. aspx k určení, jakou událost (pokud existuje) by měla být vyvolána. V důsledku toho žádná z obslužných rutin události postback pro stránku ovlivnila. aspx nebude spuštěna. | Informace o způsobech řešení problémů, které mohou nastat v důsledku této změny, najdete v části "obslužné rutiny událostí nemusí být vyvolány ve výchozím dokumentu v integrovaném režimu služby IIS 7 nebo IIS 7,5" v dokumentu [ASP.NET 4 průlomové změny](/aspnet/whitepapers/aspnet4/breaking-changes) na webu ASP.NET. webovém. |
| **Algoritmus hash** | ASP.NET používá šifrovací algoritmy i algoritmy hash k zabezpečení dat, jako jsou soubory cookie ověřování pomocí formulářů a stav zobrazení. Ve výchozím nastavení používá ASP.NET 4 algoritmus <xref:System.Security.Cryptography.HMACSHA256> pro operace hash u souborů cookie a stavu zobrazení. Starší verze ASP.NET používaly starší algoritmus <xref:System.Security.Cryptography.HMACSHA1>. | Pokud spouštíte aplikace, které mají kombinaci ASP.NET 2,0 a ASP.NET 4, kde data, jako jsou soubory cookie ověřování pomocí formulářů, musí fungovat napříč verzemi .NET Framework, nakonfigurujte webovou aplikaci ASP.NET 4 tak, aby používala starší <xref:System.Security.Cryptography.HMACSHA1> algoritmus přidáním následujícího nastavení v části Soubor Web. config:<br><br>`<machineKey validation="SHA1" />` |
| **Hostování ovládacích prvků v aplikaci Internet Explorer** | V aplikaci Internet Explorer již nelze hostovat ovládací prvky model Windows Forms, protože existují lepší řešení pro hostování ovládacích prvků na webu. Proto byla z .NET Framework odebrána sestavení IEHost. dll a IEExec. exe. | Pro vývoj vlastních ovládacích prvků ve webových aplikacích můžete použít následující technologie:<br><br>* Můžete vytvořit aplikaci Silverlight a nakonfigurovat ji tak, aby běžela mimo prohlížeč. Další informace najdete v tématu [podpora mimo prohlížeč](https://docs.microsoft.com/previous-versions/windows/silverlight/dotnet-windows-silverlight/dd550721%28v=vs.95%29).<br>* Můžete sestavit aplikaci prohlížeče XAML (XBAP), která bude využívat možnosti WPF (vyžaduje .NET Framework na klientských počítačích). Další informace naleznete v tématu [Přehled aplikací prohlížeče WPF XAML](../wpf/app-development/wpf-xaml-browser-applications-overview.md). |
| **HtmlEncode a UrlEncode metody** | Metody `HtmlEncode` a `UrlEncode` třídy <xref:System.Web.HttpUtility> a <xref:System.Web.HttpServerUtility> byly aktualizovány tak, aby se zakódovat znak jednoduché uvozovky (') následujícím způsobem:<br><br>* Metoda `HtmlEncode` kóduje instance jednoduché uvozovky jako `&#39;`<br>* Metoda `UrlEncode` kóduje instance jednoduché uvozovky jako `%27` | Projděte si kód pro místa, kde používáte metody `HtmlEncode` a `UrlEncode` a ujistěte se, že změna v kódování nemá za následek změnu, která by ovlivnila vaši aplikaci. |
| **HttpException – chyby v aplikacích ASP.NET 2,0** | Po povolení ASP.NET 4 ve službě IIS 6 mohou aplikace ASP.NET 2,0, které běží na službě IIS 6 (v systému Windows Server 2003 nebo Windows Server 2003 R2), způsobit chyby, například následující: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.` | * Pokud se ASP.NET 4 nevyžaduje pro spuštění webu, přemapujte lokalitu na místo toho použití ASP.NET 2,0.<br><br>-nebo-<br><br>* Pokud je pro spuštění webu vyžadován ASP.NET 4, přesuňte všechny podřízené virtuální adresáře ASP.NET 2,0 na jiný web, který je namapován na ASP.NET 2,0.<br><br>-nebo-<br><br>* Zakažte adresy URL s příponou. Další informace naleznete v tématu "aplikace ASP.NET 2,0 mohou generovat chyby HttpException –, které odkazují na eurl. axd" v dokumentu [ASP.NET 4 nejnovější změny](/aspnet/whitepapers/aspnet4/breaking-changes) na webu ASP.NET. |
| **Typy členství** | Některé typy (například <xref:System.Web.Security.MembershipProvider>), které se používají ve členství ASP.NET, byly přesunuty ze souboru System. Web. dll do sestavení System. Web. ApplicationServices. dll. Typy byly přesunuty za účelem vyřešení závislostí architektonického vrstvení mezi typy v klientovi a v rozšířených .NET Framework SKU. | Knihovny tříd, které byly upgradovány z dřívějších verzí ASP.NET a které používají typy členství, které byly přesunuty, mohou být při použití v projektu ASP.NET 4 neúspěšné kompilovány. Pokud ano, přidejte odkaz do projektu knihovny tříd do třídy System. Web. ApplicationServices. dll. |
| **Změny ovládacího prvku nabídky** | Změny v ovládacím prvku <xref:System.Web.UI.WebControls.Menu> mají za následek následující chování:<br><br>* Pokud je <xref:System.Web.UI.WebControls.MenuRenderingMode> nastavená na `List`nebo pokud je <xref:System.Web.UI.WebControls.MenuRenderingMode> nastavená na `Default` a <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> je nastavená na `4.0` nebo novější, vlastnost <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> nemá žádný vliv.<br>* Pokud cesta nastavená ve vlastnostech <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> a <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> obsahuje zpětné lomítko (\\), image se nevykreslují. (V dřívějších verzích nástroje ASP.NET může cesta obsahovat zpětné lomítko.) | * Místo nastavení vlastnosti <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> pro jednotlivé položky nabídky nastavte <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> nebo <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> nadřazeného ovládacího prvku <xref:System.Web.UI.WebControls.Menu>.<br><br>-nebo-<br><br>Nastavte <xref:System.Web.UI.WebControls.MenuRenderingMode> na `Table`nebo nastavte <xref:System.Web.UI.WebControls.MenuRenderingMode> na `Default` a nastavte <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> na `3.5`. Tato nastavení způsobí, že ovládací prvek <xref:System.Web.UI.WebControls.Menu> použije rozložení založené na tabulkách HTML, které používalo v dřívějších verzích nástroje ASP.NET.<br>* Pokud cesta ve vlastnosti <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> nebo <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> obsahuje zpětné lomítko (\\), nahraďte znak lomítka (/). |
| **Mobilní sestavení v souboru Web. config** | V předchozích verzích nástroje ASP.NET byl do kořenového souboru Web. config zahrnut odkaz na sestavení System. Web. Mobile. dll v části `assemblies` v části `system.web`/`compilation`. Pro zvýšení výkonu byl odebrán odkaz na toto sestavení.<br><br>Poznámka: sestavení System. Web. Mobile. dll a mobilní ovládací prvky ASP.NET jsou součástí ASP.NET 4, ale jsou zastaralé. | Pokud chcete použít typy z tohoto sestavení, přidejte odkaz na sestavení buď v kořenovém souboru Web. config, nebo v souboru Web. config aplikace. |
| **Ukládání výstupu do mezipaměti** | V ASP.NET 1,0 vygenerovala Chyba stránky v mezipaměti, které určily `Location="ServerAndClient"` jako výstupní nastavení mezipaměti, aby v odpovědi vygenerovala `Vary:*` hlavičku HTTP. To mělo vliv na to, že klientské prohlížeče nebudou stránku ukládat místně do mezipaměti. V ASP.NET 1,1 byla přidána metoda <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>, která by mohla být volána, aby bylo možné potlačit `Vary:*` hlavičku. Zprávy o chybách ale naznačují, že vývojáři neznají stávající chování `SetOmitVaryStar`.<br><br>V ASP.NET 4 se hlavička protokolu HTTP `Vary:*` už neemituje z odpovědí, které určují následující direktivu:<br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br>V důsledku toho již není potřeba metoda <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>, aby bylo možné potlačit `Vary:*` hlavičku. V aplikacích, které určují "ServerAndClient" pro atribut `Location`, budou stránky v prohlížeči ukládat do mezipaměti, aniž by bylo nutné volat <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>. | Pokud stránky v aplikaci musí vygenerovat `Vary:*`, zavolejte metodu <xref:System.Web.HttpResponse.AppendHeader%2A>, jak je znázorněno v následujícím příkladu:<br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br>Případně můžete změnit hodnotu atributu výstupní ukládání do mezipaměti `Location` atribut "Server". |
| **Analýza stránky** | Analyzátor stránky pro webové stránky ASP.NET (soubory. aspx) a uživatelské ovládací prvky (soubory. ascx) jsou přísnější v ASP.NET 4 než v dřívějších verzích ASP.NET a označí více značek jako neplatné než v dřívějších verzích. | Prověřte chybové zprávy, které jsou vytvářeny při spuštění stránky, a opravte chyby, které jsou výsledkem neplatných značek. |
| **Typy Passport** | Podpora služby Passport integrovaná do ASP.NET 2,0 je zastaralá a není podporována z důvodu změn ve službě Passport (nyní Live ID SDK). V důsledku toho jsou nyní typy související se službou Passport v <xref:System.Web.Security> označeny atributem `ObsoleteAttribute`. | Pokud chcete použít sadu Windows Live ID SDK, změňte libovolný kód, který používá typy služby Passport v oboru názvů <xref:System.Web.Security> (například <xref:System.Web.Security.PassportIdentity>). |
| **PathInfo informace v vlastnosti FilePath** | ASP.NET 4 již nezahrnuje hodnotu `PathInfo` do návratových hodnot z vlastností, jako jsou <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath>a <xref:System.Web.HttpRequest.CurrentExecutionFilePath>. Místo toho jsou informace o `PathInfo` k dispozici v <xref:System.Web.HttpRequest.PathInfo>. Představte si například následující fragment adresy URL:<br><br>`/testapp/Action.mvc/SomeAction`<br><br>V dřívějších verzích ASP.NET mají <xref:System.Web.HttpRequest> vlastnosti následující hodnoty:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`<br>* <xref:System.Web.HttpRequest.PathInfo>: (prázdné)<br><br>V ASP.NET 4 <xref:System.Web.HttpRequest> vlastnosti místo toho mít následující hodnoty:<br><br>* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`<br>* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction` | Projděte si kód pro místa, kde se spoléháte na vlastnosti <xref:System.Web.HttpRequest> třídy pro vracení informací o cestě; Změňte kód tak, aby odrážel změny v způsobu, jakým jsou vraceny informace o cestě. |
| **Žádost o ověření** | Aby bylo možné vylepšit ověření žádosti, bude ověření žádosti ASP.NET vyvoláno dříve v životním cyklu žádosti. V důsledku toho ověření žádosti spustí pro požadavky, které nejsou pro soubory. aspx, například pro volání webové služby a pro vlastní obslužné rutiny. Pokud jsou v kanálu zpracování požadavků spuštěné vlastní moduly HTTP, ověření žádosti bude také aktivní.<br><br>V důsledku této změny můžou žádosti o jiné prostředky než soubory. aspx vyvolat chyby ověření žádosti. Vlastní kód, který běží v kanálu požadavků (například vlastní moduly HTTP), může také vyvolat chyby ověření žádosti. | V případě potřeby se můžete vrátit k původnímu chování, které spouští pouze stránky. aspx, a to pomocí následujícího nastavení v souboru webové konfigurace:<br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br>Upozornění: Pokud se vrátíte ke starému chování, zajistěte, aby veškerý kód v existujících obslužných rutinách, modulech a jiném vlastním kódu prováděl kontroly potenciálně nebezpečných vstupů HTTP, které by mohly být vektory útoku XSS. |
| **Směrování** | Pokud vytvoříte web systému souborů v aplikaci Visual Studio 2010 a web je ve složce, která obsahuje tečku (.) v názvu složky, směrování adres URL nebude spolehlivě fungovat. Z některých virtuálních cest se vrátí chyba HTTP 404. K tomu dochází, protože Visual Studio 2010 spustí vývojový server sady Visual Studio, který používá nesprávnou cestu pro kořenový virtuální adresář. | * Na stránce **vlastností** webu založeného na souborech změňte atribut **virtuální cesta** na "/".<br><br>-nebo-<br><br>* Vytvořte projekt webové aplikace místo projektu webu. Projekty webové aplikace nemají tento problém a směrování adres URL funguje i v případě, že složka projektu má tečku v názvu.<br><br>-nebo-<br><br>* Vytvořte web založený na protokolu HTTP hostovaný ve službě IIS. Weby hostované službou IIS mohou obsahovat tečky ve virtuální cestě i ve složce souborů projektu. |
| **Weby služby SharePoint** | Pokud se pokusíte spustit web ASP.NET 4, který je nasazen jako podřízený webu služby SharePoint, který obsahuje vlastní úroveň částečného vztahu důvěryhodnosti s názvem `WSS_Minimal`, zobrazí se následující chyba:<br><br>`Could not find permission set named 'ASP.Net'.` | V současné době nejsou žádné verze SharePointu kompatibilní s ASP.NET. V důsledku toho byste se neměli pokoušet spustit web ASP.NET 4 jako podřízenou položku webu služby SharePoint. |
| **Standardy XHTML 1,1** | Aby bylo možné povolit dodržování předpisů XHTML 1,1 pro nové weby, ovládací prvky ASP.NET ve .NET Framework 4 budou generovat HTML kompatibilní s NORMou XHTML 1,1. Toto vykreslování je povoleno pomocí následující možnosti v souboru Web. config uvnitř elementu `<system.Web>`:<br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br>Tato možnost je ve výchozím nastavení nastavena na 4,0. Pro webové projekty, které jsou upgradovány ze sady Visual Studio 2008, je nastavení 3,5 povoleno pro zajištění kompatibility. | Žádné |

## <a name="core"></a>Jádro

### <a name="general-features"></a>Obecné funkce

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Službu** | Služba Windows CardSpace již není součástí .NET Framework. je k dispozici samostatně. | Službu Windows CardSpace si stáhněte z webu [Microsoft Download Center](https://go.microsoft.com/fwlink/?LinkId=199868). |
| **Konfigurační soubory** | V tom, jak .NET Framework přistupuje k konfiguračním souborům aplikace, byly provedeny opravy. | Pokud má konfigurační soubor aplikace název *Application-Name. config*, přejmenujte ho na *Application-Name. exe. config*. Například přejmenujte *MyApp. config* na *MyApp. exe. config*. |
| **C#Kompilátor kódu** | Třídy `Compiler`, `CompilerError`a `ErrorLevel`, které byly v oboru názvů <xref:Microsoft.CSharp>, již nejsou k dispozici a jejich sestavení (cscompmgd. dll) již není zahrnuto do .NET Framework. | Použijte třídu <xref:System.CodeDom.Compiler.CodeDomProvider> a další třídy v oboru názvů <xref:System.CodeDom.Compiler>. Další informace najdete v tématu [použití CodeDOM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/y2k85ax6%28v=vs.100%29). |
| **Hostování** (NESPRAVOVANÉ rozhraní API) | Aby bylo možné vylepšit možnosti hostování, některá rozhraní API pro aktivaci hostování jsou zastaralá. Funkce souběžného spouštění v rámci procesu umožňují aplikaci načíst a spustit více verzí .NET Framework ve stejném procesu. Můžete například spouštět aplikace, které načítají doplňky (nebo komponenty) založené na .NET Framework 2,0 SP1 a doplňky založené na .NET Framework 4 ve stejném procesu. Starší součásti budou nadále používat starší verzi .NET Framework a nové komponenty používají novou verzi .NET Framework. | Použijte konfigurace popsané v [části proces souběžného spouštění](../deployment/in-process-side-by-side-execution.md). |
| **Nový model zabezpečení** | Zásady zabezpečení přístupu kódu (CAS) byly vypnuté a nahrazené zjednodušeným modelem, jak je popsáno v [zabezpečení .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd233103%28v=vs.100%29). | Pokud závisíte na certifikačních autoritách v aplikacích, může být nutné provést úpravy. Další informace najdete v tématu [Kompatibilita a migrace zásad zabezpečení přístupu kódu](../misc/code-access-security-policy-compatibility-and-migration.md). |

### <a name="date-and-time"></a>Datum a čas

Obor názvů: <xref:System>; sestavení: mscorlib (v mscorlib. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Letní úspory** | Aby byly v souladu se systémovými hodinami, časové vlastnosti (například <xref:System.TimeZoneInfo.Local> a <xref:System.DateTime.Now>) nyní používají pravidla operačního systému místo jiných .NET Framework dat pro letní operace. | Žádné |
| **Formátování řetězců** | Aby bylo možné podporovat formátování zohledňující jazykovou verzi, zahrnuje struktura <xref:System.TimeSpan> kromě nových `ParseExact` a `TryParseExact` metod nová přetížení metod `ToString`, `Parse`a `TryParse`. | Žádné |

### <a name="globalization"></a>Globalizace

Seznam nových neutrálních a specifických kultur naleznete v tématu [co je nového v globalizaci a lokalizaci](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/dd997383%28v=vs.100%29).

Obor názvů: <xref:System.Globalization>; sestavení: mscorlib (v mscorlib. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Názvy jazykových verzí** | Následující změny názvů mají vliv na německé, Divehština a africké kultury:<br><br>* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: název měny pro Německo (Switizerland) (de-CH) jazykové verze se změnil z "sFr". na "fr.".<br>* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: vzor dlouhého data pro jazykovou verzi Divehština (Maledivy) (DV-MV) se změnil z "dd/MMMM/rrrr" na "DD/MM/RRRR".<br>* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: odp. specifikátor jazykové verze Afrikánština (Jižní Afrika) (AF-ZA) se změnil z "nm" na "PM". | Všimněte si změny názvu jazykové verze. |
| **LCID – parametr** | Pro zajištění konzistence s očekávaným chováním v nastavení automatizačního serveru již CLR nepředá aktuální jazykovou verzi pro parametr `LCID` nespravované aplikace založené na modelu COM. Místo toho předává 1033 (EN-US) pro jazykovou verzi. | Nejsou potřebné žádné úpravy kromě nativních aplikací, které vyžadují určitou jazykovou verzi. |
| **Zastaralé typy jazykové verze** | Typy <xref:System.Globalization.CultureTypes> a <xref:System.Globalization.CultureTypes> jazykové verze jsou nyní zastaralé.<br><br>Z důvodu zpětné kompatibility <xref:System.Globalization.CultureTypes> nyní vrací neutrální a specifické jazykové verze, které byly součástí předchozích .NET Framework a <xref:System.Globalization.CultureTypes> nyní vrací prázdný seznam. | Použijte další hodnoty výčtu <xref:System.Globalization.CultureTypes>. |
| **Načítání jazykové verze** | Počínaje systémem Windows 7 .NET Framework 4 načte informace o jazykové verzi z operačního systému místo uložení samotných dat. Navíc se .NET Framework synchronizuje se systémem Windows pro řazení dat a velikost písmen. | Žádné |
| **Standardy Unicode 5,1** | .NET Framework teď podporuje všechny znaky Unicode 5,1 – Přidání asi 1400 znaků. Mezi další znaky patří nové symboly, šipky, diakritiky, interpunkční znaménka, matematické symboly, tahy a znakové Symboly CJK, další Malajálamské a Telugské číselné znaky a různé Myanmary, latinka, arabština, řečtina, mongolština a cyrilice. písmena. Pro Unicode 5,1 se podporují následující nové skripty: Sundanese, figurka, šachy, Vai, polotučné, Kayah, Rejang, Gurmukhí, Udijština, tamilština, telugština a Cham. | Žádné |

### <a name="exceptions"></a>Výjimky

Obory názvů: <xref:System>, <xref:System.Runtime.ExceptionServices>; sestavení: mscorlib (v mscorlib. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Výjimky pro poškozený stav procesu** | CLR již neposkytuje výjimky pro poškozený stav procesu do obslužných rutin výjimek ve spravovaném kódu. | Tyto výjimky signalizují, že stav procesu je poškozen. Nedoporučujeme spouštět aplikaci v tomto stavu.<br><br>Další informace najdete v tématu <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> a záznam o [poškozených výjimkách stavu](https://docs.microsoft.com/archive/msdn-magazine/2009/february/clr-inside-out-handling-corrupted-state-exceptions) ve službě MSDN Magazine. |
| **Výjimky prováděcího modulu** | <xref:System.ExecutionEngineException> je nyní zastaralá, protože výjimka zachytitelné umožní pokračovat v běhu nestabilního procesu. Tato změna zlepšuje předvídatelnost a spolehlivost v modulu runtime. | K signalizaci podmínky použijte <xref:System.InvalidOperationException>. |

### <a name="reflection"></a>Reflexe

Obor názvů: <xref:System.Reflection>; sestavení: mscorlib (v mscorlib. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Algoritmy hash sestavení** | Vlastnost <xref:System.Reflection.AssemblyName.HashAlgorithm> nyní vrací hodnotu <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, protože modul runtime neznáte algoritmus hash odkazovaného sestavení, když sestavení není načteno. (To odkazuje na použití vlastnosti v odkazovaném sestavení, například, které vrátila metoda <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A>.) | Žádné |
| **Načítání sestavení** | Chcete-li zabránit redundantnímu načítání sestavení a uložit virtuální adresní prostor, modul CLR nyní načte sestavení pouze pomocí funkce Win32 `MapViewOfFile`. Již dále nevolá funkci `LoadLibrary`.<br><br>Tato změna má vliv na diagnostické aplikace následujícími způsoby:<br><br>* <xref:System.Diagnostics.ProcessModuleCollection> již nebude obsahovat žádné moduly z knihovny tříd (soubor. dll), jak získá volání `Process.GetCurrentProcess().Modules`.<br>* Aplikace Win32, které používají funkci `EnumProcessModules`, nebudou zobrazovat všechny spravované moduly uvedené v seznamu. | Žádné |
| **Deklarující typ** | Vlastnost <xref:System.Type.DeclaringType> nyní správně vrací hodnotu null, pokud typ nemá deklarující typ. | Žádné |
| **Delegáty** | Delegát nyní vyvolá <xref:System.ArgumentNullException> namísto <xref:System.NullReferenceException>, pokud je hodnota null předána konstruktoru delegáta. | Zajistěte, aby zpracování výjimek <xref:System.ArgumentNullException>. |
| **Změna umístění globální mezipaměti sestavení** | Pro sestavení .NET Framework 4 se globální mezipaměť sestavení (GAC) přesunula z adresáře Windows (% WINDIR%). do podadresáře Microsoft.Net ( *% windir%\\Microsoft.NET*). Sestavení z dřívějších verzí zůstanou ve starším adresáři.<br><br>Nespravovaný [ASM_CACHE_FLAGS](../unmanaged-api/fusion/asm-cache-flags-enumeration.md) výčet obsahuje nový příznak `ASM_CACHE_ROOT_EX`. Tento příznak Získá umístění mezipaměti pro sestavení .NET Framework 4, které lze získat funkcí [GetCachePath –](../unmanaged-api/fusion/getcachepath-function.md) . | Žádné za předpokladu, že aplikace nepoužívají explicitní cesty k sestavením, což není doporučený postup. |
| **Nástroj globální mezipaměti sestavení** | Nástroj [Gacutil. exe (nástroj Global Assembly Cache Tool)](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ex0ss12c%28v=vs.100%29) již nepodporuje prohlížeč modulů plug-in prostředí. | Žádné |

### <a name="interoperability"></a>Interoperabilita

Obor názvů: <xref:System.Runtime.InteropServices>; sestavení: mscorlib (v mscorlib. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Délka vyrovnávací paměti** (NESPRAVOVANÉ rozhraní API) | Chcete-li ušetřit paměť, funkce parametru `pBufferLengthOffset` pro metodu [ICorProfilerInfo2:: GetStringLayout –](../unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method.md) se změnila tak, aby odpovídala parametru `pStringLengthOffset`. Oba parametry nyní ukazují na umístění posunutí délky řetězce. Délka vyrovnávací paměti byla odebrána z reprezentace třídy řetězce. | Odeberte všechny závislosti na délce vyrovnávací paměti. |
| **Ladění JIT** | Aby bylo možné zjednodušit registraci JIT (just-in-time), ladicí program .NET Framework nyní používá pouze klíč registru AeDebug, který řídí chování ladění JIT pro nativní kód. Tato změna má za následek následující:<br><br>* Už nemůžete registrovat dva různé ladicí programy pro spravovaný a nativní kód.<br>* Už nemůžete spustit ladicí program automaticky pro neinteraktivní proces, ale můžete uživatele vyzvat k interaktivnímu procesu.<br>* Už nebudete informováni, když se ladicí program nepovede spustit, nebo když není k dispozici žádný registrovaný ladicí program, který by měl být spuštěn.<br>* Automaticky spouštěné zásady, které závisejí na interaktivitě aplikace, už nejsou podporované. | Podle potřeby upravte operace ladění. |
| **Vyvolání platformy** | Aby bylo možné zvýšit výkon při interoperabilitě s nespravovaným kódem, nesprávná konvence volání ve volání platformy nyní způsobí selhání aplikace. V předchozích verzích zařazovací vrstva tyto chyby vyřešila v zásobníku. | Ladění aplikací v Microsoft Visual Studio vás upozorní na tyto chyby, abyste je mohli opravit.<br><br>Pokud máte binární soubory, které nelze aktualizovat, můžete do konfiguračního souboru aplikace zahrnout prvek [\<NetFx40_PInvokeStackResilience >](../configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element.md) , aby bylo možné chyby při volání vyřešit v zásobníku jako v předchozích verzích. To však může ovlivnit výkon aplikace. |
| **Odebraná rozhraní** (NESPRAVOVANÉ rozhraní API) | Aby nedošlo k nejasnostem vývojářů, byla odebrána následující rozhraní, protože neposkytovaly žádné užitečné scénáře běhu a CLR neposkytoval ani nepřijal žádné implementace:<br><br>* **INativeImageINativeImageDependency**<br>* **INativeImageInstallInfo**<br>* **INativeImageEvaluate**<br>* **INativeImageConverter**<br>* **ICorModule**<br>* **IMetaDataConverter** | Žádné |

## <a name="data"></a>Data

Tato část popisuje problémy s migrací pro použití datových sad a klientů SQL, datových serverů Entity Framework, LINQ to SQL a WCF (dříve označovaných jako ADO.NET Data Services).

### <a name="dataset-and-sql-client"></a>Datová sada a klient SQL

V následující tabulce jsou popsána vylepšení funkcí, které dříve obsahovala určitá omezení nebo jiné problémy.

Obory názvů: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>; sestavení: System. data (v System. data. dll), System. data. entity (v System. data. entity. dll)

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Scénáře POCO** | Rozhraní <xref:System.Data.Objects.DataClasses.IRelatedEnd> má nové metody pro zlepšení použitelnosti v jednoduchých starých scénářích objektů CLR (POCO). Tyto nové metody přebírají <xref:System.Object> místo <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> entity jako parametr. |
| **Úpravy řádků** | Metoda <xref:System.Collections.IList.IndexOf%2A>, jak je implementována třídou <xref:System.Data.DataView>, nyní správně vrací hodnotu upravovaného řádku místo vrácení hodnoty-1. |
| **Události** | Událost <xref:System.Data.DataRowView.PropertyChanged> je nyní vyvolána, když je řádek v upraveném stavu a je volána metoda <xref:System.Data.DataRow.RejectChanges%2A>. Tato změna usnadňuje vytváření ovládacích prvků uživatelského rozhraní, které zpřístupňují obsah objektu <xref:System.Data.DataSet>. |
| **Výjimky** | Metoda <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> nyní vyvolá <xref:System.InvalidOperationException>, když není připojení nastaveno nebo je otevřeno místo <xref:System.NullReferenceException>. |
| **Mapování zobrazení** | Chyby mapování zobrazení dotazu jsou nyní zachyceny v době návrhu namísto vyvolání <xref:System.NullReferenceException> v době běhu.<br><br>Ověřování mapování nyní zachytí chybu, ve které jsou dvě sady přidružení v koncepčním schématu (CSDL) namapovány na stejný sloupec. |
| **Transakce** | Pokud se aplikace pokusí spustit příkaz na připojení po dokončení transakce (včetně přerušení nebo vrácení zpět), je nyní vyvolána <xref:System.InvalidOperationException>. Předchozí verze nevyvolaly výjimku a umožňují spustit další příkazy i v případě, že transakce byla přerušena. |

### <a name="entity-framework"></a>Entity Framework

V následující tabulce jsou popsána vylepšení funkcí, které dříve obsahovala určitá omezení nebo jiné problémy.

Obory názvů: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>; Assembly: System. data. entity (v System. data. entity. dll)

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Objekty entit** | V případě, že je volána metoda <xref:System.Data.Objects.ObjectContext.SaveChanges%2A>, je nyní mezi metodou <xref:System.Data.Objects.ObjectContext.Detach%2A> a stavem objektu entity parita. Tato vylepšená konzistence zabraňuje vyvolání neočekávaných výjimek. |
| **Entity SQL** | Byla vylepšena pravidla pro rozlišení identifikátorů v Entity SQL.<br><br>Analyzátor Entity SQL má vylepšenou logiku pro překlad identifikátorů s více částmi. |
| **Strukturální poznámky** | Entity Framework teď rozpoznává strukturální poznámky. |
| **Dotazy** | V dotazech byly provedeny následující vylepšení:<br><br>* `GroupBy` dotaz, který používá null klíč přes prázdnou kolekci, nevrátí žádné řádky bez ohledu na to, zda dotaz obsahuje další výběr.<br>* Vygenerovaný SQL v LINQ a dotazech Entity-SQL teď ve výchozím nastavení považují řetězcové parametry za hodnoty, které nejsou Unicode. |

### <a name="linq-to-sql"></a>Technologie LINQ to SQL

V následující tabulce jsou popsána vylepšení funkcí, které dříve obsahovala určitá omezení nebo jiné problémy.

Obor názvů: <xref:System.Data.Linq>; Assembly: System. data. Linq (v System. data. Linq. dll)

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Události** | Kolekce <xref:System.Data.Linq.EntitySet%601> nyní vyvolá událost <xref:System.Data.Linq.EntitySet%601.ListChanged> pro operace přidání a odebrání, pokud je <xref:System.Data.Linq.EntitySet%601> uvolněna, a to kromě vyvolání události při načtení kolekce. |
| **Dotazy** | `Skip(0)` se už v LINQ to SQLch dotazech Neignoruje. V důsledku toho se můžou dotazy, které mají tuto metodu, chovat jinak. Například v některých případech je vyžadována klauzule `OrderBy` s `Skip(0)`a dotaz nyní vyvolá výjimku <xref:System.NotSupportedException>, pokud nebyla zahrnuta klauzule `OrderBy`. |

### <a name="wcf-data-services"></a>WCF Data Services

V následující tabulce jsou popsána vylepšení funkcí, které dříve obsahovala určitá omezení nebo jiné problémy.

Obory názvů: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>; sestavení: System. data. Services (v System. data. Services. dll), System. data. Services. Client (v System. data. Services. Client. dll)

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Dávkový binární obsah** | WCF Data Services teď v žádostech a odpovědích podporuje dávkový binární obsah. |
| **Zachycení změn** | Pro žádost o odstranění se teď spouštějí zachycení změn.<br><br>Zachytávací modul pro změny je metoda, která se spouští pokaždé, když server obdrží požadavek na úpravu entity v sadě entit. Spustí se před provedením příchozího požadavku. Zachytávací modul changeing poskytuje přístup ke změněné entitě a operaci, která se na ní provádí. |
| **Výjimky** | Následující podmínky nyní vyvolávají užitečnější výjimky místo <xref:System.NullReferenceException>:<br><br>* <xref:System.ServiceProcess.TimeoutException>, když vyprší časový limit volání datové služby.<br>* <xref:System.Data.Services.Client.DataServiceRequestException>, když se na datovou službu navede chybný požadavek.<br><br>Ve vašich aplikacích byste měli změnit zpracování výjimek, aby se zachytily nové výjimky. |
| **Záhlaví** | V hlavičkách byly provedeny následující vylepšení:<br><br>* WCF Data Services nyní správně odmítne `eTag` hlavičku, která má nespecifikovanou hodnotu.<br>* WCF Data Services nyní vrátí chybu a nespustí požadavek na žádost o odstranění na odkaz, pokud je v žádosti `if-*` záhlaví.<br>* WCF Data Services nyní vrátí chybu klientovi ve formátu (Atom, JSON), který klient zadal v hlavičce Accept. |
| **Čtečka JSON** | Čtecí modul JavaScript Object Notation (JSON) nyní správně vrátí chybu při čtení jednoduchého řídicího znaku zpětného lomítka ("\\") při zpracování datových částí JSON odesílaných do datové služby WCF. |
| **Sloučí** | V <xref:System.Data.Services.Client.MergeOption> výčtu byly provedeny následující vylepšení:<br><br>* Možnost <xref:System.Data.Services.Client.MergeOption> Merge již nemění entitu klienta v důsledku následné reakce z datové služby.<br>* Možnost <xref:System.Data.Services.Client.MergeOption> je teď konzistentní mezi dynamickými aktualizacemi SQL a pomocí uložených procedur. |
| **Požádal** | Metoda <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> je nyní volána před zpracováním požadavku na Data Services. To umožňuje, aby požadavek správně fungoval pro <xref:System.Data.Services.Providers.ServiceOperation> služby. |
| **Datové proudy** | WCF Data Services už nezavírá podkladový datový proud pro operace čtení a zápisu. |
| **Identifikátory URI** | Uvozovací znaky identifikátorů URI od klienta WCF Data Services byly opraveny. |

## <a name="windows-communication-foundation-wcf"></a>Windows Communication Foundation (WCF)

V následující tabulce jsou popsána vylepšení funkcí, které dříve obsahovala určitá omezení nebo jiné problémy.

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Konfigurační soubory** | Pokud chcete povolit dědění chování prostřednictvím hierarchie konfiguračního souboru, WCF teď podporuje sloučení mezi konfiguračními soubory.<br><br>Model dědičnosti konfigurace je nyní rozšířen tak, aby umožnil uživatelům definovat chování, které se použije na všechny služby spuštěné v počítači.<br><br>Pokud existuje chování se stejným názvem na různých úrovních hierarchie, můžete narazit na změny chování. |
| **Hostování služeb** | Na úrovni služby již nelze zadat prvek konfigurace `<serviceHostingEnvironment>` přidáním atributu `allowDefinition="MachineToApplication"` do definice elementu.<br><br>Určení prvku `<serviceHostingEnvironment>` na úrovni služby je technicky nesprávné a způsobuje nekonzistentní chování. |

## <a name="windows-presentation-foundation-wpf"></a>Windows Presentation Foundation (WPF)

### <a name="applications"></a>Vyrovnání

Obory názvů: <xref:System.Windows>, <xref:System.Windows.Controls>; sestavení: PresentationFramework (v PresentationFramework. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Zpracování výjimek** | Aby bylo možné zjistit chyby dříve, WPF vyvolá <xref:System.Reflection.TargetInvocationException> a nastaví vlastnost <xref:System.Exception.InnerException> na kritické výjimky, jako je například <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException>a <xref:System.Security.SecurityException>namísto zachycení původní výjimky. | Žádné |
| **Propojené prostředky** | Aby bylo propojování snazší, soubory prostředků (jako jsou obrázky), které jsou umístěny v jiném umístění než ve struktuře složky projektu, používají úplnou cestu souboru prostředků namísto pouze jeho názvu souboru jako ID prostředku při sestavení aplikace. Aplikace bude moci vyhledat soubory v době běhu. | Žádné |
| **Aplikace s částečným vztahem důvěryhodnosti** | Z hlediska zabezpečení jsou aplikace založené na systému Windows, které běží v částečném vztahu důvěryhodnosti a obsahují <xref:System.Windows.Controls.WebBrowser> ovládací prvek nebo ovládací prvek <xref:System.Windows.Controls.Frame>, který obsahuje kód HTML, při vytvoření ovládacího prvku vyvolá <xref:System.Security.SecurityException>.<br><br>Aplikace prohlížeče vyvolá výjimku a zobrazí zprávu, pokud jsou splněny všechny následující podmínky:<br><br>* Aplikace běží v prohlížeči Firefox.<br>* Aplikace běží v částečném vztahu důvěryhodnosti v zóně Internet z nedůvěryhodných webů.<br>* Aplikace obsahuje ovládací prvek <xref:System.Windows.Controls.WebBrowser> nebo ovládací prvek <xref:System.Windows.Controls.Frame>, který obsahuje kód HTML.<br><br>Všimněte si, že aplikace, které běží z důvěryhodných nebo ze zóny intranetu, nebudou ovlivněny. | V aplikacích v prohlížeči můžete tuto změnu zjednodušit jedním z následujících způsobů:<br><br>* Spusťte aplikaci v prohlížeči s úplným vztahem důvěryhodnosti.<br>* Pokud chtějí zákazníci přidat web aplikace do zóny důvěryhodných serverů.<br>* Uživatelé spouštějí aplikaci v Internet Exploreru. |
| **Slovníky prostředků** | Chcete-li zlepšit slovníky prostředků na úrovni motivů a zabránit jejich změnám, Freezable prostředky, které jsou definovány ve slovníku prostředků a sloučeny do slovníku na úrovni motivu, jsou nyní vždy označeny jako zmrazené a jsou neměnné. Toto je očekávané chování prostředků Freezable. | Aplikace, které upravují prostředek definovaný ve sloučeném slovníku na úrovni motivů, by měly klonovat prostředek a upravovat Klonovaný kopii. Případně je možné prostředek označit `x:Shared="false"`, aby <xref:System.Windows.ResourceDictionary> vytvořil novou kopii při každém dotazování prostředku. |
| **Systém Windows 7** | Pro zajištění lepšího fungování aplikací WPF v systému Windows 7 byly provedeny následující vylepšení pro opravu chování okna:<br><br>* Stav ukotvení a gesta teď funguje podle očekávání na základě interakcí uživatelů.<br>* Příkazy hlavního panelu na **sebe v oknech, Zobrazit okna skládané**a **Zobrazit vedle** sebe teď mají správné chování a aktualizují příslušné vlastnosti.<br>* Vlastnosti `Top`, `Left`, `Width`a `Height` pro maximalizované nebo minimalizované okno teď v závislosti na monitorování obsahují místo jiných hodnot správné umístění pro obnovení okna. | Žádné |
| **Styl a průhlednost Windows** | <xref:System.InvalidOperationException> je vyvolána, pokud se pokusíte nastavit <xref:System.Windows.Window.WindowStyle> na jinou hodnotu než <xref:System.Windows.WindowStyle>, pokud <xref:System.Windows.Window.AllowsTransparency> `true` a <xref:System.Windows.WindowState> je <xref:System.Windows.WindowState>. | Pokud je nutné změnit <xref:System.Windows.Window.WindowStyle>, když je <xref:System.Windows.Window.AllowsTransparency> `true`, můžete zavolat funkci `SetWindowLongPtr` Win32. |
| **Prohlížeč XPS** | WPF nezahrnuje Microsoft XML Paper Specification Essentials Pack (XPSEP). XPSEP je součástí systémů Windows 7 a Windows Vista.<br><br>V počítači se systémem Windows XP bez nainstalovaného .NET Framework 3,5 SP1 se tisk pomocí rozhraní WPF API, které není v <xref:System.Windows.Controls.PrintDialog>, spoléhá na WINSPOOL. Některé funkce tiskárny nebudou hlášeny a některá nastavení tiskárny nebudou během tisku použita. | V případě potřeby nainstalujte [sadu Microsoft XML Paper Specification Essentials Pack](https://go.microsoft.com/fwlink/?LinkId=178895). |

### <a name="controls"></a>Ovládací prvky

Obory názvů: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; sestavení: PresentationFramework (v PresentationFramework. dll), PresentationCore (v PresentationCore. dll), WindowsBase (v WindowsBase. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Dialogová okna** | Pro zlepšení spolehlivosti je metoda <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> volána ve stejném vlákně, která vytvořila <xref:Microsoft.Win32.FileDialog> ovládací prvek. | Nezapomeňte vytvořit <xref:Microsoft.Win32.FileDialog> ovládací prvek a volat metodu <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> ve stejném vlákně. |
| **Plovoucí okna** | Chcete-li opravit logiku pro obnovení při obnově, která nesprávně udržuje v plovoucím okně (takže se zobrazí jako modální dialogové okno), je nyní znemožněno obnovení, pokud kandidát není podřízeným oknem. | Žádné |
| **Položky v kolekcích** | Pokud je položka přesunuta nebo přidána do podkladové kolekce, zobrazí se v <xref:System.Windows.Data.CollectionView> ve stejném relativním umístění, pokud není <xref:System.Windows.Data.CollectionView> setříděna. Tím je zajištěna konzistence mezi pozicí položky v kolekci a přidruženou <xref:System.Windows.Data.CollectionView>. | Použijte metodu <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> nebo <xref:System.Windows.Data.CollectionView.IndexOf%2A> k vyhledání umístění položky v <xref:System.Windows.Data.CollectionView> namísto spoléhání na pevné umístění položky. |
| **Rozložení** | Aby nedošlo k zbytečným opakovaným rozložením, změna <xref:System.Windows.Controls.Page.ShowsNavigationUI> už neověřuje rozložení nebo způsobuje jiné rozložení. | Pokud očekáváte, že při změně <xref:System.Windows.Controls.Page.ShowsNavigationUI> dojde k dalšímu rozložení, zavolejte <xref:System.Windows.UIElement.InvalidateVisual%2A> po nastavení vlastnosti. |
| **Nabídky** | Chcete-li povolit text ClearType v nabídce překryvných oken, byly provedeny úpravy třídy <xref:System.Windows.Controls.ControlTemplate> a <xref:System.Windows.Controls.MenuItem> ovládacího prvku a dalších ovládacích prvků. | Aplikace by neměly spoléhat na vizuální strukturu šablon ovládacích prvků. Součástí veřejné smlouvy jsou pouze pojmenované části <xref:System.Windows.Controls.ControlTemplate>. Pokud aplikace musí najít určitý objekt v <xref:System.Windows.Controls.ControlTemplate>, vyhledejte v vizuálním stromu konkrétní typ a nemusíte přitom spoléhat na pevné umístění objektu ve stromu. |
| **Navigace** | Pokud <xref:System.Windows.Controls.Frame> přímo přejde na umístění, vlastnost <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> je `true` po počáteční navigaci. Tato změna zabrání vyvolání dalších událostí během spouštěcích scénářů. | Žádné |
| **Automaticky otevíraná okna** | Delegáta <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> lze nyní vyvolat několikrát během průchodu rozložení, nikoli jenom jednou. | Pokud váš <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegát vypočítá pozici <xref:System.Windows.Controls.Primitives.Popup> na základě jeho předchozí pozice, Přepočítejte pozici pouze v případě, že se změní hodnoty parametrů `popupSize`, `targetSize`nebo `offset`. |
| **Hodnoty vlastností** | Metoda <xref:System.Windows.DependencyObject.SetCurrentValue%2A> nyní umožňuje nastavit vlastnost na efektivní hodnotu, i když stále dodržuje jakékoli vazby, styly nebo triggery, které mají vliv na vlastnost. | Autoři ovládacích prvků by měli použít <xref:System.Windows.DependencyObject.SetCurrentValue%2A> vždy, když se hodnota vlastnosti změní jako vedlejší účinek jiné akce, včetně manipulace s uživatelem. |
| **Textová pole** | Z hlediska zabezpečení jsou metody <xref:System.Windows.Forms.TextBoxBase.Copy%2A> a <xref:System.Windows.Forms.TextBoxBase.Cut%2A> tiše neúspěšné, když jsou volány v částečném vztahu důvěryhodnosti.<br><br>Kromě toho se v částečném vztahu důvěryhodnosti zablokuje programové spuštění vlastnosti <xref:System.Windows.Input.ApplicationCommands.Copy> nebo <xref:System.Windows.Input.ApplicationCommands.Cut> ovládacího prvku, který dědí z <xref:System.Windows.Controls.Primitives.TextBoxBase>. Avšak uživatelem iniciované příkazy kopírování a vyjmutí, jako je například kliknutí na tlačítko, jehož vlastnost <xref:System.Windows.Controls.Primitives.ButtonBase.Command> je svázána s některým z těchto příkazů, budou fungovat. Standardní kopírování a vyjmutí prostřednictvím klávesových zkratek a místní nabídka bude i nadále fungovat jako předtím v částečném vztahu důvěryhodnosti. | Připojte příkaz <xref:System.Windows.Input.ApplicationCommands.Copy> nebo <xref:System.Windows.Input.ApplicationCommands.Cut> k akci iniciované uživatelem, například kliknutím na tlačítko. |

### <a name="graphics"></a>Grafika

Obory názvů: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>; sestavení: PresentationFramework (v PresentationFramework. dll), PresentationCore (v PresentationCore. dll), WindowsBase (v WindowsBase. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Rastrové efekty** | Pro zvýšení výkonu jsou zakázané třídy <xref:System.Windows.Media.Effects.BitmapEffect> a třídy, které dědí z <xref:System.Windows.Media.Effects.BitmapEffect> třídy, i když jsou stále přítomné. Efekt se vykreslí pomocí kanálu vykreslování s hardwarovou akcelerací, pokud jsou splněné následující podmínky:<br><br>* Aplikace používá <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> nebo <xref:System.Windows.Media.Effects.BlurBitmapEffect>, která má nastavenou vlastnost RADIUS menší než 100 DIÚ.<br>* Videokarta na počítači, na kterém je spuštěna aplikace, podporuje Pixel Shader 2,0.<br><br>Nejsou-li tyto podmínky splněny, objekt <xref:System.Windows.Media.Effects.BitmapEffect> nebude mít žádný vliv.<br><br>Visual Studio také generuje upozornění kompilátoru při výskytu <xref:System.Windows.Media.Effects.BitmapEffect>ho objektu nebo podtřídy.<br><br>Metoda <xref:System.Windows.Media.DrawingContext.PushEffect%2A> je označena jako zastaralá. | Přestat používat starší <xref:System.Windows.Media.Effects.BitmapEffect> a odvozené třídy a místo toho použít nové třídy odvozené od <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect>a <xref:System.Windows.Media.Effects.ShaderEffect>.<br><br>Můžete také vytvořit vlastní efekty děděním z třídy <xref:System.Windows.Media.Effects.ShaderEffect>. |
| **Rastrové snímky** | Naklonované <xref:System.Windows.Media.Imaging.BitmapFrame> objekty nyní dostanou události <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>a <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>. To umožňuje, aby se obrázky stažené z webu stáhly a nastavily na <xref:System.Windows.Controls.Image> ovládacího prvku prostřednictvím <xref:System.Windows.Style> správně fungovaly.<br><br>Změna chování se projeví pouze v případě, že jsou splněné všechny následující příkazy:<br><br>* Přihlásíte se k odběru události <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>nebo <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed>.<br>* Zdrojem <xref:System.Windows.Media.Imaging.BitmapFrame> je z webu.<br>* Při stahování stále probíhá naklonování <xref:System.Windows.Media.Imaging.BitmapFrame>. | Ověřte odesílatele v obslužné rutině události a proveďte akci pouze v případě, že je odesilatel původní <xref:System.Windows.Media.Imaging.BitmapFrame>. |
| **Dekódování obrázků** | Aby nedocházelo k tomu, že se <xref:System.IO.IOException> nezpracovává, když obrázky nemusí být dekódovat, třída <xref:System.Windows.Media.Imaging.BitmapSource> vyvolá událost <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed>, když nebude dekódovat obrázek. | Odeberte jakékoli zpracování výjimek pro <xref:System.IO.IOException>a pomocí události <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> ověřte, zda nedošlo k chybě dekódování. |

### <a name="input"></a>Vstup

Obory názvů: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; sestavení: PresentationFramework (v PresentationFramework. dll), PresentationCore (v PresentationCore. dll), WindowsBase (v WindowsBase. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Instance příkazů vazby** | Chcete-li poskytnout mechanizmus pro vstupní gesta založená na zobrazení modelu, třída <xref:System.Windows.Input.InputBinding> nyní dědí z <xref:System.Windows.Freezable> namísto <xref:System.Windows.DependencyObject>. Následující vlastnosti jsou nyní vlastnosti závislosti:<br><br>* <xref:System.Windows.Input.InputBinding.Command><br>* <xref:System.Windows.Input.InputBinding.CommandParameter><br>* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br>Tato změna má za následek následující:<br><br>* Objekt <xref:System.Windows.Input.InputBinding> je teď zmrazený, když je zaregistrovaný místo zbývající měnitelné.<br>* Nemůžete získat přístup k objektům <xref:System.Windows.Input.InputBinding> na úrovni instance z více vláken z důvodu omezení <xref:System.Windows.DependencyObject> třídy.<br>* Vstupní vazby na úrovni třídy nelze po registraci provést z důvodu omezení třídy <xref:System.Windows.Freezable>.<br>* Nemůžete zadat vstupní vazby pro instance příkazů, které jsou vytvořeny v modelu zobrazení. | Vytvořte samostatné instance <xref:System.Windows.Input.InputBinding> třídy v samostatných vláknech, pokud mají být vazby proměnlivé, nebo je zablokujte jinak. Po zaregistrování neprovádějte statické <xref:System.Windows.Input.InputBinding> na úrovni třídy. |
| **Prohlížeče aplikace** | Aplikace WPF pro prohlížeč (. XBAP) nyní zpracovává klíčové události stejně jako samostatné aplikace WPF, aby objekty dostaly směrované klíčové události ve správném pořadí. | Žádné |
| **Nedoručené kombinace klíčů** | WPF odprodukuje nedoručené klíče, které nevytváří žádný viditelný znak, ale místo toho označuje, že klíč se má zkombinovat s dalším písmenem, aby se vytvořil jeden znak. Klíčové události vstupu, jako je například událost <xref:System.Windows.Input.Keyboard.KeyDownEvent>, nahlásí, že je klíč nemrtvý klíč, nastavením vlastnosti <xref:System.Windows.Input.KeyEventArgs.Key> na hodnotu <xref:System.Windows.Input.Key>. Obvykle se očekává chování, protože aplikace obvykle nechtějí reagovat na vstup z klávesnice, který vytváří kombinovaný znak. | Aplikace, které očekávají čtení klíčů, které byly součástí kombinovaných znaků, mohou získat nyní nepovolený klíč pomocí vlastnosti <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey>. |
| **Manažer Focus** | Když je metoda <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> předána prvku, který má vlastnost připojenou [IsFocusScope](xref:System.Windows.Input.FocusManager.IsFocusScope%2A) nastavenou na `true`, metoda vrátí prvek, který je posledním prvkem zaměřeným na klávesnici v rámci tohoto oboru fokusu, pokud a pouze pokud vrácený element patří do stejný objekt <xref:System.Windows.PresentationSource> jako element, který je předán metodě. | Žádné |

### <a name="ui-automation"></a>automatizace uživatelského rozhraní

Obor názvů: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; sestavení: PresentationFramework (v PresentationFramework. dll), PresentationCore (v PresentationCore. dll), UIAutomationProvider (v UIAutomationProvider. dll), WindowsBase (v WindowsBase. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Hierarchie tříd zobrazení** | Třídy <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> a <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> dědí z <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> namísto <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>. | Pokud převezmete z třídy <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> a přepište metodu <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A>, zvažte vrácení objektu, který dědí z nové třídy <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer>. |
| **Kontejnery mimo obrazovku** | Chcete-li opravit nesprávnou návratovou hodnotu, metoda <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> nyní správně vrátí `false` kontejnerů položek, které jsou posunuty mimo zobrazení. Také hodnota metody není ovlivněna překrytí jinými okny nebo podle toho, zda je prvek viditelný na konkrétním monitorování. | Žádné |
| **Nabídky a podřízené objekty** | Chcete-li povolit automatizaci uživatelského rozhraní nabídek, které obsahují podřízené objekty jiné než <xref:System.Windows.Controls.MenuItem> objekty, metoda <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> nyní vrátí objekt <xref:System.Windows.Automation.Peers.AutomationPeer> podřízeného objektu <xref:System.Windows.UIElement> namísto objektu <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer>. | Žádné |
| **Nová rozhraní a sestavení** | Chcete-li povolit nové funkce pro automatizaci uživatelského rozhraní, byla přidána následující rozhraní:<br><br>* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | Každý projekt, který sestavuje partnerské vztahy automatizace WPF, musí přidat explicitní odkaz na UIAutomationProvider. dll. |
| **Thumbs** | Metoda <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> vrací hodnotu namísto hodnoty null. Proto ovládací prvky, jako <xref:System.Windows.Controls.GridSplitter>, které dědí z <xref:System.Windows.Controls.Primitives.Thumb> třídy, nahlásí název pro automatizaci uživatelského rozhraní. | Žádné |
| **Virtualizované elementy** | Chcete-li zvýšit výkon, metoda <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> vrátí pouze podřízené objekty, které jsou ve skutečnosti ve vizuálním stromu, namísto všech podřízených objektů bez ohledu na to, zda jsou virtualizované. | Použijte <xref:System.Windows.Automation.ItemContainerPattern> k iterování všech položek <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>. |

### <a name="xaml"></a>XAML

Obory názvů: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>; sestavení: PresentationFramework (v PresentationFramework. dll), PresentationCore (v PresentationCore. dll), WindowsBase (v WindowsBase. dll)

| Funkce | Rozdíly z 3,5 SP1 | Doporučené změny |
| ------- | ------------------------ | ------------------- |
| **Rozšíření značek** | WPF teď správně používá hodnotu z metody <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> namísto vrácení objektu <xref:System.Windows.Markup.MarkupExtension> v některých případech, kdy se k nastavení vlastnosti nebo vytvoření položky v kolekci používá rozšíření značek. Rozšíření značek může v některých případech vracet sám sebe. | Pokud vaše aplikace přistupuje k prostředku, který vrátil objekt <xref:System.Windows.Markup.MarkupExtension> v dřívějších verzích, odkazujte na objekt, který je vrácen z <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>namísto objektu <xref:System.Windows.Markup.MarkupExtension>. |
| **Analýza atributů** | Atributy v XAML teď můžou mít jenom jednu tečku. Platné jsou například následující:<br><br>`<Button Background="Red"/>` (žádné tečky)<br><br>`<Button Button.Background = "Red"/>` (jedna tečka)<br><br>Následující akce již není platná:<br><br>`<Button Control.Button.Background = "Red"/>` (více než jedna tečka) | Správné atributy XAML, které mají více než jednu tečku. |

## <a name="xml"></a>XML

Řádky v této tabulce popisují vylepšení funkcí, které dříve obsahovaly omezení nebo jiné problémy.

### <a name="schema-and-transforms"></a>Schéma a transformace

Obory názvů: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; sestavení: System. XML (v System. XML. dll), System. XML. Linq (v System. XML. Linq. dll)

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Schémata Chameleon** | Aby nedošlo k poškození dat, schémata Chameleon se teď naklonují správně, když jsou zahrnutá v několika schématech.<br><br>Schémata Chameleon jsou schémata, která nemají cílový obor názvů a když jsou zahrnutá v jiném schématu XSD, přebírají cílový obor názvů importovaného schématu. Často se používají k zahrnutí běžných typů do schématu. |
| **Funkce ID** | [Funkce ID](/sql/xquery/functions-on-sequences-id) XSLT nyní vrací správnou hodnotu namísto hodnoty null, pokud je objekt <xref:System.Xml.XmlReader> předán do objektu XLST vztahuje.<br><br>Pokud uživatel vytvořil objekt <xref:System.Xml.XmlReader> z LINQ to XML třídy pomocí metody <xref:System.Xml.Linq.XNode.CreateReader%2A> a tento objekt <xref:System.Xml.XmlReader> byl předán souboru XSLT, všechny instance `id` funkce v souboru XSLT dříve vrátily hodnotu null. Toto není povolená návratová hodnota pro funkci `id`. |
| **Atribut namespace** | Aby nedošlo k poškození dat, objekt <xref:System.Xml.XPath.XPathNavigator> nyní vrátí místní název atributu `x:xmlns` správně. |
| **Deklarace oboru názvů** | Objekt <xref:System.Xml.XmlReader> v dílčím stromu již nevytváří duplicitní deklarace oboru názvů v rámci jednoho elementu XML. |
| **Ověřování schématu** | Aby nedocházelo k chybnému ověření schématu, třída <xref:System.Xml.Schema.XmlSchemaSet> umožňuje, aby schémata XSD byla správně kompilována a konzistentní. Tato schémata mohou zahrnovat další schémata; `A.xsd` může například zahrnovat `B.xsd`, které mohou zahrnovat `C.xsd`. Při kompilování jedné z těchto příčin se tento graf závislostí prochází. |
| **Funkce skriptu** | Funkce, která je [k dispozici](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms256124(v=vs.100)) , již nevrací nesprávně `false`, pokud je funkce skutečně dostupná. |
| **Identifikátory URI** | Metoda <xref:System.Xml.Linq.XElement.Load%2A> nyní vrací správné BaseURI v dotazech LINQ. |

### <a name="validation"></a>Ověřování

Obory názvů: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; sestavení: System. XML (v System. XML. dll), System. XML. Linq (v System. XML. Linq. dll)

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Překladače oborů názvů** | Metoda <xref:System.Xml.XmlReader.ReadContentAs%2A> již neignoruje předaný překladač <xref:System.Xml.IXmlNamespaceResolver>.<br><br>V předchozích verzích byl zadaný překladač oboru názvů ignorován a místo toho byl použit <xref:System.Xml.XmlReader>. |
| **Prázdné znaky** | Aby nedošlo ke ztrátě dat při vytváření čtecího zařízení, <xref:System.Xml.XmlReader.Create%2A> metoda už nehodí významné prázdné znaky.<br><br>Ověřování XML rozpozná režim smíšeného obsahu, kde lze text vzájemně kombinovat s kódem XML. Ve smíšeném režimu je všechny prázdné znaky významné a měly by být hlášeny. |

### <a name="writing"></a>Zapsat

Obory názvů: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; sestavení: System. XML (v System. XML. dll), System. XML. Linq (v System. XML. Linq. dll)

| Funkce | Rozdíly z 3,5 SP1 |
| ------- | ------------------------ |
| **Odkazy na entity** | Aby nedošlo k poškození dat, odkazy na entity se už v atributech XML entitized dvakrát.<br><br>Pokud se uživatel pokusil zapsat entitu do atributu `xmlns` nebo do atributu `xml:lang` nebo `xml:space` pomocí metody <xref:System.Xml.XmlWriter.WriteEntityRef%2A>, entita byla ve výstupu entitized dvakrát, proto by poškodila data. |
| **Nové zpracování řádků** | Aby nedošlo k poškození dat, <xref:System.Xml.XmlWriter> objekty respektují možnost <xref:System.Xml.NewLineHandling>. |

## <a name="see-also"></a>Viz také:

- [Nové typy a členové v .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff641764%28v=vs.100%29)
- [Průvodce migrací na .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ff657133%28v=vs.100%29)
- [Co je nového v .NET Framework 4](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms171868%28v=vs.100%29)
- [Kompatibilita verzí v .NET Framework](version-compatibility.md)
- [Migrace řešení pro systém Office na .NET Framework 4](/visualstudio/vsto/migrating-office-solutions-to-the-dotnet-framework-4-or-later)
- [Zastaralé položky v knihovně tříd .NET Framework](../whats-new/whats-obsolete.md)
