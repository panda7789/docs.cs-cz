---
title: 'Postupy: Povolení streamování'
description: Naučte se, jak povolit streamované zprávy ve službě WCF namísto výchozích přenosů ve vyrovnávací paměti, které je potřeba před zpracováním úplně přijmout.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: 538fd8634094aa6fbf097ddb94469d7bca749a63
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 06/23/2020
ms.locfileid: "85247023"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="06615-103">Postupy: Povolení streamování</span><span class="sxs-lookup"><span data-stu-id="06615-103">How to: Enable Streaming</span></span>
<span data-ttu-id="06615-104">Windows Communication Foundation (WCF) může odesílat zprávy pomocí vyrovnávacích pamětí nebo přenosů přes datový proud.</span><span class="sxs-lookup"><span data-stu-id="06615-104">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="06615-105">Ve výchozím režimu přenosu do vyrovnávací paměti musí být zpráva zcela doručena předtím, než ji příjemce může přečíst.</span><span class="sxs-lookup"><span data-stu-id="06615-105">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="06615-106">V režimu přenosu datového proudu může příjemce zahájit zpracování zprávy před úplným doručením.</span><span class="sxs-lookup"><span data-stu-id="06615-106">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="06615-107">Režim streamování je užitečný v případě, že předávané informace jsou zdlouhavé a dají se zpracovat sériově.</span><span class="sxs-lookup"><span data-stu-id="06615-107">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="06615-108">Režim streamování je vhodný také v případě, že je zpráva příliš velká a nemůže být zcela ukládána do vyrovnávací paměti.</span><span class="sxs-lookup"><span data-stu-id="06615-108">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="06615-109">Pokud chcete streamování povolit, definujte `OperationContract` odpovídajícím způsobem a povolte streamování na úrovni přenosu.</span><span class="sxs-lookup"><span data-stu-id="06615-109">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="06615-110">Pro streamování dat</span><span class="sxs-lookup"><span data-stu-id="06615-110">To stream data</span></span>  
  
1. <span data-ttu-id="06615-111">Pro streamování dat `OperationContract` musí služba pro službu splňovat dvě požadavky:</span><span class="sxs-lookup"><span data-stu-id="06615-111">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1. <span data-ttu-id="06615-112">Parametr, který obsahuje data, která mají být datovým proudem, musí být jediným parametrem v metodě.</span><span class="sxs-lookup"><span data-stu-id="06615-112">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="06615-113">Pokud je vstupní zpráva například ta, která se má streamovat, musí mít operace přesně jeden vstupní parametr.</span><span class="sxs-lookup"><span data-stu-id="06615-113">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="06615-114">Podobně platí, že pokud má být výstupní zpráva streamovaná, operace musí mít buď přesně jeden výstupní parametr, nebo návratovou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="06615-114">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2. <span data-ttu-id="06615-115">Nejméně jeden z typů parametrů a návratová hodnota musí být buď <xref:System.IO.Stream> , <xref:System.ServiceModel.Channels.Message> nebo <xref:System.Xml.Serialization.IXmlSerializable> .</span><span class="sxs-lookup"><span data-stu-id="06615-115">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="06615-116">Následuje příklad smlouvy pro streamovaná data.</span><span class="sxs-lookup"><span data-stu-id="06615-116">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="06615-117">`GetStream`Operace přijme některá vstupní data ve vyrovnávací paměti jako `string` , která jsou ukládána do vyrovnávací paměti, a vrátí `Stream` , který je datovým proudem.</span><span class="sxs-lookup"><span data-stu-id="06615-117">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="06615-118">Naopak `UploadStream` přebírá `Stream` (streamuje) a vrací `bool` (Buffered).</span><span class="sxs-lookup"><span data-stu-id="06615-118">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="06615-119">`EchoStream`přijímá a vrací `Stream` a je příkladem operace, jejíž vstupní a výstupní zprávy jsou přenášeny datovým proudem.</span><span class="sxs-lookup"><span data-stu-id="06615-119">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="06615-120">Nakonec `GetReversedStream` neprovede žádné vstupy a vrátí `Stream` (streamované).</span><span class="sxs-lookup"><span data-stu-id="06615-120">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2. <span data-ttu-id="06615-121">Ve vazbě musí být povoleno streamování.</span><span class="sxs-lookup"><span data-stu-id="06615-121">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="06615-122">Nastavili jste `TransferMode` vlastnost, která může mít jednu z následujících hodnot:</span><span class="sxs-lookup"><span data-stu-id="06615-122">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1. <span data-ttu-id="06615-123">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="06615-123">`Buffered`,</span></span>  
  
    2. <span data-ttu-id="06615-124">`Streamed`, což umožňuje komunikaci streamování v obou směrech.</span><span class="sxs-lookup"><span data-stu-id="06615-124">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3. <span data-ttu-id="06615-125">`StreamedRequest`, což umožňuje streamování pouze požadavku.</span><span class="sxs-lookup"><span data-stu-id="06615-125">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4. <span data-ttu-id="06615-126">`StreamedResponse`, což umožňuje streamování jenom odpovědi.</span><span class="sxs-lookup"><span data-stu-id="06615-126">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="06615-127">`BasicHttpBinding`Vlastnost zpřístupňuje `TransferMode` vlastnost vazby, jak to dělá `NetTcpBinding` a `NetNamedPipeBinding` .</span><span class="sxs-lookup"><span data-stu-id="06615-127">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="06615-128">`TransferMode`Vlastnost lze také nastavit na elementu vazby přenosu a použít ve vlastní vazbě.</span><span class="sxs-lookup"><span data-stu-id="06615-128">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="06615-129">Následující ukázky ukazují, jak nastavit `TransferMode` kód a změnit konfigurační soubor.</span><span class="sxs-lookup"><span data-stu-id="06615-129">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="06615-130">V ukázkách se také nastaví `maxReceivedMessageSize` vlastnost na 64 MB, která umístí limit na maximální povolenou velikost zpráv při příjmu.</span><span class="sxs-lookup"><span data-stu-id="06615-130">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="06615-131">Výchozí hodnota `maxReceivedMessageSize` je 64 KB, což je obvykle příliš nízké pro scénáře streamování.</span><span class="sxs-lookup"><span data-stu-id="06615-131">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="06615-132">Nastavení této kvóty nastavte podle potřeby v závislosti na maximální velikosti zpráv, které aplikace očekává přijmout.</span><span class="sxs-lookup"><span data-stu-id="06615-132">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="06615-133">Všimněte si také, že `maxBufferSize` ovládací prvky mají maximální velikost, která je ukládána do vyrovnávací paměti, a patřičně ji nastavte.</span><span class="sxs-lookup"><span data-stu-id="06615-133">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1. <span data-ttu-id="06615-134">Následující fragment kódu konfigurace z příkladu ukazuje nastavení `TransferMode` vlastnosti pro streamování na `basicHttpBinding` a vlastní vazbu HTTP.</span><span class="sxs-lookup"><span data-stu-id="06615-134">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]
  
    2. <span data-ttu-id="06615-135">Následující fragment kódu ukazuje nastavení `TransferMode` vlastnosti na streamování v `basicHttpBinding` a vlastní vazby HTTP.</span><span class="sxs-lookup"><span data-stu-id="06615-135">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3. <span data-ttu-id="06615-136">Následující fragment kódu ukazuje nastavení `TransferMode` vlastnosti na streamování ve vlastní vazbě protokolu TCP.</span><span class="sxs-lookup"><span data-stu-id="06615-136">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3. <span data-ttu-id="06615-137">Operace `GetStream` , `UploadStream` a `EchoStream` se týkají odesílání dat přímo ze souboru nebo ukládání přijatých dat přímo do souboru.</span><span class="sxs-lookup"><span data-stu-id="06615-137">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="06615-138">Následující kód je pro `GetStream` .</span><span class="sxs-lookup"><span data-stu-id="06615-138">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="06615-139">Zápis vlastního datového proudu</span><span class="sxs-lookup"><span data-stu-id="06615-139">Writing a custom stream</span></span>  
  
1. <span data-ttu-id="06615-140">Chcete-li provést speciální zpracování pro každý blok datového proudu při jeho posílání nebo přijímání, odvodit vlastní třídu Stream z <xref:System.IO.Stream> .</span><span class="sxs-lookup"><span data-stu-id="06615-140">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="06615-141">Jako příklad vlastního datového proudu obsahuje následující kód `GetReversedStream` metodu a `ReverseStream` třídu –.</span><span class="sxs-lookup"><span data-stu-id="06615-141">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="06615-142">`GetReversedStream`Vytvoří a vrátí novou instanci `ReverseStream` .</span><span class="sxs-lookup"><span data-stu-id="06615-142">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="06615-143">Ke skutečnému zpracování dojde, když systém čte z `ReverseStream` objektu.</span><span class="sxs-lookup"><span data-stu-id="06615-143">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="06615-144">`ReverseStream.Read`Metoda načte blok bajtů z podkladového souboru, obrátí je a potom vrátí obrácené bajty.</span><span class="sxs-lookup"><span data-stu-id="06615-144">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="06615-145">Tato metoda nevrátí celý obsah souboru. v jednom okamžiku vrátí jeden blok bajtů.</span><span class="sxs-lookup"><span data-stu-id="06615-145">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="06615-146">Tento příklad ukazuje, jak lze provádět zpracování datového proudu při čtení a zápisu obsahu z datového proudu.</span><span class="sxs-lookup"><span data-stu-id="06615-146">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="06615-147">Viz také</span><span class="sxs-lookup"><span data-stu-id="06615-147">See also</span></span>

- [<span data-ttu-id="06615-148">Objemná data a streamování</span><span class="sxs-lookup"><span data-stu-id="06615-148">Large Data and Streaming</span></span>](large-data-and-streaming.md)
- [<span data-ttu-id="06615-149">Datový proud</span><span class="sxs-lookup"><span data-stu-id="06615-149">Stream</span></span>](../samples/stream.md)
