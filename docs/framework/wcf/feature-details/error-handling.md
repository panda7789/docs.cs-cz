---
title: Zpracování chyb
ms.date: 03/30/2017
ms.assetid: c948841a-7db9-40ae-9b78-587d216cbcaf
ms.openlocfilehash: f6c0d676a37648678b2b726a46a6238ccc1b3331
ms.sourcegitcommit: eff6adb61852369ab690f3f047818c90580e7eb1
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/07/2019
ms.locfileid: "72004885"
---
# <a name="error-handling-in-windows-communication-foundation-wcf"></a><span data-ttu-id="8155f-102">Zpracování chyb v Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="8155f-102">Error handling in Windows Communication Foundation (WCF)</span></span>

<span data-ttu-id="8155f-103">Když dojde k neočekávané výjimce nebo chybě služby, existuje několik způsobů, jak navrhnout řešení pro zpracování výjimek.</span><span class="sxs-lookup"><span data-stu-id="8155f-103">When a service encounters an unexpected exception or error, there are multiple ways to design an exception-handling solution.</span></span> <span data-ttu-id="8155f-104">I když není k dispozici žádný jediný "správný" nebo "osvědčený postup" řešení pro zpracování chyb, existuje několik platných cest pro jeden, který je třeba zvážit.</span><span class="sxs-lookup"><span data-stu-id="8155f-104">While there is no single "correct" or "best practice" error-handling solution, there are multiple valid paths for one to consider.</span></span> <span data-ttu-id="8155f-105">Obvykle se doporučuje, aby jedna implementovala hybridní řešení, které kombinuje více přístupů ze seznamu níže v závislosti na složitosti implementace WCF, typu a četnosti výjimek, zpracovaných a nezpracovaných povaze. výjimky a všechny přidružené trasování, protokolování nebo požadavky zásad.</span><span class="sxs-lookup"><span data-stu-id="8155f-105">It is normally recommended that one implement a hybrid solution that combines multiple approaches from the list below, depending on the complexity of the WCF implementation, the type and frequency of the exceptions, the handled vs. unhandled nature of the exceptions, and any associated tracing, logging, or policy requirements.</span></span>

<span data-ttu-id="8155f-106">Tato řešení jsou podrobněji vysvětlena ve zbývající části tohoto oddílu.</span><span class="sxs-lookup"><span data-stu-id="8155f-106">These solutions are explained more deeply in the rest of this section.</span></span>

## <a name="the-microsoft-enterprise-library"></a><span data-ttu-id="8155f-107">Microsoft Enterprise Library</span><span class="sxs-lookup"><span data-stu-id="8155f-107">The Microsoft Enterprise Library</span></span>

<span data-ttu-id="8155f-108">Blok aplikace pro zpracování výjimek Microsoft Enterprise Library pomáhá implementovat běžné vzory návrhu a vytvořit konzistentní strategii pro zpracování výjimek, ke kterým dochází ve všech vrstvách architektury podnikové aplikace.</span><span class="sxs-lookup"><span data-stu-id="8155f-108">The Microsoft Enterprise Library Exception Handling Application Block helps implement common design patterns and create a consistent strategy for processing exceptions that occur in all architectural layers of an enterprise application.</span></span> <span data-ttu-id="8155f-109">Je navržena tak, aby podporovala typický kód obsažený v příkazech catch v součástech aplikace.</span><span class="sxs-lookup"><span data-stu-id="8155f-109">It is designed to support the typical code contained in catch statements in application components.</span></span> <span data-ttu-id="8155f-110">Místo opakování tohoto kódu (například kódu, který protokoluje informace o výjimce) ve stejných blocích catch v rámci aplikace, blok aplikace pro zpracování výjimek umožňuje vývojářům zapouzdřit tuto logiku jako opakovaně použitelné obslužné rutiny výjimek.</span><span class="sxs-lookup"><span data-stu-id="8155f-110">Instead of repeating this code (such as code that logs exception information) in identical catch blocks throughout an application, the Exception Handling Application Block allows developers to encapsulate this logic as reusable exception handlers.</span></span>

<span data-ttu-id="8155f-111">Tato knihovna obsahuje předem zastaralou obslužnou rutinu výjimky smlouvy o selhání.</span><span class="sxs-lookup"><span data-stu-id="8155f-111">This Library includes out-of-the-box a Fault Contract Exception Handler.</span></span> <span data-ttu-id="8155f-112">Tato obslužná rutina výjimky je navržena pro použití v hranicích služby WCF a generuje novou kontrakt chyby z výjimky.</span><span class="sxs-lookup"><span data-stu-id="8155f-112">This exception handler is designed for use at WCF service boundaries, and generates a new Fault Contract from the exception.</span></span>

<span data-ttu-id="8155f-113">Aplikační bloky mají za cíl zahrnovat běžně používané osvědčené postupy a poskytují společný přístup k zpracování výjimek v celé vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8155f-113">Application blocks aim to incorporate commonly used best practices and provide a common approach for exception handling throughout your application.</span></span> <span data-ttu-id="8155f-114">Na druhé straně vlastní obslužné rutiny chyb a smlouvy o selhání vyvíjené na vlastní může být také velmi užitečné.</span><span class="sxs-lookup"><span data-stu-id="8155f-114">On the other hand, custom error handlers and fault contracts developed on one’s own can also be very useful.</span></span> <span data-ttu-id="8155f-115">Například vlastní obslužné rutiny chyb poskytují vynikající možnost automaticky propagovat všechny výjimky na FaultExceptions a také přidávat možnosti protokolování do aplikace.</span><span class="sxs-lookup"><span data-stu-id="8155f-115">For instance, custom error handlers provide an excellent opportunity to automatically promote all exceptions to FaultExceptions and also to add logging capabilities to your application.</span></span>

<span data-ttu-id="8155f-116">Další informace najdete v tématu [Microsoft Enterprise Library](https://docs.microsoft.com/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="8155f-116">For more information, please see [Microsoft Enterprise Library](https://docs.microsoft.com/previous-versions/msp-n-p/ff632023(v=pandp.10)).</span></span>

## <a name="dealing-with-expected-exceptions"></a><span data-ttu-id="8155f-117">Zvládnutí očekávaných výjimek</span><span class="sxs-lookup"><span data-stu-id="8155f-117">Dealing with expected exceptions</span></span>

<span data-ttu-id="8155f-118">Správným postupem je zachytit očekávaná výjimka v každé operaci nebo v příslušném bodu rozšiřitelnosti, rozhodnout, zda je lze obnovit z a vrátit správnou vlastní chybu v FaultException\<T >.</span><span class="sxs-lookup"><span data-stu-id="8155f-118">The proper course of action is to catch expected exceptions in every operation or relevant extensibility point, decide whether they can be recovered from, and return the proper custom fault in a FaultException\<T>.</span></span>
  
## <a name="dealing-with-unexpected-exceptions-using-an-ierrorhandler"></a><span data-ttu-id="8155f-119">Zvládnutí neočekávaných výjimek pomocí IErrorHandler</span><span class="sxs-lookup"><span data-stu-id="8155f-119">Dealing with unexpected exceptions using an IErrorHandler</span></span>

<span data-ttu-id="8155f-120">Pokud se chcete zabývat s neočekávanými výjimkami, doporučuje se postupovat "připojit" k IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="8155f-120">To deal with unexpected exceptions, the recommended course of action is to "hook" an IErrorHandler.</span></span> <span data-ttu-id="8155f-121">Obslužné rutiny chyb zachytí pouze výjimky na úrovni modulu runtime WCF ("vrstva modelu služby"), nikoli ve vrstvě kanálu.</span><span class="sxs-lookup"><span data-stu-id="8155f-121">Error handlers only catch exceptions at the WCF runtime level (the "service model" layer), not at the channel layer.</span></span> <span data-ttu-id="8155f-122">Jediným způsobem, jak připojit IErrorHandler na úrovni kanálu, je vytvořit vlastní kanál, který se ve většině scénářů nedoporučuje.</span><span class="sxs-lookup"><span data-stu-id="8155f-122">The only way to hook an IErrorHandler at the channel level is to create a custom channel, which is not recommended in most scenarios.</span></span>

<span data-ttu-id="8155f-123">"Nečekaná výjimka" není obecně výjimka nezotavitelné ani výjimka zpracování; místo toho se jedná o neočekávanou výjimku uživatele.</span><span class="sxs-lookup"><span data-stu-id="8155f-123">An "unexpected exception" is generally neither an irrecoverable exception nor a processing exception; it is, instead, an unexpected user exception.</span></span> <span data-ttu-id="8155f-124">Výjimka nezotavitelné (například výjimka z důvodu nedostatku paměti) – jedna všeobecně zpracovaná [obslužnou rutinou výjimky modelu služby](xref:System.ServiceModel.Dispatcher.ExceptionHandler) – nelze obecně zpracovat a jediný důvod, jak tuto výjimku zpracovat, může být další protokolování nebo vrácení standardní výjimky klientovi.</span><span class="sxs-lookup"><span data-stu-id="8155f-124">An irrecoverable exception (such as an out-of-memory exception) – one generally handled by the [Service Model Exception Handler](xref:System.ServiceModel.Dispatcher.ExceptionHandler) automatically – cannot generally be handled gracefully, and the only reason to handle such an exception at all may be do additional logging or to return a standard exception to the client.</span></span> <span data-ttu-id="8155f-125">Při zpracování zprávy dojde k výjimce zpracování – například na úrovni serializace, kodér nebo formátovacího modulu – obecně nelze zpracovat na IErrorHandler, protože je všeobecně příliš nebo příliš pozdě, než se obslužná rutina chyby zavede čas, kdy dochází k těmto výjimkám.</span><span class="sxs-lookup"><span data-stu-id="8155f-125">A processing exception occurs in the processing of the message – for example, at the serialization, encoder, or formatter level – generally cannot be handled at an IErrorHandler, because it is generally either too early or too late for the error handler to intervene by the time these exceptions occur.</span></span> <span data-ttu-id="8155f-126">Podobně je možné zpracovat výjimky přenosu na IErrorHandler.</span><span class="sxs-lookup"><span data-stu-id="8155f-126">Similarly, transport exceptions cannot be handled at an IErrorHandler.</span></span>

<span data-ttu-id="8155f-127">Pomocí IErrorHandler můžete explicitně řídit chování aplikace, když je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="8155f-127">With an IErrorHandler, you can explicitly control the behavior of your application when an exception is thrown.</span></span> <span data-ttu-id="8155f-128">Možná:</span><span class="sxs-lookup"><span data-stu-id="8155f-128">You may:</span></span>  

1. <span data-ttu-id="8155f-129">Rozhodněte, zda chcete klientovi odeslat chybu.</span><span class="sxs-lookup"><span data-stu-id="8155f-129">Decide whether or not to send a fault to the client.</span></span>

2. <span data-ttu-id="8155f-130">Nahraďte výjimku chybou.</span><span class="sxs-lookup"><span data-stu-id="8155f-130">Replace an exception with a fault.</span></span>

3. <span data-ttu-id="8155f-131">Nahraďte chybu jinou chybou.</span><span class="sxs-lookup"><span data-stu-id="8155f-131">Replace a fault with another fault.</span></span>

4. <span data-ttu-id="8155f-132">Proveďte protokolování nebo trasování.</span><span class="sxs-lookup"><span data-stu-id="8155f-132">Perform logging or tracing.</span></span>

5. <span data-ttu-id="8155f-133">Proveďte další vlastní aktivity.</span><span class="sxs-lookup"><span data-stu-id="8155f-133">Perform other custom activities.</span></span>

<span data-ttu-id="8155f-134">Jedna z nich může nainstalovat vlastní obslužnou rutinu chyb přidáním do vlastnosti ErrorHandlers pro odeslání kanálu pro vaši službu.</span><span class="sxs-lookup"><span data-stu-id="8155f-134">One can install a custom error handler by adding it to the ErrorHandlers property of the channel dispatchers for your service.</span></span>  <span data-ttu-id="8155f-135">Je možné mít více než jednu obslužnou rutinu chyb a jsou volány v pořadí, v jakém jsou přidány do této kolekce.</span><span class="sxs-lookup"><span data-stu-id="8155f-135">It is possible to have more than one error handler and they are called in the order they are added to this collection.</span></span>

<span data-ttu-id="8155f-136">IErrorHandler. ProvideFault řídí zprávu o chybě, která je odeslána klientovi.</span><span class="sxs-lookup"><span data-stu-id="8155f-136">IErrorHandler.ProvideFault controls the fault message that is sent to the client.</span></span> <span data-ttu-id="8155f-137">Tato metoda je volána bez ohledu na typ výjimky vyvolané operací ve vaší službě.</span><span class="sxs-lookup"><span data-stu-id="8155f-137">This method is called regardless of the type of the exception thrown by an operation in your service.</span></span> <span data-ttu-id="8155f-138">Pokud zde není provedena žádná operace, WCF předpokládá své výchozí chování a pokračuje, jako kdyby nebyly na svém místě žádné vlastní obslužné rutiny chyb.</span><span class="sxs-lookup"><span data-stu-id="8155f-138">If no operation is performed here, WCF assumes its default behavior and continues as if there were no custom error handlers in place.</span></span>

<span data-ttu-id="8155f-139">Jednou z oblastí, které byste mohli použít tento přístup, je, že chcete vytvořit centrální místo pro převod výjimek na chyby předtím, než jsou odesílány klientovi (zajištění, že instance není uvolněna a kanál není přesunut do stavu selhání).</span><span class="sxs-lookup"><span data-stu-id="8155f-139">One area that you could perhaps use this approach is when you want to create a central place for converting exceptions to faults before they are sent to the client (ensuring that the instance is not disposed and the channel is not moved to the Faulted state).</span></span>

<span data-ttu-id="8155f-140">Metoda IErrorHandler. HandleError se obvykle používá k implementaci chování souvisejícího s chybami, jako je protokolování chyb, systémová oznámení, ukončení aplikace atd. IErrorHandler. HandleError lze volat na více místech uvnitř služby a v závislosti na tom, kde je chyba vyvolána, metoda HandleError může nebo nemusí být volána stejným vláknem jako operace. v tomto ohledu se nevedou žádné záruky.</span><span class="sxs-lookup"><span data-stu-id="8155f-140">The IErrorHandler.HandleError method is usually used to implement error-related behaviors such as error logging, system notifications, shutting down the application, etc. IErrorHandler.HandleError can be called at multiple places inside the service, and depending on where the error is thrown, the HandleError method may or may not be called by the same thread as the operation; no guarantees are made in this regard.</span></span>

## <a name="dealing-with-exceptions-outside-wcf"></a><span data-ttu-id="8155f-141">Obchodování s výjimkami mimo WCF</span><span class="sxs-lookup"><span data-stu-id="8155f-141">Dealing with exceptions outside WCF</span></span>

<span data-ttu-id="8155f-142">V kontextu aplikace WCF se často můžou vyskytovat výjimky konfigurace, výjimky připojovacích řetězců k databázi a jiné podobné výjimky, ale samy nejsou výjimky způsobené modelem služby nebo samotnými webovými službami.</span><span class="sxs-lookup"><span data-stu-id="8155f-142">Often, configuration exceptions, database connection string exceptions, and other similar exceptions may occur within the context of a WCF application, but are themselves are not exceptions caused by the service model or the web service itself.</span></span> <span data-ttu-id="8155f-143">Tyto výjimky jsou "standardními" výjimkami externími pro webovou službu a měly by být zpracovány stejně jako jiné externí výjimky v prostředí.</span><span class="sxs-lookup"><span data-stu-id="8155f-143">These exceptions are "regular" exceptions external to the web service, and should be handled just as other external exceptions in the environment are to be handled.</span></span>

## <a name="tracing-exceptions"></a><span data-ttu-id="8155f-144">Trasování výjimek</span><span class="sxs-lookup"><span data-stu-id="8155f-144">Tracing exceptions</span></span>

<span data-ttu-id="8155f-145">Trasování je jediné místo "catch-All", kde jeden může potenciálně Zobrazit všechny výjimky.</span><span class="sxs-lookup"><span data-stu-id="8155f-145">Tracing is the only "catch-all" place where one can potentially see all exceptions.</span></span> <span data-ttu-id="8155f-146">Další informace o trasování a protokolování výjimek najdete v tématu trasování a protokolování.</span><span class="sxs-lookup"><span data-stu-id="8155f-146">For more information on tracing and logging exceptions, see Tracing and Logging.</span></span>

## <a name="uri-template-errors-when-using-webgetattribute-and-webinvokeattribute"></a><span data-ttu-id="8155f-147">Chyby šablon identifikátoru URI při použití funkce WebGetAttribute a WebInvokeAttribute</span><span class="sxs-lookup"><span data-stu-id="8155f-147">URI template errors when using WebGetAttribute and WebInvokeAttribute</span></span>

<span data-ttu-id="8155f-148">Atributy WebGet a WebInvoke umožňují zadat šablonu identifikátoru URI, která mapuje součásti adresy požadavku na parametry operace.</span><span class="sxs-lookup"><span data-stu-id="8155f-148">The WebGet and WebInvoke attributes allow you to specify a URI template that maps components of the request address to operation parameters.</span></span> <span data-ttu-id="8155f-149">Například šablona identifikátoru URI "počasí/{State}/{City}" mapuje adresu žádosti na literálové tokeny, parametr s názvem State a parametr s názvem City.</span><span class="sxs-lookup"><span data-stu-id="8155f-149">For example, the URI template "weather/{state}/{city}" maps the request address into literal tokens, a parameter named state, and a parameter named city.</span></span> <span data-ttu-id="8155f-150">Tyto parametry je pak možné svázat podle názvu s některými formálními parametry operace.</span><span class="sxs-lookup"><span data-stu-id="8155f-150">These parameters might then be bound by name to some of the formal parameters of the operation.</span></span>

<span data-ttu-id="8155f-151">Parametry šablony se zobrazí ve formě řetězců v identifikátoru URI, zatímco formální parametry typové kontraktu mohou být typy bez řetězců.</span><span class="sxs-lookup"><span data-stu-id="8155f-151">The template parameters appear in the form of strings within the URI while the formal parameters of a typed contract might be of non-string types.</span></span> <span data-ttu-id="8155f-152">Proto je třeba provést převod, aby bylo možné operaci vyvolat.</span><span class="sxs-lookup"><span data-stu-id="8155f-152">Therefore, a conversion needs to take place before the operation can be invoked.</span></span> <span data-ttu-id="8155f-153">[Tabulka formátů převodu](wcf-web-http-programming-model-overview.md) je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="8155f-153">A [table of conversion formats](wcf-web-http-programming-model-overview.md) is available.</span></span>

<span data-ttu-id="8155f-154">Pokud však převod neproběhne úspěšně, neexistuje žádný způsob, jak dát této operaci jistotu, že došlo k nějakému problému.</span><span class="sxs-lookup"><span data-stu-id="8155f-154">However, if the conversion fails, then there's no way to let the operation know that something has gone wrong.</span></span> <span data-ttu-id="8155f-155">Převod typu se místo povrchů ve formě chyby odeslání.</span><span class="sxs-lookup"><span data-stu-id="8155f-155">The type conversion instead surfaces in the form of a dispatch failure.</span></span>

<span data-ttu-id="8155f-156">Selhání odeslání převodu typu lze zkontrolovat stejně jako u mnoha dalších typů selhání odeslání instalací obslužné rutiny chyby.</span><span class="sxs-lookup"><span data-stu-id="8155f-156">A type conversion dispatch failure can be inspected the same as with many other types of dispatch failures by installing an error handler.</span></span> <span data-ttu-id="8155f-157">Bod rozšiřitelnosti IErrorHandler se volá za účelem zpracování výjimek na úrovni služby.</span><span class="sxs-lookup"><span data-stu-id="8155f-157">The IErrorHandler extensibility point is called to handle service-level exceptions.</span></span> <span data-ttu-id="8155f-158">Odtud se dá odpověď odeslat volajícímu a také provádět jakékoli vlastní úkoly a vytváření sestav – může být zvolena.</span><span class="sxs-lookup"><span data-stu-id="8155f-158">From there, the response to be sent back to the caller – as well as perform any custom tasks and reporting – may be chosen.</span></span>

## <a name="see-also"></a><span data-ttu-id="8155f-159">Viz také:</span><span class="sxs-lookup"><span data-stu-id="8155f-159">See also</span></span>

- [<span data-ttu-id="8155f-160">Základní programování WCF</span><span class="sxs-lookup"><span data-stu-id="8155f-160">Basic WCF Programming</span></span>](../basic-wcf-programming.md)
