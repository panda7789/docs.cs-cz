---
title: Omezení distribuce zpráv
ms.date: 03/30/2017
ms.assetid: 8b5ec4b8-1ce9-45ef-bb90-2c840456bcc1
ms.openlocfilehash: 36d9d43760e68f6bcf0099ac17dec5a8278d0e49
ms.sourcegitcommit: 09b4090b78f52fd09b0e430cd4b26576f1fdf96e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/17/2020
ms.locfileid: "76211895"
---
# <a name="limiting-message-distribution"></a><span data-ttu-id="2dede-102">Omezení distribuce zpráv</span><span class="sxs-lookup"><span data-stu-id="2dede-102">Limiting Message Distribution</span></span>

<span data-ttu-id="2dede-103">Rovnocenným kanálem je návrh sítě pro všesměrové vysílání.</span><span class="sxs-lookup"><span data-stu-id="2dede-103">Peer Channel is by design a broadcast mesh.</span></span> <span data-ttu-id="2dede-104">Základní model zahlcení zahrnuje distribuci každé zprávy odeslané jakýmkoli členem sítě do všech ostatních členů této sítě.</span><span class="sxs-lookup"><span data-stu-id="2dede-104">Its basic flooding model involves distributing each message sent by any member of a mesh to all other members of that mesh.</span></span> <span data-ttu-id="2dede-105">To je ideální v situacích, kdy každá zpráva generovaná členem je relevantní a užitečná pro všechny ostatní členy (například chatovací místnosti).</span><span class="sxs-lookup"><span data-stu-id="2dede-105">This is ideal in situations where every message generated by a member is relevant and useful to all other members (for example, a chat room).</span></span> <span data-ttu-id="2dede-106">Mnohé aplikace ale mají příležitostnou nutnost omezit distribuci zpráv.</span><span class="sxs-lookup"><span data-stu-id="2dede-106">However, many applications have an occasional need for limiting message distribution.</span></span> <span data-ttu-id="2dede-107">Například pokud se nový člen připojí k síti a chce načíst poslední zprávu odeslanou prostřednictvím sítě, nemusí být tento požadavek zahlcený každým členem sítě.</span><span class="sxs-lookup"><span data-stu-id="2dede-107">For example, if a new member joins a mesh and wants to retrieve the last message sent through the mesh, this request does not need to be flooded to every member of the mesh.</span></span> <span data-ttu-id="2dede-108">Požadavek může být omezen na okolí sousedů nebo mohou být vyfiltrovány místně generované zprávy. Zprávy je také možné odeslat do samostatného uzlu na síti.</span><span class="sxs-lookup"><span data-stu-id="2dede-108">The request could be limited to near neighbors, or locally generated messages can be filtered out. Messages can also be sent to an individual node on the mesh.</span></span> <span data-ttu-id="2dede-109">Toto téma popisuje použití čítače směrování, filtru šíření zpráv, místního filtru nebo přímého připojení k řízení toho, jak se zprávy předávají v celé síti, a poskytuje obecné pokyny pro výběr přístupu.</span><span class="sxs-lookup"><span data-stu-id="2dede-109">This topic discusses using Hop Count, a Message Propagation Filter, a local filter, or a direct connection to control how messages are forwarded throughout the mesh, and provides general guidelines for choosing an approach.</span></span>

## <a name="hop-counts"></a><span data-ttu-id="2dede-110">Počty segmentů</span><span class="sxs-lookup"><span data-stu-id="2dede-110">Hop Counts</span></span>

<span data-ttu-id="2dede-111">Koncept `PeerHopCount` se podobá hodnotě TTL (Time-to-Live), která se používá v protokolu IP.</span><span class="sxs-lookup"><span data-stu-id="2dede-111">The concept of `PeerHopCount` is similar to TTL (Time-To-Live) used in IP protocol.</span></span> <span data-ttu-id="2dede-112">Hodnota `PeerHopCount` je svázána s instancí zprávy a určuje počet, kolikrát by se měla zpráva před vyřazením přesměrovat.</span><span class="sxs-lookup"><span data-stu-id="2dede-112">The value of `PeerHopCount` is tied to a message instance, and it specifies how many times a message should be forwarded before being dropped.</span></span> <span data-ttu-id="2dede-113">Pokaždé, když klient partnerského kanálu obdrží zprávu, ověří klient zprávu, jestli je zadaný `PeerHopCount`.</span><span class="sxs-lookup"><span data-stu-id="2dede-113">Each time a message is received by a Peer Channel client, the client examines the message to see if `PeerHopCount` is specified.</span></span> <span data-ttu-id="2dede-114">Pokud je zadaný, pak klient sníží hodnotu počet směrování o jednu před předáním zprávy do sousedních uzlů.</span><span class="sxs-lookup"><span data-stu-id="2dede-114">If it is specified, then the client decrements the hop count value by one before forwarding the message to neighboring nodes.</span></span> <span data-ttu-id="2dede-115">Když klient obdrží zprávu s hodnotou čítače směrování nula, klient zprávu zpracuje, ale nepředá zprávu sousedním sousedům.</span><span class="sxs-lookup"><span data-stu-id="2dede-115">When a client receives a message with a hop count value of zero, the client processes the message, but does not forward the message to neighbors.</span></span>

<span data-ttu-id="2dede-116">Počet segmentů směrování lze přidat do zprávy přidáním `PeerHopCount` jako atributu do příslušné vlastnosti nebo pole v implementaci třídy Message.</span><span class="sxs-lookup"><span data-stu-id="2dede-116">Hop count may be added to a message by adding `PeerHopCount` as an attribute to the applicable property or field in the implementation of the message class.</span></span> <span data-ttu-id="2dede-117">Před odesláním zprávy do sítě můžete nastavit konkrétní hodnotu.</span><span class="sxs-lookup"><span data-stu-id="2dede-117">You can set this to a specific value before sending the message to the mesh.</span></span> <span data-ttu-id="2dede-118">Tímto způsobem můžete použít počet segmentů k omezení distribuce zpráv v rámci sítě v případě potřeby, což může zabránit zbytečnému duplikaci zprávy.</span><span class="sxs-lookup"><span data-stu-id="2dede-118">In this manner, you can use hop count to limit distribution of messages throughout the mesh when necessary, potentially avoiding unnecessary message duplication.</span></span> <span data-ttu-id="2dede-119">To je užitečné v případech, kdy síť obsahuje vysoké množství redundantních dat, nebo pro posílání zpráv bezprostředním sousedům nebo pro sousední sítě v několika segmentech směrování.</span><span class="sxs-lookup"><span data-stu-id="2dede-119">This is useful in cases where the mesh contains a high amount of redundant data, or for sending a message to immediate neighbors, or neighbors within a few hops.</span></span>

- <span data-ttu-id="2dede-120">Fragmenty kódu a související informace naleznete v tématu [atribut PeerHopCount: řízení distribuce zprávy](https://docs.microsoft.com/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) na blogu rovnocenného kanálu.</span><span class="sxs-lookup"><span data-stu-id="2dede-120">For code snippets and related information, see the [The PeerHopCount Attribute: Controlling Message Distribution](https://docs.microsoft.com/archive/blogs/peerchan/the-peerhopcount-attribute-controlling-message-distribution) post on the Peer Channel blog.</span></span>

## <a name="message-propagation-filter"></a><span data-ttu-id="2dede-121">Filtr šíření zpráv</span><span class="sxs-lookup"><span data-stu-id="2dede-121">Message Propagation Filter</span></span>

<span data-ttu-id="2dede-122">`MessagePropagationFilter` lze použít pro přizpůsobenou kontrolu zaplavování zpráv, zejména v případě, že obsah zprávy nebo jiné konkrétní scénáře určují šíření.</span><span class="sxs-lookup"><span data-stu-id="2dede-122">`MessagePropagationFilter` can be used for customized control of message flooding, especially when the content of the message or other specific scenarios determine propagation.</span></span> <span data-ttu-id="2dede-123">Filtr provádí rozhodování o šíření každé zprávy, která projde uzlem.</span><span class="sxs-lookup"><span data-stu-id="2dede-123">The filter makes propagation decisions for every message that passes through the node.</span></span> <span data-ttu-id="2dede-124">To platí pro zprávy, které pocházejí jinde v síti, kterou váš uzel přijal, i zprávy vytvořené vaší aplikací.</span><span class="sxs-lookup"><span data-stu-id="2dede-124">This is true for messages that originated elsewhere in the mesh that your node has received as well as messages created by your application.</span></span> <span data-ttu-id="2dede-125">Filtr má přístup ke zprávě i k jejímu původci, takže rozhodnutí o přeposílání nebo vyřazení zprávy můžou být založená na úplných dostupných informacích.</span><span class="sxs-lookup"><span data-stu-id="2dede-125">The filter has access to both the message and its origination, so decisions about forwarding or dropping the message can be based on the full information available.</span></span>

<span data-ttu-id="2dede-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> je základní abstraktní třída s jednou funkcí, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span><span class="sxs-lookup"><span data-stu-id="2dede-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> is a base abstract class with a single function, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span></span> <span data-ttu-id="2dede-127">První argument volání metody předává úplnou kopii zprávy.</span><span class="sxs-lookup"><span data-stu-id="2dede-127">The first argument of the method call passes in a full copy of the message.</span></span> <span data-ttu-id="2dede-128">Jakékoli změny provedené ve zprávě nemají vliv na skutečnou zprávu.</span><span class="sxs-lookup"><span data-stu-id="2dede-128">Any changes made to the message do not affect the actual message.</span></span> <span data-ttu-id="2dede-129">Poslední argument volání metody identifikuje původ zprávy (`PeerMessageOrigination.Local` nebo `PeerMessageOrigination.Remote`).</span><span class="sxs-lookup"><span data-stu-id="2dede-129">The last argument of the method call identifies the origin of the message (`PeerMessageOrigination.Local` or `PeerMessageOrigination.Remote`).</span></span> <span data-ttu-id="2dede-130">Konkrétní implementace této metody musí vracet konstantu z výčtu <xref:System.ServiceModel.PeerMessagePropagation>, což značí, že se zpráva má přesměrovat do místní aplikace (`Local`), přesměrovaná na vzdálené klienty (`Remote`), (`LocalAndRemote`), nebo ani na (`None`).</span><span class="sxs-lookup"><span data-stu-id="2dede-130">Concrete implementations of this method must return a constant from the <xref:System.ServiceModel.PeerMessagePropagation> enumeration indicating that the message is to be forwarded to the local application (`Local`), forwarded to remote clients (`Remote`), both (`LocalAndRemote`), or neither (`None`).</span></span> <span data-ttu-id="2dede-131">Tento filtr lze použít přístupem k odpovídajícímu objektu `PeerNode` a určením instance třídy odvozeného filtru šíření ve vlastnosti `PeerNode.MessagePropagationFilter`.</span><span class="sxs-lookup"><span data-stu-id="2dede-131">This filter can be applied by accessing the corresponding `PeerNode` object and specifying an instance of the derived propagation filter class in the `PeerNode.MessagePropagationFilter` property.</span></span> <span data-ttu-id="2dede-132">Před otevřením rovnocenného kanálu zajistěte, aby byl filtr šíření připojen.</span><span class="sxs-lookup"><span data-stu-id="2dede-132">Ensure that the propagation filter is attached before opening the Peer Channel.</span></span>

- <span data-ttu-id="2dede-133">Fragmenty kódu a související informace najdete na blogu s rovnocenným [kanálem a na MessagePropagationFilter](https://docs.microsoft.com/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) příspěvku na blogu s rovnocenným kanálem.</span><span class="sxs-lookup"><span data-stu-id="2dede-133">For code snippets and related information, see the [Peer Channel and MessagePropagationFilter](https://docs.microsoft.com/archive/blogs/peerchan/peer-channel-and-messagepropagationfilter) post on the Peer Channel blog.</span></span>

## <a name="contacting-an-individual-node-in-the-mesh"></a><span data-ttu-id="2dede-134">Kontaktování jednotlivého uzlu v síti</span><span class="sxs-lookup"><span data-stu-id="2dede-134">Contacting an Individual Node in the Mesh</span></span>

<span data-ttu-id="2dede-135">Jednotlivé uzly v síti je možné kontaktovat nastavením místního filtru nebo nastavením přímého připojení.</span><span class="sxs-lookup"><span data-stu-id="2dede-135">An individual node in a mesh can be contacted by setting up a local filter, or by setting up a direct connection.</span></span>

<span data-ttu-id="2dede-136">Pokud mají uzly v síti jednotlivá ID, může být v implementaci vaší zprávy zadáno ID cíle.</span><span class="sxs-lookup"><span data-stu-id="2dede-136">If the nodes in a mesh each have an individual ID, a destination ID can be specified in the implementation of your message.</span></span> <span data-ttu-id="2dede-137">Místní filtr se dá nastavit tak, že v kontraktu zprávy napíšete funkci, která zobrazí zprávu jenom na aktuálním uzlu, pokud jeho ID odpovídá cílovému ID, které jste zadali.</span><span class="sxs-lookup"><span data-stu-id="2dede-137">A local filter can be set up by writing a function in your message contract that will only display the message to the current node if its ID matches the destination ID you specified.</span></span> <span data-ttu-id="2dede-138">Síť přemění zprávu, takže režijní náklady na nastavení nového připojení nemusí být účtovány.</span><span class="sxs-lookup"><span data-stu-id="2dede-138">The mesh transports the message, so the overhead of setting up a new connection does not have to be incurred.</span></span> <span data-ttu-id="2dede-139">Nicméně dojde ke ztrátě efektivity, protože zpráva je v celé síti posílána mnohokrát.</span><span class="sxs-lookup"><span data-stu-id="2dede-139">However, there is a loss of efficiency since the message is sent many times throughout the mesh.</span></span> <span data-ttu-id="2dede-140">To je vhodné pro posílání zpráv jednotlivým členům sítě, pokud zprávy nejsou příliš velké ani příliš časté.</span><span class="sxs-lookup"><span data-stu-id="2dede-140">This works well for sending messages to individual members of a mesh as long as the messages are neither too big nor too frequent.</span></span>

<span data-ttu-id="2dede-141">Pro dlouhodobá připojení s vysokou šířkou pásma jsou vhodnější přímá připojení.</span><span class="sxs-lookup"><span data-stu-id="2dede-141">For long-lasting, high-bandwidth connections, direct connections are preferable.</span></span> <span data-ttu-id="2dede-142">Můžete odesílat informace o připojení přes síť a pak nastavit přímé připojení k vašemu výběru pro odesílání a příjem zpráv.</span><span class="sxs-lookup"><span data-stu-id="2dede-142">You can send connection information over the mesh, and then set up a direct connection of your choosing to send/receive messages.</span></span>

## <a name="choosing-an-approach-for-limiting-message-distribution"></a><span data-ttu-id="2dede-143">Výběr přístupu k omezení distribuce zpráv</span><span class="sxs-lookup"><span data-stu-id="2dede-143">Choosing an Approach for Limiting Message Distribution</span></span>

<span data-ttu-id="2dede-144">Když zjistíte situaci, kdy potřebujete omezit distribuci zpráv, položte si následující otázky:</span><span class="sxs-lookup"><span data-stu-id="2dede-144">When you discover a scenario in which you need to limit message distribution, ask yourself the following questions:</span></span>

- <span data-ttu-id="2dede-145">**Kdo** potřebuje zprávu přijmout?</span><span class="sxs-lookup"><span data-stu-id="2dede-145">**Who** needs to receive the message?</span></span> <span data-ttu-id="2dede-146">Jenom jeden sousední uzel?</span><span class="sxs-lookup"><span data-stu-id="2dede-146">Just one neighbor node?</span></span> <span data-ttu-id="2dede-147">Uzel někam jinde v síti?</span><span class="sxs-lookup"><span data-stu-id="2dede-147">A node somewhere else in the mesh?</span></span> <span data-ttu-id="2dede-148">Polovinu sítě?</span><span class="sxs-lookup"><span data-stu-id="2dede-148">Half the mesh?</span></span>

- <span data-ttu-id="2dede-149">**Jak často** bude tato zpráva odeslána?</span><span class="sxs-lookup"><span data-stu-id="2dede-149">**How often** will this message be sent?</span></span>

- <span data-ttu-id="2dede-150">Jaký druh **šířky pásma** bude tato zpráva používat?</span><span class="sxs-lookup"><span data-stu-id="2dede-150">What kind of **bandwidth** will this message use?</span></span>

<span data-ttu-id="2dede-151">Odpovědi na tyto otázky vám pomůžou určit, jestli se má použít počet segmentů směrování, filtr šíření zpráv, místní filtr nebo přímé připojení.</span><span class="sxs-lookup"><span data-stu-id="2dede-151">The answers to these questions can help you determine whether to use Hop Count, a Message Propagation Filter, a local filter, or a direct connection.</span></span> <span data-ttu-id="2dede-152">Vezměte v úvahu následující obecné pokyny:</span><span class="sxs-lookup"><span data-stu-id="2dede-152">Consider the following general guidelines:</span></span>

- <span data-ttu-id="2dede-153">**Kdo**</span><span class="sxs-lookup"><span data-stu-id="2dede-153">**Who**</span></span>

  - <span data-ttu-id="2dede-154">*Jednotlivý uzel*: místní filtr nebo přímé připojení.</span><span class="sxs-lookup"><span data-stu-id="2dede-154">*Individual node*:  Local filter or direct connection.</span></span>

  - <span data-ttu-id="2dede-155">*Okolí v rámci určitého okolí*: PeerHopCount.</span><span class="sxs-lookup"><span data-stu-id="2dede-155">*Neighbors within a certain vicinity*:  PeerHopCount.</span></span>

  - <span data-ttu-id="2dede-156">*Složitá podmnožina sítě*: MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="2dede-156">*Complex subset of the mesh*:  MessagePropagationFilter.</span></span>

- <span data-ttu-id="2dede-157">**Jak často**</span><span class="sxs-lookup"><span data-stu-id="2dede-157">**How often**</span></span>

  - <span data-ttu-id="2dede-158">*Velmi časté*: přímé připojení, PeerHopCount, MessagePropagationFilter.</span><span class="sxs-lookup"><span data-stu-id="2dede-158">*Very frequent*:  Direct connection, PeerHopCount, MessagePropagationFilter.</span></span>

  - <span data-ttu-id="2dede-159">*Příležitostné*: místní filtr.</span><span class="sxs-lookup"><span data-stu-id="2dede-159">*Occasional*:  Local filter.</span></span>

- <span data-ttu-id="2dede-160">**Využití šířky pásma**</span><span class="sxs-lookup"><span data-stu-id="2dede-160">**Bandwidth use**</span></span>

  - <span data-ttu-id="2dede-161">*Vysoká*: přímé připojení, méně vhodné pro použití MessagePropagationFilter nebo místního filtru.</span><span class="sxs-lookup"><span data-stu-id="2dede-161">*High*:  Direct connection, less advisable to use MessagePropagationFilter or local filter.</span></span>

  - <span data-ttu-id="2dede-162">*Nízká*: jakékoli přímé připojení pravděpodobně není potřeba.</span><span class="sxs-lookup"><span data-stu-id="2dede-162">*Low*:  Any, direct connection probably not needed.</span></span>

## <a name="see-also"></a><span data-ttu-id="2dede-163">Viz také:</span><span class="sxs-lookup"><span data-stu-id="2dede-163">See also</span></span>

- [<span data-ttu-id="2dede-164">Vytvoření aplikace protokolu Peer Channel</span><span class="sxs-lookup"><span data-stu-id="2dede-164">Building a Peer Channel Application</span></span>](../../../../docs/framework/wcf/feature-details/building-a-peer-channel-application.md)
