---
title: Zabezpečení zpráv
ms.date: 03/30/2017
ms.assetid: a17ebe67-836b-4c52-9a81-2c3d58e225ee
ms.openlocfilehash: 1098057042c0842161258fd081d3ee63e82b4c5f
ms.sourcegitcommit: 2e95559d957a1a942e490c5fd916df04b39d73a9
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/16/2019
ms.locfileid: "72395706"
---
# <a name="securing-messages-using-message-security"></a><span data-ttu-id="0a2bf-102">Zabezpečení zpráv</span><span class="sxs-lookup"><span data-stu-id="0a2bf-102">Securing Messages Using Message Security</span></span>
<span data-ttu-id="0a2bf-103">Tato část popisuje zabezpečení zpráv WCF při použití <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-103">This section discusses WCF message security when using <xref:System.ServiceModel.NetMsmqBinding>.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="0a2bf-104">Než si přečtete toto téma, doporučujeme, abyste si přečetli [koncepty zabezpečení](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span><span class="sxs-lookup"><span data-stu-id="0a2bf-104">Before reading through this topic, it is recommended that you read [Security Concepts](../../../../docs/framework/wcf/feature-details/security-concepts.md).</span></span>  
  
 <span data-ttu-id="0a2bf-105">Následující ilustrace poskytuje koncepční model komunikace ve frontě pomocí WCF.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-105">The following illustration provides a conceptual model of queued communication using WCF.</span></span> <span data-ttu-id="0a2bf-106">Tato ilustrace a terminologie slouží k vysvětlení</span><span class="sxs-lookup"><span data-stu-id="0a2bf-106">This illustration and terminology are used to explain</span></span>  
  
 <span data-ttu-id="0a2bf-107">Koncepce zabezpečení přenosu.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-107">transport security concepts.</span></span>  
  
 <span data-ttu-id="0a2bf-108">![Diagram aplikace ve frontě](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distribuované – fronta – obrázek")</span><span class="sxs-lookup"><span data-stu-id="0a2bf-108">![Queued Application Diagram](../../../../docs/framework/wcf/feature-details/media/distributed-queue-figure.jpg "Distributed-Queue-Figure")</span></span>  
  
 <span data-ttu-id="0a2bf-109">Při odesílání zpráv zařazených do fronty pomocí WCF je zpráva WCF připojena jako tělo zprávy služby Řízení front zpráv (MSMQ).</span><span class="sxs-lookup"><span data-stu-id="0a2bf-109">When sending queued messages using WCF, the WCF message is attached as a body of the Message Queuing (MSMQ) message.</span></span> <span data-ttu-id="0a2bf-110">I když zabezpečení přenosu zabezpečuje celou zprávu služby MSMQ, zabezpečení zprávy (nebo protokolu SOAP) zabezpečuje pouze tělo zprávy služby MSMQ.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-110">While transport security secures the entire MSMQ message, message (or SOAP) security only secures the body of the MSMQ message.</span></span>  
  
 <span data-ttu-id="0a2bf-111">Klíčovým konceptem zabezpečení zpráv je, že klient zabezpečuje zprávu pro přijímající aplikaci (službu), na rozdíl od zabezpečení přenosu, kde klient zabezpečuje zprávu pro cílovou frontu.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-111">The key concept of message security is that the client secures the message for the receiving application (service), unlike transport security where the client secures the message for the Target Queue.</span></span> <span data-ttu-id="0a2bf-112">V takovém případě služba MSMQ nehraje žádnou součást při zabezpečení zprávy WCF pomocí zabezpečení zpráv.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-112">As such, MSMQ plays no part when securing the WCF message using message security.</span></span>  
  
 <span data-ttu-id="0a2bf-113">Zabezpečení zpráv WCF přidává záhlaví zabezpečení do zprávy WCF, která se integruje s existujícími infrastrukturami zabezpečení, jako je certifikát nebo protokol Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-113">WCF message security adds security headers to the WCF message that integrate with existing security infrastructures, such as a certificate or the Kerberos protocol.</span></span>  
  
## <a name="message-credential-type"></a><span data-ttu-id="0a2bf-114">Typ přihlašovacích údajů zprávy</span><span class="sxs-lookup"><span data-stu-id="0a2bf-114">Message Credential Type</span></span>  
 <span data-ttu-id="0a2bf-115">Pomocí zabezpečení zpráv můžou služby a klienti zadat přihlašovací údaje pro jiné ověřování.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-115">Using message security, the service and client can present credentials to authenticate each another.</span></span> <span data-ttu-id="0a2bf-116">Můžete vybrat zabezpečení zprávy nastavením režimu <xref:System.ServiceModel.NetMsmqBinding.Security%2A> na `Message` nebo `Both` (to znamená zabezpečení přenosu i zabezpečení zpráv).</span><span class="sxs-lookup"><span data-stu-id="0a2bf-116">You can select message security by setting the <xref:System.ServiceModel.NetMsmqBinding.Security%2A> mode to `Message` or `Both` (that is, use both transport security and message security).</span></span>  
  
 <span data-ttu-id="0a2bf-117">Služba může pomocí vlastnosti <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> zkontrolovat přihlašovací údaje používané k ověřování klienta.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-117">The service can use the <xref:System.ServiceModel.ServiceSecurityContext.Current%2A> property to inspect the credential used to authenticate the client.</span></span> <span data-ttu-id="0a2bf-118">Tato možnost se dá použít taky k dalším kontrolám autorizace, které služba zvolí k implementaci.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-118">This can also be used for further authorization checks that the service chooses to implement.</span></span>  
  
 <span data-ttu-id="0a2bf-119">V této části jsou vysvětleny různé typy přihlašovacích údajů a jejich použití s frontami.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-119">This section explains the different credential types and how to use them with queues.</span></span>  
  
### <a name="certificate"></a><span data-ttu-id="0a2bf-120">Certifikát</span><span class="sxs-lookup"><span data-stu-id="0a2bf-120">Certificate</span></span>  
 <span data-ttu-id="0a2bf-121">Typ přihlašovacích údajů certifikátu používá k identifikaci služby a klienta certifikát X. 509.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-121">The certificate credential type uses an X.509 certificate to identify the service and the client.</span></span>  
  
 <span data-ttu-id="0a2bf-122">V typickém scénáři klient a služba vydávají platný certifikát důvěryhodnou certifikační autoritou.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-122">In a typical scenario, the client and the service are issued a valid certificate by a trusted certification authority.</span></span> <span data-ttu-id="0a2bf-123">Pak se připojení naváže, klient ověří platnost služby pomocí certifikátu služby a určí, jestli může službu důvěřovat.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-123">Then the connection is established, the client authenticates the validity of the service using the service's certificate to decide whether it can trust the service.</span></span> <span data-ttu-id="0a2bf-124">Podobně služba používá certifikát klienta k ověření vztahu důvěryhodnosti klienta.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-124">Similarly, the service uses the client's certificate to validate the client trust.</span></span>  
  
 <span data-ttu-id="0a2bf-125">Vzhledem k odpojené povaze front nemusí být klient a služba online ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-125">Given the disconnected nature of queues, the client and the service may not be online at the same time.</span></span> <span data-ttu-id="0a2bf-126">V takovém případě musí klient a služba vyměňovat certifikáty vzdáleně.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-126">As such, the client and service have to exchange certificates out-of-band.</span></span> <span data-ttu-id="0a2bf-127">Konkrétně je potřeba, aby klient na základě držení certifikátu služby (který může být zřetězený k certifikační autoritě) ve svém důvěryhodném úložišti důvěřoval, že komunikuje se správnou službou.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-127">In particular, the client, by virtue of holding the service's certificate (which can be chained to a certification authority) in its trusted store, must trust that it is communicating with the correct service.</span></span> <span data-ttu-id="0a2bf-128">Pro ověřování klienta používá služba k ověření pravosti klienta certifikát X. 509 připojený ke zprávě, aby se shodoval s certifikátem v úložišti.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-128">For authenticating the client, the service uses the X.509 certificate attached with the message to matches it with the certificate in its store to verify the authenticity of the client.</span></span> <span data-ttu-id="0a2bf-129">Certifikát musí být znovu zřetězený s certifikační autoritou.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-129">Again, the certificate must be chained to a certification authority.</span></span>  
  
 <span data-ttu-id="0a2bf-130">V počítači se systémem Windows jsou certifikáty uchovávány v několika druzích úložišť.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-130">On a computer running Windows, certificates are held in several kinds of stores.</span></span> <span data-ttu-id="0a2bf-131">Další informace o různých úložištích najdete v tématu [úložiště certifikátů](https://go.microsoft.com/fwlink/?LinkId=87787).</span><span class="sxs-lookup"><span data-stu-id="0a2bf-131">For more information about the different stores, see [Certificate stores](https://go.microsoft.com/fwlink/?LinkId=87787).</span></span>  
  
### <a name="windows"></a><span data-ttu-id="0a2bf-132">Windows</span><span class="sxs-lookup"><span data-stu-id="0a2bf-132">Windows</span></span>  
 <span data-ttu-id="0a2bf-133">Typ přihlašovacích údajů zprávy systému Windows používá protokol Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-133">Windows message credential type uses the Kerberos protocol.</span></span>  
  
 <span data-ttu-id="0a2bf-134">Protokol Kerberos je bezpečnostní mechanismus, který ověřuje uživatele v doméně a umožňuje ověřeným uživatelům vytvářet zabezpečené kontexty s jinými entitami v doméně.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-134">The Kerberos protocol is a security mechanism that authenticates users on a domain and allows the authenticated users to establish secure contexts with other entities on a domain.</span></span>  
  
 <span data-ttu-id="0a2bf-135">Problém s používáním protokolu Kerberos pro komunikaci ve frontě je, že lístky obsahující identitu klienta, které jsou distribuovány služba KDC (Key Distribution Center) (KDC), jsou poměrně krátkodobé.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-135">The problem with using the Kerberos protocol for queued communication is that the tickets that contain client identity that the Key Distribution Center (KDC) distributes are relatively short-lived.</span></span> <span data-ttu-id="0a2bf-136">K lístku Kerberos, který označuje platnost lístku, je přidružená *Doba života* .</span><span class="sxs-lookup"><span data-stu-id="0a2bf-136">A *lifetime* is associated with the Kerberos ticket that indicates the validity of the ticket.</span></span> <span data-ttu-id="0a2bf-137">V takovém případě s vysokou latencí nemůžete mít jistotu, že je token stále platný pro službu, která ověřuje klienta.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-137">As such, given high latency, you cannot be sure that the token is still valid for the service that authenticates the client.</span></span>  
  
 <span data-ttu-id="0a2bf-138">Všimněte si, že při použití tohoto typu pověření musí služba běžet pod účtem služby.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-138">Note that when using this credential type, the service must be running under the SERVICE account.</span></span>  
  
 <span data-ttu-id="0a2bf-139">Protokol Kerberos se ve výchozím nastavení používá při výběru přihlašovacích údajů zprávy.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-139">The Kerberos protocol is used by default when choosing message credential.</span></span>
  
### <a name="username-password"></a><span data-ttu-id="0a2bf-140">Heslo pro uživatelské jméno</span><span class="sxs-lookup"><span data-stu-id="0a2bf-140">Username Password</span></span>  
 <span data-ttu-id="0a2bf-141">Pomocí této vlastnosti může klient ověřit server pomocí hesla uživatele v záhlaví zabezpečení zprávy.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-141">Using this property, the client can authenticate to the server using a username password in the security header of the message.</span></span>  
  
### <a name="issuedtoken"></a><span data-ttu-id="0a2bf-142">Třídy IssuedToken</span><span class="sxs-lookup"><span data-stu-id="0a2bf-142">IssuedToken</span></span>  
 <span data-ttu-id="0a2bf-143">Klient může použít službu tokenu zabezpečení k vydání tokenu, který je možné připojit ke zprávě, aby mohl ověřit klienta.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-143">The client can use the security token service to issue a token that can then be attached to the message for the service to authenticate the client.</span></span>  
  
## <a name="using-transport-and-message-security"></a><span data-ttu-id="0a2bf-144">Použití přenosu a zabezpečení zpráv</span><span class="sxs-lookup"><span data-stu-id="0a2bf-144">Using Transport and Message Security</span></span>  
 <span data-ttu-id="0a2bf-145">Při použití zabezpečení přenosů a zabezpečení zpráv musí být certifikát použitý k zabezpečení zprávy jak v přenosu, tak i v úrovni zprávy protokolu SOAP.</span><span class="sxs-lookup"><span data-stu-id="0a2bf-145">When using both transport security and message security, the certificate used to secure the message both at the transport and the SOAP message level must be the same.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0a2bf-146">Viz také:</span><span class="sxs-lookup"><span data-stu-id="0a2bf-146">See also</span></span>

- [<span data-ttu-id="0a2bf-147">Zabezpečení zpráv pomocí zabezpečení přenosu</span><span class="sxs-lookup"><span data-stu-id="0a2bf-147">Securing Messages Using Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/securing-messages-using-transport-security.md)
- [<span data-ttu-id="0a2bf-148">Zabezpečení zprávy pomocí služby Řízení front zpráv</span><span class="sxs-lookup"><span data-stu-id="0a2bf-148">Message Security over Message Queuing</span></span>](../../../../docs/framework/wcf/samples/message-security-over-message-queuing.md)
- [<span data-ttu-id="0a2bf-149">Koncepty zabezpečení</span><span class="sxs-lookup"><span data-stu-id="0a2bf-149">Security Concepts</span></span>](../../../../docs/framework/wcf/feature-details/security-concepts.md)
- [<span data-ttu-id="0a2bf-150">Zabezpečení služeb a klientů</span><span class="sxs-lookup"><span data-stu-id="0a2bf-150">Securing Services and Clients</span></span>](../../../../docs/framework/wcf/feature-details/securing-services-and-clients.md)
