---
title: Doporučené postupy pro zabezpečení ve WCF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- best practices [WCF], security
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
author: BrucePerlerMS
ms.openlocfilehash: a45ec6b5cdd241cb92069e8097bc94baa65b2166
ms.sourcegitcommit: 213292dfbb0c37d83f62709959ff55c50af5560d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/25/2018
ms.locfileid: "47075620"
---
# <a name="best-practices-for-security-in-wcf"></a><span data-ttu-id="e8ef7-102">Doporučené postupy pro zabezpečení ve WCF</span><span class="sxs-lookup"><span data-stu-id="e8ef7-102">Best Practices for Security in WCF</span></span>
<span data-ttu-id="e8ef7-103">V následujících částech jsou osvědčené postupy, které je třeba zvážit při vytváření zabezpečených aplikací pomocí služby Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="e8ef7-103">The following sections list the best practices to consider when creating secure applications using Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="e8ef7-104">Další informace o zabezpečení najdete v tématu [aspekty zabezpečení](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [aspekty zabezpečení pro Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), a [informace o zabezpečení metadat](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="e8ef7-104">For more information about security, see [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), and [Security Considerations with Metadata](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span></span>  
  
## <a name="identify-services-performing-windows-authentication-with-spns"></a><span data-ttu-id="e8ef7-105">Identifikace služeb ověřování Windows s hlavní názvy služby</span><span class="sxs-lookup"><span data-stu-id="e8ef7-105">Identify Services Performing Windows Authentication with SPNs</span></span>  
 <span data-ttu-id="e8ef7-106">Služby lze identifikovat s hlavní názvy uživatelů (UPN) nebo hlavní názvy služby (SPN).</span><span class="sxs-lookup"><span data-stu-id="e8ef7-106">Services can be identified with either user principal names (UPNs) or service principal names (SPNs).</span></span> <span data-ttu-id="e8ef7-107">Služby spuštěné pod účty počítače, například Síťová služba mají hlavní název služby identity odpovídající počítač, na kterém běží.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-107">Services running under machine accounts such as network service have an SPN identity corresponding to the machine they're running.</span></span> <span data-ttu-id="e8ef7-108">Služby spuštěné v rámci uživatelské účty mají identita UPN odpovídající uživatel spuštěnými jako, i když `setspn` nástroj je možné přiřadit název SPN pro uživatelský účet.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-108">Services running under user accounts have a UPN identity corresponding to the user they're running as, although the `setspn` tool can be used to assign an SPN to the user account.</span></span> <span data-ttu-id="e8ef7-109">Konfigurace služby, tak ho lze identifikovat pomocí hlavního názvu služby a konfiguraci klientů připojuje ke službě, aby používali tuto hlavního názvu služby mohl provádět určité útokům obtížnější.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-109">Configuring a service so it can be identified via SPN and configuring the clients connecting to the service to use that SPN can make certain attacks more difficult.</span></span> <span data-ttu-id="e8ef7-110">Tento návod se vztahuje na vazby, které používají vyjednávání protokolu Kerberos nebo SSPI.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-110">This guidance applies to bindings using Kerberos or SSPI negotiation.</span></span>  <span data-ttu-id="e8ef7-111">Klienti byste specifikovat název SPN v případě, kdy SSPI spadne zpět na protokol NTLM.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-111">Clients should still specify an SPN in the case where SSPI falls back to NTLM.</span></span>  
  
## <a name="verify-service-identities-in-wsdl"></a><span data-ttu-id="e8ef7-112">Ověření identity služby ve WSDL</span><span class="sxs-lookup"><span data-stu-id="e8ef7-112">Verify Service Identities in WSDL</span></span>  
 <span data-ttu-id="e8ef7-113">WS-SecurityPolicy umožňuje službám pro zveřejnění informací o svoje vlastní identity v metadatech.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-113">WS-SecurityPolicy allows services to publish information about their own identities in metadata.</span></span> <span data-ttu-id="e8ef7-114">Při načítání prostřednictvím `svcutil` nebo jiné metody, jako <xref:System.ServiceModel.Description.WsdlImporter>, tato informace o identitě se přeloží na vlastnosti identity adresy koncových bodů služby WCF.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-114">When retrieved via `svcutil` or other methods such as <xref:System.ServiceModel.Description.WsdlImporter>, this identity information is translated to the identity properties of the WCF service endpoint addresses.</span></span> <span data-ttu-id="e8ef7-115">Klientů, kteří Neověřovat, že tyto identity služby jsou správné a platný efektivně se nebude používat ověřování služby.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-115">Clients which do not verify that these service identities are correct and valid effectively bypass service authentication.</span></span> <span data-ttu-id="e8ef7-116">Škodlivé služby budou moci zneužít tyto klienty k provedení předávání přihlašovacích údajů a dalších útoků "man in the middle" tak, že změníte identitu uplatněné ve své WSDL.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-116">A malicious service can exploit such clients to execute credential forwarding and other "man in the middle" attacks by changing the identity claimed in its WSDL.</span></span>  
  
## <a name="use-x509-certificates-instead-of-ntlm"></a><span data-ttu-id="e8ef7-117">Používat X509 certifikáty místo protokolu NTLM</span><span class="sxs-lookup"><span data-stu-id="e8ef7-117">Use X509 Certificates Instead of NTLM</span></span>  
 <span data-ttu-id="e8ef7-118">WCF nabízí dva mechanismy ověřování peer-to-peer: X509 certifikáty (používané protokolu peer channel) a ověřování Windows, ve kterém vyjednávání SSPI změní úroveň z protokolu Kerberos k ověřování NTLM.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-118">WCF offers two mechanisms for peer-to-peer authentication: X509 certificates (used by peer channel) and Windows authentication where an SSPI negotiation downgrades from Kerberos to NTLM.</span></span>  <span data-ttu-id="e8ef7-119">Ověřování pomocí certifikátů pomocí velikostí klíče 1 024 bitů nebo více je upřednostňována před NTLM z několika důvodů:</span><span class="sxs-lookup"><span data-stu-id="e8ef7-119">Certificate-based authentication using key sizes of 1024 bits or more is preferred to NTLM for several reasons:</span></span>  
  
-   <span data-ttu-id="e8ef7-120">dostupnost vzájemného ověřování</span><span class="sxs-lookup"><span data-stu-id="e8ef7-120">the availability of mutual authentication,</span></span>  
  
-   <span data-ttu-id="e8ef7-121">Použijte silnější kryptografické algoritmy a</span><span class="sxs-lookup"><span data-stu-id="e8ef7-121">the use of stronger cryptographic algorithms, and</span></span>  
  
-   <span data-ttu-id="e8ef7-122">větší potíže využití předané X509 přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-122">the greater difficulty of utilizing forwarded X509 credentials.</span></span>  
   
## <a name="always-revert-after-impersonation"></a><span data-ttu-id="e8ef7-123">Po zosobnění se vždycky vrátit</span><span class="sxs-lookup"><span data-stu-id="e8ef7-123">Always Revert After Impersonation</span></span>  
 <span data-ttu-id="e8ef7-124">Při použití rozhraní API vám umožní zosobnění klienta, je potřeba vrátit zpět na původní identitu.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-124">When using APIs that enable impersonation of a client, be sure to revert to the original identity.</span></span> <span data-ttu-id="e8ef7-125">Například při použití <xref:System.Security.Principal.WindowsIdentity> a <xref:System.Security.Principal.WindowsImpersonationContext>, pomocí C# `using` příkazu nebo Visual Basic`Using` příkaz, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-125">For example, when using the <xref:System.Security.Principal.WindowsIdentity> and <xref:System.Security.Principal.WindowsImpersonationContext>, use the C# `using` statement or the Visual Basic`Using` statement, as shown in the following code.</span></span> <span data-ttu-id="e8ef7-126"><xref:System.Security.Principal.WindowsImpersonationContext> Implementuje třída <xref:System.IDisposable> rozhraní a proto common language runtime (CLR) se automaticky vrátí původní identitu jakmile opustí kód `using` bloku.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-126">The <xref:System.Security.Principal.WindowsImpersonationContext> class implements the <xref:System.IDisposable> interface, and therefore the common language runtime (CLR) automatically reverts to the original identity once the code leaves the `using` block.</span></span>  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## <a name="impersonate-only-as-needed"></a><span data-ttu-id="e8ef7-127">Zosobnění pouze v případě potřeby</span><span class="sxs-lookup"><span data-stu-id="e8ef7-127">Impersonate Only as Needed</span></span>  
 <span data-ttu-id="e8ef7-128">Použití <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> metodu <xref:System.Security.Principal.WindowsIdentity> třídy, je možné použít zosobnění ve velmi řízené oboru.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-128">Using the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method of the <xref:System.Security.Principal.WindowsIdentity> class, it is possible to use impersonation in a very controlled scope.</span></span> <span data-ttu-id="e8ef7-129">To se liší od použití <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> vlastnost <xref:System.ServiceModel.OperationBehaviorAttribute>, který umožňuje zosobnění pro obor celá operace.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-129">This is in contrast to using the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute>, which allows impersonation for the scope of the entire operation.</span></span> <span data-ttu-id="e8ef7-130">Kdykoli je to možné, řízení rozsahu zosobnění s použitím více přesné <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-130">Whenever possible, control the scope of impersonation by using the more precise <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method.</span></span>  
  
## <a name="obtain-metadata-from-trusted-sources"></a><span data-ttu-id="e8ef7-131">Získat Metadata z důvěryhodných zdrojů</span><span class="sxs-lookup"><span data-stu-id="e8ef7-131">Obtain Metadata from Trusted Sources</span></span>  
 <span data-ttu-id="e8ef7-132">Ujistěte se, že důvěřujete jeho zdroji metadata a ujistěte se, že nikdo nemanipuloval s metadaty.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-132">Be sure you trust the source of your metadata and make sure that no one has tampered with the metadata.</span></span> <span data-ttu-id="e8ef7-133">Metadata načten pomocí protokolu HTTP se odesílá ve formátu prostého textu a mohou být změněny.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-133">Metadata retrieved using the HTTP protocol is sent in clear text and can be tampered with.</span></span> <span data-ttu-id="e8ef7-134">Pokud služba používá <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> a <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> vlastnosti, použijte adresu URL poskytnutou Tvůrce služby ke stahování dat pomocí protokolu HTTPS.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-134">If the service uses the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> and <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> properties, use the URL supplied by the service creator to download the data using the HTTPS protocol.</span></span>  
  
## <a name="publish-metadata-using-security"></a><span data-ttu-id="e8ef7-135">Publikování metadat pomocí zabezpečení</span><span class="sxs-lookup"><span data-stu-id="e8ef7-135">Publish Metadata Using Security</span></span>  
 <span data-ttu-id="e8ef7-136">Chcete-li zabránit manipulaci s publikovaných metadat služby, zabezpečený koncový bod metadat exchange s přenosu nebo zabezpečení na úrovni zprávy.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-136">To prevent tampering with a service's published metadata, secure the metadata exchange endpoint with transport or message-level security.</span></span> <span data-ttu-id="e8ef7-137">Další informace najdete v tématu [publikování kocových bodů metadat](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) a [postupy: publikování metadat služby pomocí kódu](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="e8ef7-137">For more information, see [Publishing Metadata Endpoints](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) and [How to: Publish Metadata for a Service Using Code](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span></span>  
  
## <a name="ensure-use-of-local-issuer"></a><span data-ttu-id="e8ef7-138">Zkontrolujte použití místního vystavitele</span><span class="sxs-lookup"><span data-stu-id="e8ef7-138">Ensure Use of Local Issuer</span></span>  
 <span data-ttu-id="e8ef7-139">Případného vystavitele adresu a vazbu jsou pro danou vazbu lokálního vystavitele se nepoužije pro koncové body, které tuto vazbu používají.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-139">If an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.</span></span> <span data-ttu-id="e8ef7-140">Klienti, kteří očekávají, že vždy používejte lokálního vystavitele zajistil nepoužívají takovou vazbu nebo jejich změňte vazbu tak, aby adresa Vystavitel je null.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-140">Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding such that the issuer address is null.</span></span>  
  
## <a name="saml-token-size-quotas"></a><span data-ttu-id="e8ef7-141">Kvóty velikost tokenu SAML</span><span class="sxs-lookup"><span data-stu-id="e8ef7-141">SAML Token Size Quotas</span></span>  
 <span data-ttu-id="e8ef7-142">Při tokeny zabezpečení kontrolní výrazy SAML (Markup Language) serializují ve zprávách, když jsou vydány službou tokenu služby zabezpečení (STS) nebo když se klienti k dispozici je ke službám jako součást ověření, maximální kvóta velikosti zprávy musí být dostatečně k tomuto tokenu SAML a další části zprávy dostačující.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-142">When Security Assertions Markup Language (SAML) tokens are serialized in messages, either when they are issued by a Security Token Service (STS) or when clients present them to services as part of authentication, the maximum message size quota must be sufficiently large to accommodate the SAML token and the other message parts.</span></span> <span data-ttu-id="e8ef7-143">V případech, normální postačí výchozí kvóty velikosti zprávy.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-143">In normal cases, the default message size quotas are sufficient.</span></span> <span data-ttu-id="e8ef7-144">Ale v případech, kdy je SAML token velké vzhledem k tomu, že obsahuje stovky deklarace identity, kvót by měl být skutečnost zohlednit zvýšením serializovaný token.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-144">However, in cases where a SAML token is large because it contains hundreds of claims, the quotas should be increased to accommodate the serialized token.</span></span> <span data-ttu-id="e8ef7-145">Další informace o kvótách najdete v tématu [aspekty zabezpečení pro Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="e8ef7-145">For more information about quotas, see [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span></span>  
  
## <a name="set-securitybindingelementincludetimestamp-to-true-on-custom-bindings"></a><span data-ttu-id="e8ef7-146">SecurityBindingElement.IncludeTimestamp nastavena na hodnotu True na vlastních vazeb</span><span class="sxs-lookup"><span data-stu-id="e8ef7-146">Set SecurityBindingElement.IncludeTimestamp to True on Custom Bindings</span></span>  
 <span data-ttu-id="e8ef7-147">Při vytváření vlastní vazby, je nutné nastavit <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> k `true`.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-147">When you create a custom binding, you must set <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> to `true`.</span></span> <span data-ttu-id="e8ef7-148">Jinak, pokud <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> je nastavena na `false`, a že klient používá asymetrické na základě klíčů token jako je například x X509 certifikát, zprávy nebude podepsán.</span><span class="sxs-lookup"><span data-stu-id="e8ef7-148">Otherwise, if <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> is set to `false`, and the client is using an asymmetric key-based token such as an X509 certificate, the message will not be signed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e8ef7-149">Viz také</span><span class="sxs-lookup"><span data-stu-id="e8ef7-149">See Also</span></span>  
 [<span data-ttu-id="e8ef7-150">Důležité informace o zabezpečení</span><span class="sxs-lookup"><span data-stu-id="e8ef7-150">Security Considerations</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)  
 [<span data-ttu-id="e8ef7-151">Důležité informace o zabezpečení dat</span><span class="sxs-lookup"><span data-stu-id="e8ef7-151">Security Considerations for Data</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)  
 [<span data-ttu-id="e8ef7-152">Informace o zabezpečení metadat</span><span class="sxs-lookup"><span data-stu-id="e8ef7-152">Security Considerations with Metadata</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)
