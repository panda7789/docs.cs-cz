---
title: Rozšíření hostitele služby pracovního postupu
ms.date: 03/30/2017
ms.assetid: c0e8f7bb-cb13-49ec-852f-b85d7c23972f
ms.openlocfilehash: 776fc78cd3f5b012dd40576fe56f71835e949708
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/12/2020
ms.locfileid: "79184161"
---
# <a name="workflow-service-host-extensibility"></a><span data-ttu-id="43c76-102">Rozšíření hostitele služby pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="43c76-102">Workflow Service Host Extensibility</span></span>
[!INCLUDE[netfx_current_long](../../../../includes/netfx-current-long-md.md)]<span data-ttu-id="43c76-103">poskytuje <xref:System.ServiceModel.Activities.WorkflowServiceHost> třídu pro hostování služeb pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-103">provides the <xref:System.ServiceModel.Activities.WorkflowServiceHost> class for hosting workflow services.</span></span> <span data-ttu-id="43c76-104">Tato třída se používá, když vlastní hostování služby pracovního postupu ve spravované aplikaci nebo služby systému Windows.</span><span class="sxs-lookup"><span data-stu-id="43c76-104">This class is used when you are self-hosting a workflow service in a managed application or a Windows service.</span></span> <span data-ttu-id="43c76-105">Tato třída se také používá při hostování služby pracovního postupu s Internetovou informační službou (IIS) nebo službou aktivace procesů systému Windows (WAS).</span><span class="sxs-lookup"><span data-stu-id="43c76-105">This class is also used when hosting a workflow service with Internet Information Services (IIS) or Windows Process Activation Service (WAS).</span></span> <span data-ttu-id="43c76-106">Třída <xref:System.ServiceModel.Activities.WorkflowServiceHost> poskytuje body rozšíření, které umožňují přidávat vlastní rozšíření, změnit chování nečinnosti a hostovat pracovní postupy neslužby (pracovní postupy, které nepoužívají aktivity zasílání zpráv).</span><span class="sxs-lookup"><span data-stu-id="43c76-106">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> class provides extension points that allow you to add custom extensions, change the idle behavior, and host non-service workflows (workflows that do not use messaging activities).</span></span>  
  
## <a name="workflow-service-host-extensions"></a><span data-ttu-id="43c76-107">Rozšíření hostitele služby pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="43c76-107">Workflow Service Host Extensions</span></span>  
 <span data-ttu-id="43c76-108">Obsahuje <xref:System.ServiceModel.Activities.WorkflowServiceHost> <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> vlastnost typu, <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> který poskytuje metody pro <xref:System.ServiceModel.Activities.WorkflowServiceHost>přidání rozšíření do .</span><span class="sxs-lookup"><span data-stu-id="43c76-108">The <xref:System.ServiceModel.Activities.WorkflowServiceHost> contains a <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> property of type <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager> that provides methods to add extensions to the <xref:System.ServiceModel.Activities.WorkflowServiceHost>.</span></span> <span data-ttu-id="43c76-109">Pomocí <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> metody můžete přidat rozšíření pro každou instanci služby pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-109">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service instance.</span></span> <span data-ttu-id="43c76-110">Zadaný delegát je volán k vytvoření nového rozšíření při vytvoření nebo načtení instance služby pracovního postupu z úložiště trvalosti.</span><span class="sxs-lookup"><span data-stu-id="43c76-110">The delegate specified is called to create a new extension when a workflow service instance is created or loaded from a persistence store.</span></span> <span data-ttu-id="43c76-111">Pomocí <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> metody přidejte rozšíření pro každého hostitele služby pracovního postupu, jedna instance rozšíření je sdílena pro všechny instance služby pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-111">Use the <xref:System.Activities.Hosting.WorkflowInstanceExtensionManager.Add%2A> method to add an extension for each workflow service host, one instance of the extension is shared for all workflow service instances.</span></span>  
  
## <a name="react-to-unhandled-exceptions"></a><span data-ttu-id="43c76-112">Reagovat na neošetřené výjimky</span><span class="sxs-lookup"><span data-stu-id="43c76-112">React to Unhandled Exceptions</span></span>  
 <span data-ttu-id="43c76-113">Umožňuje <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> zadat akci, která má být v případě, že dojde k neošetřené výjimce v rámci služby pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-113">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> enables you to specify the action to take if an unhandled exception occurs within a workflow service.</span></span> <span data-ttu-id="43c76-114">Vlastnost <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> určuje jednu <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> z hodnot:</span><span class="sxs-lookup"><span data-stu-id="43c76-114">The <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior.Action%2A> property specifies one of the <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction> values:</span></span>  
  
- <span data-ttu-id="43c76-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon>– Přeruší instanci služby pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-115"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Abandon> – Aborts the workflow service instance.</span></span>  
  
- <span data-ttu-id="43c76-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend>– Vrátí se zpět do posledního trvalého stavu a pozastaví instanci služby pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-116"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.AbandonAndSuspend> – Rolls back to the last persisted state and suspends the workflow service instance.</span></span> <span data-ttu-id="43c76-117">K tomu dochází pouze v případě, že pracovní postup již byl zachován alespoň jednou.</span><span class="sxs-lookup"><span data-stu-id="43c76-117">This only occurs if the workflow has already been persisted at least once.</span></span> <span data-ttu-id="43c76-118">Pokud ne instance pracovního postupu je přerušena.</span><span class="sxs-lookup"><span data-stu-id="43c76-118">If not the workflow instance is aborted.</span></span>  
  
- <span data-ttu-id="43c76-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel>– Zruší instanci.</span><span class="sxs-lookup"><span data-stu-id="43c76-119"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> – Cancels the instance.</span></span>  
  
- <span data-ttu-id="43c76-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate>– Ukončí instanci.</span><span class="sxs-lookup"><span data-stu-id="43c76-120"><xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Terminate> – Terminates the instance.</span></span>  
  
 <span data-ttu-id="43c76-121">Toto chování lze nakonfigurovat v kódu, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="43c76-121">This behavior can be configured in code as shown in the following example.</span></span>  
  
```csharp  
host.Description.Behaviors.Add(new WorkflowUnhandledExceptionBehavior { Action = WorkflowUnhandledExceptionAction.Abandon });  
```  
  
 <span data-ttu-id="43c76-122">Lze jej také nakonfigurovat v konfiguračním souboru, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="43c76-122">It can also be configured in a configuration file as shown in the following example.</span></span>  
  
```xml
<behaviors>  
      <serviceBehaviors>  
        <behavior>  
          <serviceMetadata httpGetEnabled="True"/>  
          <serviceDebug includeExceptionDetailInFaults="False" />  
          <workflowUnhandledExceptionBehavior action="Abandon" />
        </behavior>  
      </serviceBehaviors>  
```  
  
## <a name="hosting-non-service-workflows"></a><span data-ttu-id="43c76-123">Hostování pracovních postupů, které nejsou službami</span><span class="sxs-lookup"><span data-stu-id="43c76-123">Hosting Non-Service Workflows</span></span>  
 <span data-ttu-id="43c76-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost>lze použít k hostování neservisních pracovních postupů nebo pracovních <xref:System.ServiceModel.Activities.Receive> postupů, které nezačínají aktivitou nebo pracovními postupy, které nepoužívají aktivity zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="43c76-124"><xref:System.ServiceModel.Activities.WorkflowServiceHost> can be used to host non-service workflows, or workflows that either do not begin with a <xref:System.ServiceModel.Activities.Receive> activity or workflows that do not use the messaging activities.</span></span> <span data-ttu-id="43c76-125">Služby pracovního <xref:System.ServiceModel.Activities.Receive> postupu obvykle začínají aktivitou.</span><span class="sxs-lookup"><span data-stu-id="43c76-125">Workflow services normally begin with a <xref:System.ServiceModel.Activities.Receive> activity.</span></span> <span data-ttu-id="43c76-126">Když <xref:System.ServiceModel.Activities.WorkflowServiceHost> obdrží zprávu pro službu pracovního postupu, pokud není již spuštěna (nebo trvalá) je vytvořena nová instance služby pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-126">When the <xref:System.ServiceModel.Activities.WorkflowServiceHost> receives a message for a workflow service, if it is not already running (or persisted) a new workflow service instance is created.</span></span> <span data-ttu-id="43c76-127">Pokud pracovní postup nezačíná příjem aktivity, nelze spustit odesláním zprávy, protože neexistuje žádná aktivita pro příjem zprávy.</span><span class="sxs-lookup"><span data-stu-id="43c76-127">If a workflow does not begin with a Receive activity, it cannot be started by sending a message because there is no activity to receive the message.</span></span> <span data-ttu-id="43c76-128">Chcete-li hostovat pracovní postup bez <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> služby, odvoděte třídu z a přepsat <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>a <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span><span class="sxs-lookup"><span data-stu-id="43c76-128">To host a non-service workflow, derive a class from <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint> and override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A>, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A>, and <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A>.</span></span> <span data-ttu-id="43c76-129">Přepište, <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> pokud chcete zadat upřednostňované ID instance.</span><span class="sxs-lookup"><span data-stu-id="43c76-129">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetInstanceId%2A> if you want to provide a preferred instance ID.</span></span> <span data-ttu-id="43c76-130">Přepsáním <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> vytvoříte vlastní kontext vytvoření pracovního <xref:System.ServiceModel.Activities.WorkflowCreationContext>postupu nebo naplníte instanci existujícího .</span><span class="sxs-lookup"><span data-stu-id="43c76-130">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnGetCreationContext%2A> to create a custom workflow creation context or populate an instance of the existing <xref:System.ServiceModel.Activities.WorkflowCreationContext>.</span></span> <span data-ttu-id="43c76-131">Přepsáním <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> ručně extrahujete záložku z příchozí zprávy.</span><span class="sxs-lookup"><span data-stu-id="43c76-131">Override <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint.OnResolveBookmark%2A> to manually extract the bookmark from the incoming message.</span></span> <span data-ttu-id="43c76-132">Pokud přepsat tuto metodu, <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> musíte vyvolat v jeho těle tak, aby reagovat na zprávu odeslanou WorkflowHostingEndpoint.</span><span class="sxs-lookup"><span data-stu-id="43c76-132">If you override this method, you must invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> in its body so as to respond to the message sent to the WorkflowHostingEndpoint.</span></span> <span data-ttu-id="43c76-133">Pokud tak neučiníte, <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> může být nakonec překročen limit.</span><span class="sxs-lookup"><span data-stu-id="43c76-133">If you do not do so, a <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> limit may be eventually exceeded.</span></span> <span data-ttu-id="43c76-134">V obousměrné smlouvy, může být možné zjistit <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> selhání vyvolat z důvodu selhání klienta přijímat odpovědi.</span><span class="sxs-lookup"><span data-stu-id="43c76-134">In two-way contracts, you may be able to detect your   failure to invoke <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> because of the client’s failure to receive a response.</span></span> <span data-ttu-id="43c76-135">V jednosměrných smlouvách nemusí rozpoznat chybu, že <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> se nepodařilo volat, <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> dokud není příliš pozdě, po překročení limitu škrticí klapky.</span><span class="sxs-lookup"><span data-stu-id="43c76-135">In one-way contracts, you may not recognize the mistake of failing to call <xref:System.ServiceModel.Activities.WorkflowHostingResponseContext.SendResponse%2A> until it’s too late, after the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentCalls%2A> throttle limit is exceeded.</span></span> <span data-ttu-id="43c76-136">Další informace naleznete [v tématu WorkflowHostingEndpoint Resume Bookmark](../../../../docs/framework/windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)Chcete-li vytvořit novou instanci pracovního postupu bez služby, deklarujte servisní smlouvu, která definuje operaci, která vytvoří novou instanci.</span><span class="sxs-lookup"><span data-stu-id="43c76-136">For more information, please see the [WorkflowHostingEndpoint Resume Bookmark](../../../../docs/framework/windows-workflow-foundation/samples/workflowhostingendpoint-resume-bookmark.md)To create a new instance of a non-service workflow, declare a service contract that defines an operation that creates a new instance.</span></span> <span data-ttu-id="43c76-137">Operace vytvoření by měla trvat řetězec IDictionary,\<objekt> předat všechny požadované parametry pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="43c76-137">The creation operation should take an IDictionary\<string, object> to pass any required workflow parameters.</span></span> <span data-ttu-id="43c76-138">Tato smlouva je implicitně <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>implementována -derived třídy.</span><span class="sxs-lookup"><span data-stu-id="43c76-138">This contract is implicitly implemented by the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class.</span></span> <span data-ttu-id="43c76-139">Při hostování pracovního postupu přidejte instanci <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>odvozené <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> třídy <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>do hostitele voláním a voláním .</span><span class="sxs-lookup"><span data-stu-id="43c76-139">When hosting the workflow, add an instance of the <xref:System.ServiceModel.Activities.WorkflowHostingEndpoint>-derived class to the host by calling <xref:System.ServiceModel.Activities.WorkflowServiceHost.AddServiceEndpoint%2A> and call <xref:System.ServiceModel.Channels.CommunicationObject.Open%2A>.</span></span> <span data-ttu-id="43c76-140">Chcete-li vytvořit instanci <xref:System.ServiceModel.ChannelFactory%601> pracovního postupu, vytvořte typ a volání <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>servisní smlouvy .</span><span class="sxs-lookup"><span data-stu-id="43c76-140">To create an instance of the workflow, create a <xref:System.ServiceModel.ChannelFactory%601> of your service contract type and call <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A>.</span></span> <span data-ttu-id="43c76-141">Potom můžete volat operaci vytvoření definovanou v servisní smlouvě.</span><span class="sxs-lookup"><span data-stu-id="43c76-141">You can then call the create operation defined in your service contract.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="43c76-142">Viz také</span><span class="sxs-lookup"><span data-stu-id="43c76-142">See also</span></span>

- [<span data-ttu-id="43c76-143">Služby pracovních postupů</span><span class="sxs-lookup"><span data-stu-id="43c76-143">Workflow Services</span></span>](../../../../docs/framework/wcf/feature-details/workflow-services.md)
- [<span data-ttu-id="43c76-144">Aktivity zasílání zpráv</span><span class="sxs-lookup"><span data-stu-id="43c76-144">Messaging Activities</span></span>](../../../../docs/framework/wcf/feature-details/messaging-activities.md)
