---
title: Ladění chyb ověřování systému Windows
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: 4a5e56f6b7f33a4c6f29aa384635737eeee37ddd
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/09/2020
ms.locfileid: "77095031"
---
# <a name="debug-windows-authentication-errors"></a><span data-ttu-id="177b1-102">Ladění chyb ověřování systému Windows</span><span class="sxs-lookup"><span data-stu-id="177b1-102">Debug Windows authentication errors</span></span>

<span data-ttu-id="177b1-103">Při použití ověřování systému Windows jako mechanismu zabezpečení zpracovává rozhraní SSPI (Security Support Provider Interface) procesy zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="177b1-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="177b1-104">Pokud dojde k chybám zabezpečení ve vrstvě SSPI, jsou umístěny na základě Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="177b1-104">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="177b1-105">Toto téma poskytuje strukturu a sadu otázek, které vám pomůžou diagnostikovat chyby.</span><span class="sxs-lookup"><span data-stu-id="177b1-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="177b1-106">Přehled protokolu Kerberos najdete v tématu [Vysvětlení protokolu Kerberos](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-2000-server/bb742516(v=technet.10)). Přehled rozhraní SSPI naleznete v tématu [SSPI](/windows/win32/secauthn/sspi).</span><span class="sxs-lookup"><span data-stu-id="177b1-106">For an overview of the Kerberos protocol, see [Kerberos Explained](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-2000-server/bb742516(v=technet.10)); for an overview of SSPI, see [SSPI](/windows/win32/secauthn/sspi).</span></span>  
  
 <span data-ttu-id="177b1-107">Pro ověřování systému Windows WCF typicky používá zprostředkovatele *zabezpečení (* SSP), který provádí vzájemné ověřování protokolu Kerberos mezi klientem a službou.</span><span class="sxs-lookup"><span data-stu-id="177b1-107">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="177b1-108">Pokud protokol Kerberos není k dispozici, ve výchozím nastavení se služba WCF vrátí do programu NT LAN Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="177b1-108">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="177b1-109">Můžete ale nakonfigurovat WCF na použití jenom protokolu Kerberos (a vyvolat výjimku, pokud není k dispozici protokol Kerberos).</span><span class="sxs-lookup"><span data-stu-id="177b1-109">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="177b1-110">Můžete také nakonfigurovat WCF tak, aby používal omezené formuláře protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="177b1-110">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="177b1-111">Metodologie ladění</span><span class="sxs-lookup"><span data-stu-id="177b1-111">Debugging Methodology</span></span>  
 <span data-ttu-id="177b1-112">Základní metoda je následující:</span><span class="sxs-lookup"><span data-stu-id="177b1-112">The basic method is as follows:</span></span>  
  
1. <span data-ttu-id="177b1-113">Určete, zda používáte ověřování systému Windows.</span><span class="sxs-lookup"><span data-stu-id="177b1-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="177b1-114">Pokud používáte jiné schéma, toto téma se nevztahuje.</span><span class="sxs-lookup"><span data-stu-id="177b1-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2. <span data-ttu-id="177b1-115">Pokud jste si jisti, že používáte ověřování systému Windows, určete, zda konfigurace WCF používá metodu Kerberos Direct nebo Negotiate.</span><span class="sxs-lookup"><span data-stu-id="177b1-115">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3. <span data-ttu-id="177b1-116">Jakmile zjistíte, jestli vaše konfigurace používá protokol Kerberos nebo NTLM, můžete pochopit chybové zprávy ve správném kontextu.</span><span class="sxs-lookup"><span data-stu-id="177b1-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="177b1-117">Dostupnost protokolu Kerberos a protokolu NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="177b1-118">Zprostředkovatel zabezpečení protokolu Kerberos vyžaduje, aby řadič domény fungoval jako služba KDC (Key Distribution Center) protokolu Kerberos (KDC).</span><span class="sxs-lookup"><span data-stu-id="177b1-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="177b1-119">Protokol Kerberos je k dispozici pouze v případě, že klient i služba používají identity domény.</span><span class="sxs-lookup"><span data-stu-id="177b1-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="177b1-120">V kombinaci s jinými účty se používá protokol NTLM, jak je shrnuto v následující tabulce.</span><span class="sxs-lookup"><span data-stu-id="177b1-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="177b1-121">Záhlaví tabulky zobrazují možné typy účtů používané serverem.</span><span class="sxs-lookup"><span data-stu-id="177b1-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="177b1-122">V levém sloupci se zobrazují možné typy účtů používané klientem.</span><span class="sxs-lookup"><span data-stu-id="177b1-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="177b1-123">Místní uživatel</span><span class="sxs-lookup"><span data-stu-id="177b1-123">Local User</span></span>|<span data-ttu-id="177b1-124">Místní systém</span><span class="sxs-lookup"><span data-stu-id="177b1-124">Local System</span></span>|<span data-ttu-id="177b1-125">Uživatel domény</span><span class="sxs-lookup"><span data-stu-id="177b1-125">Domain User</span></span>|<span data-ttu-id="177b1-126">Počítač domény</span><span class="sxs-lookup"><span data-stu-id="177b1-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="177b1-127">Místní uživatel</span><span class="sxs-lookup"><span data-stu-id="177b1-127">Local User</span></span>|<span data-ttu-id="177b1-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-128">NTLM</span></span>|<span data-ttu-id="177b1-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-129">NTLM</span></span>|<span data-ttu-id="177b1-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-130">NTLM</span></span>|<span data-ttu-id="177b1-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-131">NTLM</span></span>|  
|<span data-ttu-id="177b1-132">Místní systém</span><span class="sxs-lookup"><span data-stu-id="177b1-132">Local System</span></span>|<span data-ttu-id="177b1-133">Anonymní protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-133">Anonymous NTLM</span></span>|<span data-ttu-id="177b1-134">Anonymní protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-134">Anonymous NTLM</span></span>|<span data-ttu-id="177b1-135">Anonymní protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-135">Anonymous NTLM</span></span>|<span data-ttu-id="177b1-136">Anonymní protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="177b1-137">Uživatel domény</span><span class="sxs-lookup"><span data-stu-id="177b1-137">Domain User</span></span>|<span data-ttu-id="177b1-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-138">NTLM</span></span>|<span data-ttu-id="177b1-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-139">NTLM</span></span>|<span data-ttu-id="177b1-140">Sdílené</span><span class="sxs-lookup"><span data-stu-id="177b1-140">Kerberos</span></span>|<span data-ttu-id="177b1-141">Sdílené</span><span class="sxs-lookup"><span data-stu-id="177b1-141">Kerberos</span></span>|  
|<span data-ttu-id="177b1-142">Počítač domény</span><span class="sxs-lookup"><span data-stu-id="177b1-142">Domain Machine</span></span>|<span data-ttu-id="177b1-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-143">NTLM</span></span>|<span data-ttu-id="177b1-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-144">NTLM</span></span>|<span data-ttu-id="177b1-145">Sdílené</span><span class="sxs-lookup"><span data-stu-id="177b1-145">Kerberos</span></span>|<span data-ttu-id="177b1-146">Sdílené</span><span class="sxs-lookup"><span data-stu-id="177b1-146">Kerberos</span></span>|  
  
 <span data-ttu-id="177b1-147">Mezi ně patří konkrétně tyto čtyři typy účtů:</span><span class="sxs-lookup"><span data-stu-id="177b1-147">Specifically, the four account types include:</span></span>  
  
- <span data-ttu-id="177b1-148">Místní uživatel: uživatelský profil pouze počítač.</span><span class="sxs-lookup"><span data-stu-id="177b1-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="177b1-149">Například: `MachineName\Administrator` nebo `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="177b1-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
- <span data-ttu-id="177b1-150">Místní systém: integrovaný systém účtů na počítači, který není připojený k doméně.</span><span class="sxs-lookup"><span data-stu-id="177b1-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
- <span data-ttu-id="177b1-151">Uživatel domény: uživatelský účet v doméně systému Windows.</span><span class="sxs-lookup"><span data-stu-id="177b1-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="177b1-152">Například: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="177b1-152">For example: `DomainName\ProfileName`.</span></span>  
  
- <span data-ttu-id="177b1-153">Počítač domény: proces s identitou počítače běžící na počítači připojeném k doméně systému Windows.</span><span class="sxs-lookup"><span data-stu-id="177b1-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="177b1-154">Například: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="177b1-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="177b1-155">Pověření služby je zachyceno při volání metody <xref:System.ServiceModel.ICommunicationObject.Open%2A> třídy <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="177b1-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="177b1-156">Přihlašovací údaje klienta se čtou při každém odeslání zprávy klientem.</span><span class="sxs-lookup"><span data-stu-id="177b1-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="177b1-157">Běžné problémy s ověřováním systému Windows</span><span class="sxs-lookup"><span data-stu-id="177b1-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="177b1-158">Tato část popisuje některé běžné problémy s ověřováním systému Windows a možné nápravy.</span><span class="sxs-lookup"><span data-stu-id="177b1-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="177b1-159">Protokol Kerberos</span><span class="sxs-lookup"><span data-stu-id="177b1-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="177b1-160">Problémy hlavního názvu služby (SPN) nebo UPN s protokolem Kerberos</span><span class="sxs-lookup"><span data-stu-id="177b1-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="177b1-161">Při použití ověřování systému Windows a protokolem SSPI se používá nebo vyjednává protokol Kerberos, adresa URL, kterou koncový bod klienta používá, musí obsahovat plně kvalifikovaný název domény hostitele služby v adrese URL služby.</span><span class="sxs-lookup"><span data-stu-id="177b1-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="177b1-162">Předpokládá se, že účet, pod kterým je služba spuštěná, má přístup k klíči hlavního názvu (SPN) služby (SPN), který se vytvoří při přidání počítače do domény služby Active Directory, která se nejčastěji provádí spuštěním služby pod Účet síťové služby.</span><span class="sxs-lookup"><span data-stu-id="177b1-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="177b1-163">Pokud služba nemá přístup k klíči hlavního názvu služby, je nutné, abyste zadali správný název SPN nebo hlavní název uživatele (UPN) účtu, pod kterým je služba spuštěná v identitě koncového bodu klienta.</span><span class="sxs-lookup"><span data-stu-id="177b1-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="177b1-164">Další informace o tom, jak WCF funguje se službou SPN a hlavním názvem uživatele (UPN), najdete v tématu [Identita a ověřování služby](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="177b1-164">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="177b1-165">V rámci scénářů vyrovnávání zatížení, jako jsou webové nebo webové zahrady, se v běžné praxi definují jedinečný účet pro každou aplikaci, přiřadíte k tomuto účtu hlavní název služby (SPN) a zajistěte, aby všechny služby aplikace běžely v tomto účtu.</span><span class="sxs-lookup"><span data-stu-id="177b1-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="177b1-166">K získání hlavního názvu služby (SPN) pro účet vaší služby musíte být správcem domény služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="177b1-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="177b1-167">Další informace najdete v tématu o [technickém dodatku Kerberos pro Windows](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="177b1-167">For more information, see [Kerberos Technical Supplement for Windows](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="177b1-168">Protokol Kerberos Direct vyžaduje, aby služba běžela pod účtem počítače domény.</span><span class="sxs-lookup"><span data-stu-id="177b1-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="177b1-169">K tomu dochází, je-li vlastnost `ClientCredentialType` nastavena na hodnotu `Windows` a vlastnost <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> je nastavena na `false`, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="177b1-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="177b1-170">Pokud chcete tento problém vyřešit, spusťte službu pomocí účtu počítače v doméně, jako je třeba síťová služba, na počítači připojeném k doméně.</span><span class="sxs-lookup"><span data-stu-id="177b1-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="177b1-171">Delegování vyžaduje vyjednávání přihlašovacích údajů</span><span class="sxs-lookup"><span data-stu-id="177b1-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="177b1-172">Chcete-li použít ověřovací protokol Kerberos s delegováním, je nutné implementovat protokol Kerberos s vyjednáváním přihlašovacích údajů (někdy se jim říká "Multi-nohy" nebo "multi-step" Kerberos).</span><span class="sxs-lookup"><span data-stu-id="177b1-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="177b1-173">Pokud implementujete ověřování protokolu Kerberos bez vyjednávání přihlašovacích údajů (někdy se nazývá "jednorázové" nebo "jednorázové" Kerberos), vyvolá se výjimka.</span><span class="sxs-lookup"><span data-stu-id="177b1-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="177b1-174">K implementaci protokolu Kerberos s vyjednáváním přihlašovacích údajů proveďte následující kroky:</span><span class="sxs-lookup"><span data-stu-id="177b1-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1. <span data-ttu-id="177b1-175">Implementujte delegování nastavením <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> na <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="177b1-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2. <span data-ttu-id="177b1-176">Vyžadovat vyjednávání SSPI:</span><span class="sxs-lookup"><span data-stu-id="177b1-176">Require SSPI negotiation:</span></span>  
  
    1. <span data-ttu-id="177b1-177">Pokud používáte standardní vazby, nastavte vlastnost `NegotiateServiceCredential` na hodnotu `true`.</span><span class="sxs-lookup"><span data-stu-id="177b1-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2. <span data-ttu-id="177b1-178">Pokud používáte vlastní vazby, nastavte atribut `AuthenticationMode` elementu `Security` na `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="177b1-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3. <span data-ttu-id="177b1-179">Vyžaduje, aby vyjednávání SSPI používalo protokol Kerberos, a to tak, že nepovolí použití NTLM:</span><span class="sxs-lookup"><span data-stu-id="177b1-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1. <span data-ttu-id="177b1-180">Udělejte to v kódu s následujícím příkazem: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="177b1-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2. <span data-ttu-id="177b1-181">Nebo to můžete provést v konfiguračním souboru nastavením atributu `allowNtlm` na `false`.</span><span class="sxs-lookup"><span data-stu-id="177b1-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="177b1-182">Tento atribut je součástí [\<> Windows](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="177b1-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="177b1-183">Protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="177b1-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="177b1-184">Vyjednání SSP se vrátí do protokolu NTLM, ale protokol NTLM je zakázán.</span><span class="sxs-lookup"><span data-stu-id="177b1-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="177b1-185">Vlastnost <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> je nastavena na hodnotu `false`, která způsobuje, že Windows Communication Foundation (WCF) vyvolá výjimku, pokud se používá protokol NTLM.</span><span class="sxs-lookup"><span data-stu-id="177b1-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="177b1-186">Nastavení této vlastnosti na `false` nesmí bránit v posílání přihlašovacích údajů protokolu NTLM z přenosů.</span><span class="sxs-lookup"><span data-stu-id="177b1-186">Setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="177b1-187">Následující příklad ukazuje, jak zakázat použití funkce Fallback na NTLM.</span><span class="sxs-lookup"><span data-stu-id="177b1-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="177b1-188">Přihlášení k protokolu NTLM se nezdařilo</span><span class="sxs-lookup"><span data-stu-id="177b1-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="177b1-189">Pověření klienta nejsou ve službě platná.</span><span class="sxs-lookup"><span data-stu-id="177b1-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="177b1-190">Ověřte, že uživatelské jméno a heslo jsou správně nastaveny a odpovídají účtu, který je známý pro počítač, na kterém je služba spuštěná.</span><span class="sxs-lookup"><span data-stu-id="177b1-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="177b1-191">Protokol NTLM používá zadaná pověření pro přihlášení k počítači služby.</span><span class="sxs-lookup"><span data-stu-id="177b1-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="177b1-192">I když jsou přihlašovací údaje platné v počítači, kde je spuštěný klient nástroje, přihlášení se nezdaří, pokud nejsou přihlašovací údaje v počítači služby platné.</span><span class="sxs-lookup"><span data-stu-id="177b1-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="177b1-193">Dojde k anonymnímu přihlášení NTLM, ale anonymní přihlášení jsou ve výchozím nastavení zakázaná.</span><span class="sxs-lookup"><span data-stu-id="177b1-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="177b1-194">Při vytváření klienta je vlastnost <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> nastavena na hodnotu <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, jak je znázorněno v následujícím příkladu, ale ve výchozím nastavení Server nepovoluje anonymní přihlašování.</span><span class="sxs-lookup"><span data-stu-id="177b1-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="177b1-195">K tomu dochází, protože výchozí hodnota vlastnosti <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> třídy <xref:System.ServiceModel.Security.WindowsServiceCredential> je `false`.</span><span class="sxs-lookup"><span data-stu-id="177b1-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="177b1-196">Následující kód klienta se pokusí povolit anonymní přihlašování (Všimněte si, že výchozí vlastnost je `Identification`).</span><span class="sxs-lookup"><span data-stu-id="177b1-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="177b1-197">Následující kód služby změní výchozí, aby bylo možné povolit anonymní přihlášení ze serveru.</span><span class="sxs-lookup"><span data-stu-id="177b1-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="177b1-198">Další informace o zosobnění najdete v tématu [delegování a zosobnění](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="177b1-198">For more information about impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="177b1-199">Další možností je, že klient je spuštěn jako služba systému Windows, a to pomocí integrovaného systému účtů.</span><span class="sxs-lookup"><span data-stu-id="177b1-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="177b1-200">Jiné problémy</span><span class="sxs-lookup"><span data-stu-id="177b1-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="177b1-201">Přihlašovací údaje klienta nejsou nastavené správně.</span><span class="sxs-lookup"><span data-stu-id="177b1-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="177b1-202">Ověřování systému Windows používá instanci <xref:System.ServiceModel.Security.WindowsClientCredential> vrácenou vlastností <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> třídy <xref:System.ServiceModel.ClientBase%601>, nikoli <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="177b1-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="177b1-203">Následující příklad ukazuje nesprávný příklad.</span><span class="sxs-lookup"><span data-stu-id="177b1-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="177b1-204">V následujícím příkladu je uveden správný příklad.</span><span class="sxs-lookup"><span data-stu-id="177b1-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="177b1-205">Rozhraní SSPI není k dispozici.</span><span class="sxs-lookup"><span data-stu-id="177b1-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="177b1-206">Následující operační systémy nepodporují ověřování systému Windows, pokud se používají jako server: Windows XP Home Edition, Windows XP Media Center Edition a Windows Vista Home Edition.</span><span class="sxs-lookup"><span data-stu-id="177b1-206">The following operating systems do not support Windows authentication when used as a server: Windows XP Home Edition, Windows XP Media Center Edition, and Windows Vista Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="177b1-207">Vývoj a nasazení s různými identitami</span><span class="sxs-lookup"><span data-stu-id="177b1-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="177b1-208">Pokud vyvíjíte aplikaci na jednom počítači a nasadíte ji na jiný počítač a použijete k ověřování na každém počítači různé typy účtů, může docházet k různým chování.</span><span class="sxs-lookup"><span data-stu-id="177b1-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="177b1-209">Předpokládejme například, že vyvíjíte aplikaci na počítači se systémem Windows XP pro pomocí režimu ověřování `SSPI Negotiated`.</span><span class="sxs-lookup"><span data-stu-id="177b1-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="177b1-210">Použijete-li k ověřování pomocí místní uživatelský účet, bude použit protokol NTLM.</span><span class="sxs-lookup"><span data-stu-id="177b1-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="177b1-211">Po dokončení vývoje aplikace službu nasadíte na počítač s Windows serverem 2003, na kterém běží pod účtem domény.</span><span class="sxs-lookup"><span data-stu-id="177b1-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="177b1-212">V tomto okamžiku klient nebude moci ověřit službu, protože bude používat protokol Kerberos a řadič domény.</span><span class="sxs-lookup"><span data-stu-id="177b1-212">At this point, the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="177b1-213">Viz také</span><span class="sxs-lookup"><span data-stu-id="177b1-213">See also</span></span>

- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.Security.WindowsServiceCredential>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ClientBase%601>
- [<span data-ttu-id="177b1-214">Delegace a zosobnění</span><span class="sxs-lookup"><span data-stu-id="177b1-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="177b1-215">Nepodporované scénáře</span><span class="sxs-lookup"><span data-stu-id="177b1-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
