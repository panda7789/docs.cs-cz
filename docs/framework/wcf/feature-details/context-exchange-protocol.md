---
title: Protokol kontextové výměny
ms.date: 03/30/2017
ms.assetid: 3dfd38e0-ae52-491c-94f4-7a862b9843d4
ms.openlocfilehash: 00adb68d96f77ce0953811d13b5377ec4ed1e0ea
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185268"
---
# <a name="context-exchange-protocol"></a><span data-ttu-id="a2d8a-102">Protokol kontextové výměny</span><span class="sxs-lookup"><span data-stu-id="a2d8a-102">Context Exchange Protocol</span></span>
<span data-ttu-id="a2d8a-103">Tato část popisuje protokol pro výměnu kontextu zavedený ve verzi WCF (Windows Communication Foundation) .NET Framework verze 3.5.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-103">This section describes the context exchange protocol introduced in Windows Communication Foundation (WCF) release .NET Framework version 3.5.</span></span> <span data-ttu-id="a2d8a-104">Tento protokol umožňuje kanálu klienta přijmout kontext dodaný službou a použít jej na všechny následné požadavky na tuto službu odeslanou prostřednictvím stejné instance kanálu klienta.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-104">This protocol allows the client channel to accept a context supplied by a service and apply it to all subsequent requests to that service sent over the same client channel instance.</span></span> <span data-ttu-id="a2d8a-105">Implementace protokolu kontextové výměny může použít jeden z následujících dvou mechanismů k šíření kontextu mezi serverem a klientem: http cookies nebo hlavička SOAP.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-105">The implementation of the context exchange protocol can use one of the following two mechanisms to propagate the context between the server and the client: HTTP cookies or a SOAP header.</span></span>  
  
 <span data-ttu-id="a2d8a-106">Protokol výměny kontextu je implementován ve vlastní vrstvě kanálu.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-106">The context exchange protocol is implemented in a custom channel layer.</span></span> <span data-ttu-id="a2d8a-107">Kanál komunikuje kontext do a z aplikační <xref:System.ServiceModel.Channels.ContextMessageProperty> vrstvy pomocí vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-107">The channel communicates the context to and from the application layer using a <xref:System.ServiceModel.Channels.ContextMessageProperty> property.</span></span> <span data-ttu-id="a2d8a-108">Pro přenos mezi koncovými body je hodnota kontextu serializována jako hlavička SOAP ve vrstvě kanálu nebo převedena na nebo z vlastností zprávy, které představují požadavek a odpověď HTTP.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-108">For transmission between endpoints, the value of the context is either serialized as a SOAP header at the channel layer, or converted to or from the message properties that represent a HTTP request and response.</span></span> <span data-ttu-id="a2d8a-109">V druhém případě se očekává, že jeden z vrstev základní kanál převede http požadavek a odpověď zprávy vlastnosti a z http cookies, resp.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-109">In the latter case, it is expected that one of the underlying channel layers converts the HTTP request and response message properties to and from HTTP cookies, respectively.</span></span> <span data-ttu-id="a2d8a-110">Volba mechanismu s použitím mechanismu použitého k <xref:System.ServiceModel.Channels.ContextExchangeMechanism> výměně <xref:System.ServiceModel.Channels.ContextBindingElement>kontextu se provádí pomocí vlastnosti na .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-110">The choice of the mechanism used to exchange the context is done using the <xref:System.ServiceModel.Channels.ContextExchangeMechanism> property on the <xref:System.ServiceModel.Channels.ContextBindingElement>.</span></span> <span data-ttu-id="a2d8a-111">Platné hodnoty `HttpCookie` `SoapHeader`jsou nebo .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-111">Valid values are `HttpCookie` or `SoapHeader`.</span></span>  
  
 <span data-ttu-id="a2d8a-112">Na straně klienta může instance kanálu pracovat ve dvou režimech založených <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>na nastavení vlastnosti kanálu .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-112">On the client, an instance of a channel can operate in two modes based on the settings on the channel property, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span></span>  
  
## <a name="mode-1-channel-context-management"></a><span data-ttu-id="a2d8a-113">Režim 1: Správa kontextu kanálu</span><span class="sxs-lookup"><span data-stu-id="a2d8a-113">Mode 1: Channel Context Management</span></span>  
 <span data-ttu-id="a2d8a-114">Toto je výchozí <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> režim, `true`ve kterém je nastavena na .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-114">This is the default mode where <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `true`.</span></span> <span data-ttu-id="a2d8a-115">V tomto režimu kontextový kanál spravuje kontext a ukládá kontext během jeho životnosti.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-115">In this mode the context channel manages the context and caches the context during its lifetime.</span></span> <span data-ttu-id="a2d8a-116">Kontext lze načíst z kanálu `IContextManager` prostřednictvím `GetContext` vlastnosti kanálu voláním metody.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-116">Context can be retrieved from the channel through channel property `IContextManager` by calling the `GetContext` method.</span></span> <span data-ttu-id="a2d8a-117">Kanál lze také předem inicializovat s určitým kontextem před otevřením voláním `SetContext` metody na vlastnosti kanálu.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-117">The channel can also be pre-initialized with specific context before being opened by calling the `SetContext` method on the channel property.</span></span> <span data-ttu-id="a2d8a-118">Jakmile je kanál inicializován s kontextem, nelze jej obnovit.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-118">Once the channel is initialized with context it cannot be reset.</span></span>  
  
 <span data-ttu-id="a2d8a-119">Následuje seznam invariants v tomto režimu:</span><span class="sxs-lookup"><span data-stu-id="a2d8a-119">The following is a list of invariants in this mode:</span></span>  
  
- <span data-ttu-id="a2d8a-120">Jakýkoli pokus o obnovení `SetContext` kontextu pomocí po otevření <xref:System.InvalidOperationException>kanálu vyvolá .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-120">Any attempt to reset the context using `SetContext` after the channel has been opened throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="a2d8a-121">Jakýkoli pokus o odeslání <xref:System.ServiceModel.Channels.ContextMessageProperty> kontextu pomocí v odchozí <xref:System.InvalidOperationException>zprávy vyvolá .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-121">Any attempt to send context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty> in an outgoing message throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="a2d8a-122">Pokud je zpráva přijata ze serveru s určitým kontextem, pokud kanál již byl <xref:System.ServiceModel.ProtocolException>inicializován s určitým kontextem, výsledkem je .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-122">If a message is received from server with a specific context, when the channel has already been initialized with a specific context, this results in a <xref:System.ServiceModel.ProtocolException>.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="a2d8a-123">Je vhodné přijímat počáteční kontext ze serveru pouze v případě, že kanál je otevřen bez jakéhokoli kontextu explicitně.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-123">It is appropriate to receive an initial context from the server only if the channel is opened without any context set explicitly.</span></span>  
  
- <span data-ttu-id="a2d8a-124">Příchozí <xref:System.ServiceModel.Channels.ContextMessageProperty> zpráva je vždy null.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-124">The <xref:System.ServiceModel.Channels.ContextMessageProperty> on incoming message is always null.</span></span>  
  
## <a name="mode-2-application-context-management"></a><span data-ttu-id="a2d8a-125">Režim 2: Správa kontextu aplikace</span><span class="sxs-lookup"><span data-stu-id="a2d8a-125">Mode 2: Application Context Management</span></span>  
 <span data-ttu-id="a2d8a-126">Toto je <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> režim, `false`kdy je nastavena na .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-126">This is the mode when <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `false`.</span></span> <span data-ttu-id="a2d8a-127">V tomto režimu kontextový kanál nespravuje kontext.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-127">In this mode the context channel does not manage context.</span></span> <span data-ttu-id="a2d8a-128">Je odpovědností aplikace načíst, spravovat a použít kontext <xref:System.ServiceModel.Channels.ContextMessageProperty>pomocí .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-128">It is the application's responsibility to retrieve, manage and apply context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="a2d8a-129">Jakýkoli pokus `GetContext` o `SetContext` volání <xref:System.InvalidOperationException>nebo výsledkem v .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-129">Any attempt to call `GetContext` or `SetContext` results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="a2d8a-130">Bez ohledu na to, který <xref:System.ServiceModel.Channels.IRequestChannel>režim <xref:System.ServiceModel.Channels.IRequestSessionChannel>je <xref:System.ServiceModel.Channels.IDuplexSessionChannel> vybrán, podporuje toto způsoby obnovení klientského kanálu , a vzory výměny zpráv.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-130">No matter which mode is chosen the client channel factory supports <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, and <xref:System.ServiceModel.Channels.IDuplexSessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="a2d8a-131">Ve službě je instance kanálu zodpovědná za převod kontextu poskytnutého klientem na <xref:System.ServiceModel.Channels.ContextMessageProperty>příchozí zprávy na .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-131">On the service, an instance of the channel is responsible for converting the context supplied by the client on incoming messages to the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="a2d8a-132">Vlastnost zprávy pak lze přistupovat aplikační vrstvy nebo jiné kanály dále v zásobníku volání.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-132">The message property can then be accessed by the application layer or other channels further up in the call stack.</span></span> <span data-ttu-id="a2d8a-133">Kanály služeb také umožňují aplikační vrstvě určit novou hodnotu kontextu, která má <xref:System.ServiceModel.Channels.ContextMessageProperty> být rozšířena zpět klientovi, připojením a ke zprávě odpovědi.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-133">The service channels also allow the application layer to specify a new context value to be propagated back to the client by attaching a <xref:System.ServiceModel.Channels.ContextMessageProperty> to the response message.</span></span> <span data-ttu-id="a2d8a-134">Tato vlastnost je převedena na hlavičku SOAP nebo soubor cookie HTTP, který obsahuje kontext, který závisí na konfiguraci vazby.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-134">This property is converted to the SOAP header or HTTP cookie that contains the context, which depends on the configuration of the binding.</span></span> <span data-ttu-id="a2d8a-135">Naslouchací <xref:System.ServiceModel.Channels.IReplySessionChannel>proces <xref:System.ServiceModel.Channels.IReplySessionChannel> kanálu služby podporuje <xref:System.ServiceModel.Channels.IReplyChannel>vzory , a výměnu zpráv.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-135">The service channel listener supports <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, and <xref:System.ServiceModel.Channels.IReplySessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="a2d8a-136">Protokol výměny kontextu zavádí `wsc:Context` novou hlavičku SOAP představující kontextové informace, pokud se soubory cookie PROTOKOLU HTTP nepoužívají k šíření kontextu.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-136">The context exchange protocol introduces a new `wsc:Context` SOAP header to represent the context information when HTTP cookies are not used to propagate the context.</span></span> <span data-ttu-id="a2d8a-137">Schéma záhlaví kontextu umožňuje libovolný počet podřízených prvků, každý s řetězcovou klávesou a obsahem řetězce.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-137">The context header schema allows for any number of child elements, each with a string key and string content.</span></span> <span data-ttu-id="a2d8a-138">Následuje příklad záhlaví kontextu.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-138">The following is an example of a context header.</span></span>  
  
 `<Context xmlns="http://schemas.microsoft.com/ws/2006/05/context">`  
  
 `<property name="myContext">context-2</property>`  
  
 `</Context>`  
  
 <span data-ttu-id="a2d8a-139">V `HttpCookie` režimu jsou soubory `SetCookie` cookie nastaveny pomocí záhlaví.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-139">When in `HttpCookie` mode, cookies are set using the `SetCookie` header.</span></span> <span data-ttu-id="a2d8a-140">Název souboru `WscContext`cookie je .</span><span class="sxs-lookup"><span data-stu-id="a2d8a-140">The cookie name is `WscContext`.</span></span> <span data-ttu-id="a2d8a-141">Hodnota souboru cookie je base64 kódování `wsc:Context` záhlaví.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-141">The value of the cookie is the Base64 encoding of the `wsc:Context` header.</span></span> <span data-ttu-id="a2d8a-142">Tato hodnota je uzavřena v uvozovkách.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-142">This value is enclosed in quotes.</span></span>  
  
 <span data-ttu-id="a2d8a-143">Hodnota kontextu musí být chráněna před změnami při přenosu ze stejného důvodu ws adresování hlavičky jsou chráněny – záhlaví slouží k určení, kam odeslat požadavek na službu.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-143">The value of the context must be protected from modification while in transit for the same reason WS-Addressing headers are protected – the header is used to determine where to dispatch the request to on the service.</span></span> <span data-ttu-id="a2d8a-144">Záhlaví `wsc:Context` je proto nutné digitálně podepsána nebo podepsána a šifrována na úrovni SOAP nebo přenosu, pokud vazba nabízí možnost ochrany zpráv.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-144">The `wsc:Context` header is therefore required to be digitally signed or signed and encrypted at either the SOAP or transport level when the binding offers message protection capability.</span></span> <span data-ttu-id="a2d8a-145">Při použití souborů cookie HTTP k šíření kontextu by měly být chráněny pomocí zabezpečení přenosu.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-145">When HTTP cookies are used to propagate context, they should be protected using transport security.</span></span>  
  
 <span data-ttu-id="a2d8a-146">Koncové body služby, které vyžadují podporu pro protokol výměny kontextu můžete explicitní v publikované zásady.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-146">Service endpoints that require support for the context exchange protocol can make it explicit in the published policy.</span></span> <span data-ttu-id="a2d8a-147">Dvě nová tvrzení zásad byly zavedeny představují požadavek pro klienta na podporu protokolu výměny kontextu na úrovni SOAP nebo povolit podporu souborů cookie HTTP.</span><span class="sxs-lookup"><span data-stu-id="a2d8a-147">Two new policy assertions have been introduced to represent the requirement for the client to support the context exchange protocol at the SOAP level or to enable HTTP cookie support.</span></span> <span data-ttu-id="a2d8a-148">Generování těchto tvrzení do zásad y služby je řízeno hodnotou vlastnosti <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="a2d8a-148">Generation of these assertions into the policy on the service is controlled by the value of the <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> property as follows:</span></span>  
  
- <span data-ttu-id="a2d8a-149">Pro <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, je generován následující kontrolní výraz:</span><span class="sxs-lookup"><span data-stu-id="a2d8a-149">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, the following assertion is generated:</span></span>  
  
    ```xml  
    <IncludeContext
    xmlns="http://schemas.microsoft.com/ws/2006/05/context"  
    protectionLevel="Sign" />  
    ```  
  
- <span data-ttu-id="a2d8a-150">Pro <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, je generován následující kontrolní výraz:</span><span class="sxs-lookup"><span data-stu-id="a2d8a-150">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, the following assertion is generated:</span></span>  
  
    ```xml  
    <HttpUseCookie xmlns="http://schemas.xmlsoap.org/soap/http"/>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="a2d8a-151">Viz také</span><span class="sxs-lookup"><span data-stu-id="a2d8a-151">See also</span></span>

- [<span data-ttu-id="a2d8a-152">Průvodce interoperabilitou protokolů webových služeb</span><span class="sxs-lookup"><span data-stu-id="a2d8a-152">Web Services Protocols Interoperability Guide</span></span>](../../../../docs/framework/wcf/feature-details/web-services-protocols-interoperability-guide.md)
