---
title: Použití relací
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- sessions [WCF]
ms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035
ms.openlocfilehash: aea26c3a814a34c9d2985bb1bf02dbb80d32ef12
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/15/2019
ms.locfileid: "72320290"
---
# <a name="using-sessions"></a><span data-ttu-id="684d9-102">Použití relací</span><span class="sxs-lookup"><span data-stu-id="684d9-102">Using Sessions</span></span>
<span data-ttu-id="684d9-103">V aplikacích Windows Communication Foundation (WCF) *relace* koreluje skupinu zpráv do konverzace.</span><span class="sxs-lookup"><span data-stu-id="684d9-103">In Windows Communication Foundation (WCF) applications, a *session* correlates a group of messages into a conversation.</span></span> <span data-ttu-id="684d9-104">Relace WCF se liší od objektu relace, který je k dispozici v aplikacích ASP.NET, podporují různá chování a jsou ovládány různými způsoby.</span><span class="sxs-lookup"><span data-stu-id="684d9-104">WCF sessions are different than the session object available in ASP.NET applications, support different behaviors, and are controlled in different ways.</span></span> <span data-ttu-id="684d9-105">Toto téma popisuje funkce, které relace povolují v aplikacích WCF a jejich použití.</span><span class="sxs-lookup"><span data-stu-id="684d9-105">This topic describes the features that sessions enable in WCF applications and how to use them.</span></span>  
  
## <a name="sessions-in-windows-communication-foundation-applications"></a><span data-ttu-id="684d9-106">Relace v Windows Communication Foundationch aplikacích</span><span class="sxs-lookup"><span data-stu-id="684d9-106">Sessions in Windows Communication Foundation Applications</span></span>  
 <span data-ttu-id="684d9-107">Pokud kontrakt služby určí, že vyžaduje relaci, je nutné, aby tato smlouva určila, že všechna volání (tj. základní výměny zpráv podporující volání) musí být součástí stejné konverzace.</span><span class="sxs-lookup"><span data-stu-id="684d9-107">When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="684d9-108">Pokud kontrakt určí, že umožňuje relace, ale nevyžaduje jednu, klienti se mohou připojit a vytvořit relaci nebo nevytvořit relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-108">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.</span></span> <span data-ttu-id="684d9-109">Pokud dojde k ukončení relace a zpráva se pošle prostřednictvím stejného kanálu, vyvolá se výjimka.</span><span class="sxs-lookup"><span data-stu-id="684d9-109">If the session ends and a message is sent through the same channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="684d9-110">Relace WCF mají následující hlavní koncepční funkce:</span><span class="sxs-lookup"><span data-stu-id="684d9-110">WCF sessions have the following main conceptual features:</span></span>  
  
- <span data-ttu-id="684d9-111">Jsou explicitně iniciovány a ukončeny volající aplikací (klient služby WCF).</span><span class="sxs-lookup"><span data-stu-id="684d9-111">They are explicitly initiated and terminated by the calling application (the WCF client).</span></span>  
  
- <span data-ttu-id="684d9-112">Zprávy dodávané během relace jsou zpracovávány v pořadí, ve kterém byly přijaty.</span><span class="sxs-lookup"><span data-stu-id="684d9-112">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
- <span data-ttu-id="684d9-113">Relace korelují skupinu zpráv do konverzace.</span><span class="sxs-lookup"><span data-stu-id="684d9-113">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="684d9-114">Je možné použít různé typy korelace.</span><span class="sxs-lookup"><span data-stu-id="684d9-114">Different types of correlation are possible.</span></span> <span data-ttu-id="684d9-115">Jeden kanál založený na relaci může například korelovat zprávy na základě sdíleného síťového připojení, zatímco jiný kanál založený na relaci může korelovat zprávy na základě sdílené značky v těle zprávy.</span><span class="sxs-lookup"><span data-stu-id="684d9-115">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="684d9-116">Funkce, které mohou být odvozeny z relace závisí na povaze korelace.</span><span class="sxs-lookup"><span data-stu-id="684d9-116">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
- <span data-ttu-id="684d9-117">K relaci WCF není přidruženo žádné obecné úložiště dat.</span><span class="sxs-lookup"><span data-stu-id="684d9-117">There is no general data store associated with a WCF session.</span></span>  
  
 <span data-ttu-id="684d9-118">Pokud znáte třídu <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> v aplikacích ASP.NET a funkcích, které poskytuje, můžete si všimnout následujících rozdílů mezi tímto druhem relace a relacemi WCF:</span><span class="sxs-lookup"><span data-stu-id="684d9-118">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in ASP.NET applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:</span></span>  
  
- <span data-ttu-id="684d9-119">ASP.NET relace jsou vždy iniciovány serverem.</span><span class="sxs-lookup"><span data-stu-id="684d9-119">ASP.NET sessions are always server-initiated.</span></span>  
  
- <span data-ttu-id="684d9-120">ASP.NET relace jsou implicitně neuspořádané.</span><span class="sxs-lookup"><span data-stu-id="684d9-120">ASP.NET sessions are implicitly unordered.</span></span>  
  
- <span data-ttu-id="684d9-121">ASP.NET relace poskytují obecný mechanismus pro ukládání dat napříč požadavky.</span><span class="sxs-lookup"><span data-stu-id="684d9-121">ASP.NET sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="684d9-122">Toto téma popisuje:</span><span class="sxs-lookup"><span data-stu-id="684d9-122">This topic describes:</span></span>  
  
- <span data-ttu-id="684d9-123">Výchozí chování při spouštění při použití vazeb založených na relacích ve vrstvě modelu služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-123">The default execution behavior when using session-based bindings in the service model layer.</span></span>  
  
- <span data-ttu-id="684d9-124">Typy funkcí, které poskytují vazby založené na relaci WCF.</span><span class="sxs-lookup"><span data-stu-id="684d9-124">The types of features that the WCF session-based, system-provided bindings provide.</span></span>  
  
- <span data-ttu-id="684d9-125">Vytvoření kontraktu, který deklaruje požadavek relace.</span><span class="sxs-lookup"><span data-stu-id="684d9-125">How to create a contract that declares a session requirement.</span></span>  
  
- <span data-ttu-id="684d9-126">Pochopení a řízení vytvoření a ukončení relace a relace relace k instanci služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-126">How to understand and control the creation and termination of the session and the relationship of the session to the service instance.</span></span>  
  
## <a name="default-execution-behavior-using-sessions"></a><span data-ttu-id="684d9-127">Výchozí chování při provádění pomocí relací</span><span class="sxs-lookup"><span data-stu-id="684d9-127">Default Execution Behavior Using Sessions</span></span>  
 <span data-ttu-id="684d9-128">Vazba, která se pokusí iniciovat relaci, se nazývá vazba *založená na relaci* .</span><span class="sxs-lookup"><span data-stu-id="684d9-128">A binding that attempts to initiate a session is called a *session-based* binding.</span></span> <span data-ttu-id="684d9-129">Kontrakty služby určují, že vyžadují, povolují nebo odmítnou vazby založené na relacích nastavením vlastnosti <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> v rozhraní kontraktu služby (nebo třídě) na jednu z hodnot <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> výčtu.</span><span class="sxs-lookup"><span data-stu-id="684d9-129">Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values.</span></span> <span data-ttu-id="684d9-130">Ve výchozím nastavení je hodnota této vlastnosti <xref:System.ServiceModel.SessionMode.Allowed>, což znamená, že pokud klient používá vazbu založenou na relaci s implementací služby WCF, služba vytvoří a použije poskytnutou relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-130">By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided.</span></span>  
  
 <span data-ttu-id="684d9-131">Když služba WCF akceptuje relaci klienta, jsou ve výchozím nastavení povoleny následující funkce:</span><span class="sxs-lookup"><span data-stu-id="684d9-131">When a WCF service accepts a client session, the following features are enabled by default:</span></span>  
  
1. <span data-ttu-id="684d9-132">Všechna volání mezi objektem klienta WCF jsou zpracovávána stejnou instancí služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-132">All calls between a WCF client object are handled by the same service instance.</span></span>  
  
2. <span data-ttu-id="684d9-133">Různé vazby založené na relacích poskytují další funkce.</span><span class="sxs-lookup"><span data-stu-id="684d9-133">Different session-based bindings provide additional features.</span></span>  
  
## <a name="system-provided-session-types"></a><span data-ttu-id="684d9-134">Typy relací poskytovaných systémem</span><span class="sxs-lookup"><span data-stu-id="684d9-134">System-Provided Session Types</span></span>  
 <span data-ttu-id="684d9-135">Vazba založená na relaci podporuje výchozí přidružení instance služby k určité relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-135">A session-based binding supports the default association of a service instance with a particular session.</span></span> <span data-ttu-id="684d9-136">Jiné vazby založené na relaci však podporují různé funkce kromě povolení výše popsaného řízení vytváření instancí založeného na relacích.</span><span class="sxs-lookup"><span data-stu-id="684d9-136">However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.</span></span>  
  
 <span data-ttu-id="684d9-137">WCF nabízí následující typy chování aplikace založené na relacích:</span><span class="sxs-lookup"><span data-stu-id="684d9-137">WCF provides the following types of session-based application behavior:</span></span>  
  
- <span data-ttu-id="684d9-138"><xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> podporuje relace založené na zabezpečení, ve kterých se na konkrétní zabezpečenou konverzaci dohodla obě konce komunikace.</span><span class="sxs-lookup"><span data-stu-id="684d9-138">The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.</span></span> <span data-ttu-id="684d9-139">Další informace najdete v tématu [zabezpečení služeb](securing-services.md).</span><span class="sxs-lookup"><span data-stu-id="684d9-139">For more information, see [Securing Services](securing-services.md).</span></span> <span data-ttu-id="684d9-140">Například vazba <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType>, která obsahuje podporu pro relace zabezpečení i spolehlivé relace, ve výchozím nastavení používá jenom zabezpečenou relaci, která šifruje a digitálně podepisuje zprávy.</span><span class="sxs-lookup"><span data-stu-id="684d9-140">For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.</span></span>  
  
- <span data-ttu-id="684d9-141">Vazba <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> podporuje relace založené na protokolu TCP/IP, aby se zajistilo, že se všechny zprávy budou korelovat připojením na úrovni soketu.</span><span class="sxs-lookup"><span data-stu-id="684d9-141">The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.</span></span>  
  
- <span data-ttu-id="684d9-142">Element <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType>, který implementuje specifikaci WS-ReliableMessaging, poskytuje podporu pro spolehlivé relace, ve kterých je možné nakonfigurovat zprávy tak, aby byly doručeny v daném pořadí a právě jednou, aby bylo zajištěno, že zprávy jsou přijímány i v případě, že se zprávy během konverzace cestují mezi více uzly.</span><span class="sxs-lookup"><span data-stu-id="684d9-142">The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.</span></span> <span data-ttu-id="684d9-143">Další informace najdete v tématu [spolehlivé relace](./feature-details/reliable-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="684d9-143">For more information, see [Reliable Sessions](./feature-details/reliable-sessions.md).</span></span>  
  
- <span data-ttu-id="684d9-144">Vazba <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> poskytuje relace datagramů MSMQ.</span><span class="sxs-lookup"><span data-stu-id="684d9-144">The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions.</span></span> <span data-ttu-id="684d9-145">Další informace najdete v tématu [fronty ve službě WCF](./feature-details/queues-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="684d9-145">For more information, see [Queues in WCF](./feature-details/queues-in-wcf.md).</span></span>  
  
 <span data-ttu-id="684d9-146">Nastavením vlastnosti <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> neurčíte typ relace, kterou kontrakt vyžaduje, jenom to, že vyžaduje jeden.</span><span class="sxs-lookup"><span data-stu-id="684d9-146">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.</span></span>  
  
## <a name="creating-a-contract-that-requires-a-session"></a><span data-ttu-id="684d9-147">Vytvoření kontraktu, který vyžaduje relaci</span><span class="sxs-lookup"><span data-stu-id="684d9-147">Creating a Contract That Requires a Session</span></span>  
 <span data-ttu-id="684d9-148">Vytvoření kontraktu, který vyžaduje relaci, má za následek, že skupina operací, které kontrakt služby deklaruje, musí být spuštěná v rámci stejné relace a zprávy musí být doručeny v daném pořadí.</span><span class="sxs-lookup"><span data-stu-id="684d9-148">Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.</span></span> <span data-ttu-id="684d9-149">Pokud chcete vyhodnotit úroveň podpory relací, kterou kontrakt služby vyžaduje, nastavte vlastnost <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> v rozhraní nebo třídě kontraktu služby na hodnotu <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> výčtu, abyste určili, jestli kontrakt:</span><span class="sxs-lookup"><span data-stu-id="684d9-149">To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:</span></span>  
  
- <span data-ttu-id="684d9-150">Vyžaduje relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-150">Requires a session.</span></span>  
  
- <span data-ttu-id="684d9-151">Umožňuje klientovi vytvořit relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-151">Allows a client to establish a session.</span></span>  
  
- <span data-ttu-id="684d9-152">Zakáže relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-152">Prohibits a session.</span></span>  
  
 <span data-ttu-id="684d9-153">Nastavení vlastnosti <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> ale neurčuje typ chování založeného na relacích, které kontrakt vyžaduje.</span><span class="sxs-lookup"><span data-stu-id="684d9-153">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires.</span></span> <span data-ttu-id="684d9-154">Instruuje službu WCF, aby ověřila za běhu, že nakonfigurovaná vazba (která vytvoří komunikační kanál) pro službu, není nebo může vytvořit relaci při implementaci služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-154">It instructs WCF to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.</span></span> <span data-ttu-id="684d9-155">Vazba pak může tento požadavek splnit s jakýmkoli typem chování založeného na relacích, který zvolí – zabezpečení, přenos, spolehlivý nebo několik kombinací.</span><span class="sxs-lookup"><span data-stu-id="684d9-155">Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.</span></span> <span data-ttu-id="684d9-156">Přesné chování závisí na vybrané hodnotě <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="684d9-156">The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected.</span></span> <span data-ttu-id="684d9-157">Pokud konfigurovaná vazba služby není v souladu s hodnotou <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="684d9-157">If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown.</span></span> <span data-ttu-id="684d9-158">Vazby a kanály, které vytvoří, jsou označeny jako založené na relacích.</span><span class="sxs-lookup"><span data-stu-id="684d9-158">Bindings and the channels they create that support sessions are said to be session-based.</span></span>  
  
 <span data-ttu-id="684d9-159">Následující kontrakt služby určuje, že všechny operace v `ICalculatorSession` musí být vyměňovány v rámci relace.</span><span class="sxs-lookup"><span data-stu-id="684d9-159">The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session.</span></span> <span data-ttu-id="684d9-160">Žádná operace nevrátí hodnotu volajícímu s výjimkou metody `Equals`.</span><span class="sxs-lookup"><span data-stu-id="684d9-160">None of the operations returns a value to the caller except the `Equals` method.</span></span> <span data-ttu-id="684d9-161">Metoda `Equals` však nepřebírá žádné parametry a proto může vrátit nenulovou hodnotu v rámci relace, ve které již byla data předána do ostatních operací.</span><span class="sxs-lookup"><span data-stu-id="684d9-161">However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.</span></span> <span data-ttu-id="684d9-162">Tato smlouva vyžaduje, aby relace fungovala správně.</span><span class="sxs-lookup"><span data-stu-id="684d9-162">This contract requires a session to function properly.</span></span> <span data-ttu-id="684d9-163">Bez relace přidružené ke konkrétnímu klientovi nemá instance služby žádný způsob, jak poznáte předchozí data, která klient odeslal.</span><span class="sxs-lookup"><span data-stu-id="684d9-163">Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.</span></span>  
  
 [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]
 [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  
  
 <span data-ttu-id="684d9-164">Pokud služba umožňuje relaci, pak se vytvoří relace, která se použije, pokud klient jednu z nich zahájí. v opačném případě se nevytvoří žádná relace.</span><span class="sxs-lookup"><span data-stu-id="684d9-164">If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.</span></span>  
  
## <a name="sessions-and-service-instances"></a><span data-ttu-id="684d9-165">Relace a instance služby</span><span class="sxs-lookup"><span data-stu-id="684d9-165">Sessions and Service Instances</span></span>  
 <span data-ttu-id="684d9-166">Použijete-li výchozí chování vytváření instancí v technologii WCF, všechna volání mezi objektem klienta WCF jsou zpracovávána stejnou instancí služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-166">If you use the default instancing behavior in WCF, all calls between a WCF client object are handled by the same service instance.</span></span> <span data-ttu-id="684d9-167">Proto můžete na úrovni aplikace představit relaci jako povolení chování aplikace podobně jako chování místního volání.</span><span class="sxs-lookup"><span data-stu-id="684d9-167">Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.</span></span> <span data-ttu-id="684d9-168">Například při vytváření místního objektu:</span><span class="sxs-lookup"><span data-stu-id="684d9-168">For example, when you create a local object:</span></span>  
  
- <span data-ttu-id="684d9-169">Je volán konstruktor.</span><span class="sxs-lookup"><span data-stu-id="684d9-169">A constructor is called.</span></span>  
  
- <span data-ttu-id="684d9-170">Všechna následná volání odkaz na objekt klienta služby WCF jsou zpracována stejnou instancí objektu.</span><span class="sxs-lookup"><span data-stu-id="684d9-170">All subsequent calls made to the WCF client object reference are processed by the same object instance.</span></span>  
  
- <span data-ttu-id="684d9-171">Destruktor se volá, když je zničen odkaz na objekt.</span><span class="sxs-lookup"><span data-stu-id="684d9-171">A destructor is called when the object reference is destroyed.</span></span>  
  
 <span data-ttu-id="684d9-172">Relace umožňují podobné chování mezi klienty a službami, pokud se použije výchozí chování instance služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-172">Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.</span></span> <span data-ttu-id="684d9-173">Pokud kontrakt služby vyžaduje nebo podporuje relace, může být jedna nebo víc operací kontraktu označená jako iniciovaná nebo koncová relace nastavením vlastností <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> a <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>.</span><span class="sxs-lookup"><span data-stu-id="684d9-173">If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.</span></span>  
  
 <span data-ttu-id="684d9-174">*Operace inicializace* jsou ty, které se musí volat jako první operace nové relace.</span><span class="sxs-lookup"><span data-stu-id="684d9-174">*Initiating operations* are those that must be called as the first operation of a new session.</span></span> <span data-ttu-id="684d9-175">Operace, které nelze iniciovat, lze volat pouze po volání nejméně jedné operace zahájení.</span><span class="sxs-lookup"><span data-stu-id="684d9-175">Non-initiating operations can be called only after at least one initiating operation has been called.</span></span> <span data-ttu-id="684d9-176">Proto můžete vytvořit druh konstruktoru relace pro vaši službu tím, že deklarujete inicializační operace navržené k převzetí vstupu od klientů odpovídajících začátku instance služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-176">You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.</span></span> <span data-ttu-id="684d9-177">(Stav je přidružen k relaci, ale nikoli k objektu služby.)</span><span class="sxs-lookup"><span data-stu-id="684d9-177">(The state is associated with the session, however, and not the service object.)</span></span>  
  
 <span data-ttu-id="684d9-178">*Koncové operace*, naopak, jsou ty, které se musí volat jako poslední zpráva v existující relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-178">*Terminating operations*, conversely, are those that must be called as the last message in an existing session.</span></span> <span data-ttu-id="684d9-179">Ve výchozím případu služba WCF recykluje objekt služby a jeho kontext po ukončení relace, ke které byla služba přidružena.</span><span class="sxs-lookup"><span data-stu-id="684d9-179">In the default case, WCF recycles the service object and its context after the session with which the service was associated is closed.</span></span> <span data-ttu-id="684d9-180">Můžete tedy vytvořit druh destruktoru deklarováním ukončovacích operací navržených k provedení funkce vhodné na konci instance služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-180">You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="684d9-181">I když je výchozí chování rovno lokálním konstruktorům a destruktorům, je to pouze podobné.</span><span class="sxs-lookup"><span data-stu-id="684d9-181">Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.</span></span> <span data-ttu-id="684d9-182">Jakoukoli operací služby WCF může být operace iniciování nebo ukončení, nebo obojí.</span><span class="sxs-lookup"><span data-stu-id="684d9-182">Any WCF service operation can be an initiating or terminating operation, or both at the same time.</span></span> <span data-ttu-id="684d9-183">Kromě toho ve výchozím případu se iniciované operace můžou v libovolném pořadí volat libovolným počtem časů; Po navázání relace a přidružení s instancí se nevytvoří žádné další relace, pokud explicitně neurčíte dobu života instance služby (při manipulaci s objektem <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType>).</span><span class="sxs-lookup"><span data-stu-id="684d9-183">In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object).</span></span> <span data-ttu-id="684d9-184">Nakonec je tento stav přidružen k relaci, nikoli k objektu služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-184">Finally, the state is associated with the session and not the service object.</span></span>  
  
 <span data-ttu-id="684d9-185">Například kontrakt `ICalculatorSession` použitý v předchozím příkladu vyžaduje, aby objekt klienta WCF nejprve volal operaci `Clear` před jakoukoliv jinou operací a aby relace s tímto objektem klienta WCF při volání operace `Equals` ukončila činnost.</span><span class="sxs-lookup"><span data-stu-id="684d9-185">For example, the `ICalculatorSession` contract used in the preceding example requires that the WCF client object first call the `Clear` operation prior to any other operation and that the session with this WCF client object should terminate when it calls the `Equals` operation.</span></span> <span data-ttu-id="684d9-186">Následující příklad kódu ukazuje kontrakt, který tyto požadavky vynutil.</span><span class="sxs-lookup"><span data-stu-id="684d9-186">The following code example shows a contract that enforces these requirements.</span></span> <span data-ttu-id="684d9-187">aby bylo možné inicializovat relaci, musí být nejprve volána `Clear` a relace končí při volání `Equals`.</span><span class="sxs-lookup"><span data-stu-id="684d9-187">`Clear` must be called first to initiate a session, and that session ends when `Equals` is called.</span></span>  
  
 [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]
 [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  
  
 <span data-ttu-id="684d9-188">Služby nespouštějí relace s klienty.</span><span class="sxs-lookup"><span data-stu-id="684d9-188">Services do not start sessions with clients.</span></span> <span data-ttu-id="684d9-189">V klientských aplikacích WCF existuje přímá relace mezi životností kanálu založeného na relaci a životností samotné relace.</span><span class="sxs-lookup"><span data-stu-id="684d9-189">In WCF client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.</span></span> <span data-ttu-id="684d9-190">V takovém případě klienti vytvářejí nové relace vytvořením nových kanálů založených na relacích a odcházejí stávající relace tím, že budou kanály založené na relacích řádně uzavírat.</span><span class="sxs-lookup"><span data-stu-id="684d9-190">As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.</span></span> <span data-ttu-id="684d9-191">Klient spustí relaci s koncovým bodem služby voláním jedné z následujících možností:</span><span class="sxs-lookup"><span data-stu-id="684d9-191">A client starts a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="684d9-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> na kanálu vráceném voláním <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="684d9-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="684d9-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> objektu klienta WCF generovaného [nástrojem Svcutil. exe (Nástroj pro metadata ServiceModel)](servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="684d9-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the WCF client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span>  
  
- <span data-ttu-id="684d9-194">Operace iniciování na jednom typu objektu klienta WCF (ve výchozím nastavení se spouští všechny operace).</span><span class="sxs-lookup"><span data-stu-id="684d9-194">An initiating operation on either type of WCF client object (by default, all operations are initiating).</span></span> <span data-ttu-id="684d9-195">Když je volána první operace, objekt klienta WCF automaticky otevře kanál a zahájí relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-195">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="684d9-196">Klient obvykle ukončí relaci s koncovým bodem služby voláním jedné z následujících možností:</span><span class="sxs-lookup"><span data-stu-id="684d9-196">Typically a client ends a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="684d9-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> na kanálu vráceném voláním <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="684d9-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="684d9-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> objektu klienta WCF generovaného nástrojem Svcutil. exe.</span><span class="sxs-lookup"><span data-stu-id="684d9-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the WCF client object generated by Svcutil.exe.</span></span>  
  
- <span data-ttu-id="684d9-199">Ukončující operace na jednom typu objektu klienta WCF (ve výchozím nastavení se neukončí žádné operace; kontrakt musí explicitně zadat ukončující operaci).</span><span class="sxs-lookup"><span data-stu-id="684d9-199">A terminating operation on either type of WCF client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).</span></span> <span data-ttu-id="684d9-200">Když je volána první operace, objekt klienta WCF automaticky otevře kanál a zahájí relaci.</span><span class="sxs-lookup"><span data-stu-id="684d9-200">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="684d9-201">Příklady najdete v tématu [Postupy: vytvoření služby, která vyžaduje relace,](./feature-details/how-to-create-a-service-that-requires-sessions.md) a také [výchozí chování služby](./samples/default-service-behavior.md) a ukázky vytváření [instancí](./samples/instancing.md) .</span><span class="sxs-lookup"><span data-stu-id="684d9-201">For examples, see [How to: Create a Service That Requires Sessions](./feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](./samples/default-service-behavior.md) and [Instancing](./samples/instancing.md) samples.</span></span>  
  
 <span data-ttu-id="684d9-202">Další informace o klientech a relacích najdete v tématu [přístup ke službám pomocí klienta WCF](./feature-details/accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="684d9-202">For more information about clients and sessions, see [Accessing Services Using a WCF Client](./feature-details/accessing-services-using-a-client.md).</span></span>  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="684d9-203">Relace pracují s nastavením InstanceContext</span><span class="sxs-lookup"><span data-stu-id="684d9-203">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="684d9-204">Existuje interakce mezi výčtem <xref:System.ServiceModel.SessionMode> ve kontraktu a vlastností <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType>, která řídí přidružení mezi kanály a konkrétními objekty služby.</span><span class="sxs-lookup"><span data-stu-id="684d9-204">There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects.</span></span> <span data-ttu-id="684d9-205">Další informace najdete v tématu [relace, vytváření instancí a souběžnost](./feature-details/sessions-instancing-and-concurrency.md).</span><span class="sxs-lookup"><span data-stu-id="684d9-205">For more information, see [Sessions, Instancing, and Concurrency](./feature-details/sessions-instancing-and-concurrency.md).</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="684d9-206">Sdílení objektů InstanceContext</span><span class="sxs-lookup"><span data-stu-id="684d9-206">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="684d9-207">Můžete také určit, ke kterému kanálu nebo volání založenému na relaci je přidruženo, které <xref:System.ServiceModel.InstanceContext> objekt provádí přidružení sami.</span><span class="sxs-lookup"><span data-stu-id="684d9-207">You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span> 
  
## <a name="sessions-and-streaming"></a><span data-ttu-id="684d9-208">Relace a streamování</span><span class="sxs-lookup"><span data-stu-id="684d9-208">Sessions and Streaming</span></span>  
 <span data-ttu-id="684d9-209">Pokud máte velké množství dat, která se mají přenést, je režim přenosu streamování ve službě WCF vhodná alternativa k výchozímu chování ukládání zpráv do vyrovnávací paměti a jejich zpracování v celé paměti.</span><span class="sxs-lookup"><span data-stu-id="684d9-209">When you have a large amount of data to transfer, the streaming transfer mode in WCF is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.</span></span> <span data-ttu-id="684d9-210">Může dojít k neočekávanému chování při volání streamování s vazbou založenou na relacích.</span><span class="sxs-lookup"><span data-stu-id="684d9-210">You may get unexpected behavior when streaming calls with a session-based binding.</span></span> <span data-ttu-id="684d9-211">Všechna volání streamování se provádějí pomocí jednoho kanálu (kanálu Datagram), který nepodporuje relace ani v případě, že použitá vazba je nakonfigurovaná tak, aby používala relace.</span><span class="sxs-lookup"><span data-stu-id="684d9-211">All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.</span></span> <span data-ttu-id="684d9-212">Pokud více klientů provede volání do stejného objektu služby přes vazbu založenou na relaci a režim souběžnosti objektu služby je nastaven na hodnotu Single a kontextový režim instance je nastaven na `PerSession`, všechna volání musí projít kanálem datagramu a takže pouze jedno volání je zpracováváno v jednom okamžiku.</span><span class="sxs-lookup"><span data-stu-id="684d9-212">If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time.</span></span> <span data-ttu-id="684d9-213">Jeden nebo více klientů může vyprší časový limit. Tento problém můžete obejít tak, že nastavíte `InstanceContextMode` objektu služby na hodnotu `PerCall` nebo souběžnost na násobek.</span><span class="sxs-lookup"><span data-stu-id="684d9-213">One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="684d9-214">MaxConcurrentSessions se v tomto případě nijak neprojeví, protože je k dispozici pouze jedna relace.</span><span class="sxs-lookup"><span data-stu-id="684d9-214">MaxConcurrentSessions have no effect in this case because there is only one "session" available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="684d9-215">Viz také:</span><span class="sxs-lookup"><span data-stu-id="684d9-215">See also</span></span>

- <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>
