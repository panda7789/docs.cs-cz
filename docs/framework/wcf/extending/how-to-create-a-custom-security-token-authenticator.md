---
title: 'Postupy: Vytvoření vlastního ověřovacího modulu tokenu zabezpečení'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
author: BrucePerlerMS
manager: mbaldwin
ms.openlocfilehash: cbd45580e84a0723d28bab538bc0ffe388899d61
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/05/2018
ms.locfileid: "43724419"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="ad36d-102">Postupy: Vytvoření vlastního ověřovacího modulu tokenu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="ad36d-102">How to: Create a Custom Security Token Authenticator</span></span>
<span data-ttu-id="ad36d-103">Toto téma ukazuje, jak vytvořit ověřovací data tokenu zabezpečení vlastní a jak ji integrovat s Správce tokenů zabezpečení vlastní.</span><span class="sxs-lookup"><span data-stu-id="ad36d-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="ad36d-104">Ověřovací data tokenu zabezpečení ověří obsah token zabezpečení, opatřeného příchozí zprávy.</span><span class="sxs-lookup"><span data-stu-id="ad36d-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="ad36d-105">Pokud je ověření úspěšné, ověřovacích vrátí kolekci <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instancí, které, při vyhodnocování, vrátí sadu deklarací identity.</span><span class="sxs-lookup"><span data-stu-id="ad36d-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="ad36d-106">Určený ověřovací data tokenu zabezpečení vlastní ve Windows Communication Foundation (WCF), musíte nejprve vytvořit vlastní přihlašovací údaje a zabezpečení implementace Správce tokenů.</span><span class="sxs-lookup"><span data-stu-id="ad36d-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="ad36d-107">Další informace o vytváření vlastních přihlašovacích údajů a zabezpečení Správce tokenů najdete v tématu [návod: vytvoření vlastního klienta a pověření služby](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="ad36d-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span> <span data-ttu-id="ad36d-108">Další informace o pověření, Správce tokenů zabezpečení a třídy zprostředkovatele a ověřovací data, najdete v části [architektury zabezpečení](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span><span class="sxs-lookup"><span data-stu-id="ad36d-108">For more information about credentials, security token manager, and provider and authenticator classes, see [Security Architecture](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="ad36d-109">Procedury</span><span class="sxs-lookup"><span data-stu-id="ad36d-109">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="ad36d-110">Chcete-li vytvořit vlastní bezpečnostní ověřovací data tokenu</span><span class="sxs-lookup"><span data-stu-id="ad36d-110">To create a custom security token authenticator</span></span>  
  
1.  <span data-ttu-id="ad36d-111">Definovat nové třídy odvozené od <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> třídy.</span><span class="sxs-lookup"><span data-stu-id="ad36d-111">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2.  <span data-ttu-id="ad36d-112">Přepsat <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ad36d-112">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="ad36d-113">Metoda vrátí `true` nebo `false` v závislosti na tom, zda vlastní ověřovací data můžete ověřit příchozí typ tokenu nebo ne.</span><span class="sxs-lookup"><span data-stu-id="ad36d-113">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3.  <span data-ttu-id="ad36d-114">Přepsat <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ad36d-114">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="ad36d-115">Tato metoda je potřeba ověřit token obsah odpovídajícím způsobem.</span><span class="sxs-lookup"><span data-stu-id="ad36d-115">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="ad36d-116">Pokud token, který projde krokem ověření, vrátí kolekci <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instancí.</span><span class="sxs-lookup"><span data-stu-id="ad36d-116">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="ad36d-117">Následující příklad používá implementaci zásad autorizace, která bude vytvořena v dalším postupu.</span><span class="sxs-lookup"><span data-stu-id="ad36d-117">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="ad36d-118">Vrátí kolekci objektů zásad autorizace v předchozím kódu <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> metody.</span><span class="sxs-lookup"><span data-stu-id="ad36d-118">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="ad36d-119">WCF neposkytuje veřejné implementace tohoto rozhraní.</span><span class="sxs-lookup"><span data-stu-id="ad36d-119">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="ad36d-120">Následující postup ukazuje, jak na to pro vaše požadavky.</span><span class="sxs-lookup"><span data-stu-id="ad36d-120">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="ad36d-121">Chcete-li vytvořit vlastní zásady autorizace</span><span class="sxs-lookup"><span data-stu-id="ad36d-121">To create a custom authorization policy</span></span>  
  
1.  <span data-ttu-id="ad36d-122">Definovat novou implementaci třídy <xref:System.IdentityModel.Policy.IAuthorizationPolicy> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="ad36d-122">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2.  <span data-ttu-id="ad36d-123">Implementace <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> vlastnost jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="ad36d-123">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="ad36d-124">Jedním ze způsobů implementace této vlastnosti je v konstruktoru třídy generovat globálně jedinečný identifikátor (GUID) a vrátit ho pokaždé, když je požadována hodnota této vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="ad36d-124">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3.  <span data-ttu-id="ad36d-125">Implementace <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> vlastnost jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="ad36d-125">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="ad36d-126">Tato vlastnost musí vrátit vystavitele sad deklarací identity, které jsou získány z tokenu.</span><span class="sxs-lookup"><span data-stu-id="ad36d-126">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="ad36d-127">Vystavitel tokenu nebo autoritu, která zodpovídá za ověření tokenu obsah by měl odpovídat vystaviteli.</span><span class="sxs-lookup"><span data-stu-id="ad36d-127">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="ad36d-128">Následující příklad používá deklarace identity vystavitele, který předá do této třídy z vlastní ověřovací data tokenu zabezpečení vytvořené v předchozím postupu.</span><span class="sxs-lookup"><span data-stu-id="ad36d-128">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="ad36d-129">Ověřovací data tokenu zabezpečení vlastní používá sadu deklarací poskytovaných systémem (vrácené <xref:System.IdentityModel.Claims.ClaimSet.System%2A> vlastnost) představující vystavitele tokenu uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="ad36d-129">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4.  <span data-ttu-id="ad36d-130">Implementace <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ad36d-130">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="ad36d-131">Tato metoda naplní instance <xref:System.IdentityModel.Policy.EvaluationContext> třídy (předanou jako argument) s deklarací identity, které jsou založeny na příchozí obsah tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="ad36d-131">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="ad36d-132">Metoda vrátí `true` po dokončení hodnocení.</span><span class="sxs-lookup"><span data-stu-id="ad36d-132">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="ad36d-133">V případech, při implementaci spoléhá na přítomnost jiných zásad autorizace, které poskytují další informace, které kontext vyhodnocení, tato metoda může vrátit `false` Pokud není k dispozici požadované informace ještě v rámci vyhodnocení.</span><span class="sxs-lookup"><span data-stu-id="ad36d-133">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="ad36d-134">V takovém případě WCF se znovu za vaše rozhodnutí vyzkoušet všechny zásady autorizace pro příchozí zprávy vygenerovat, pokud alespoň jedna z těchto zásad autorizace změnit kontext vyhodnocení volání metody.</span><span class="sxs-lookup"><span data-stu-id="ad36d-134">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  
  
 <span data-ttu-id="ad36d-135">[Návod: Vytvoření vlastního klienta a pověření služby](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) popisuje, jak vytvořit vlastní přihlašovací údaje a vlastní bezpečnostní správce tokenů.</span><span class="sxs-lookup"><span data-stu-id="ad36d-135">[Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="ad36d-136">Použít vlastní ověřovací data tokenu zabezpečení vytvořené, implementace Správce tokenů zabezpečení je upravit tak, aby vrátit vlastní ověřovací data z <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="ad36d-136">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="ad36d-137">Pokud požadavek na token zabezpečení je předáno, vrátí metoda ověřovací data.</span><span class="sxs-lookup"><span data-stu-id="ad36d-137">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="ad36d-138">Ověřovací data tokenu zabezpečení vlastní integrovat Správce tokenů zabezpečení vlastní</span><span class="sxs-lookup"><span data-stu-id="ad36d-138">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1.  <span data-ttu-id="ad36d-139">Přepsat <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> metodu ve vaší implementaci správce tokenů zabezpečení vlastní.</span><span class="sxs-lookup"><span data-stu-id="ad36d-139">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2.  <span data-ttu-id="ad36d-140">Přidejte logiku do metody, který umožňuje vrátit vaše vlastní ověřovací data tokenu zabezpečení na základě <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parametru.</span><span class="sxs-lookup"><span data-stu-id="ad36d-140">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="ad36d-141">Následující příklad vrátí ověřovací data tokenu zabezpečení vlastní, pokud typ tokenu požadavky tokenu je uživatelské jméno (představované <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> vlastnost) a směr zprávy, které jsou požadovány ověřovací data tokenu zabezpečení je vstupu ( reprezentována <xref:System.ServiceModel.Description.MessageDirection.Input> pole).</span><span class="sxs-lookup"><span data-stu-id="ad36d-141">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  
  
## <a name="see-also"></a><span data-ttu-id="ad36d-142">Viz také</span><span class="sxs-lookup"><span data-stu-id="ad36d-142">See Also</span></span>  
 <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>  
 <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>  
 <xref:System.IdentityModel.Selectors.SecurityTokenManager>  
 <xref:System.IdentityModel.Tokens.UserNameSecurityToken>  
 [<span data-ttu-id="ad36d-143">Návod: Vytvoření vlastních přihlašovacích údajů klienta a služby</span><span class="sxs-lookup"><span data-stu-id="ad36d-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)  
 [<span data-ttu-id="ad36d-144">Postupy: Vytvoření vlastního zprostředkovatele tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="ad36d-144">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
 [<span data-ttu-id="ad36d-145">Architektura zabezpečení</span><span class="sxs-lookup"><span data-stu-id="ad36d-145">Security Architecture</span></span>](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f)
