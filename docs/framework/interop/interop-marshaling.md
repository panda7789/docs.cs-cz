---
title: Zařazování spolupráce
ms.date: 03/30/2017
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
ms.openlocfilehash: 70514811a9d236dc485f64fc34297cdb057a1512
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/30/2019
ms.locfileid: "73124278"
---
# <a name="interop-marshaling"></a><span data-ttu-id="d2b1f-102">Zařazování spolupráce</span><span class="sxs-lookup"><span data-stu-id="d2b1f-102">Interop Marshaling</span></span>

<span data-ttu-id="d2b1f-103">Zařazování spolupráce určuje, jak jsou data předávána v argumentech metody a návratové hodnoty mezi spravovanou a nespravovanou pamětí během volání.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="d2b1f-104">Zařazování Interop je běhová aktivita prováděná zařazováním služby Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>

<span data-ttu-id="d2b1f-105">Většina datových typů má běžné reprezentace v spravované i nespravované paměti.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="d2b1f-106">Zařazovací modul Interop tyto typy zpracovává za vás.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="d2b1f-107">Jiné typy mohou být dvojznačné nebo nejsou ve spravované paměti zastoupeny vůbec.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>

<span data-ttu-id="d2b1f-108">Nejednoznačný typ může mít buď více nespravovaných reprezentací, které jsou mapovány na jeden spravovaný typ, nebo chybějící informace o typu, například velikost pole.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="d2b1f-109">Pro dvojznačné typy zařazovací modul poskytuje výchozí reprezentaci a alternativní reprezentace, u nichž existuje více reprezentujes.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="d2b1f-110">Zařazovacímu objektu můžete zadat explicitní pokyny k zařazení nejednoznačného typu.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>

## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="d2b1f-111">Volání platforem a modely spolupráce modelu COM</span><span class="sxs-lookup"><span data-stu-id="d2b1f-111">Platform Invoke and COM Interop Models</span></span>

<span data-ttu-id="d2b1f-112">Modul CLR (Common Language Runtime) poskytuje dva mechanismy pro spolupráci s nespravovaným kódem:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-112">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>

- <span data-ttu-id="d2b1f-113">Vyvolání platformy, které umožňuje spravovanému kódu volat funkce exportované z nespravované knihovny.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-113">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>
- <span data-ttu-id="d2b1f-114">Zprostředkovatel komunikace s objekty COM, který umožňuje spravovanému kódu pracovat s objekty modelu COM (Component Object Model) prostřednictvím rozhraní.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-114">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>

<span data-ttu-id="d2b1f-115">Volání metody a zprostředkovatel komunikace s objekty COM používají interop marshaling k přesnému přesunu argumentů mezi volajícím a volaným a zpětným voláním v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-115">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="d2b1f-116">Jak ukazuje následující obrázek, metoda vyvolání platformy volá toky ze spravovaného do nespravovaného kódu a nikdy jiný způsob, s výjimkou případů, kdy jsou zapojeny [funkce zpětného volání](callback-functions.md) .</span><span class="sxs-lookup"><span data-stu-id="d2b1f-116">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](callback-functions.md) are involved.</span></span> <span data-ttu-id="d2b1f-117">I když volání vyvolání platformy mohou směrovat pouze ze spravovaného do nespravovaného kódu, data mohou být v obou směrech předávána jako vstupní nebo výstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-117">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="d2b1f-118">Volání metod Interop modelu COM mohou tok v obou směrech.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-118">COM interop method calls can flow in either direction.</span></span>

<span data-ttu-id="d2b1f-119">![Vyvolání platformy](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Volání platformy a tok volání Interop modelu COM")</span><span class="sxs-lookup"><span data-stu-id="d2b1f-119">![Platform invoke](./media/interop-marshaling/interop-marshaling-invoke-and-com.png "Platform invoke and COM interop call flow")</span></span>

<span data-ttu-id="d2b1f-120">Na nejnižší úrovni oba mechanismy používají stejnou službu interop marshaling; Některé typy dat jsou však podporovány výhradně pomocí zprostředkovatele komunikace s objekty COM nebo voláním platformy.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-120">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="d2b1f-121">Podrobnosti najdete v tématu [výchozí chování zařazování](default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="d2b1f-121">For details, see [Default Marshaling Behavior](default-marshaling-behavior.md).</span></span>

## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="d2b1f-122">Zařazování a COM Apartment</span><span class="sxs-lookup"><span data-stu-id="d2b1f-122">Marshaling and COM Apartments</span></span>

<span data-ttu-id="d2b1f-123">Zařazovací modul Interop zařazuje data mezi haldou společného jazykového modulu runtime a nespravovanou haldou.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-123">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="d2b1f-124">Zařazování probíhá vždy, když volající a volaný nemůže pracovat na stejné instanci dat.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-124">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="d2b1f-125">Zařazovací modul interoperability umožňuje volajícímu a volanému, aby mohl být provozován na stejných datech, i když mají svou vlastní kopii dat.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-125">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>

<span data-ttu-id="d2b1f-126">Model COM má také zařazovací modul, který zařazování dat mezi objekty COM Apartment nebo různými procesy COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-126">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="d2b1f-127">Při volání mezi spravovaným a nespravovaným kódem v rámci stejného objektu COM Apartment je zařazovací modul interoperability jediným zařazovacím objektem.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-127">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="d2b1f-128">Při volání mezi spravovaným kódem a nespravovaným kódem v jiném izolovaném modelu COM nebo jiném procesu jsou zapojeny i zařazovací a zařazovací modul COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-128">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>

### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="d2b1f-129">Klienti modelu COM a spravované servery</span><span class="sxs-lookup"><span data-stu-id="d2b1f-129">COM Clients and Managed Servers</span></span>

<span data-ttu-id="d2b1f-130">Exportovaný spravovaný server s knihovnou typů zaregistrovanou modulem [Regasm. exe (nástroj registrace sestavení)](../tools/regasm-exe-assembly-registration-tool.md) má položku `ThreadingModel` registru nastavenou na `Both`.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-130">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="d2b1f-131">Tato hodnota indikuje, že server může být aktivovaný v prostředí STA (Single-threaded Apartment) nebo v modelu MTA (Apartment).</span><span class="sxs-lookup"><span data-stu-id="d2b1f-131">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="d2b1f-132">Objekt serveru je vytvořen ve stejném typu Apartment jako jeho volající, jak je znázorněno v následující tabulce:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-132">The server object is created in the same apartment as its caller, as shown in the following table:</span></span>

|<span data-ttu-id="d2b1f-133">Klient modelu COM</span><span class="sxs-lookup"><span data-stu-id="d2b1f-133">COM client</span></span>|<span data-ttu-id="d2b1f-134">Server .NET</span><span class="sxs-lookup"><span data-stu-id="d2b1f-134">.NET server</span></span>|<span data-ttu-id="d2b1f-135">Požadavky zařazování</span><span class="sxs-lookup"><span data-stu-id="d2b1f-135">Marshaling requirements</span></span>|
|----------------|-----------------|-----------------------------|
|<span data-ttu-id="d2b1f-136">REŽIMU</span><span class="sxs-lookup"><span data-stu-id="d2b1f-136">STA</span></span>|<span data-ttu-id="d2b1f-137">`Both`Vytvoří STA.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-137">`Both` becomes STA.</span></span>|<span data-ttu-id="d2b1f-138">Zařazování do stejného typu apartment.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-138">Same-apartment marshaling.</span></span>|
|<span data-ttu-id="d2b1f-139">Agent</span><span class="sxs-lookup"><span data-stu-id="d2b1f-139">MTA</span></span>|<span data-ttu-id="d2b1f-140">`Both`se staly MTA.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-140">`Both` becomes MTA.</span></span>|<span data-ttu-id="d2b1f-141">Zařazování do stejného typu apartment.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-141">Same-apartment marshaling.</span></span>|

<span data-ttu-id="d2b1f-142">Vzhledem k tomu, že klient a Server jsou ve stejném typu apartment, služba interop marshaling automaticky zpracovává všechna zařazování dat.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-142">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="d2b1f-143">Následující ilustrace znázorňuje interop marshaling službu, která je provozována mezi spravovanými a nespravovanými haldami v rámci stejného typu Apartment ve stylu COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-143">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>

<span data-ttu-id="d2b1f-144">![Spolupráce při zařazování mezi spravovanými a nespravovanými haldami](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Proces zařazování stejného typu Apartment")</span><span class="sxs-lookup"><span data-stu-id="d2b1f-144">![Interop marshaling between managed and unmanaged heaps](./media/interop-marshaling/interop-heaps-managed-and-unmanaged.gif "Same-apartment marshaling process")</span></span>

<span data-ttu-id="d2b1f-145">Pokud plánujete exportovat spravovaný server, uvědomte si, že klient COM určí byt serveru.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-145">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="d2b1f-146">Spravovaný server, který je volán klientem modelu COM inicializovaným v modelu MTA, musí zajistit bezpečnost vlákna.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-146">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>

### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="d2b1f-147">Spravované klienty a servery COM</span><span class="sxs-lookup"><span data-stu-id="d2b1f-147">Managed Clients and COM Servers</span></span>

<span data-ttu-id="d2b1f-148">Výchozím nastavením pro objekty Apartment spravovaného klienta je MTA; Typ aplikace klienta .NET však může změnit výchozí nastavení.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-148">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="d2b1f-149">Například Visual Basic nastavení klienta Apartment je STA.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-149">For example, a Visual Basic client apartment setting is STA.</span></span> <span data-ttu-id="d2b1f-150">Pro kontrolu a změnu <xref:System.STAThreadAttribute?displayProperty=nameWithType>nastavení bytu <xref:System.MTAThreadAttribute?displayProperty=nameWithType>spravovaného <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> klienta můžete použít <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> vlastnost,, vlastnost nebo vlastnost.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-150">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>

<span data-ttu-id="d2b1f-151">Autor komponenty nastaví spřažení vlákna pro server COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-151">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="d2b1f-152">V následující tabulce jsou uvedeny kombinace nastavení bytu pro klienty rozhraní .NET a servery COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-152">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="d2b1f-153">Zobrazuje také výsledné požadavky na zařazování pro kombinace.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-153">It also shows the resulting marshaling requirements for the combinations.</span></span>

|<span data-ttu-id="d2b1f-154">Klient .NET</span><span class="sxs-lookup"><span data-stu-id="d2b1f-154">.NET client</span></span>|<span data-ttu-id="d2b1f-155">Server COM</span><span class="sxs-lookup"><span data-stu-id="d2b1f-155">COM server</span></span>|<span data-ttu-id="d2b1f-156">Požadavky zařazování</span><span class="sxs-lookup"><span data-stu-id="d2b1f-156">Marshaling requirements</span></span>|
|-----------------|----------------|-----------------------------|
|<span data-ttu-id="d2b1f-157">MTA (výchozí)</span><span class="sxs-lookup"><span data-stu-id="d2b1f-157">MTA (default)</span></span>|<span data-ttu-id="d2b1f-158">Agent</span><span class="sxs-lookup"><span data-stu-id="d2b1f-158">MTA</span></span><br /><br /> <span data-ttu-id="d2b1f-159">REŽIMU</span><span class="sxs-lookup"><span data-stu-id="d2b1f-159">STA</span></span>|<span data-ttu-id="d2b1f-160">Zařazování Interop.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-160">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="d2b1f-161">Interoperabilita a zařazování modelu COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-161">Interop and COM marshaling.</span></span>|
|<span data-ttu-id="d2b1f-162">REŽIMU</span><span class="sxs-lookup"><span data-stu-id="d2b1f-162">STA</span></span>|<span data-ttu-id="d2b1f-163">Agent</span><span class="sxs-lookup"><span data-stu-id="d2b1f-163">MTA</span></span><br /><br /> <span data-ttu-id="d2b1f-164">REŽIMU</span><span class="sxs-lookup"><span data-stu-id="d2b1f-164">STA</span></span>|<span data-ttu-id="d2b1f-165">Interoperabilita a zařazování modelu COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-165">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="d2b1f-166">Zařazování Interop.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-166">Interop marshaling.</span></span>|

<span data-ttu-id="d2b1f-167">Pokud jsou spravovaný klient a nespravovaný Server ve stejném typu apartment, služba interop marshaling zpracovává všechna zařazování dat.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-167">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="d2b1f-168">Pokud je ale klient a server inicializovaný v různých podsystémech, vyžaduje se také zařazování COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-168">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="d2b1f-169">Následující ilustrace znázorňuje prvky volání křížového typu:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-169">The following illustration shows the elements of a cross-apartment call:</span></span>

<span data-ttu-id="d2b1f-170">![Zařazování modelu COM](./media/interop-marshaling/single-process-across-multi-apartment.gif "Volání mezi klienty .NET a objektem COM")</span><span class="sxs-lookup"><span data-stu-id="d2b1f-170">![COM marshaling](./media/interop-marshaling/single-process-across-multi-apartment.gif "Cross-apartment call between a .NET client and COM object")</span></span>

<span data-ttu-id="d2b1f-171">Pro zařazování mezi platformami můžete provádět následující akce:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-171">For cross-apartment marshaling, you can do the following:</span></span>

- <span data-ttu-id="d2b1f-172">Přijměte režii k zařazování mezi jednotlivými platformami, což je patrné jenom v případě, že hranice obsahuje mnoho volání.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-172">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="d2b1f-173">Je nutné zaregistrovat knihovnu typů komponenty modelu COM pro volání úspěšného křížení hranice objektu apartment.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-173">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>
- <span data-ttu-id="d2b1f-174">Změňte hlavní vlákno nastavením vlákna klienta na STA nebo MTA.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-174">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="d2b1f-175">Například pokud váš klient C# volá mnoho komponent modelu COM STA, můžete zamezit zařazování na více platforem nastavením hlavního vlákna na STA.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-175">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d2b1f-176">Jakmile je vlákno klienta v jazyce C# nastaveno na hodnotu STA, budou volání komponent modelu COM MTA vyžadovat zařazování mezi prostředími.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-176">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>

<span data-ttu-id="d2b1f-177">Pokyny, jak explicitně vybrat model Apartment, najdete v tématu [spravovaná a nespravované vlákno](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="d2b1f-177">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/5s8ee185(v=vs.100)).</span></span>

## <a name="marshaling-remote-calls"></a><span data-ttu-id="d2b1f-178">Zařazování vzdálených volání</span><span class="sxs-lookup"><span data-stu-id="d2b1f-178">Marshaling Remote Calls</span></span>

<span data-ttu-id="d2b1f-179">Podobně jako při zařazování do více platforem je zařazování do modelu COM zapojeno do každého volání mezi spravovaným a nespravovaným kódem, kdykoli se objekty nacházejí v samostatných procesech.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-179">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="d2b1f-180">Příklad:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-180">For example:</span></span>

- <span data-ttu-id="d2b1f-181">Klient COM, který vyvolá spravovaný server na vzdáleném hostiteli, používá Distributed COM (DCOM).</span><span class="sxs-lookup"><span data-stu-id="d2b1f-181">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>
- <span data-ttu-id="d2b1f-182">Spravovaný klient, který vyvolá server COM na vzdáleném hostiteli, používá model DCOM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-182">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>

<span data-ttu-id="d2b1f-183">Následující obrázek ukazuje, jak interop marshaling a COM zařazování poskytují komunikační kanály napříč procesy a hranicemi hostitele:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-183">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries:</span></span>

<span data-ttu-id="d2b1f-184">![Zařazování modelu COM](./media/interop-marshaling/interop-and-com-marshaling.gif "Zařazování mezi procesy")</span><span class="sxs-lookup"><span data-stu-id="d2b1f-184">![COM marshaling](./media/interop-marshaling/interop-and-com-marshaling.gif "Cross-process marshaling")</span></span>

### <a name="preserving-identity"></a><span data-ttu-id="d2b1f-185">Zachování identity</span><span class="sxs-lookup"><span data-stu-id="d2b1f-185">Preserving Identity</span></span>

<span data-ttu-id="d2b1f-186">Modul CLR (Common Language Runtime) zachovává identitu spravovaných a nespravovaných odkazů.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-186">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="d2b1f-187">Následující ilustrace znázorňuje tok přímých nespravovaných odkazů (horní řádek) a přímé spravované odkazy (dolní řádek) napříč hranicemi procesu a hostitele.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-187">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>

<span data-ttu-id="d2b1f-188">![Obálka s příchodem modelu COM a vyvolané za běhu](./media/interop-marshaling/interop-direct-ref-across-process.gif "Reference procházející přes hranice procesu a hostitele")</span><span class="sxs-lookup"><span data-stu-id="d2b1f-188">![COM callable wrapper and runtime callable wrapper](./media/interop-marshaling/interop-direct-ref-across-process.gif "Reference passing across process and host boundaries")</span></span>

<span data-ttu-id="d2b1f-189">Na tomto obrázku:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-189">In this illustration:</span></span>

- <span data-ttu-id="d2b1f-190">Nespravovaný klient získá odkaz na objekt modelu COM ze spravovaného objektu, který získá tento odkaz ze vzdáleného hostitele.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-190">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="d2b1f-191">Mechanismus vzdálené komunikace je DCOM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-191">The remoting mechanism is DCOM.</span></span>
- <span data-ttu-id="d2b1f-192">Spravovaný klient získá odkaz na spravovaný objekt z objektu COM, který získá tento odkaz ze vzdáleného hostitele.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-192">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="d2b1f-193">Mechanismus vzdálené komunikace je DCOM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-193">The remoting mechanism is DCOM.</span></span>

    > [!NOTE]
    > <span data-ttu-id="d2b1f-194">Exportovaná knihovna typů spravovaného serveru musí být zaregistrovaná.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-194">The exported type library of the managed server must be registered.</span></span>

<span data-ttu-id="d2b1f-195">Počet hranic procesu mezi volajícím a volaným je nepodstatný; stejný přímý odkazování nastane pro volání v procesu a mimoprocesové procesy.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-195">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>

### <a name="managed-remoting"></a><span data-ttu-id="d2b1f-196">Spravovaná Vzdálená komunikace</span><span class="sxs-lookup"><span data-stu-id="d2b1f-196">Managed Remoting</span></span>

<span data-ttu-id="d2b1f-197">Modul runtime také poskytuje spravovanou vzdálenou komunikaci, kterou můžete použít k vytvoření komunikačního kanálu mezi spravovanými objekty napříč procesy a hranicemi hostitelů.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-197">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="d2b1f-198">Spravovaná Vzdálená komunikace může vyhovovat bráně firewall mezi komunikujícími součástmi, jak je znázorněno na následujícím obrázku:</span><span class="sxs-lookup"><span data-stu-id="d2b1f-198">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows:</span></span>

<span data-ttu-id="d2b1f-199">![SOAP nebo TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Vzdálená volání přes brány firewall pomocí protokolu SOAP nebo třídy TcpChannel") Vzdálená volání přes brány firewall pomocí protokolu SOAP nebo třídy TcpChannel</span><span class="sxs-lookup"><span data-stu-id="d2b1f-199">![SOAP or TcpChannel](./media/interop-marshaling/interop-remote-soap-or-tcp.gif "Remote calls across firewalls using SOAP or the TcpChannel class") Remote calls across firewalls using SOAP or the TcpChannel class</span></span>

<span data-ttu-id="d2b1f-200">Některé nespravované volání lze přesměrovat prostřednictvím protokolu SOAP, například volání mezi službami a komponentami COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-200">Some unmanaged calls can be channeled through SOAP, such as the calls between serviced components and COM.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d2b1f-201">Související témata</span><span class="sxs-lookup"><span data-stu-id="d2b1f-201">Related Topics</span></span>

|<span data-ttu-id="d2b1f-202">Nadpis</span><span class="sxs-lookup"><span data-stu-id="d2b1f-202">Title</span></span>|<span data-ttu-id="d2b1f-203">Popis</span><span class="sxs-lookup"><span data-stu-id="d2b1f-203">Description</span></span>|
|-----------|-----------------|
|[<span data-ttu-id="d2b1f-204">Výchozí chování zařazování</span><span class="sxs-lookup"><span data-stu-id="d2b1f-204">Default Marshaling Behavior</span></span>](default-marshaling-behavior.md)|<span data-ttu-id="d2b1f-205">Popisuje pravidla, která služba interop marshaling používá k zařazování dat.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-205">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|
|[<span data-ttu-id="d2b1f-206">Zařazování dat s voláním platformy</span><span class="sxs-lookup"><span data-stu-id="d2b1f-206">Marshaling Data with Platform Invoke</span></span>](marshaling-data-with-platform-invoke.md)|<span data-ttu-id="d2b1f-207">Popisuje, jak deklarovat parametry metody a předávat argumenty funkcím exportovaným nespravovanými knihovnami.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-207">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|
|[<span data-ttu-id="d2b1f-208">Zařazování dat se spoluprací COM</span><span class="sxs-lookup"><span data-stu-id="d2b1f-208">Marshaling Data with COM Interop</span></span>](marshaling-data-with-com-interop.md)|<span data-ttu-id="d2b1f-209">Popisuje, jak přizpůsobit obálky modelu COM pro změnu chování při zařazování.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-209">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|
|[<span data-ttu-id="d2b1f-210">Postup: Migrace spravovaného kódu DCOM do WCF</span><span class="sxs-lookup"><span data-stu-id="d2b1f-210">How to: Migrate Managed-Code DCOM to WCF</span></span>](how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="d2b1f-211">Popisuje, jak migrovat z modelu DCOM na WCF.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-211">Describes how to migrate from DCOM to WCF.</span></span>|
|[<span data-ttu-id="d2b1f-212">Postupy: Mapování výsledků HRESULT a výjimek</span><span class="sxs-lookup"><span data-stu-id="d2b1f-212">How to: Map HRESULTs and Exceptions</span></span>](how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="d2b1f-213">Popisuje, jak namapovat vlastní výjimky na HRESULTs a poskytuje úplné mapování z každého HRESULT na jeho srovnatelnou třídu výjimek v .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-213">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|
|<span data-ttu-id="d2b1f-214">[Spolupráce pomocí obecných typů](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="d2b1f-214">[Interoperating Using Generic Types](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/ms229590(v=vs.100))</span></span>|<span data-ttu-id="d2b1f-215">Popisuje, které akce jsou podporovány při použití obecných typů pro interoperabilitu modelu COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-215">Describes which actions are supported when using generic types for COM interoperability.</span></span>|
|[<span data-ttu-id="d2b1f-216">Spolupráce s nespravovaným kódem</span><span class="sxs-lookup"><span data-stu-id="d2b1f-216">Interoperating with Unmanaged Code</span></span>](index.md)|<span data-ttu-id="d2b1f-217">Popisuje služby vzájemné funkční spolupráce poskytované modulem CLR (Common Language Runtime).</span><span class="sxs-lookup"><span data-stu-id="d2b1f-217">Describes interoperability services provided by the common language runtime.</span></span>|
|<span data-ttu-id="d2b1f-218">[Pokročilá interoperabilita modelu COM](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="d2b1f-218">[Advanced COM Interoperability](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bd9cdfyx(v=vs.100))</span></span>|<span data-ttu-id="d2b1f-219">Obsahuje odkazy na Další informace o zahrnutí komponent modelu COM do aplikace .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-219">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|
|<span data-ttu-id="d2b1f-220">[Faktory návrhu pro spoluprovozování](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="d2b1f-220">[Design Considerations for Interoperation](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/61aax4kh(v=vs.100))</span></span>|<span data-ttu-id="d2b1f-221">Poskytuje tipy pro psaní integrovaných komponent modelu COM.</span><span class="sxs-lookup"><span data-stu-id="d2b1f-221">Provides tips for writing integrated COM components.</span></span>|

## <a name="reference"></a><span data-ttu-id="d2b1f-222">Referenční informace</span><span class="sxs-lookup"><span data-stu-id="d2b1f-222">Reference</span></span>

<xref:System.Runtime.InteropServices?displayProperty=nameWithType>
