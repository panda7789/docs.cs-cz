---
title: "Implementace virtuálního režimu s načítáním dat za běhu v ovládacím prvku Windows Forms DataGridView"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-winforms
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- examples [Windows Forms], just-in-time data loading
- data [Windows Forms], managing large data sets
- DataGridView control [Windows Forms], virtual mode
- just-in-time data loading
- DataGridView control [Windows Forms], large data sets
- virtual mode [Windows Forms], just-in-time data loading
ms.assetid: c2a052b9-423c-4ff7-91dc-d8c7c79345f6
caps.latest.revision: "13"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 0bddac01a0d85ae985b54587619bcac6de5f966f
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/21/2017
---
# <a name="implementing-virtual-mode-with-just-in-time-data-loading-in-the-windows-forms-datagridview-control"></a><span data-ttu-id="b7c13-102">Implementace virtuálního režimu s načítáním dat za běhu v ovládacím prvku Windows Forms DataGridView</span><span class="sxs-lookup"><span data-stu-id="b7c13-102">Implementing Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>
<span data-ttu-id="b7c13-103">Jedním z důvodů implementace virtuálního režimu v <xref:System.Windows.Forms.DataGridView> ovládací prvek je k načtení dat pouze dle potřeby.</span><span class="sxs-lookup"><span data-stu-id="b7c13-103">One reason to implement virtual mode in the <xref:System.Windows.Forms.DataGridView> control is to retrieve data only as it is needed.</span></span> <span data-ttu-id="b7c13-104">To se označuje jako *načítání dat za běhu*.</span><span class="sxs-lookup"><span data-stu-id="b7c13-104">This is called *just-in-time data loading*.</span></span>  
  
 <span data-ttu-id="b7c13-105">Pokud pracujete s velmi velké tabulky v vzdálenou databázi, například můžete chtít vyhnout zpoždění spuštění načítání jenom data, která je potřebná pro zobrazení a načítání další data jenom v případě, že uživatel posune nové řádky do zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b7c13-105">If you are working with a very large table in a remote database, for example, you might want to avoid startup delays by retrieving only the data that is necessary for display and retrieving additional data only when the user scrolls new rows into view.</span></span> <span data-ttu-id="b7c13-106">Pokud klientské počítače se systémem aplikaci máte omezené množství paměti k dispozici pro ukládání dat, můžete také chtít zahodit nepoužívané data při získávání nových hodnot z databáze.</span><span class="sxs-lookup"><span data-stu-id="b7c13-106">If the client computers running your application have a limited amount of memory available for storing data, you might also want to discard unused data when retrieving new values from the database.</span></span>  
  
 <span data-ttu-id="b7c13-107">Následující části popisují způsob použití <xref:System.Windows.Forms.DataGridView> ovládacího prvku s mezipamětí za běhu.</span><span class="sxs-lookup"><span data-stu-id="b7c13-107">The following sections describe how to use a <xref:System.Windows.Forms.DataGridView> control with a just-in-time cache.</span></span>  
  
 <span data-ttu-id="b7c13-108">Zkopírujte kód v tomto tématu v jednom seznamu, najdete v části [postupy: Implementace virtuálního režimu s JIT načítání dat v ovládacím prvku Windows Forms DataGridView](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span><span class="sxs-lookup"><span data-stu-id="b7c13-108">To copy the code in this topic as a single listing, see [How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span></span>  
  
## <a name="the-form"></a><span data-ttu-id="b7c13-109">Formulář</span><span class="sxs-lookup"><span data-stu-id="b7c13-109">The Form</span></span>  
 <span data-ttu-id="b7c13-110">Následující příklad kódu definuje formulář obsahující jen pro čtení <xref:System.Windows.Forms.DataGridView> ovládací prvek, který komunikuje se službou `Cache` objektu prostřednictvím <xref:System.Windows.Forms.DataGridView.CellValueNeeded> obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="b7c13-110">The following code example defines a form containing a read-only <xref:System.Windows.Forms.DataGridView> control that interacts with a `Cache` object through a <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler.</span></span> <span data-ttu-id="b7c13-111">`Cache` Objekt spravuje místně uložené hodnoty a používá `DataRetriever` objekt, který chcete načíst hodnoty v tabulce ukázková databáze Northwind.</span><span class="sxs-lookup"><span data-stu-id="b7c13-111">The `Cache` object manages the locally stored values and uses a `DataRetriever` object to retrieve values from the Orders table of the sample Northwind database.</span></span> <span data-ttu-id="b7c13-112">`DataRetriever` Objekt, který implementuje `IDataPageRetriever` rozhraní vyžaduje `Cache` třídy, se používá i k inicializaci <xref:System.Windows.Forms.DataGridView> řízení řádků a sloupců.</span><span class="sxs-lookup"><span data-stu-id="b7c13-112">The `DataRetriever` object, which implements the `IDataPageRetriever` interface required by the `Cache` class, is also used to initialize the <xref:System.Windows.Forms.DataGridView> control rows and columns.</span></span>  
  
 <span data-ttu-id="b7c13-113">`IDataPageRetriever`, `DataRetriever`, A `Cache` typy jsou popsány dále v tomto tématu.</span><span class="sxs-lookup"><span data-stu-id="b7c13-113">The `IDataPageRetriever`, `DataRetriever`, and `Cache` types are described later in this topic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b7c13-114">Ukládání citlivé informace, jako jsou hesla, v připojovacím řetězci může ovlivnit zabezpečení vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="b7c13-114">Storing sensitive information, such as a password, within the connection string can affect the security of your application.</span></span> <span data-ttu-id="b7c13-115">Bezpečnější způsob, jak řídit přístup k databázi, je ověřování systému Windows (označované také jako integrované zabezpečení).</span><span class="sxs-lookup"><span data-stu-id="b7c13-115">Using Windows Authentication (also known as integrated security) is a more secure way to control access to a database.</span></span> <span data-ttu-id="b7c13-116">Další informace najdete v tématu [chrání informace o připojení](../../../../docs/framework/data/adonet/protecting-connection-information.md).</span><span class="sxs-lookup"><span data-stu-id="b7c13-116">For more information, see [Protecting Connection Information](../../../../docs/framework/data/adonet/protecting-connection-information.md).</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#100)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#100)]  
  
## <a name="the-idatapageretriever-interface"></a><span data-ttu-id="b7c13-117">Rozhraní IDataPageRetriever</span><span class="sxs-lookup"><span data-stu-id="b7c13-117">The IDataPageRetriever Interface</span></span>  
 <span data-ttu-id="b7c13-118">Následující příklad kódu definuje `IDataPageRetriever` rozhraní, které je implementované `DataRetriever` třídy.</span><span class="sxs-lookup"><span data-stu-id="b7c13-118">The following code example defines the `IDataPageRetriever` interface, which is implemented by the `DataRetriever` class.</span></span> <span data-ttu-id="b7c13-119">Jedinou metodou deklarované v toto rozhraní je `SupplyPageOfData` metodu, která vyžaduje počáteční řádek indexu a počet řádků v jediné stránce data.</span><span class="sxs-lookup"><span data-stu-id="b7c13-119">The only method declared in this interface is the `SupplyPageOfData` method, which requires an initial row index and a count of the number of rows in a single page of data.</span></span> <span data-ttu-id="b7c13-120">Tyto hodnoty jsou používány implementátor k získání podmnožiny dat z datového zdroje.</span><span class="sxs-lookup"><span data-stu-id="b7c13-120">These values are used by the implementer to retrieve a subset of data from a data source.</span></span>  
  
 <span data-ttu-id="b7c13-121">A `Cache` objekt používá implementace tohoto rozhraní během vytváření k načtení dat dvě počáteční stránek.</span><span class="sxs-lookup"><span data-stu-id="b7c13-121">A `Cache` object uses an implementation of this interface during construction to load two initial pages of data.</span></span> <span data-ttu-id="b7c13-122">Vždy, když je potřeba hodnotou bez vyrovnávací paměti, mezipaměti zruší jednu z těchto stránek a požaduje novou stránku obsahující hodnotu z `IDataPageRetriever`.</span><span class="sxs-lookup"><span data-stu-id="b7c13-122">Whenever an uncached value is needed, the cache discards one of these pages and requests a new page containing the value from the `IDataPageRetriever`.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#201)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#201)]  
  
## <a name="the-dataretriever-class"></a><span data-ttu-id="b7c13-123">DataRetriever – třída</span><span class="sxs-lookup"><span data-stu-id="b7c13-123">The DataRetriever Class</span></span>  
 <span data-ttu-id="b7c13-124">Následující příklad kódu definuje `DataRetriever` třídy, které implementuje `IDataPageRetriever` rozhraní k načtení stránky dat ze serveru.</span><span class="sxs-lookup"><span data-stu-id="b7c13-124">The following code example defines the `DataRetriever` class, which implements the `IDataPageRetriever` interface to retrieve pages of data from a server.</span></span> <span data-ttu-id="b7c13-125">`DataRetriever` Třída rovněž poskytuje `Columns` a `RowCount` vlastnosti, které <xref:System.Windows.Forms.DataGridView> řízení používá k vytvoření nezbytných sloupců a přidat odpovídající počet prázdné řádky, které <xref:System.Windows.Forms.DataGridView.Rows%2A> kolekce.</span><span class="sxs-lookup"><span data-stu-id="b7c13-125">The `DataRetriever` class also provides `Columns` and `RowCount` properties, which the <xref:System.Windows.Forms.DataGridView> control uses to create the necessary columns and to add the appropriate number of empty rows to the <xref:System.Windows.Forms.DataGridView.Rows%2A> collection.</span></span> <span data-ttu-id="b7c13-126">Přidání prázdné řádky je nutné, aby ovládacího prvku se bude chovat, jako kdyby obsahuje všechna data v tabulce.</span><span class="sxs-lookup"><span data-stu-id="b7c13-126">Adding the empty rows is necessary so that the control will behave as though it contains all the data in the table.</span></span> <span data-ttu-id="b7c13-127">To znamená, že posouvací políčko posuvníku budou mít správnou velikost, a uživatel bude mít přístup k žádné řádek v tabulce.</span><span class="sxs-lookup"><span data-stu-id="b7c13-127">This means that the scroll box in the scroll bar will have the appropriate size, and the user will be able to access any row in the table.</span></span> <span data-ttu-id="b7c13-128">Řádky jsou vyplněny <xref:System.Windows.Forms.DataGridView.CellValueNeeded> obslužné rutiny události jenom v případě, že jsou přesunut do zobrazení oblasti.</span><span class="sxs-lookup"><span data-stu-id="b7c13-128">The rows are filled by the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler only when they are scrolled into view.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#200)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#200)]  
  
## <a name="the-cache-class"></a><span data-ttu-id="b7c13-129">Třída mezipaměti</span><span class="sxs-lookup"><span data-stu-id="b7c13-129">The Cache Class</span></span>  
 <span data-ttu-id="b7c13-130">Následující příklad kódu definuje `Cache` třída, která spravuje dvě stránky dat naplněno prostřednictvím `IDataPageRetriever` implementace.</span><span class="sxs-lookup"><span data-stu-id="b7c13-130">The following code example defines the `Cache` class, which manages two pages of data populated through an `IDataPageRetriever` implementation.</span></span> <span data-ttu-id="b7c13-131">`Cache` Třída definuje vnitřní `DataPage` struktura, která obsahuje <xref:System.Data.DataTable> pro uložení hodnot v jednom mezipaměti stránky a která vypočítá indexovat řádek, který představuje horní a dolní hranice stránky.</span><span class="sxs-lookup"><span data-stu-id="b7c13-131">The `Cache` class defines an inner `DataPage` structure, which contains a <xref:System.Data.DataTable> to store the values in a single cache page and which calculates the row indexes that represent the upper and lower boundaries of the page.</span></span>  
  
 <span data-ttu-id="b7c13-132">`Cache` Třída načte dvě stránky dat v době konstrukce.</span><span class="sxs-lookup"><span data-stu-id="b7c13-132">The `Cache` class loads two pages of data at construction time.</span></span> <span data-ttu-id="b7c13-133">Vždy, když <xref:System.Windows.Forms.DataGridView.CellValueNeeded> událostí vyžádá hodnotu, `Cache` objektu určuje, jestli je k dispozici v hodnotě jeden z jeho dvě stránky a, pokud ano, vrátí.</span><span class="sxs-lookup"><span data-stu-id="b7c13-133">Whenever the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event requests a value, the `Cache` object determines if the value is available in one of its two pages and, if so, returns it.</span></span> <span data-ttu-id="b7c13-134">Pokud hodnota není k dispozici místně, `Cache` objektu určuje, které z jeho dvě stránky je zcela dole aktuálně zobrazených řádků a nahradí stránce novou obsahující požadovanou hodnotu, kterou pak vrátí.</span><span class="sxs-lookup"><span data-stu-id="b7c13-134">If the value is not available locally, the `Cache` object determines which of its two pages is farthest from the currently displayed rows and replaces the page with a new one containing the requested value, which it then returns.</span></span>  
  
 <span data-ttu-id="b7c13-135">Za předpokladu, že počet řádků na stránce dat je stejný jako počet řádků, které lze zobrazit na obrazovce najednou, tento model umožňuje uživatelům stránkování prostřednictvím tabulky efektivně návrat naposledy zobrazenou stránku.</span><span class="sxs-lookup"><span data-stu-id="b7c13-135">Assuming that the number of rows in a data page is the same as the number of rows that can be displayed on screen at once, this model allows users paging through the table to efficiently return to the most recently viewed page.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](../../../../samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#300)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](../../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#300)]  
  
## <a name="additional-considerations"></a><span data-ttu-id="b7c13-136">Další informace</span><span class="sxs-lookup"><span data-stu-id="b7c13-136">Additional Considerations</span></span>  
 <span data-ttu-id="b7c13-137">Předchozí příklady kódu jsou uvedeny jako ukázka načítání dat za běhu.</span><span class="sxs-lookup"><span data-stu-id="b7c13-137">The previous code examples are provided as a demonstration of just-in-time data loading.</span></span> <span data-ttu-id="b7c13-138">Potřebujete změnit kód vlastní potřebujete k dosažení maximální efektivity.</span><span class="sxs-lookup"><span data-stu-id="b7c13-138">You will need to modify the code for your own needs to achieve maximum efficiency.</span></span> <span data-ttu-id="b7c13-139">Minimálně musíte vybrat odpovídající hodnotu pro počet řádků na stránce dat v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="b7c13-139">At minimum, you will need to choose an appropriate value for the number of rows per page of data in the cache.</span></span> <span data-ttu-id="b7c13-140">Tato hodnota je předán do `Cache` konstruktor.</span><span class="sxs-lookup"><span data-stu-id="b7c13-140">This value is passed into the `Cache` constructor.</span></span> <span data-ttu-id="b7c13-141">Počet řádků na stránce by měl být již menší než počet řádků, které lze zobrazit současně ve vaší <xref:System.Windows.Forms.DataGridView> ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="b7c13-141">The number of rows per page should be no less than the number of rows that can be displayed simultaneously in your <xref:System.Windows.Forms.DataGridView> control.</span></span>  
  
 <span data-ttu-id="b7c13-142">Nejlepších výsledků dosáhnete musíte provést testování výkonu a testování použitelnosti určit požadavky na systém a vaši uživatelé.</span><span class="sxs-lookup"><span data-stu-id="b7c13-142">For best results, you will need to conduct performance testing and usability testing to determine the requirements of your system and your users.</span></span> <span data-ttu-id="b7c13-143">Několik různých faktorů, které je potřeba vzít v úvahu zahrnout množství paměti do klientských počítačů, spouštění aplikace, dostupnou šířku pásma síťového připojení používá a latence serveru použít.</span><span class="sxs-lookup"><span data-stu-id="b7c13-143">Several factors that you will need to take into consideration include the amount of memory in the client machines running your application, the available bandwidth of the network connection used, and the latency of the server used.</span></span> <span data-ttu-id="b7c13-144">Šířka pásma a latence se určí v některých případech využití ve špičce.</span><span class="sxs-lookup"><span data-stu-id="b7c13-144">The bandwidth and latency should be determined at times of peak usage.</span></span>  
  
 <span data-ttu-id="b7c13-145">Chcete-li zlepšit výkon posouvání vaší aplikace, můžete zvýšit množství dat uložených místně.</span><span class="sxs-lookup"><span data-stu-id="b7c13-145">To improve the scrolling performance of your application, you can increase the amount of data stored locally.</span></span> <span data-ttu-id="b7c13-146">Pro zlepšení spuštění, ale musí neměli načítání příliš mnoho dat původně.</span><span class="sxs-lookup"><span data-stu-id="b7c13-146">To improve startup time, however, you must avoid loading too much data initially.</span></span> <span data-ttu-id="b7c13-147">Můžete chtít změnit `Cache` třída zvyšte počet datových stránek můžete uložit.</span><span class="sxs-lookup"><span data-stu-id="b7c13-147">You may want to modify the `Cache` class to increase the number of data pages it can store.</span></span> <span data-ttu-id="b7c13-148">Použití více stránek dat může zlepšit efektivitu posouvání, ale budete muset určit ideální počet řádků na stránce dat, v závislosti na dostupnou šířku pásma a dobu serveru.</span><span class="sxs-lookup"><span data-stu-id="b7c13-148">Using more data pages can improve scrolling efficiency, but you will need to determine the ideal number of rows in a data page, depending on the available bandwidth and the server latency.</span></span> <span data-ttu-id="b7c13-149">S menší stránky serveru bude přistupovat častěji, ale bude trvat méně času k vrátit požadovaná data.</span><span class="sxs-lookup"><span data-stu-id="b7c13-149">With smaller pages, the server will be accessed more frequently, but will take less time to return the requested data.</span></span> <span data-ttu-id="b7c13-150">Pokud je latence více problém než šířky pásma, můžete použít větší datových stránek.</span><span class="sxs-lookup"><span data-stu-id="b7c13-150">If latency is more of an issue than bandwidth, you may want to use larger data pages.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b7c13-151">Viz také</span><span class="sxs-lookup"><span data-stu-id="b7c13-151">See Also</span></span>  
 <xref:System.Windows.Forms.DataGridView>  
 <xref:System.Windows.Forms.DataGridView.VirtualMode%2A>  
 [<span data-ttu-id="b7c13-152">Ladění výkonu v systému Windows Forms DataGridView – ovládací prvek</span><span class="sxs-lookup"><span data-stu-id="b7c13-152">Performance Tuning in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/performance-tuning-in-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="b7c13-153">Osvědčené postupy pro změnu velikosti ovládacího prvku Windows Forms DataGridView</span><span class="sxs-lookup"><span data-stu-id="b7c13-153">Best Practices for Scaling the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/best-practices-for-scaling-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="b7c13-154">Virtuální režim v systému Windows Forms DataGridView – ovládací prvek</span><span class="sxs-lookup"><span data-stu-id="b7c13-154">Virtual Mode in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/virtual-mode-in-the-windows-forms-datagridview-control.md)  
 [<span data-ttu-id="b7c13-155">Návod: Implementace virtuálního režimu v ovládacím prvku Windows Forms DataGridView</span><span class="sxs-lookup"><span data-stu-id="b7c13-155">Walkthrough: Implementing Virtual Mode in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/implementing-virtual-mode-wf-datagridview-control.md)  
 [<span data-ttu-id="b7c13-156">Postupy: Implementace virtuálního režimu s načítání dat za běhu v systému Windows Forms DataGridView – ovládací prvek</span><span class="sxs-lookup"><span data-stu-id="b7c13-156">How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>](../../../../docs/framework/winforms/controls/virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md)
