---
title: Požadavky na výkon pro interoperabilitu Direct3D9 a WPF
titleSuffix: ''
ms.date: 03/30/2017
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
ms.openlocfilehash: 2445732c27d210a41da26303d6a9ce07ef6fcc94
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/24/2020
ms.locfileid: "76743928"
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="e3687-102">Předpokládaný výkon pro Direct3D9 a interoperabilitu WPF</span><span class="sxs-lookup"><span data-stu-id="e3687-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="e3687-103">Direct3D9 obsah můžete hostovat pomocí třídy <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="e3687-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="e3687-104">Hostování Direct3D9 obsahu může ovlivnit výkon vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="e3687-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="e3687-105">V tomto tématu jsou popsány osvědčené postupy pro optimalizaci výkonu při hostování Direct3D9 obsahu v aplikaci Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="e3687-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="e3687-106">Tyto osvědčené postupy zahrnují použití <xref:System.Windows.Interop.D3DImage> a osvědčených postupů při zobrazení Windows Vista, Windows XP a multi-monitor.</span><span class="sxs-lookup"><span data-stu-id="e3687-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e3687-107">Příklady kódu, které předvádějí tyto osvědčené postupy, najdete v tématu [spolupráce WPF a Direct3D9](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="e3687-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="e3687-108">Používejte D3DImage zřídka.</span><span class="sxs-lookup"><span data-stu-id="e3687-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="e3687-109">Obsah Direct3D9 hostovaný v instanci <xref:System.Windows.Interop.D3DImage> se nevykresluje jako rychlá jako v aplikaci čistě Direct3D.</span><span class="sxs-lookup"><span data-stu-id="e3687-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="e3687-110">Zkopírování povrchu a vyprázdnění vyrovnávací paměti příkazů může být nákladné operace.</span><span class="sxs-lookup"><span data-stu-id="e3687-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="e3687-111">Vzhledem k tomu, že se počet instancí <xref:System.Windows.Interop.D3DImage> zvyšuje, dochází k většímu počtu vyprázdnění a snížení výkonu.</span><span class="sxs-lookup"><span data-stu-id="e3687-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="e3687-112">Proto byste měli použít <xref:System.Windows.Interop.D3DImage> bez omezeného využití.</span><span class="sxs-lookup"><span data-stu-id="e3687-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="e3687-113">Osvědčené postupy v systému Windows Vista</span><span class="sxs-lookup"><span data-stu-id="e3687-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="e3687-114">Pro dosažení nejlepšího výkonu v systému Windows Vista se zobrazením, které je nakonfigurováno pro použití modelu WDDM (Windows Display Driver Model), vytvořte Direct3D9 plochu na zařízení `IDirect3DDevice9Ex`.</span><span class="sxs-lookup"><span data-stu-id="e3687-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="e3687-115">To umožňuje sdílení Surface.</span><span class="sxs-lookup"><span data-stu-id="e3687-115">This enables surface sharing.</span></span> <span data-ttu-id="e3687-116">Grafická karta musí podporovat možnosti ovladače `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` a `D3DCAPS2_CANSHARERESOURCE` v systému Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e3687-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="e3687-117">Jakékoli jiné nastavení způsobí, že se plocha bude kopírovat prostřednictvím softwaru, což výrazně snižuje výkon.</span><span class="sxs-lookup"><span data-stu-id="e3687-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e3687-118">Pokud má systém Windows Vista zobrazení, které je nakonfigurováno pro použití modelu XDDM (Windows XP Display Driver Model), je plocha vždy zkopírována prostřednictvím softwaru bez ohledu na nastavení.</span><span class="sxs-lookup"><span data-stu-id="e3687-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="e3687-119">Pomocí správného nastavení a videokarty se při použití ovladače WDDM v systému Windows Vista zobrazí lepší výkon, protože se kopie povrchu provádějí v hardwaru.</span><span class="sxs-lookup"><span data-stu-id="e3687-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="e3687-120">Osvědčené postupy v systému Windows XP</span><span class="sxs-lookup"><span data-stu-id="e3687-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="e3687-121">Pro zajištění nejlepšího výkonu v systému Windows XP, který používá model ovladače zobrazení systému Windows XP (XDDM), vytvořte uzamykatelný povrch, který se bude chovat správně při volání metody `IDirect3DSurface9::GetDC`.</span><span class="sxs-lookup"><span data-stu-id="e3687-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="e3687-122">Interně `BitBlt` metoda přenáší plochu napříč zařízeními v hardwaru.</span><span class="sxs-lookup"><span data-stu-id="e3687-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="e3687-123">Metoda `GetDC` vždy funguje na plochách XRGB.</span><span class="sxs-lookup"><span data-stu-id="e3687-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="e3687-124">Pokud však na klientském počítači běží systém Windows XP s aktualizací SP3 nebo SP2 a klient má také opravu hotfix pro funkci vrstveného okna, tato metoda funguje pouze na ARGB površích.</span><span class="sxs-lookup"><span data-stu-id="e3687-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="e3687-125">Grafická karta musí podporovat možnosti ovladače `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES`.</span><span class="sxs-lookup"><span data-stu-id="e3687-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="e3687-126">16bitová hloubka zobrazení plochy může významně snížit výkon.</span><span class="sxs-lookup"><span data-stu-id="e3687-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="e3687-127">Doporučuje se 32 Desktop.</span><span class="sxs-lookup"><span data-stu-id="e3687-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="e3687-128">Pokud vyvíjíte pro systémy Windows Vista a Windows XP, otestujte výkon v systému Windows XP.</span><span class="sxs-lookup"><span data-stu-id="e3687-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="e3687-129">Nedostatek grafické paměti v systému Windows XP je obavou.</span><span class="sxs-lookup"><span data-stu-id="e3687-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="e3687-130">Kromě toho <xref:System.Windows.Interop.D3DImage> v systému Windows XP k dispaměti větší množství videí a šířku pásma než Windows Vista WDDM z důvodu potřebné kopie dodatečné videopaměti.</span><span class="sxs-lookup"><span data-stu-id="e3687-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="e3687-131">Proto můžete očekávat, že výkon systému Windows XP je horší než v systému Windows Vista pro stejný hardware videa.</span><span class="sxs-lookup"><span data-stu-id="e3687-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e3687-132">XDDM je k dispozici v systémech Windows XP i Windows Vista; WDDM je však k dispozici pouze v systému Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e3687-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="e3687-133">Obecné osvědčené postupy</span><span class="sxs-lookup"><span data-stu-id="e3687-133">General Best Practices</span></span>  
 <span data-ttu-id="e3687-134">Při vytváření zařízení použijte příznak vytváření `D3DCREATE_MULTITHREADED`.</span><span class="sxs-lookup"><span data-stu-id="e3687-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="e3687-135">Tím se snižuje výkon, ale systém vykreslování WPF volá metody v tomto zařízení z jiného vlákna.</span><span class="sxs-lookup"><span data-stu-id="e3687-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="e3687-136">Ujistěte se, že se správně dodržují protokol uzamykání, takže se zařízení nepřístupí současně.</span><span class="sxs-lookup"><span data-stu-id="e3687-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="e3687-137">Pokud je vykreslování prováděno ve spravovaném vlákně WPF, důrazně doporučujeme vytvořit zařízení s příznakem vytváření `D3DCREATE_FPU_PRESERVE`.</span><span class="sxs-lookup"><span data-stu-id="e3687-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="e3687-138">Bez tohoto nastavení může vykreslování D3D snížit přesnost operací s dvojitou přesností WPF a způsobit problémy s vykreslováním.</span><span class="sxs-lookup"><span data-stu-id="e3687-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="e3687-139">Dělení <xref:System.Windows.Interop.D3DImage> je rychlé, Pokud neprovedete dlaždici mimo pow2 plochu bez hardwarové podpory, nebo Pokud podržíte <xref:System.Windows.Media.DrawingBrush> nebo <xref:System.Windows.Media.VisualBrush>, které obsahují <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="e3687-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="e3687-140">Osvědčené postupy pro zobrazení s více monitory</span><span class="sxs-lookup"><span data-stu-id="e3687-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="e3687-141">Pokud používáte počítač, který obsahuje více monitorů, měli byste postupovat podle výše uvedených osvědčených postupů.</span><span class="sxs-lookup"><span data-stu-id="e3687-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="e3687-142">K dispozici jsou také další požadavky na výkon pro konfiguraci s více monitory.</span><span class="sxs-lookup"><span data-stu-id="e3687-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="e3687-143">Když vytvoříte zpětnou vyrovnávací paměť, vytvoří se na konkrétním zařízení a adaptéru, ale WPF může zobrazit front-buffer na jakémkoli adaptéru.</span><span class="sxs-lookup"><span data-stu-id="e3687-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="e3687-144">Kopírování v rámci adaptérů pro aktualizaci front-buffer může být velmi nákladné.</span><span class="sxs-lookup"><span data-stu-id="e3687-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="e3687-145">V systému Windows Vista, který je nakonfigurovaný tak, aby používal WDDM s více grafickými kartami a s `IDirect3DDevice9Ex`m zařízením, pokud je front-buffer na jiném adaptéru, ale stále stejná grafická karta, nedošlo k žádnému snížení výkonu.</span><span class="sxs-lookup"><span data-stu-id="e3687-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="e3687-146">V systému Windows XP a v XDDM s více grafickými kartami je ale při zobrazení vyrovnávací paměti na jiném adaptéru než vyrovnávací paměť k dispozici významná snížení výkonu.</span><span class="sxs-lookup"><span data-stu-id="e3687-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="e3687-147">Další informace najdete v tématu [spolupráce WPF a Direct3D9](wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="e3687-147">For more information, see [WPF and Direct3D9 Interoperation](wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="e3687-148">Souhrn výkonu</span><span class="sxs-lookup"><span data-stu-id="e3687-148">Performance Summary</span></span>  
 <span data-ttu-id="e3687-149">Následující tabulka ukazuje výkon přední aktualizace vyrovnávací paměti jako funkce operačního systému, formátu pixelů a možností uzamčení povrchu.</span><span class="sxs-lookup"><span data-stu-id="e3687-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="e3687-150">Předpokládá se, že je front-buffer a zpětná vyrovnávací paměť na stejném adaptéru.</span><span class="sxs-lookup"><span data-stu-id="e3687-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="e3687-151">V závislosti na konfiguraci adaptéru jsou aktualizace hardwaru všeobecně mnohem rychlejší než aktualizace softwaru.</span><span class="sxs-lookup"><span data-stu-id="e3687-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="e3687-152">Formát Surface pixelů</span><span class="sxs-lookup"><span data-stu-id="e3687-152">Surface pixel format</span></span>|<span data-ttu-id="e3687-153">Windows Vista, WDDM a 9Ex</span><span class="sxs-lookup"><span data-stu-id="e3687-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="e3687-154">Další konfigurace systému Windows Vista</span><span class="sxs-lookup"><span data-stu-id="e3687-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="e3687-155">Systém Windows XP SP3 nebo SP2 s aktualizací hotfix</span><span class="sxs-lookup"><span data-stu-id="e3687-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="e3687-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="e3687-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="e3687-157">D3DFMT_X8R8G8B8 (není uzamykatelný)</span><span class="sxs-lookup"><span data-stu-id="e3687-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="e3687-158">**Aktualizace hardwaru**</span><span class="sxs-lookup"><span data-stu-id="e3687-158">**Hardware Update**</span></span>|<span data-ttu-id="e3687-159">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-159">Software Update</span></span>|<span data-ttu-id="e3687-160">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-160">Software Update</span></span>|<span data-ttu-id="e3687-161">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-161">Software Update</span></span>|  
|<span data-ttu-id="e3687-162">D3DFMT_X8R8G8B8 (lockable)</span><span class="sxs-lookup"><span data-stu-id="e3687-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="e3687-163">**Aktualizace hardwaru**</span><span class="sxs-lookup"><span data-stu-id="e3687-163">**Hardware Update**</span></span>|<span data-ttu-id="e3687-164">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-164">Software Update</span></span>|<span data-ttu-id="e3687-165">**Aktualizace hardwaru**</span><span class="sxs-lookup"><span data-stu-id="e3687-165">**Hardware Update**</span></span>|<span data-ttu-id="e3687-166">**Aktualizace hardwaru**</span><span class="sxs-lookup"><span data-stu-id="e3687-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="e3687-167">D3DFMT_A8R8G8B8 (není uzamykatelný)</span><span class="sxs-lookup"><span data-stu-id="e3687-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="e3687-168">**Aktualizace hardwaru**</span><span class="sxs-lookup"><span data-stu-id="e3687-168">**Hardware Update**</span></span>|<span data-ttu-id="e3687-169">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-169">Software Update</span></span>|<span data-ttu-id="e3687-170">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-170">Software Update</span></span>|<span data-ttu-id="e3687-171">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-171">Software Update</span></span>|  
|<span data-ttu-id="e3687-172">D3DFMT_A8R8G8B8 (lockable)</span><span class="sxs-lookup"><span data-stu-id="e3687-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="e3687-173">**Aktualizace hardwaru**</span><span class="sxs-lookup"><span data-stu-id="e3687-173">**Hardware Update**</span></span>|<span data-ttu-id="e3687-174">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-174">Software Update</span></span>|<span data-ttu-id="e3687-175">**Aktualizace hardwaru**</span><span class="sxs-lookup"><span data-stu-id="e3687-175">**Hardware Update**</span></span>|<span data-ttu-id="e3687-176">Aktualizace softwaru</span><span class="sxs-lookup"><span data-stu-id="e3687-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e3687-177">Viz také:</span><span class="sxs-lookup"><span data-stu-id="e3687-177">See also</span></span>

- <xref:System.Windows.Interop.D3DImage>
- [<span data-ttu-id="e3687-178">Vzájemná spolupráce grafického subsystému WPF a systému Direct3D9</span><span class="sxs-lookup"><span data-stu-id="e3687-178">WPF and Direct3D9 Interoperation</span></span>](wpf-and-direct3d9-interoperation.md)
- [<span data-ttu-id="e3687-179">Návod: Vytvoření obsahu Direct3D9 pro hostování v subsystému WPF</span><span class="sxs-lookup"><span data-stu-id="e3687-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)
- [<span data-ttu-id="e3687-180">Návod: Hostování obsahu Direct3D9 v subsystému WPF</span><span class="sxs-lookup"><span data-stu-id="e3687-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](walkthrough-hosting-direct3d9-content-in-wpf.md)
