---
title: Výkon Windows Workflow Foundation 4
description: Tento článek vysvětluje výkonnostní charakteristiky hlavní revize programovací model Windows Workflow Foundation, která je součástí .NET Framework 4.
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 9b1b9e7c4fd7cdd122d425b2746859dde30ec209
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/15/2020
ms.locfileid: "83421563"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="16cf2-103">Výkon Windows Workflow Foundation 4</span><span class="sxs-lookup"><span data-stu-id="16cf2-103">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="16cf2-104">.NET Framework 4 zahrnuje zásadní revizi programovací model Windows Workflow Foundation (WF) s vysokými investicemi do výkonu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-104">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="16cf2-105">Tato nová revize přináší významné změny návrhu z předchozích verzí nástroje [!INCLUDE[wf1](../../../includes/wf1-md.md)] dodávané jako součást .NET Framework 3,0 a .NET Framework 3,5.</span><span class="sxs-lookup"><span data-stu-id="16cf2-105">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="16cf2-106">Byl znovu navržený z jádra programovacího modelu, modulu runtime a nástrojů, aby významně vylepšil výkon a použitelnost.</span><span class="sxs-lookup"><span data-stu-id="16cf2-106">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="16cf2-107">Toto téma ukazuje důležité charakteristiky výkonu těchto revizí a porovnává je s předchozími verzemi.</span><span class="sxs-lookup"><span data-stu-id="16cf2-107">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="16cf2-108">Výkon součásti jednotlivého pracovního postupu se zvýšil o objednávky podle velikosti mezi WF3 a WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-108">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="16cf2-109">To znamená, že mezera mezi ručně kódovanými službami Windows Communication Foundation (WCF) a službami pracovního postupu WCF budou poměrně malé.</span><span class="sxs-lookup"><span data-stu-id="16cf2-109">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="16cf2-110">Latence pracovního postupu se výrazně snížila v WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-110">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="16cf2-111">Výkon trvalosti se zvýšil o faktor 2,5-3,0.</span><span class="sxs-lookup"><span data-stu-id="16cf2-111">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="16cf2-112">Sledování stavu prostřednictvím sledování pracovního postupu má výrazně menší nároky na režii.</span><span class="sxs-lookup"><span data-stu-id="16cf2-112">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="16cf2-113">Jedná se o přesvědčivé důvody k migraci na nebo přijetí WF4 ve vašich aplikacích.</span><span class="sxs-lookup"><span data-stu-id="16cf2-113">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="16cf2-114">Terminologie</span><span class="sxs-lookup"><span data-stu-id="16cf2-114">Terminology</span></span>

 <span data-ttu-id="16cf2-115">Verze [!INCLUDE[wf1](../../../includes/wf1-md.md)] zavedená v .NET Framework 4 bude pro zbytek tohoto tématu označovat jako WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-115">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="16cf2-116">Služba WAS byla představena v .NET Framework 3,0 a měla několik menších revizí prostřednictvím .NET Framework 3,5 SP1.</span><span class="sxs-lookup"><span data-stu-id="16cf2-116">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="16cf2-117">Verze modelu Workflow Foundation pro .NET Framework 3,5 bude pro zbytek tohoto tématu označovat jako WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-117">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="16cf2-118">WF3 se dodává v .NET Framework 4 vedle sebe s WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-118">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="16cf2-119">Další informace o migraci artefaktů WF3 do WF4 naleznete v tématu: [Průvodce migrací programovací model Windows Workflow Foundation 4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="16cf2-119">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="16cf2-120">Windows Communication Foundation (WCF) je jednotný programovací model Microsoftu pro vytváření aplikací orientovaných na služby.</span><span class="sxs-lookup"><span data-stu-id="16cf2-120">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="16cf2-121">Byl nejprve představen jako součást .NET 3,0 společně s WF3 a teď je jednou z klíčových součástí .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="16cf2-121">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="16cf2-122">Windows Server AppFabric je sada integrovaných technologií, které usnadňují vytváření, škálování a správu webových a složených aplikací, které běží na službě IIS.</span><span class="sxs-lookup"><span data-stu-id="16cf2-122">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="16cf2-123">Poskytuje nástroje pro monitorování a správu služeb a pracovních postupů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-123">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="16cf2-124">Další informace najdete v tématu [Windows Server AppFabric 1,0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="16cf2-124">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="16cf2-125">Cíle</span><span class="sxs-lookup"><span data-stu-id="16cf2-125">Goals</span></span>
 <span data-ttu-id="16cf2-126">Cílem tohoto tématu je Ukázat výkonnostní charakteristiky WF4 s daty měřenými pro různé scénáře.</span><span class="sxs-lookup"><span data-stu-id="16cf2-126">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="16cf2-127">Poskytuje také podrobná porovnání mezi WF4 a WF3, a proto zobrazuje Skvělé vylepšení, která byla provedena v této nové revizi.</span><span class="sxs-lookup"><span data-stu-id="16cf2-127">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="16cf2-128">Scénáře a data uvedená v tomto článku kvantifikují základní náklady na různé aspekty WF4 a WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-128">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="16cf2-129">Tato data jsou užitečná v seznámení s výkonnostními charakteristikami WF4 a mohou být užitečné při plánování migrace z WF3 na WF4 nebo použití WF4 při vývoji aplikací.</span><span class="sxs-lookup"><span data-stu-id="16cf2-129">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="16cf2-130">Doporučuje se však vzít v potaz závěry z dat uvedených v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="16cf2-130">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="16cf2-131">Výkon aplikace kompozitního pracovního postupu je vysoce závislý na způsobu implementace pracovního postupu a způsobu integrace různých součástí.</span><span class="sxs-lookup"><span data-stu-id="16cf2-131">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="16cf2-132">Jeden musí měřit jednotlivé aplikace, aby bylo možné určit výkonnostní charakteristiky této aplikace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-132">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="16cf2-133">Přehled vylepšení výkonu WF4</span><span class="sxs-lookup"><span data-stu-id="16cf2-133">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="16cf2-134">WF4 bylo pečlivě navrženo a implementováno s vysokým výkonem a škálovatelností, které jsou popsány v následujících částech.</span><span class="sxs-lookup"><span data-stu-id="16cf2-134">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="16cf2-135">Modul runtime WF</span><span class="sxs-lookup"><span data-stu-id="16cf2-135">WF Runtime</span></span>
 <span data-ttu-id="16cf2-136">V jádru [!INCLUDE[wf1](../../../includes/wf1-md.md)] modulu runtime je asynchronní Plánovač, který řídí provádění aktivit v pracovním postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-136">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="16cf2-137">Poskytuje výkonné a předvídatelné prováděcí prostředí pro aktivity.</span><span class="sxs-lookup"><span data-stu-id="16cf2-137">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="16cf2-138">Prostředí má dobře definovaný kontrakt pro provádění, pokračování, dokončení, zrušení, výjimky a předvídatelný model vláken.</span><span class="sxs-lookup"><span data-stu-id="16cf2-138">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="16cf2-139">V porovnání s WF3 má modul runtime WF4 efektivnější Plánovač.</span><span class="sxs-lookup"><span data-stu-id="16cf2-139">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="16cf2-140">Využívá stejný fond vstupně-výstupních vláken, který se používá pro WCF, což je velmi efektivní při provádění dávkových pracovních položek.</span><span class="sxs-lookup"><span data-stu-id="16cf2-140">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="16cf2-141">Fronta interních pracovních položek je optimalizována pro nejběžnější vzorce použití.</span><span class="sxs-lookup"><span data-stu-id="16cf2-141">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="16cf2-142">Běhový modul WF4 také spravuje stavy spouštění velmi nenáročným způsobem s minimální synchronizací a logikou zpracování událostí, zatímco WF3 závisí na vysoké registraci událostí a voláních, aby prováděla komplexní synchronizaci pro přechody stavu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-142">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="16cf2-143">Úložiště a tok dat</span><span class="sxs-lookup"><span data-stu-id="16cf2-143">Data Storage and Flow</span></span>
 <span data-ttu-id="16cf2-144">V WF3 jsou data přidružená k aktivitě modelována prostřednictvím vlastností závislosti implementovaných tímto typem <xref:System.Windows.DependencyProperty> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-144">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="16cf2-145">Vzor vlastnosti závislosti byl představen v Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="16cf2-145">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="16cf2-146">Obecně platí, že tento model je velmi flexibilní pro podporu jednoduchých datových vazeb a dalších funkcí uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="16cf2-146">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="16cf2-147">Vzor však vyžaduje, aby byly vlastnosti definovány jako statická pole v definici pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-147">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="16cf2-148">Vždy [!INCLUDE[wf1](../../../includes/wf1-md.md)] , když modul runtime nastaví nebo Získá hodnoty vlastností, zahrnuje silně váženou logiku vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="16cf2-148">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="16cf2-149">WF4 používá k výraznému zlepšení způsobu zpracování dat v pracovním postupu pomocí logiky nejasného rozsahu dat.</span><span class="sxs-lookup"><span data-stu-id="16cf2-149">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="16cf2-150">Odděluje data uložená v aktivitě z dat, která se přenášejí přes hranice aktivity pomocí dvou různých konceptů: proměnné a argumenty.</span><span class="sxs-lookup"><span data-stu-id="16cf2-150">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="16cf2-151">Při použití jasného hierarchického rozsahu pro proměnné a argumenty "in/out/InOut" jsou složitost využití dat pro aktivity výrazně snížena a životnost dat je také automaticky vymezena.</span><span class="sxs-lookup"><span data-stu-id="16cf2-151">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="16cf2-152">Aktivity mají jasně definovaný podpis, který popisuje jeho argumenty.</span><span class="sxs-lookup"><span data-stu-id="16cf2-152">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="16cf2-153">Pouhým zkontrolováním aktivity můžete určit, jaká data očekává, a jaká data budou vytvořená v důsledku jejího spuštění.</span><span class="sxs-lookup"><span data-stu-id="16cf2-153">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="16cf2-154">V aktivitách WF3 byly inicializovány při vytvoření pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-154">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="16cf2-155">V aktivitách WF 4 jsou inicializovány pouze v případě, že jsou spuštěny odpovídající aktivity.</span><span class="sxs-lookup"><span data-stu-id="16cf2-155">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="16cf2-156">To umožňuje jednodušší životní cyklus aktivity bez provádění operací inicializace/zrušení inicializace při vytvoření nové instance pracovního postupu, a proto dosáhl vyšší efektivity.</span><span class="sxs-lookup"><span data-stu-id="16cf2-156">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="16cf2-157">Tok řízení</span><span class="sxs-lookup"><span data-stu-id="16cf2-157">Control Flow</span></span>
 <span data-ttu-id="16cf2-158">Stejně jako v jakémkoli programovacím jazyce [!INCLUDE[wf1](../../../includes/wf1-md.md)] poskytuje podporu pro kontrolní toky pro definice pracovních postupů tím, že zavádí sadu aktivit toku řízení pro sekvencování, smyčky, větvení a jiné vzory.</span><span class="sxs-lookup"><span data-stu-id="16cf2-158">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="16cf2-159">V WF3, pokud je potřeba znovu spustit stejnou aktivitu, <xref:System.Workflow.ComponentModel.ActivityExecutionContext> je vytvořena nová a aktivita je klonována pomocí dlouhodobé serializace a logiky deserializace založené na <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-159">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="16cf2-160">Výkon iterativních řídicích toků je obvykle mnohem pomalejší než provádění posloupnosti aktivit.</span><span class="sxs-lookup"><span data-stu-id="16cf2-160">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="16cf2-161">WF4 to velmi jinak.</span><span class="sxs-lookup"><span data-stu-id="16cf2-161">WF4 handles this quite differently.</span></span> <span data-ttu-id="16cf2-162">Provede šablonu aktivity, vytvoří nový objekt vlastnosti ActivityInstance. a přidá ho do fronty plánovače.</span><span class="sxs-lookup"><span data-stu-id="16cf2-162">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="16cf2-163">Tento celý proces zahrnuje jenom explicitní vytváření objektů a je velmi odlehčený.</span><span class="sxs-lookup"><span data-stu-id="16cf2-163">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="16cf2-164">Asynchronní programování</span><span class="sxs-lookup"><span data-stu-id="16cf2-164">Asynchronous Programming</span></span>
 <span data-ttu-id="16cf2-165">Aplikace obvykle mají lepší výkon a škálovatelnost s asynchronním programováním pro dlouhotrvající operace blokujících operací, jako jsou vstupně-výstupní operace nebo distribuované výpočetní operace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-165">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="16cf2-166">WF4 poskytuje asynchronní podporu prostřednictvím typů základních aktivit <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity%601> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-166">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="16cf2-167">Modul runtime nativně rozumí asynchronním aktivitám a proto může automaticky vložit instanci do zóny bez trvalého uložení, zatímco asynchronní práce je nedokončená.</span><span class="sxs-lookup"><span data-stu-id="16cf2-167">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="16cf2-168">Vlastní aktivity mohou odvozovat z těchto typů, aby prováděly asynchronní práci bez podržení vlákna plánovače pracovních postupů a blokování všech aktivit, které mohou být schopny běžet paralelně.</span><span class="sxs-lookup"><span data-stu-id="16cf2-168">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="16cf2-169">Zasílání zpráv</span><span class="sxs-lookup"><span data-stu-id="16cf2-169">Messaging</span></span>
 <span data-ttu-id="16cf2-170">Zpočátku WF3 mít velmi omezené podpory pro zasílání zpráv prostřednictvím externích událostí nebo volání webových služeb.</span><span class="sxs-lookup"><span data-stu-id="16cf2-170">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="16cf2-171">V .NET 3,5 můžete pracovní postupy implementovat jako klienty WCF nebo zveřejnit jako služby WCF prostřednictvím <xref:System.Workflow.Activities.SendActivity> a <xref:System.Workflow.Activities.ReceiveActivity> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-171">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="16cf2-172">V WF4 byl koncept programování zasílání zpráv na základě pracovního postupu dále posílen díky těsné integraci logiky zasílání zpráv WCF do WF.</span><span class="sxs-lookup"><span data-stu-id="16cf2-172">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="16cf2-173">Jednotný kanál zpracování zpráv poskytovaný v technologii WCF v rozhraní .NET 4 pomáhá službám WF4 významně zlepšit výkon a škálovatelnost než WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-173">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="16cf2-174">WF4 také poskytuje bohatou podporu programování pro zasílání zpráv, která může modelovat složité vzory výměny zpráv (MEPs).</span><span class="sxs-lookup"><span data-stu-id="16cf2-174">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="16cf2-175">Vývojáři mohou použít buď typové smlouvy o poskytování služeb, aby bylo dosaženo lepšího výkonu, aniž by bylo nutné platit náklady na serializaci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-175">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="16cf2-176">Podpora ukládání kanálů na straně klienta prostřednictvím <xref:System.ServiceModel.Activities.SendMessageChannelCache> třídy v WF4 pomáhá vývojářům vytvářet rychlé aplikace s minimálním úsilím.</span><span class="sxs-lookup"><span data-stu-id="16cf2-176">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="16cf2-177">Další informace najdete v tématu [Změna úrovní sdílení mezipaměti pro aktivity odeslat](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="16cf2-177">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="16cf2-178">Deklarativní programování</span><span class="sxs-lookup"><span data-stu-id="16cf2-178">Declarative Programming</span></span>
 <span data-ttu-id="16cf2-179">WF4 poskytuje čistou a jednoduchou deklarativní programovací architekturu pro modelování obchodních procesů a služeb.</span><span class="sxs-lookup"><span data-stu-id="16cf2-179">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="16cf2-180">Programovací model podporuje plně deklarativní složení aktivit bez jakýchkoli kódů, což výrazně zjednodušuje vytváření pracovních postupů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-180">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="16cf2-181">V .NET Framework 4 byla deklarativní programovací architektura založená na jazyce XAML sjednocena do jediného sestavení System. XAML. dll pro podporu WPF i WF.</span><span class="sxs-lookup"><span data-stu-id="16cf2-181">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="16cf2-182">V WF4 poskytuje XAML skutečně deklarativní prostředí a umožňuje definovat celou definici pracovního postupu v kódu XML, odkazování na aktivity a typy sestavené pomocí .NET.</span><span class="sxs-lookup"><span data-stu-id="16cf2-182">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="16cf2-183">To bylo obtížné dělat v WF3 s formátem XOML bez zahrnutí vlastní logiky kódu na pozadí.</span><span class="sxs-lookup"><span data-stu-id="16cf2-183">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="16cf2-184">Nový zásobník XAML v rozhraní .NET 4 má mnohem lepší výkon při serializaci nebo deserializaci artefaktů pracovního postupu a deklarativní programování je přitažlivé a plné.</span><span class="sxs-lookup"><span data-stu-id="16cf2-184">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="16cf2-185">Návrhář postupu provádění</span><span class="sxs-lookup"><span data-stu-id="16cf2-185">Workflow Designer</span></span>
 <span data-ttu-id="16cf2-186">Plně deklarativní Podpora programování pro WF4 explicitně ukládá vyšší požadavky na výkon při návrhu velkých pracovních postupů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-186">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="16cf2-187">Návrhář pracovního postupu v WF4 má mnohem lepší škálovatelnost pro velké pracovní postupy, než je to pro WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-187">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="16cf2-188">Díky podpoře virtualizace uživatelského rozhraní může Návrhář snadno načíst velký pracovní postup 1000 aktivit během několika sekund, zatímco je téměř nemožné načíst pracovní postup s několika stovkami aktivit pomocí návrháře WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-188">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="16cf2-189">Porovnání výkonu na úrovni součásti</span><span class="sxs-lookup"><span data-stu-id="16cf2-189">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="16cf2-190">Tato část obsahuje data o přímých porovnáních mezi jednotlivými aktivitami v pracovních postupech WF3 a WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-190">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="16cf2-191">Klíčové oblasti, jako je trvalost, mají větší dopad na výkon než jednotlivé součásti aktivity.</span><span class="sxs-lookup"><span data-stu-id="16cf2-191">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="16cf2-192">Zlepšení výkonu v jednotlivých součástech v WF4 je důležité, i když jsou tyto komponenty teď dostatečně rychlé, aby je bylo možné porovnat s ručními kódovanými logikami orchestrace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-192">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="16cf2-193">Příklad, který je popsaný v následující části: "scénář kompozice služeb".</span><span class="sxs-lookup"><span data-stu-id="16cf2-193">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="16cf2-194">Nastavení prostředí</span><span class="sxs-lookup"><span data-stu-id="16cf2-194">Environment Setup</span></span>
 ![Nastavení prostředí pro měření výkonu pracovního postupu](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="16cf2-196">Výše uvedený obrázek ukazuje konfiguraci počítače, která se používá pro měření výkonu na úrovni součásti.</span><span class="sxs-lookup"><span data-stu-id="16cf2-196">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="16cf2-197">Jeden server a pět klientů připojených přes jedno síťové rozhraní sítě Ethernet s rychlostí 1 GB/s.</span><span class="sxs-lookup"><span data-stu-id="16cf2-197">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="16cf2-198">Pro snazší měření je server nakonfigurovaný tak, aby používal jeden jádro serveru s duálním nebo čtyřjádrovým jádrem, na kterém běží Windows Server 2008 x86.</span><span class="sxs-lookup"><span data-stu-id="16cf2-198">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="16cf2-199">Využití CPU systému je udržováno téměř 100%.</span><span class="sxs-lookup"><span data-stu-id="16cf2-199">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="16cf2-200">Podrobnosti testu</span><span class="sxs-lookup"><span data-stu-id="16cf2-200">Test Details</span></span>
 <span data-ttu-id="16cf2-201">WF3 <xref:System.Workflow.Activities.CodeActivity> je pravděpodobně nejjednodušší aktivita, kterou lze použít v pracovním postupu WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-201">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="16cf2-202">Aktivita volá metodu v kódu, na kterou programátor pracovního postupu může vložit vlastní kód do.</span><span class="sxs-lookup"><span data-stu-id="16cf2-202">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="16cf2-203">V WF4 neexistuje žádný přímý analogový WF3 <xref:System.Workflow.Activities.CodeActivity> , který poskytuje stejné funkce.</span><span class="sxs-lookup"><span data-stu-id="16cf2-203">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="16cf2-204">Všimněte si, že <xref:System.Activities.CodeActivity> v WF4 je základní třída, která nesouvisí s WF3 <xref:System.Workflow.Activities.CodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-204">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="16cf2-205">Autoři pracovního postupu jsou doporučováni k vytváření vlastních aktivit a vytváření pracovních postupů pouze v jazyce XAML.</span><span class="sxs-lookup"><span data-stu-id="16cf2-205">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="16cf2-206">V testech níže `Comment` se jako místo prázdné <xref:System.Workflow.Activities.CodeActivity> v pracovních postupech WF4 používá aktivita s názvem.</span><span class="sxs-lookup"><span data-stu-id="16cf2-206">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="16cf2-207">Kód v `Comment` aktivitě je následující:</span><span class="sxs-lookup"><span data-stu-id="16cf2-207">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="16cf2-208">Prázdný pracovní postup</span><span class="sxs-lookup"><span data-stu-id="16cf2-208">Empty Workflow</span></span>
 <span data-ttu-id="16cf2-209">Tento test používá pracovní postup sekvence bez podřízených aktivit.</span><span class="sxs-lookup"><span data-stu-id="16cf2-209">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="16cf2-210">Jedna aktivita</span><span class="sxs-lookup"><span data-stu-id="16cf2-210">Single Activity</span></span>
 <span data-ttu-id="16cf2-211">Pracovní postup je sekvenční pracovní postup obsahující jednu podřízenou aktivitu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-211">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="16cf2-212">Aktivita je <xref:System.Workflow.Activities.CodeActivity> bez kódu v WF3 a v `Comment` případě aktivity v WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-212">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="16cf2-213">I když s 1000 iteracemi</span><span class="sxs-lookup"><span data-stu-id="16cf2-213">While with 1000 Iterations</span></span>
 <span data-ttu-id="16cf2-214">Pracovní postup sekvence obsahuje jednu <xref:System.Activities.Statements.While> aktivitu s jednou podřízenou aktivitou ve smyčce, která neprovádí žádnou práci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-214">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="16cf2-215">Replikátor ve srovnání s ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="16cf2-215">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="16cf2-216"><xref:System.Workflow.Activities.ReplicatorActivity>v WF3 má režimy sekvenčního a paralelního spuštění.</span><span class="sxs-lookup"><span data-stu-id="16cf2-216"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="16cf2-217">V sekvenčním režimu je výkon aktivity podobný <xref:System.Workflow.Activities.WhileActivity> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-217">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="16cf2-218"><xref:System.Workflow.Activities.ReplicatorActivity>Je nejužitečnější pro paralelní spouštění.</span><span class="sxs-lookup"><span data-stu-id="16cf2-218">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="16cf2-219">WF4 analogová pro toto je <xref:System.Activities.Statements.ParallelForEach%601> aktivita.</span><span class="sxs-lookup"><span data-stu-id="16cf2-219">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="16cf2-220">Následující diagram znázorňuje pracovní postupy použité pro tento test.</span><span class="sxs-lookup"><span data-stu-id="16cf2-220">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="16cf2-221">Pracovní postup WF3 je na levé straně a pracovní postup WF4 je na pravé straně.</span><span class="sxs-lookup"><span data-stu-id="16cf2-221">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3 Aktivita ReplicatorActivity a WF4 ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="16cf2-223">Sekvenční pracovní postup s pěti aktivitami</span><span class="sxs-lookup"><span data-stu-id="16cf2-223">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="16cf2-224">Tento test je určen k zobrazení efektu, který provede několik aktivit v pořadí.</span><span class="sxs-lookup"><span data-stu-id="16cf2-224">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="16cf2-225">V sekvenci je pět aktivit.</span><span class="sxs-lookup"><span data-stu-id="16cf2-225">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="16cf2-226">Obor transakce</span><span class="sxs-lookup"><span data-stu-id="16cf2-226">Transaction Scope</span></span>
 <span data-ttu-id="16cf2-227">Test rozsahu transakce se mírně liší od ostatních testů v tom, že nová instance pracovního postupu není vytvořena pro každou iteraci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-227">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="16cf2-228">Místo toho je pracovní postup strukturován pomocí smyčky while obsahující <xref:System.Activities.Statements.TransactionScope> aktivitu obsahující jednu aktivitu, která nefunguje.</span><span class="sxs-lookup"><span data-stu-id="16cf2-228">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="16cf2-229">Každé spuštění dávky 50 iterací prostřednictvím smyčky while se počítá jako jediná operace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-229">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="16cf2-230">Kompenzace</span><span class="sxs-lookup"><span data-stu-id="16cf2-230">Compensation</span></span>
 <span data-ttu-id="16cf2-231">Pracovní postup WF3 má jednu aktivitu Aktivita nadřazená s názvem `WorkScope` .</span><span class="sxs-lookup"><span data-stu-id="16cf2-231">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="16cf2-232">Aktivita jednoduše implementuje <xref:System.Workflow.ComponentModel.ICompensatableActivity> rozhraní:</span><span class="sxs-lookup"><span data-stu-id="16cf2-232">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="16cf2-233">Obslužná rutina chyb cílí na `WorkScope` aktivitu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-233">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="16cf2-234">Pracovní postup WF4 je rovnoměrně zjednodušený.</span><span class="sxs-lookup"><span data-stu-id="16cf2-234">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="16cf2-235"><xref:System.Activities.Statements.CompensableActivity>Má tělo a obslužnou rutinu kompenzace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-235">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="16cf2-236">Explicitní kompenzace je v posloupnosti další.</span><span class="sxs-lookup"><span data-stu-id="16cf2-236">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="16cf2-237">Aktivita aktivity těla a obslužné rutiny kompenzace jsou prázdné implementace:</span><span class="sxs-lookup"><span data-stu-id="16cf2-237">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="16cf2-238">Následující diagram znázorňuje základní pracovní postup kompenzace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-238">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="16cf2-239">Pracovní postup WF3 je na levé straně a pracovní postup WF4 je na pravé straně.</span><span class="sxs-lookup"><span data-stu-id="16cf2-239">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Pracovní postupy WF3 a WF4 Basic kompenzace](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="16cf2-241">Výsledky testů výkonu</span><span class="sxs-lookup"><span data-stu-id="16cf2-241">Performance Test Results</span></span>

 ![Tabulka zobrazující data výsledků testu výkonu](./media/performance/performance-test-data.gif)

 ![Sloupcový graf, který porovnává data testu výkonu WF3 a WF4](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="16cf2-244">Všechny testy se měří v pracovních postupech za sekundu s výjimkou testu rozsahu transakce.</span><span class="sxs-lookup"><span data-stu-id="16cf2-244">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="16cf2-245">Jak je uvedeno výše, [!INCLUDE[wf1](../../../includes/wf1-md.md)] výkon modulu runtime se zlepšil v rámci panelu, zejména v oblastech, které vyžadují více spuštění stejné aktivity, jako je smyčka while.</span><span class="sxs-lookup"><span data-stu-id="16cf2-245">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="16cf2-246">Scénář složení služby</span><span class="sxs-lookup"><span data-stu-id="16cf2-246">Service Composition Scenario</span></span>
 <span data-ttu-id="16cf2-247">Jak je uvedeno v předchozí části, "porovnání výkonu na úrovni komponenty", došlo k výraznému snížení režie mezi WF3 a WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-247">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="16cf2-248">Služby pracovního postupu WCF teď můžou skoro odpovídat výkonu ručně kódovaných služeb WCF, ale mají stále všechny výhody [!INCLUDE[wf1](../../../includes/wf1-md.md)] modulu runtime.</span><span class="sxs-lookup"><span data-stu-id="16cf2-248">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="16cf2-249">Tento testovací scénář porovnává službu WCF se službou pracovního postupu WCF v WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-249">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="16cf2-250">Služba Online Store</span><span class="sxs-lookup"><span data-stu-id="16cf2-250">Online Store Service</span></span>
 <span data-ttu-id="16cf2-251">Jednou z sílu programovací model Windows Workflow Foundation je schopnost vytvářet procesy pomocí několika služeb.</span><span class="sxs-lookup"><span data-stu-id="16cf2-251">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="16cf2-252">V tomto příkladu je k dispozici služba online úložiště, která orchestruje dvě volání služeb k nákupu objednávky.</span><span class="sxs-lookup"><span data-stu-id="16cf2-252">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="16cf2-253">Prvním krokem je ověření pořadí pomocí služby ověřování objednávky.</span><span class="sxs-lookup"><span data-stu-id="16cf2-253">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="16cf2-254">Druhým krokem je vyplnit objednávku pomocí služby skladu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-254">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="16cf2-255">Tyto dvě služby back-end, pořadí ověřování služby a služby skladu, zůstávají u obou testů stejné.</span><span class="sxs-lookup"><span data-stu-id="16cf2-255">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="16cf2-256">Součástí změny je služba online obchodu, která provádí orchestraci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-256">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="16cf2-257">V jednom případě je služba rukou kódovaná jako služba WCF.</span><span class="sxs-lookup"><span data-stu-id="16cf2-257">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="16cf2-258">Pro druhý případ se služba zapisuje jako služba pracovního postupu WCF v WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-258">For the other case, the service is written as a WCF workflow service in WF4.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="16cf2-259">specifické funkce, jako je sledování a trvalost, jsou pro tento test vypnuté.</span><span class="sxs-lookup"><span data-stu-id="16cf2-259">-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="16cf2-260">Prostředí</span><span class="sxs-lookup"><span data-stu-id="16cf2-260">Environment</span></span>
![Nastavení prostředí pro měření výkonu](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="16cf2-262">Požadavky klientů jsou převedené do služby Online Store prostřednictvím protokolu HTTP z více počítačů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-262">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="16cf2-263">Jeden počítač hostuje všechny tři služby.</span><span class="sxs-lookup"><span data-stu-id="16cf2-263">A single computer hosts all three services.</span></span>  <span data-ttu-id="16cf2-264">Přenosová vrstva mezi službou online úložiště a back-end službami je TCP nebo HTTP.</span><span class="sxs-lookup"><span data-stu-id="16cf2-264">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="16cf2-265">Měření operací za sekundu vychází z počtu dokončených `PurchaseOrder` volání služby Online Store.</span><span class="sxs-lookup"><span data-stu-id="16cf2-265">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="16cf2-266">Sdružování kanálů je nová funkce, která je k dispozici v WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-266">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="16cf2-267">V části WCF tohoto sdružování testovacích kanálů není tato služba vydaná, takže se ve službě Online Store použila ruční kódovaná Implementace jednoduchého sdružování.</span><span class="sxs-lookup"><span data-stu-id="16cf2-267">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="16cf2-268">Výkon</span><span class="sxs-lookup"><span data-stu-id="16cf2-268">Performance</span></span>
![Sloupcový graf zobrazující výkon služby Online Store](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="16cf2-270">Připojení ke službám back-end TCP bez sdružování kanálů [!INCLUDE[wf1](../../../includes/wf1-md.md)] má služba 17,2% dopad na propustnost.</span><span class="sxs-lookup"><span data-stu-id="16cf2-270">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="16cf2-271">Díky sdružování kanálů je penalizace o 23,8%.</span><span class="sxs-lookup"><span data-stu-id="16cf2-271">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="16cf2-272">V případě protokolu HTTP je dopad mnohem menší: 4,3% bez sdružování a 8,1% s fondem.</span><span class="sxs-lookup"><span data-stu-id="16cf2-272">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="16cf2-273">Je také důležité si uvědomit, že sdružování kanálů při použití HTTP nabízí velmi malou výhodu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-273">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="16cf2-274">I když existuje režie z WF4 runtime v porovnání s rukou kódované služby WCF v tomto testu, může být považována za nejhorší případ.</span><span class="sxs-lookup"><span data-stu-id="16cf2-274">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="16cf2-275">Tyto dvě back-end služby v tomto testu provede velmi málo práce.</span><span class="sxs-lookup"><span data-stu-id="16cf2-275">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="16cf2-276">V reálném čase by tyto služby prováděly dražší operace, jako jsou volání databáze, což vede k tomu, že vliv přenosové vrstvy na výkon je méně důležitý.</span><span class="sxs-lookup"><span data-stu-id="16cf2-276">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="16cf2-277">To navíc přináší výhody funkcí, které jsou k dispozici v WF4, díky tomu je pro vytváření služeb Orchestration Foundation vhodným způsobem.</span><span class="sxs-lookup"><span data-stu-id="16cf2-277">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="16cf2-278">Klíčové požadavky na výkon</span><span class="sxs-lookup"><span data-stu-id="16cf2-278">Key Performance Considerations</span></span>
 <span data-ttu-id="16cf2-279">Oblasti funkcí v této části, s výjimkou spolupráce, se výrazně změnily mezi WF3 a WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-279">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="16cf2-280">To má vliv na návrh aplikací pracovních postupů i na výkon.</span><span class="sxs-lookup"><span data-stu-id="16cf2-280">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="16cf2-281">Latence aktivace pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="16cf2-281">Workflow Activation Latency</span></span>
 <span data-ttu-id="16cf2-282">V aplikaci služby pracovního postupu WCF je latence pro spuštění nového pracovního postupu nebo načítání existujícího pracovního postupu důležitá, protože může být blokování.</span><span class="sxs-lookup"><span data-stu-id="16cf2-282">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="16cf2-283">Tento testovací případ měří hostitele WF3 XOML proti hostiteli WF4 XAMLX v typickém scénáři.</span><span class="sxs-lookup"><span data-stu-id="16cf2-283">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="16cf2-284">Nastavení prostředí</span><span class="sxs-lookup"><span data-stu-id="16cf2-284">Environment Setup</span></span>
 ![Nastavení prostředí pro latenci a testy propustnosti](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="16cf2-286">Nastavení testu</span><span class="sxs-lookup"><span data-stu-id="16cf2-286">Test Setup</span></span>
 <span data-ttu-id="16cf2-287">Ve scénáři klientský počítač kontaktuje službu pracovního postupu WCF pomocí korelace založené na kontextu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-287">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="16cf2-288">Korelace kontextu vyžaduje speciální vazbu kontextu a používá hlavičku kontextu nebo soubor cookie k propojení zpráv se správnou instancí pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-288">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="16cf2-289">Má přínos pro zvýšení výkonu v případě, že je v záhlaví zprávy umístěný identifikátor korelace, aby tělo zprávy nebylo nutné analyzovat.</span><span class="sxs-lookup"><span data-stu-id="16cf2-289">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="16cf2-290">Služba vytvoří nový pracovní postup s požadavkem a pošle okamžitou odezvu tak, aby měření latence nezahrnovalo čas strávený spouštěním pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-290">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="16cf2-291">Pracovní postup WF3 je souborem XOML s kódem na pozadí a pracovní postup WF4 je zcela XAML.</span><span class="sxs-lookup"><span data-stu-id="16cf2-291">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="16cf2-292">Pracovní postup WF4 vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="16cf2-292">The WF4 workflow looks like this:</span></span>

 ![Pracovní postup oboru korelace WF4](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="16cf2-294"><xref:System.ServiceModel.Activities.Receive>Aktivita vytvoří instanci pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-294">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="16cf2-295">Hodnota předaná v přijaté zprávě se zobrazí ve zprávě odpovědi.</span><span class="sxs-lookup"><span data-stu-id="16cf2-295">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="16cf2-296">Sekvence, která následuje po odpovědi, obsahuje zbytek pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-296">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="16cf2-297">Ve výše uvedeném případě se zobrazí pouze jedna aktivita komentáře.</span><span class="sxs-lookup"><span data-stu-id="16cf2-297">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="16cf2-298">Počet aktivit komentářů se změnil, aby se simulovala složitost pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-298">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="16cf2-299">Aktivita komentáře je ekvivalentní WF3 <xref:System.Workflow.Activities.CodeActivity> , který neprovede žádnou práci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-299">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="16cf2-300">Další informace o aktivitě komentářů naleznete v části porovnání výkonu na úrovni komponenty výše v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="16cf2-300">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="16cf2-301">Výsledky testů</span><span class="sxs-lookup"><span data-stu-id="16cf2-301">Test Results</span></span>

 <span data-ttu-id="16cf2-302">Latence a doba zahřívání pro služby pracovního postupu WCF:</span><span class="sxs-lookup"><span data-stu-id="16cf2-302">Cold and warm latency for WCF workflow services:</span></span>

 ![Sloupcový graf znázorňující latenci a latenci pro služby pracovního postupu WCF využívající WF3 a WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="16cf2-304">V předchozím grafu se studeným odkazem nevztahují na případ, kdy <xref:System.ServiceModel.WorkflowServiceHost> pro daný pracovní postup neexistuje existující.</span><span class="sxs-lookup"><span data-stu-id="16cf2-304">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="16cf2-305">Jinými slovy, studená latence je při prvním použití pracovního postupu a soubor XOML nebo XAML musí být zkompilován.</span><span class="sxs-lookup"><span data-stu-id="16cf2-305">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="16cf2-306">Doba zahřívání je čas vytvoření nové instance pracovního postupu v případě, že byl typ pracovního postupu již zkompilován.</span><span class="sxs-lookup"><span data-stu-id="16cf2-306">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="16cf2-307">Složitost pracovního postupu způsobuje velmi malý rozdíl v WF4 případu, ale v případu WF3 má lineární průběh.</span><span class="sxs-lookup"><span data-stu-id="16cf2-307">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="16cf2-308">Propustnost korelace</span><span class="sxs-lookup"><span data-stu-id="16cf2-308">Correlation Throughput</span></span>
 <span data-ttu-id="16cf2-309">WF4 zavádí novou funkci korelace založenou na obsahu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-309">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="16cf2-310">WF3 poskytuje pouze korelaci na základě kontextu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-310">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="16cf2-311">Korelace na základě kontextu by se dala provést jenom přes konkrétní vazby kanálu WCF.</span><span class="sxs-lookup"><span data-stu-id="16cf2-311">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="16cf2-312">ID pracovního postupu je vloženo do záhlaví zprávy při použití těchto vazeb.</span><span class="sxs-lookup"><span data-stu-id="16cf2-312">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="16cf2-313">Běhový modul WF3 mohl identifikovat pouze pracovní postup podle jeho ID.  V případě korelace na základě obsahu může autor pracovního postupu vytvořit korelační klíč ze relevantního data, jako je číslo účtu nebo ID zákazníka.</span><span class="sxs-lookup"><span data-stu-id="16cf2-313">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="16cf2-314">Korelace založená na kontextu má výkonovou výhodu v tom, že korelační klíč je umístěný v záhlaví zprávy.</span><span class="sxs-lookup"><span data-stu-id="16cf2-314">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="16cf2-315">Klíč lze číst ze zprávy bez zrušení serializace/zprávy-kopírování.</span><span class="sxs-lookup"><span data-stu-id="16cf2-315">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="16cf2-316">V rámci korelace na základě obsahu je korelační klíč uložený v těle zprávy.</span><span class="sxs-lookup"><span data-stu-id="16cf2-316">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="16cf2-317">K vyhledání klíče se používá výraz XPath.</span><span class="sxs-lookup"><span data-stu-id="16cf2-317">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="16cf2-318">Náklady na toto dodatečné zpracování závisí na velikosti zprávy, hloubce klíče v těle a na počtu klíčů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-318">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="16cf2-319">Tento test porovnává kontextovou a korelaci založenou na obsahu a také ukazuje snížení výkonu při použití více klíčů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-319">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="16cf2-320">Nastavení prostředí</span><span class="sxs-lookup"><span data-stu-id="16cf2-320">Environment Setup</span></span>
![Nastavení prostředí pro test výkonnosti pracovního postupu](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="16cf2-322">Nastavení testu</span><span class="sxs-lookup"><span data-stu-id="16cf2-322">Test Setup</span></span>
<span data-ttu-id="16cf2-323">![Test pracovního postupu propustnosti korelace](./media/performance/correlation-throughput-workflow.gif "Nastavení testu pracovního postupu propustnosti korelace")</span><span class="sxs-lookup"><span data-stu-id="16cf2-323">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="16cf2-324">Předchozí pracovní postup je stejný jako použitý v oddílu [Persistence](#persistence) .</span><span class="sxs-lookup"><span data-stu-id="16cf2-324">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="16cf2-325">Pro testy korelace bez trvalosti není v modulu runtime nainstalována žádná Zprostředkovatel trvalosti.</span><span class="sxs-lookup"><span data-stu-id="16cf2-325">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="16cf2-326">Korelace probíhá na dvou místech: CreateOrder a CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="16cf2-326">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="16cf2-327">Výsledky testů</span><span class="sxs-lookup"><span data-stu-id="16cf2-327">Test Results</span></span>
<span data-ttu-id="16cf2-328">![Propustnost korelace](./media/performance/correlation-throughput-graph.gif "Graf propustnosti korelace")</span><span class="sxs-lookup"><span data-stu-id="16cf2-328">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="16cf2-329">Tento graf znázorňuje snížení výkonu, protože se zvyšuje počet klíčů použitých při korelace na základě obsahu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-329">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="16cf2-330">Podobnost na křivích mezi TCP a HTTP indikuje režii spojenou s těmito protokoly.</span><span class="sxs-lookup"><span data-stu-id="16cf2-330">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="16cf2-331">Korelace s persistencí</span><span class="sxs-lookup"><span data-stu-id="16cf2-331">Correlation with Persistence</span></span>
 <span data-ttu-id="16cf2-332">U trvalého pracovního postupu se zatížení procesoru z korelace na základě obsahu posouvá z modulu runtime pracovního postupu do databáze SQL.</span><span class="sxs-lookup"><span data-stu-id="16cf2-332">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="16cf2-333">Úložné procedury ve zprostředkovateli trvalosti SQL prohledají práci odpovídající klíčům, aby našli příslušný pracovní postup.</span><span class="sxs-lookup"><span data-stu-id="16cf2-333">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Spojnicový graf znázorňující výsledky korelace a trvalosti](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="16cf2-335">Korelace založená na kontextu je stále rychlejší než korelace na základě obsahu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-335">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="16cf2-336">Rozdíl je však méně vyslovný, protože trvalost má větší vliv na výkon než korelace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-336">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="16cf2-337">Složitá propustnost pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="16cf2-337">Complex Workflow Throughput</span></span>
 <span data-ttu-id="16cf2-338">Složitost pracovního postupu není měřena pouze počtem aktivit.</span><span class="sxs-lookup"><span data-stu-id="16cf2-338">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="16cf2-339">Složené aktivity mohou obsahovat mnoho podřízených objektů a podřízené aktivity mohou být také složené aktivity.</span><span class="sxs-lookup"><span data-stu-id="16cf2-339">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="16cf2-340">Jak roste počet úrovní vnoření, tak počet aktivit, které mohou být aktuálně ve spuštěném stavu, a počet proměnných, které mohou být ve stavu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-340">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="16cf2-341">Tento test porovnává propustnost mezi WF3 a WF4 při provádění složitých pracovních postupů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-341">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="16cf2-342">Nastavení testu</span><span class="sxs-lookup"><span data-stu-id="16cf2-342">Test Setup</span></span>
 <span data-ttu-id="16cf2-343">Tyto testy byly spuštěny na počítači Intel Xeon X5355 @ 8jádrový 2,66 GHz a 4 GB paměti RAM se systémem Windows Server 2008 x64.</span><span class="sxs-lookup"><span data-stu-id="16cf2-343">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="16cf2-344">Testovací kód se spustí v jednom procesu s jedním vláknem na jádro, abyste dosáhli 100% využití CPU.</span><span class="sxs-lookup"><span data-stu-id="16cf2-344">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="16cf2-345">Pracovní postupy vygenerované pro tento test mají dvě hlavní proměnné: hloubku a počet aktivit v jednotlivých sekvencích.</span><span class="sxs-lookup"><span data-stu-id="16cf2-345">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="16cf2-346">Každá úroveň hloubky zahrnuje paralelní aktivity, zatímco smyčky, rozhodnutí, přiřazení a sekvence.</span><span class="sxs-lookup"><span data-stu-id="16cf2-346">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="16cf2-347">V následujícím obrázku návrháře WF4 je graf toku nejvyšší úrovně obrázek.</span><span class="sxs-lookup"><span data-stu-id="16cf2-347">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="16cf2-348">Každá aktivita vývojového diagramu se podobá hlavnímu vývojovému diagramu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-348">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="16cf2-349">Může být užitečné si představit Fractal při Picturing tohoto pracovního postupu, kde hloubka je omezená na parametry testu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-349">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="16cf2-350">Počet aktivit v daném testu je určen hloubkou a počtem aktivit na sekvenci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-350">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="16cf2-351">Následující rovnice vypočítá počet aktivit v testu WF4:</span><span class="sxs-lookup"><span data-stu-id="16cf2-351">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Rovnice pro výpočet počtu aktivit](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="16cf2-353">Počet aktivit testu WF3 lze vypočítat s mírně odlišnou rovnicí z důvodu nadbytečné posloupnosti:</span><span class="sxs-lookup"><span data-stu-id="16cf2-353">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Rovnice pro výpočet počtu aktivit WF3](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="16cf2-355">Kde d je hloubka a je počet aktivit na sekvenci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-355">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="16cf2-356">Logika za těmito rovnice je, že první konstanta vynásobená, je počet sekvencí a druhá konstanta je statickým počtem aktivit na aktuální úrovni.</span><span class="sxs-lookup"><span data-stu-id="16cf2-356">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="16cf2-357">V každém vývojovém diagramu jsou tři podřízené aktivity vývojového diagramu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-357">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="16cf2-358">U nejnižší úrovně hloubky jsou tyto vývojové diagramy prázdné, ale na ostatních úrovních jsou kopie hlavního vývojového diagramu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-358">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="16cf2-359">Počet aktivit v definici pracovního postupu každé variace testu je uveden v následující tabulce:</span><span class="sxs-lookup"><span data-stu-id="16cf2-359">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Tabulka, která zobrazuje počet aktivit použitých v každém testu](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="16cf2-361">Počet aktivit v definici pracovního postupu se prudce zvyšuje s každou úrovní hloubky.</span><span class="sxs-lookup"><span data-stu-id="16cf2-361">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="16cf2-362">Ale v dané instanci pracovního postupu se spustí jenom jedna cesta na bod rozhodování, takže se spustí jenom malá podmnožina skutečných aktivit.</span><span class="sxs-lookup"><span data-stu-id="16cf2-362">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Vývojový diagram pracovního postupu komplexní propustnosti](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="16cf2-364">Pro WF3 byl vytvořen ekvivalentní pracovní postup.</span><span class="sxs-lookup"><span data-stu-id="16cf2-364">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="16cf2-365">Návrhář WF3 zobrazí celý pracovní postup v oblasti návrhu místo vnoření, proto je pro zobrazení v tomto tématu příliš velký.</span><span class="sxs-lookup"><span data-stu-id="16cf2-365">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="16cf2-366">Níže je uveden fragment pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-366">A snippet of the workflow is shown below.</span></span>

 ![Fragment pro vývojový diagram pracovního postupu WF3](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="16cf2-368">Pro vykonávání vnoření do extrémního případu používá jiný pracovní postup, který je součástí tohoto testu, použití vnořených sekvencí 100.</span><span class="sxs-lookup"><span data-stu-id="16cf2-368">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="16cf2-369">V nejvnitřnější sekvenci je jeden `Comment` nebo <xref:System.Workflow.Activities.CodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-369">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Vývojový diagram vnořené sekvence](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="16cf2-371">Sledování a trvalost se v rámci tohoto testu nepoužívají.</span><span class="sxs-lookup"><span data-stu-id="16cf2-371">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="16cf2-372">Výsledky testů</span><span class="sxs-lookup"><span data-stu-id="16cf2-372">Test Results</span></span>
 ![Sloupcový graf znázorňující výsledky propustnosti výkonu](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="16cf2-374">I u složitých pracovních postupů s hodně hloubkou a vysokým počtem aktivit jsou výsledky výkonu konzistentní s ostatními čísly propustnosti, které jsou uvedené dříve v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="16cf2-374">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="16cf2-375">WF4's propustnost je rychlejší a musí se porovnávat podle logaritmické stupnice.</span><span class="sxs-lookup"><span data-stu-id="16cf2-375">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="16cf2-376">Memory (Paměť)</span><span class="sxs-lookup"><span data-stu-id="16cf2-376">Memory</span></span>
 <span data-ttu-id="16cf2-377">Režie paměti programovací model Windows Workflow Foundation se měří ve dvou klíčových oblastech: složitost pracovního postupu a počet definicí pracovních postupů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-377">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="16cf2-378">Měření paměti byla provedena na pracovní stanici Windows 7 64.</span><span class="sxs-lookup"><span data-stu-id="16cf2-378">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="16cf2-379">Existuje mnoho způsobů, jak získat měření velikosti pracovní sady, jako jsou čítače výkonu monitorování, prostředí cyklického dotazování. WorkingSet nebo použití nástroje, jako je VMMap, který je k dispozici v [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="16cf2-379">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="16cf2-380">Kombinace metod byla použita k získání a ověření výsledků každého testu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-380">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="16cf2-381">Test složitosti pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="16cf2-381">Workflow Complexity Test</span></span>
 <span data-ttu-id="16cf2-382">Test složitosti pracovního postupu měří rozdíl pracovní sady na základě složitosti pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-382">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="16cf2-383">Kromě složitých pracovních postupů použitých v předchozí části se přidávají nové variace, které se týkají dvou základních případů: pracovní postup jedné aktivity a sekvence s 1000 aktivitami.</span><span class="sxs-lookup"><span data-stu-id="16cf2-383">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="16cf2-384">Pro tyto testy jsou pracovní postupy inicializovány a provedeny k dokončení jedné sériové smyčky po dobu jedné minuty.</span><span class="sxs-lookup"><span data-stu-id="16cf2-384">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="16cf2-385">Každá variace testu se spouští třikrát a zaznamenaná data jsou průměrem těchto tří spuštění.</span><span class="sxs-lookup"><span data-stu-id="16cf2-385">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="16cf2-386">Tyto dva nové základní testy mají pracovní postupy, které vypadají jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="16cf2-386">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Složitý pracovní postup pro WF3 i WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="16cf2-388">Ve výše uvedeném pracovním postupu WF3 <xref:System.Workflow.Activities.CodeActivity> se použijí prázdné aktivity.</span><span class="sxs-lookup"><span data-stu-id="16cf2-388">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="16cf2-389">Pracovní postup WF4 výše používá `Comment` aktivity.</span><span class="sxs-lookup"><span data-stu-id="16cf2-389">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="16cf2-390">Tato `Comment` aktivita byla popsána v části porovnání výkonu na úrovni komponenty výše v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="16cf2-390">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Sloupcový graf znázorňující komplexní využití paměti pracovního postupu pro pracovní postupy WF3 a WF4](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="16cf2-392">Jedním z jasných trendů, které je potřeba odvšimnout v tomto grafu, je, že vnořování má poměrně minimální dopad na využití paměti v WF3 i WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-392">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="16cf2-393">Nejvýznamnější dopad na paměť pochází z počtu aktivit v daném pracovním postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-393">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="16cf2-394">S ohledem na data z sekvence 1000, komplexní hloubky 5 sekvence 5 a složitá hloubka 7 sekvence 1, je zřejmé, že když počet aktivit vstoupí do tisíců, zvýšení využití paměti bude poznatelný.</span><span class="sxs-lookup"><span data-stu-id="16cf2-394">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="16cf2-395">V extrémním případě (hloubka 7 sekvence 1), kde se nacházejí ne29K aktivity, WF4 používá téměř 79% méně paměti než WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-395">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="16cf2-396">Test vícenásobných pracovních postupů</span><span class="sxs-lookup"><span data-stu-id="16cf2-396">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="16cf2-397">Měření paměti na definici pracovního postupu je rozděleno do dvou různých testů z důvodu dostupných možností pro hostování pracovních postupů v WF3 a WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-397">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="16cf2-398">Testy jsou spouštěny jiným způsobem než test složitosti pracovního postupu v tom, že daný pracovní postup je instance a proveden pouze jednou pro každou definici.</span><span class="sxs-lookup"><span data-stu-id="16cf2-398">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="16cf2-399">Důvodem je, že definice pracovního postupu a jeho hostitel zůstane v paměti pro celou dobu životnosti domény AppDomain.</span><span class="sxs-lookup"><span data-stu-id="16cf2-399">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="16cf2-400">Paměť používaná při spuštění dané instance pracovního postupu by měla být vyčištěna během uvolňování paměti.</span><span class="sxs-lookup"><span data-stu-id="16cf2-400">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="16cf2-401">Pokyny k migraci pro WF4 obsahují podrobnější informace o možnostech hostování.</span><span class="sxs-lookup"><span data-stu-id="16cf2-401">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="16cf2-402">Další informace najdete v tématu [Migrace WF kuchařka: Hostování pracovního postupu](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="16cf2-402">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="16cf2-403">Vytvoření mnoha definicí pracovních postupů pro test definice pracovního postupu lze provést několika způsoby.</span><span class="sxs-lookup"><span data-stu-id="16cf2-403">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="16cf2-404">Například jedna by mohla použít generování kódu k vytvoření sady 1000 pracovních postupů, které jsou identické s výjimkou názvu a uložení každého z těchto pracovních postupů do samostatných souborů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-404">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="16cf2-405">Tento přístup byl proveden pro test hostovaný v konzole.</span><span class="sxs-lookup"><span data-stu-id="16cf2-405">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="16cf2-406">V WF3 se <xref:System.Workflow.Runtime.WorkflowRuntime> ke spuštění definice pracovního postupu použila třída.</span><span class="sxs-lookup"><span data-stu-id="16cf2-406">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="16cf2-407">WF4 můžete použít <xref:System.Activities.WorkflowApplication> k vytvoření jedné instance pracovního postupu nebo přímo použít <xref:System.Activities.WorkflowInvoker> ke spuštění aktivity, jako by šlo o volání metody.</span><span class="sxs-lookup"><span data-stu-id="16cf2-407">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="16cf2-408"><xref:System.Activities.WorkflowApplication>je hostitelem jedné instance pracovního postupu a má při <xref:System.Workflow.Runtime.WorkflowRuntime> použití v tomto testu lepší paritu funkcí.</span><span class="sxs-lookup"><span data-stu-id="16cf2-408"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="16cf2-409">Při hostování pracovních postupů ve službě IIS je možné použít <xref:System.Web.Hosting.VirtualPathProvider> k vytvoření nové <xref:System.ServiceModel.WorkflowServiceHost> místo generování všech souborů xamlx nebo XOML.</span><span class="sxs-lookup"><span data-stu-id="16cf2-409">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="16cf2-410"><xref:System.Web.Hosting.VirtualPathProvider>Zpracovává příchozí požadavek a reaguje s "virtuálním souborem", který lze načíst z databáze nebo v tomto případě vygenerovaný průběžně.</span><span class="sxs-lookup"><span data-stu-id="16cf2-410">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="16cf2-411">Je proto nutné vytvořit 1000 fyzických souborů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-411">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="16cf2-412">Definice pracovního postupu použité v testu konzoly byly jednoduché sekvenční pracovní postupy s jednou aktivitou.</span><span class="sxs-lookup"><span data-stu-id="16cf2-412">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="16cf2-413">Jedna aktivita byla prázdná <xref:System.Workflow.Activities.CodeActivity> pro případ WF3 a `Comment` aktivitu pro případ WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-413">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="16cf2-414">Případ hostovaný v rámci služby IIS používaný při přijímání zprávy a ukončení odeslání odpovědi:</span><span class="sxs-lookup"><span data-stu-id="16cf2-414">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="16cf2-415">Následující obrázek znázorňuje WF3 pracovní postup s ReceiveActivity a pracovním postupem WF4 se vzorem požadavků a odpovědí:</span><span class="sxs-lookup"><span data-stu-id="16cf2-415">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Služby pracovních postupů v WF3 a WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="16cf2-417">Následující tabulka ukazuje rozdíl v pracovní sadě mezi definicí jedné pracovní postup a definicemi 1001:</span><span class="sxs-lookup"><span data-stu-id="16cf2-417">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="16cf2-418">Možnosti hostování</span><span class="sxs-lookup"><span data-stu-id="16cf2-418">Hosting Options</span></span>|<span data-ttu-id="16cf2-419">Rozdíl pracovní sady WF3</span><span class="sxs-lookup"><span data-stu-id="16cf2-419">WF3 Working Set Delta</span></span>|<span data-ttu-id="16cf2-420">Rozdíl pracovní sady WF4</span><span class="sxs-lookup"><span data-stu-id="16cf2-420">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="16cf2-421">Hostované pracovní postupy konzolové aplikace</span><span class="sxs-lookup"><span data-stu-id="16cf2-421">Console Application Hosted Workflows</span></span>|<span data-ttu-id="16cf2-422">18 MB</span><span class="sxs-lookup"><span data-stu-id="16cf2-422">18 MB</span></span>|<span data-ttu-id="16cf2-423">9 MB</span><span class="sxs-lookup"><span data-stu-id="16cf2-423">9 MB</span></span>|
|<span data-ttu-id="16cf2-424">Služby pracovních postupů hostovaných službou IIS</span><span class="sxs-lookup"><span data-stu-id="16cf2-424">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="16cf2-425">446 MB</span><span class="sxs-lookup"><span data-stu-id="16cf2-425">446 MB</span></span>|<span data-ttu-id="16cf2-426">364 MB</span><span class="sxs-lookup"><span data-stu-id="16cf2-426">364 MB</span></span>|

 <span data-ttu-id="16cf2-427">Hostování definic pracovních postupů ve službě IIS spotřebovává mnohem více paměti z důvodu <xref:System.ServiceModel.WorkflowServiceHost> podrobnějších artefaktů služby WCF a logiky zpracování zpráv, která je přidružena k hostiteli.</span><span class="sxs-lookup"><span data-stu-id="16cf2-427">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="16cf2-428">Pro hostování konzoly nástroje v WF3 byly pracovní postupy implementovány v kódu místo XOML.</span><span class="sxs-lookup"><span data-stu-id="16cf2-428">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="16cf2-429">Ve výchozím nastavení je použita hodnota XAML v WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-429">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="16cf2-430">XAML je uložen jako vložený prostředek v sestavení a zkompilován během běhu za účelem zajištění implementace pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-430">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="16cf2-431">K tomuto procesu je spojená nějaká režie.</span><span class="sxs-lookup"><span data-stu-id="16cf2-431">There is some overhead associated with this process.</span></span>  <span data-ttu-id="16cf2-432">Aby bylo možné provést spravedlivé porovnání mezi WF3 a WF4, byly použity kódované pracovní postupy namísto XAML.</span><span class="sxs-lookup"><span data-stu-id="16cf2-432">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="16cf2-433">Příklad jednoho z pracovních postupů WF4 je uveden níže:</span><span class="sxs-lookup"><span data-stu-id="16cf2-433">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="16cf2-434">Existuje mnoho dalších faktorů, které mohou ovlivnit spotřebu paměti.</span><span class="sxs-lookup"><span data-stu-id="16cf2-434">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="16cf2-435">Pro všechny spravované programy se stále platí stejná doporučení.</span><span class="sxs-lookup"><span data-stu-id="16cf2-435">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="16cf2-436">V prostředích hostovaných službou IIS <xref:System.ServiceModel.WorkflowServiceHost> zůstane objekt vytvořený pro definici pracovního postupu v paměti, dokud se fond aplikací recykluje.</span><span class="sxs-lookup"><span data-stu-id="16cf2-436">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="16cf2-437">To by mělo být při psaní rozšíření zachováno.</span><span class="sxs-lookup"><span data-stu-id="16cf2-437">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="16cf2-438">Je také vhodné se vyhnout "globálním" proměnným (proměnné v oboru celého pracovního postupu) a omezit rozsah proměnných, pokud je to možné.</span><span class="sxs-lookup"><span data-stu-id="16cf2-438">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="16cf2-439">Běhové služby pracovních postupů</span><span class="sxs-lookup"><span data-stu-id="16cf2-439">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="16cf2-440">Uchování</span><span class="sxs-lookup"><span data-stu-id="16cf2-440">Persistence</span></span>
 <span data-ttu-id="16cf2-441">WF3 a WF4 se dodávají se zprostředkovatelem trvalosti SQL.</span><span class="sxs-lookup"><span data-stu-id="16cf2-441">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="16cf2-442">Zprostředkovatel trvalosti SQL WF3 je jednoduchá implementace, která serializace instanci pracovního postupu a ukládá ji do objektu BLOB.</span><span class="sxs-lookup"><span data-stu-id="16cf2-442">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="16cf2-443">Z tohoto důvodu výkon tohoto zprostředkovatele závisí silně na velikosti instance pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-443">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="16cf2-444">V WF3 se velikost instance může zvětšit z mnoha důvodů, jak je popsáno výše v tomto dokumentu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-444">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="16cf2-445">Mnoho zákazníků nepoužívá výchozího poskytovatele trvalosti SQL, protože ukládání serializovaných instancí v databázi neposkytuje žádnou viditelnost stavu pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-445">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="16cf2-446">Aby bylo možné najít konkrétní pracovní postup bez znalosti ID pracovního postupu, bude nutné, aby bylo možné deserializovat každou trvalou instanci a prohlédnout si obsah.</span><span class="sxs-lookup"><span data-stu-id="16cf2-446">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="16cf2-447">Mnoho vývojářů preferuje psaní vlastních poskytovatelů trvalosti pro překonání této překážky.</span><span class="sxs-lookup"><span data-stu-id="16cf2-447">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="16cf2-448">Zprostředkovatel trvalosti WF4 SQL se pokusil vyřešit některé z těchto otázek.</span><span class="sxs-lookup"><span data-stu-id="16cf2-448">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="16cf2-449">Dočasné tabulky zveřejňují určité informace, jako jsou aktivní záložky a vlastnosti k vlastnost.</span><span class="sxs-lookup"><span data-stu-id="16cf2-449">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="16cf2-450">Nová funkce korelace na základě obsahu v WF4 nefunguje správně s využitím přístupu WF3 SQL pro trvalost, který v organizaci trvalé instance pracovního postupu způsobil nějakou změnu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-450">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="16cf2-451">Díky tomu je úloha poskytovatele trvalější a přináší další zátěž v databázi.</span><span class="sxs-lookup"><span data-stu-id="16cf2-451">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="16cf2-452">Nastavení prostředí</span><span class="sxs-lookup"><span data-stu-id="16cf2-452">Environment Setup</span></span>
![Nastavení prostředí pro test výkonnosti pracovního postupu](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="16cf2-454">Nastavení testu</span><span class="sxs-lookup"><span data-stu-id="16cf2-454">Test Setup</span></span>
 <span data-ttu-id="16cf2-455">I s vylepšenou sadou funkcí a lepším zpracováním souběžnosti je poskytovatel SQL trvalosti v WF4 rychlejší než poskytovatel v WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-455">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="16cf2-456">Aby se to předvedlo, dva pracovní postupy, které provádějí v podstatě stejné operace v WF3 a WF4, jsou porovnávány níže.</span><span class="sxs-lookup"><span data-stu-id="16cf2-456">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Pracovní postup trvalosti v WF3 vlevo a WF4 na pravé straně](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="16cf2-458">Oba pracovní postupy jsou vytvářeny přijatou zprávou.</span><span class="sxs-lookup"><span data-stu-id="16cf2-458">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="16cf2-459">Po odeslání počáteční odpovědi se pracovní postup trvale zachová.</span><span class="sxs-lookup"><span data-stu-id="16cf2-459">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="16cf2-460">V případě WF3 <xref:System.Workflow.ComponentModel.TransactionScopeActivity> je pro zahájení trvalosti použito prázdné.</span><span class="sxs-lookup"><span data-stu-id="16cf2-460">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="16cf2-461">Totéž lze dosáhnout v WF3 označením aktivity jako "trvale při zavření".</span><span class="sxs-lookup"><span data-stu-id="16cf2-461">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="16cf2-462">Druhá, korelační zpráva dokončí pracovní postup.</span><span class="sxs-lookup"><span data-stu-id="16cf2-462">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="16cf2-463">Pracovní postupy jsou trvalé, ale nejsou uvolněny.</span><span class="sxs-lookup"><span data-stu-id="16cf2-463">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="16cf2-464">Výsledky testů</span><span class="sxs-lookup"><span data-stu-id="16cf2-464">Test Results</span></span>
 ![Sloupcový graf znázorňující trvalost propustnosti](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="16cf2-466">Když je přenos mezi klientem a střední vrstvou HTTP, trvalost v WF4 zobrazuje vylepšení 2,6 časů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-466">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="16cf2-467">Přenos TCP zvyšuje tento faktor na 3,0 časů.</span><span class="sxs-lookup"><span data-stu-id="16cf2-467">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="16cf2-468">Ve všech případech je využití procesoru na střední úrovni 98% nebo vyšší.</span><span class="sxs-lookup"><span data-stu-id="16cf2-468">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="16cf2-469">Důvodem, proč je WF4 propustnost větší, je z důvodu rychlejšího modulu runtime pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-469">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="16cf2-470">Velikost serializované instance je pro oba případy nízká a není hlavním přispívajícím prvkem v této situaci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-470">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="16cf2-471">Pracovní postupy WF3 i WF4 v tomto testu používají aktivitu k explicitnímu označení toho, kdy by trvala trvalá situace.</span><span class="sxs-lookup"><span data-stu-id="16cf2-471">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="16cf2-472">Výhodou je zachování pracovního postupu bez jeho uvolnění.</span><span class="sxs-lookup"><span data-stu-id="16cf2-472">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="16cf2-473">V WF3 je také možné trvale použít <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> funkci, ale tato funkce uvolní instanci pracovního postupu z paměti.</span><span class="sxs-lookup"><span data-stu-id="16cf2-473">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="16cf2-474">Pokud vývojář používající WF3 chce zajistit, že pracovní postup v určitých bodech přetrvává, musí buď upravit definici pracovního postupu, nebo platit náklady na uvolnění a opětovné načtení instance pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-474">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="16cf2-475">Nová funkce v WF4 umožňuje zachovat bez uvolnění těchto možností: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> .</span><span class="sxs-lookup"><span data-stu-id="16cf2-475">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="16cf2-476">Tato funkce umožňuje, aby se instance pracovního postupu trvala při nečinnosti, ale zůstala v paměti, dokud <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> není prahová hodnota splněna, nebo dokud nebude provedeno obnovení.</span><span class="sxs-lookup"><span data-stu-id="16cf2-476">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="16cf2-477">Všimněte si, že zprostředkovatel trvalosti WF4 SQL provádí více práce v databázové vrstvě.</span><span class="sxs-lookup"><span data-stu-id="16cf2-477">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="16cf2-478">SQL Database se může stát kritickým bodem, takže je důležité monitorovat využití procesoru a disku.</span><span class="sxs-lookup"><span data-stu-id="16cf2-478">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="16cf2-479">Nezapomeňte do aplikace pracovní postup testování výkonu zahrnout následující čítače výkonu z databáze SQL:</span><span class="sxs-lookup"><span data-stu-id="16cf2-479">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="16cf2-480">Fyzický \\ disk% doba čtení disku</span><span class="sxs-lookup"><span data-stu-id="16cf2-480">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="16cf2-481">Fyzický \\ disk% času disku</span><span class="sxs-lookup"><span data-stu-id="16cf2-481">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="16cf2-482">Fyzický disk \\ % Doba zápisu disku</span><span class="sxs-lookup"><span data-stu-id="16cf2-482">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="16cf2-483">Fyzický disk \\ % Průměrná délka fronty disku</span><span class="sxs-lookup"><span data-stu-id="16cf2-483">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="16cf2-484">Délka fronty čtení z disku fyzický</span><span class="sxs-lookup"><span data-stu-id="16cf2-484">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="16cf2-485">Délka fronty zápisu na disk fyzický</span><span class="sxs-lookup"><span data-stu-id="16cf2-485">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="16cf2-486">Délka fronty disku fyzický</span><span class="sxs-lookup"><span data-stu-id="16cf2-486">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="16cf2-487">Informace o procesoru – \\ % času procesoru</span><span class="sxs-lookup"><span data-stu-id="16cf2-487">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="16cf2-488">SQLServer: Latches\Average doba čekání na západku (MS)</span><span class="sxs-lookup"><span data-stu-id="16cf2-488">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="16cf2-489">SQLServer: Latches\Latch čeká za sekundu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-489">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="16cf2-490">Sledování</span><span class="sxs-lookup"><span data-stu-id="16cf2-490">Tracking</span></span>
 <span data-ttu-id="16cf2-491">Sledování pracovního postupu lze použít ke sledování průběhu pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-491">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="16cf2-492">Informace, které jsou součástí sledovacích událostí, jsou určeny profilem sledování.</span><span class="sxs-lookup"><span data-stu-id="16cf2-492">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="16cf2-493">Čím komplexnější profil sledování, tím dražší sledování se stane.</span><span class="sxs-lookup"><span data-stu-id="16cf2-493">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="16cf2-494">WF3 se dodává se službou sledování založené na SQL.</span><span class="sxs-lookup"><span data-stu-id="16cf2-494">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="16cf2-495">Tato služba může pracovat v režimech v dávce i v jiných dávkách.</span><span class="sxs-lookup"><span data-stu-id="16cf2-495">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="16cf2-496">V režimu bez dávek jsou sledování událostí zapisovány přímo do databáze.</span><span class="sxs-lookup"><span data-stu-id="16cf2-496">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="16cf2-497">V dávkovém režimu jsou sledování událostí shromažďovány do stejné dávky jako stav instance pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-497">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="16cf2-498">Dávkový režim má nejlepší výkon pro nejširší škálu návrhů pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-498">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="16cf2-499">Dávkování ale může mít negativní dopad na výkon, pokud pracovní postup spouští mnoho aktivit bez zachování a aktivity jsou sledovány.</span><span class="sxs-lookup"><span data-stu-id="16cf2-499">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="16cf2-500">K tomu obvykle dochází ve smyčce a nejlepším způsobem, jak se tomuto scénáři vyhnout, je navrhovat velké smyčky, aby obsahovaly trvalý bod.</span><span class="sxs-lookup"><span data-stu-id="16cf2-500">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="16cf2-501">Představení bodu trvalosti do smyčky může negativně ovlivnit výkon, takže je důležité změřit náklady na jednotlivé a se zaměřením na rovnováhu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-501">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="16cf2-502">WF4 se nedodává se službou sledování SQL.</span><span class="sxs-lookup"><span data-stu-id="16cf2-502">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="16cf2-503">Zaznamenávání informací o sledování do databáze SQL je možné zpracovat lépe z aplikačního serveru, nikoli z integrovaného do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="16cf2-503">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="16cf2-504">Proto je sledování SQL teď zpracováváno pomocí technologie AppFabric.</span><span class="sxs-lookup"><span data-stu-id="16cf2-504">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="16cf2-505">Dodaný Zprostředkovatel sledování v WF4 je založený na trasování událostí pro Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="16cf2-505">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="16cf2-506">ETW je systém událostí s nízkou latencí, který je součástí systému Windows na úrovni jádra.</span><span class="sxs-lookup"><span data-stu-id="16cf2-506">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="16cf2-507">Používá model poskytovatele/příjemce, který umožňuje, aby bylo možné pouze vytvořit pokutu pro trasování událostí v případě, že existuje skutečný příjemce.</span><span class="sxs-lookup"><span data-stu-id="16cf2-507">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="16cf2-508">Kromě událostí jádra, jako je procesor, disk, paměť a využití sítě, mnoho aplikací využívá i trasování událostí pro Windows.</span><span class="sxs-lookup"><span data-stu-id="16cf2-508">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="16cf2-509">Události ETW jsou výkonnější než čítače výkonu v tom, že události lze přizpůsobit aplikaci.</span><span class="sxs-lookup"><span data-stu-id="16cf2-509">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="16cf2-510">Událost může obsahovat text, jako je ID pracovního postupu nebo informační zpráva.</span><span class="sxs-lookup"><span data-stu-id="16cf2-510">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="16cf2-511">Události jsou také zařazeny do kategorií vyčíslení, takže využívání určité podmnožiny událostí bude mít menší dopad na výkon než zachycení všech událostí.</span><span class="sxs-lookup"><span data-stu-id="16cf2-511">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="16cf2-512">Výhody použití ETW pro sledování místo SQL include:</span><span class="sxs-lookup"><span data-stu-id="16cf2-512">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="16cf2-513">Kolekce sledovacích událostí může být oddělena jiným procesem.</span><span class="sxs-lookup"><span data-stu-id="16cf2-513">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="16cf2-514">Díky tomu je větší flexibilita při zaznamenávání událostí.</span><span class="sxs-lookup"><span data-stu-id="16cf2-514">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="16cf2-515">Události sledování ETW jsou snadno kombinovány s událostmi ETW WCF nebo jinými zprostředkovateli trasování událostí pro Windows, jako je SQL Server nebo zprostředkovatel jádra.</span><span class="sxs-lookup"><span data-stu-id="16cf2-515">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="16cf2-516">Autoři pracovních postupů nemusí měnit pracovní postup, aby bylo možné lépe pracovat s určitou implementací sledování, jako je například režim dávky služby sledování SQL WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-516">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="16cf2-517">Správce může zapnout nebo vypnout sledování bez recyklace procesu hostitele.</span><span class="sxs-lookup"><span data-stu-id="16cf2-517">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="16cf2-518">Výhody sledování trasování událostí pro Windows přináší nevýhodný výkon.</span><span class="sxs-lookup"><span data-stu-id="16cf2-518">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="16cf2-519">Události trasování událostí pro Windows se můžou ztratit, pokud je systém v intenzivním tlaku na zdroje.</span><span class="sxs-lookup"><span data-stu-id="16cf2-519">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="16cf2-520">Zpracování událostí není určeno k blokování normálního spuštění programu, a proto není zaručeno, že všechny události ETW budou všesměrově vysílané svým předplatitelům.</span><span class="sxs-lookup"><span data-stu-id="16cf2-520">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="16cf2-521">Díky tomu je sledování ETW Skvělé pro monitorování stavu, ale není vhodné pro auditování.</span><span class="sxs-lookup"><span data-stu-id="16cf2-521">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="16cf2-522">I když WF4 nemá poskytovatele sledování SQL, technologie AppFabric dělá.</span><span class="sxs-lookup"><span data-stu-id="16cf2-522">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="16cf2-523">Přístup ke sledování SQL pro AppFabric je přihlášení k odběru událostí ETW pomocí služby systému Windows, která události zapisuje a zapisuje je do tabulky SQL navržené pro rychlé vložení.</span><span class="sxs-lookup"><span data-stu-id="16cf2-523">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="16cf2-524">Samostatná úloha vyprázdní data z této tabulky a reformuje je do tabulek pro vytváření sestav, které lze zobrazit na řídicím panelu AppFabric.</span><span class="sxs-lookup"><span data-stu-id="16cf2-524">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="16cf2-525">To znamená, že dávka sledování událostí je zpracována nezávisle na pracovním postupu, ze kterého pochází, a proto nemusí čekat na bod trvalosti před nahráním.</span><span class="sxs-lookup"><span data-stu-id="16cf2-525">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="16cf2-526">Události trasování událostí pro Windows se dají zaznamenávat pomocí nástrojů, jako je například Logman nebo Xperf.</span><span class="sxs-lookup"><span data-stu-id="16cf2-526">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="16cf2-527">Kompaktní soubor ETL lze zobrazit pomocí nástroje, jako je například xperfview nebo převeden do čitelnějšího formátu, jako je například XML, pomocí rozhraní Tracerpt.</span><span class="sxs-lookup"><span data-stu-id="16cf2-527">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="16cf2-528">V WF3 je jediná možnost, jak získat události sledování bez databáze SQL, vytvořit vlastní službu sledování.</span><span class="sxs-lookup"><span data-stu-id="16cf2-528">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="16cf2-529">Další informace o trasování událostí pro Windows najdete v tématu [služby WCF a trasování událostí pro Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) a [trasování událostí – aplikace pro Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="16cf2-529">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="16cf2-530">Povolení sledování pracovního postupu bude mít vliv na výkon v různých stupních.</span><span class="sxs-lookup"><span data-stu-id="16cf2-530">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="16cf2-531">Srovnávací test používá nástroj Logman ke zpracování událostí sledování ETW a jejich zaznamenávání do souboru ETL.</span><span class="sxs-lookup"><span data-stu-id="16cf2-531">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="16cf2-532">Náklady na sledování SQL v rozhraní AppFabric nejsou v rozsahu tohoto článku.</span><span class="sxs-lookup"><span data-stu-id="16cf2-532">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="16cf2-533">V tomto srovnávacím testu se zobrazí základní profil sledování, který se používá také v rozhraní AppFabric.</span><span class="sxs-lookup"><span data-stu-id="16cf2-533">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="16cf2-534">Zahrnuje také náklady na sledování pouze událostí monitorování stavu.</span><span class="sxs-lookup"><span data-stu-id="16cf2-534">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="16cf2-535">Tyto události jsou užitečné pro řešení problémů a určení průměrné propustnosti systému.</span><span class="sxs-lookup"><span data-stu-id="16cf2-535">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="16cf2-536">Nastavení prostředí</span><span class="sxs-lookup"><span data-stu-id="16cf2-536">Environment Setup</span></span>
 ![Nastavení prostředí pro test výkonnosti pracovního postupu](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="16cf2-538">Výsledky testů</span><span class="sxs-lookup"><span data-stu-id="16cf2-538">Test Results</span></span>

 ![Sloupcový graf znázorňující náklady sledování pracovního postupu](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="16cf2-540">Monitorování stavu má přibližně 3% dopad na propustnost.</span><span class="sxs-lookup"><span data-stu-id="16cf2-540">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="16cf2-541">Náklady na základní profil jsou přibližně 8%.</span><span class="sxs-lookup"><span data-stu-id="16cf2-541">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="16cf2-542">Zprostředkovatel komunikace</span><span class="sxs-lookup"><span data-stu-id="16cf2-542">Interop</span></span>
 <span data-ttu-id="16cf2-543">WF4 je skoro úplný přepis [!INCLUDE[wf1](../../../includes/wf1-md.md)] , takže pracovní postupy a aktivity WF3 nejsou přímo kompatibilní s WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-543">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="16cf2-544">Mnoho zákazníků, kteří programovací model Windows Workflow Foundation brzkém rozhodnutím, bude mít interní nebo vlastní definice pracovních postupů třetích stran a vlastní aktivity pro WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-544">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="16cf2-545">Jedním ze způsobů, jak usnadnit přechod na WF4, je použití aktivity spolupráce, která může provádět aktivity WF3 z pracovního postupu WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-545">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="16cf2-546">Doporučuje se, aby se tato <xref:System.Activities.Statements.Interop> aktivita používala jenom v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="16cf2-546">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="16cf2-547">Další informace o migraci na WF4 najdete v [pokynech k migraci WF4](migration-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="16cf2-547">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="16cf2-548">Nastavení prostředí</span><span class="sxs-lookup"><span data-stu-id="16cf2-548">Environment Setup</span></span>
 ![Nastavení prostředí pro test výkonnosti pracovního postupu](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="16cf2-550">Výsledky testů</span><span class="sxs-lookup"><span data-stu-id="16cf2-550">Test Results</span></span>

<span data-ttu-id="16cf2-551">V následující tabulce jsou uvedeny výsledky spuštění pracovního postupu obsahujícího pět aktivit v posloupnosti v různých konfiguracích.</span><span class="sxs-lookup"><span data-stu-id="16cf2-551">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="16cf2-552">Test</span><span class="sxs-lookup"><span data-stu-id="16cf2-552">Test</span></span>|<span data-ttu-id="16cf2-553">Propustnost (pracovní postupy/s)</span><span class="sxs-lookup"><span data-stu-id="16cf2-553">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="16cf2-554">Sekvence WF3 v modulu runtime WF3</span><span class="sxs-lookup"><span data-stu-id="16cf2-554">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="16cf2-555">1 576</span><span class="sxs-lookup"><span data-stu-id="16cf2-555">1,576</span></span>|
|<span data-ttu-id="16cf2-556">Sekvence WF3 v modulu runtime WF4 pomocí spolupráce</span><span class="sxs-lookup"><span data-stu-id="16cf2-556">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="16cf2-557">2 745</span><span class="sxs-lookup"><span data-stu-id="16cf2-557">2,745</span></span>|
|<span data-ttu-id="16cf2-558">WF4 sekvence</span><span class="sxs-lookup"><span data-stu-id="16cf2-558">WF4 Sequence</span></span>|<span data-ttu-id="16cf2-559">153 582</span><span class="sxs-lookup"><span data-stu-id="16cf2-559">153,582</span></span>|

 <span data-ttu-id="16cf2-560">Existuje významné zvýšení výkonu při použití zprostředkovatele komunikace přes rovnou WF3.</span><span class="sxs-lookup"><span data-stu-id="16cf2-560">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="16cf2-561">Nicméně při porovnání s aktivitami WF4 je nárůst zanedbatelný.</span><span class="sxs-lookup"><span data-stu-id="16cf2-561">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="16cf2-562">Souhrn</span><span class="sxs-lookup"><span data-stu-id="16cf2-562">Summary</span></span>
 <span data-ttu-id="16cf2-563">Velké investice do výkonu pro WF4 se v mnoha důležitých oblastech vyplácejí.</span><span class="sxs-lookup"><span data-stu-id="16cf2-563">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="16cf2-564">Výkon součásti pro jednotlivé pracovní postupy je v některých případech rychlejší v WF4 ve srovnání s WF3 z důvodu prostředí štíhlé výroby [!INCLUDE[wf1](../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="16cf2-564">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="16cf2-565">Hodnoty latence jsou také výrazně lepší.</span><span class="sxs-lookup"><span data-stu-id="16cf2-565">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="16cf2-566">To znamená, že snížení výkonu pro použití na [!INCLUDE[wf1](../../../includes/wf1-md.md)] rozdíl od ručního kódování služeb orchestrace WCF je velmi malé s ohledem na přidané výhody použití [!INCLUDE[wf1](../../../includes/wf1-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="16cf2-566">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="16cf2-567">Výkon trvalosti se zvýšil o faktor 2,5-3,0.</span><span class="sxs-lookup"><span data-stu-id="16cf2-567">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="16cf2-568">Sledování stavu pomocí sledování pracovního postupu teď má velmi malou režii.</span><span class="sxs-lookup"><span data-stu-id="16cf2-568">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="16cf2-569">K dispozici je komplexní sada průvodců migrací, které zvažuje přesun z WF3 do WF4.</span><span class="sxs-lookup"><span data-stu-id="16cf2-569">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="16cf2-570">To vše by mělo WF4 být atraktivní možností pro psaní složitých aplikací.</span><span class="sxs-lookup"><span data-stu-id="16cf2-570">All of this should make WF4 an attractive option for writing complex applications.</span></span>
