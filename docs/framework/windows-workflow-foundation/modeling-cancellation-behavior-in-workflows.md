---
title: Chování zrušení modelování v pracovních postupech
ms.date: 03/30/2017
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
ms.openlocfilehash: 8738afa838f1d0ca36b7fd6def00f0794bcf47ac
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/12/2020
ms.locfileid: "79143041"
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="f198c-102">Chování zrušení modelování v pracovních postupech</span><span class="sxs-lookup"><span data-stu-id="f198c-102">Modeling Cancellation Behavior in Workflows</span></span>
<span data-ttu-id="f198c-103">Aktivity lze zrušit v rámci pracovního <xref:System.Activities.Statements.Parallel> postupu, například aktivitou, která `true`zruší neúplné větve, když <xref:System.Activities.WorkflowApplication.Cancel%2A>je vyhodnocována <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> do aplikace , nebo mimo pracovní postup, pokud hostitel volá .</span><span class="sxs-lookup"><span data-stu-id="f198c-103">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="f198c-104">Chcete-li poskytnout zpracování zrušení, <xref:System.Activities.Statements.CancellationScope> autoři <xref:System.Activities.Statements.CompensableActivity> pracovního postupu můžete použít aktivitu, aktivitu nebo vytvořit vlastní aktivity, které poskytují logiku zrušení.</span><span class="sxs-lookup"><span data-stu-id="f198c-104">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="f198c-105">Toto téma obsahuje přehled zrušení v pracovních postupech.</span><span class="sxs-lookup"><span data-stu-id="f198c-105">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="f198c-106">Zrušení, kompenzace a transakce</span><span class="sxs-lookup"><span data-stu-id="f198c-106">Cancellation, Compensation, and Transactions</span></span>  
 <span data-ttu-id="f198c-107">Transakce poskytují aplikaci možnost přerušit (vrátit zpět) všechny změny provedené v rámci transakce, pokud dojde k chybám během jakékoli části procesu transakce.</span><span class="sxs-lookup"><span data-stu-id="f198c-107">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="f198c-108">Však ne všechny práce, které mohou být nutné zrušit nebo vrátit zpět je vhodné pro transakce, jako je například dlouhotrvající práce nebo práce, která nezahrnuje transakční prostředky.</span><span class="sxs-lookup"><span data-stu-id="f198c-108">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="f198c-109">Kompenzace poskytuje model pro vrácení dříve dokončené netransakční práce, pokud dojde k následné chybě v pracovním postupu.</span><span class="sxs-lookup"><span data-stu-id="f198c-109">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="f198c-110">Zrušení poskytuje model pro autory pracovního postupu a aktivity pro zpracování netransakční práce, která nebyla dokončena.</span><span class="sxs-lookup"><span data-stu-id="f198c-110">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="f198c-111">Pokud aktivita nedokončila své spuštění a je zrušena, její logika zrušení bude vyvolána, pokud je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="f198c-111">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="f198c-112">Další informace o transakcích a kompenzacích naleznete v [tématu Transakce](workflow-transactions.md) a [kompenzace](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="f198c-112">For more information about transactions and compensation, see [Transactions](workflow-transactions.md) and [Compensation](compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="f198c-113">Použití CancellationScope</span><span class="sxs-lookup"><span data-stu-id="f198c-113">Using CancellationScope</span></span>  
 <span data-ttu-id="f198c-114">Aktivita <xref:System.Activities.Statements.CancellationScope> má dvě části, které <xref:System.Activities.Statements.CancellationScope.Body%2A> <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>mohou obsahovat podřízené aktivity: a .</span><span class="sxs-lookup"><span data-stu-id="f198c-114">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="f198c-115">Je, <xref:System.Activities.Statements.CancellationScope.Body%2A> kde jsou umístěny aktivity, které tvoří <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> logiku aktivity a je, kde jsou umístěny aktivity, které poskytují logiku zrušení pro aktivitu.</span><span class="sxs-lookup"><span data-stu-id="f198c-115">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="f198c-116">Aktivitu lze zrušit pouze v případě, že nebyla dokončena.</span><span class="sxs-lookup"><span data-stu-id="f198c-116">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="f198c-117">V případě <xref:System.Activities.Statements.CancellationScope> činnosti se dokončením rozumí dokončení činností v <xref:System.Activities.Statements.CancellationScope.Body%2A>oblasti .</span><span class="sxs-lookup"><span data-stu-id="f198c-117">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="f198c-118">Pokud je naplánována žádost o zrušení <xref:System.Activities.Statements.CancellationScope.Body%2A> a aktivity <xref:System.Activities.Statements.CancellationScope> v aplikaci <xref:System.Activities.ActivityInstanceState.Canceled> nebyly <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> dokončeny, budou označeny jako a aktivity budou provedeny.</span><span class="sxs-lookup"><span data-stu-id="f198c-118">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="f198c-119">Zrušení pracovního postupu z hostitele</span><span class="sxs-lookup"><span data-stu-id="f198c-119">Canceling a Workflow from the Host</span></span>  
 <span data-ttu-id="f198c-120">Hostitel může zrušit pracovní postup <xref:System.Activities.WorkflowApplication.Cancel%2A> voláním <xref:System.Activities.WorkflowApplication> metody instance, která je hostitelem pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="f198c-120">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="f198c-121">V následujícím příkladu je vytvořen <xref:System.Activities.Statements.CancellationScope>pracovní postup, který má .</span><span class="sxs-lookup"><span data-stu-id="f198c-121">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="f198c-122">Pracovní postup je vyvolán a hostitel provede <xref:System.Activities.WorkflowApplication.Cancel%2A>volání .</span><span class="sxs-lookup"><span data-stu-id="f198c-122">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="f198c-123">Hlavní spuštění pracovního postupu je <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> zastaveno, <xref:System.Activities.Statements.CancellationScope> je vyvoláno a pracovní postup <xref:System.Activities.ActivityInstanceState.Canceled>se dokončí se stavem .</span><span class="sxs-lookup"><span data-stu-id="f198c-123">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="f198c-124">Při vyvolání tohoto pracovního postupu se konzoli zobrazí následující výstup.</span><span class="sxs-lookup"><span data-stu-id="f198c-124">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f198c-125">**Spuštění pracovního postupu.**</span><span class="sxs-lookup"><span data-stu-id="f198c-125">**Starting the workflow.**</span></span>  
<span data-ttu-id="f198c-126">**CancellationHandler vyvolána.** 
 **Pracovní postup b30ebb30-df46-4d90-a211-e31c38d8db3c Zrušeno.**</span><span class="sxs-lookup"><span data-stu-id="f198c-126">**CancellationHandler invoked.**
**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>
> [!NOTE]
> <span data-ttu-id="f198c-127">Pokud <xref:System.Activities.Statements.CancellationScope> je aktivita zrušena <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> a vyvolána, je odpovědností autora pracovního postupu určit průběh, který byla zrušena před zrušením, aby byla poskytnuta příslušná logika zrušení.</span><span class="sxs-lookup"><span data-stu-id="f198c-127">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="f198c-128">Neposkytuje <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> žádné informace o průběhu zrušené aktivity.</span><span class="sxs-lookup"><span data-stu-id="f198c-128">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="f198c-129">Pracovní postup lze také zrušit z hostitele, pokud neošetřená výjimka bubliny <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> až <xref:System.Activities.UnhandledExceptionAction.Cancel>za kořen pracovního postupu a obslužná rutina vrátí .</span><span class="sxs-lookup"><span data-stu-id="f198c-129">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="f198c-130">V tomto příkladu se spustí <xref:System.ApplicationException>pracovní postup a potom vyvolá .</span><span class="sxs-lookup"><span data-stu-id="f198c-130">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="f198c-131">Tato výjimka není zpracována pracovním <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> postupem a proto je obslužná rutina vyvolána.</span><span class="sxs-lookup"><span data-stu-id="f198c-131">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="f198c-132">Obslužná rutina instruuje <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> modul runtime ke <xref:System.Activities.Statements.CancellationScope> zrušení pracovního postupu a je vyvolána aktuálně spuštěná aktivita.</span><span class="sxs-lookup"><span data-stu-id="f198c-132">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="f198c-133">Při vyvolání tohoto pracovního postupu se konzoli zobrazí následující výstup.</span><span class="sxs-lookup"><span data-stu-id="f198c-133">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f198c-134">**Spuštění pracovního postupu.**</span><span class="sxs-lookup"><span data-stu-id="f198c-134">**Starting the workflow.**</span></span>  
<span data-ttu-id="f198c-135">**OnUnhandledException v pracovním postupu 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9**
**Byla vyvolána výjimka z aplikace.** 
 **CancellationHandler vyvolána.** 
 **Pracovní postup 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Zrušeno.**</span><span class="sxs-lookup"><span data-stu-id="f198c-135">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9**
**An ApplicationException was thrown.**
**CancellationHandler invoked.**
**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>
### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="f198c-136">Zrušení aktivity z pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="f198c-136">Canceling an Activity from Inside a Workflow</span></span>  
 <span data-ttu-id="f198c-137">Aktivitu může zrušit také nadřazená aktivita.</span><span class="sxs-lookup"><span data-stu-id="f198c-137">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="f198c-138">Například pokud <xref:System.Activities.Statements.Parallel> aktivita má více vykonávajících <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> větví `true` a její vyhodnocuje se pak její neúplné větve budou zrušeny.</span><span class="sxs-lookup"><span data-stu-id="f198c-138">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="f198c-139">V tomto <xref:System.Activities.Statements.Parallel> příkladu je vytvořena aktivita, která má dvě větve.</span><span class="sxs-lookup"><span data-stu-id="f198c-139">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="f198c-140">Jeho <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> je `true` nastavena <xref:System.Activities.Statements.Parallel> tak, aby dokončí, jakmile některý z jeho poboček je dokončena.</span><span class="sxs-lookup"><span data-stu-id="f198c-140">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="f198c-141">V tomto příkladu bude dokončena větev 2, a proto je pobočka 1 zrušena.</span><span class="sxs-lookup"><span data-stu-id="f198c-141">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="f198c-142">Při vyvolání tohoto pracovního postupu se konzoli zobrazí následující výstup.</span><span class="sxs-lookup"><span data-stu-id="f198c-142">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f198c-143">**Větev 1 začíná.**</span><span class="sxs-lookup"><span data-stu-id="f198c-143">**Branch 1 starting.**</span></span>  
<span data-ttu-id="f198c-144">**Pobočka 2 dokončena.** 
 **Pobočka 1 zrušena.** 
 **Pracovní postup e0685e24-18ef-4a47-acf3-5c638732f3be dokončen.**</span><span class="sxs-lookup"><span data-stu-id="f198c-144">**Branch 2 complete.**
**Branch 1 canceled.**
**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="f198c-145">Aktivity jsou také zrušeny, pokud výjimka bubliny za kořen aktivity, ale je zpracována na vyšší úrovni v pracovním postupu.</span><span class="sxs-lookup"><span data-stu-id="f198c-145">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="f198c-146">V tomto příkladu se hlavní logika <xref:System.Activities.Statements.Sequence> pracovního postupu skládá z aktivity.</span><span class="sxs-lookup"><span data-stu-id="f198c-146">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="f198c-147">Je <xref:System.Activities.Statements.Sequence> určen jako <xref:System.Activities.Statements.CancellationScope.Body%2A> aktivita, <xref:System.Activities.Statements.CancellationScope> která je <xref:System.Activities.Statements.TryCatch> obsažena aktivity.</span><span class="sxs-lookup"><span data-stu-id="f198c-147">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="f198c-148">Výjimka je vyvolána z <xref:System.Activities.Statements.Sequence>těla , je <xref:System.Activities.Statements.TryCatch> zpracována <xref:System.Activities.Statements.Sequence> nadřazenou aktivitou a je zrušena.</span><span class="sxs-lookup"><span data-stu-id="f198c-148">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="f198c-149">Při vyvolání tohoto pracovního postupu se konzoli zobrazí následující výstup.</span><span class="sxs-lookup"><span data-stu-id="f198c-149">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="f198c-150">**Sekvence začíná.**</span><span class="sxs-lookup"><span data-stu-id="f198c-150">**Sequence starting.**</span></span>  
<span data-ttu-id="f198c-151">**Sekvence byla zrušena.** 
 **Výjimka byla zachycena.** 
 **Pracovní postup e3c18939-121e-4c43-af1c-ba1ce977ce55 Dokončeno.**</span><span class="sxs-lookup"><span data-stu-id="f198c-151">**Sequence canceled.**
**Exception caught.**
**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>
### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="f198c-152">Vyvolání výjimek z operátoru CancellationHandler</span><span class="sxs-lookup"><span data-stu-id="f198c-152">Throwing Exceptions from a CancellationHandler</span></span>  
 <span data-ttu-id="f198c-153">Všechny výjimky vyvoláné <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> z <xref:System.Activities.Statements.CancellationScope> a jsou závažné pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="f198c-153">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="f198c-154">Pokud existuje možnost výjimky uvození <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>z <xref:System.Activities.Statements.TryCatch> , <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> použijte v catch a zpracování těchto výjimek.</span><span class="sxs-lookup"><span data-stu-id="f198c-154">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="f198c-155">Zrušení pomocí CompensableActivity</span><span class="sxs-lookup"><span data-stu-id="f198c-155">Cancellation using CompensableActivity</span></span>  
 <span data-ttu-id="f198c-156">Stejně <xref:System.Activities.Statements.CancellationScope> jako <xref:System.Activities.Statements.CompensableActivity> činnost, <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>má .</span><span class="sxs-lookup"><span data-stu-id="f198c-156">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="f198c-157">Pokud <xref:System.Activities.Statements.CompensableActivity> je zrušena, všechny aktivity v jeho <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> jsou vyvolány.</span><span class="sxs-lookup"><span data-stu-id="f198c-157">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="f198c-158">To může být užitečné pro zrušení částečně dokončené kompenzační práce.</span><span class="sxs-lookup"><span data-stu-id="f198c-158">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="f198c-159">Informace o tom, <xref:System.Activities.Statements.CompensableActivity> jak použít pro kompenzaci a zrušení, naleznete [v tématu Kompenzace](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="f198c-159">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="f198c-160">Zrušení pomocí vlastních aktivit</span><span class="sxs-lookup"><span data-stu-id="f198c-160">Cancellation using Custom Activities</span></span>  
 <span data-ttu-id="f198c-161">Vlastní autoři aktivit mohou implementovat logiku zrušení do svých vlastních aktivit několika různými způsoby.</span><span class="sxs-lookup"><span data-stu-id="f198c-161">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="f198c-162">Vlastní aktivity, <xref:System.Activities.Activity> které jsou odvozeny <xref:System.Activities.Statements.CancellationScope> z můžete implementovat logiku zrušení umístěním nebo jiné vlastní aktivity, která obsahuje logiku zrušení v těle aktivity.</span><span class="sxs-lookup"><span data-stu-id="f198c-162">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="f198c-163"><xref:System.Activities.AsyncCodeActivity>a <xref:System.Activities.NativeActivity> odvozené aktivity můžete <xref:System.Activities.NativeActivity.Cancel%2A> přepsat jejich příslušné metody a poskytnout logiku zrušení tam.</span><span class="sxs-lookup"><span data-stu-id="f198c-163"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="f198c-164"><xref:System.Activities.CodeActivity>odvozené aktivity neposkytují žádné ustanovení o zrušení, protože všechny jejich práce se <xref:System.Activities.CodeActivity.Execute%2A> provádí v jednom spuštění při runtime volá metodu.</span><span class="sxs-lookup"><span data-stu-id="f198c-164"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="f198c-165">Pokud metoda spuštění ještě nebyla <xref:System.Activities.CodeActivity> volána a je zrušena aktivita založená, aktivita se zavře se stavem <xref:System.Activities.ActivityInstanceState.Canceled> a <xref:System.Activities.CodeActivity.Execute%2A> metoda není volána.</span><span class="sxs-lookup"><span data-stu-id="f198c-165">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="f198c-166">Zrušení pomocí NativeActivity</span><span class="sxs-lookup"><span data-stu-id="f198c-166">Cancellation using NativeActivity</span></span>  
 <span data-ttu-id="f198c-167"><xref:System.Activities.NativeActivity>odvozené aktivity můžete <xref:System.Activities.NativeActivity.Cancel%2A> přepsat metodu poskytnout vlastní zrušení logiky.</span><span class="sxs-lookup"><span data-stu-id="f198c-167"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="f198c-168">Pokud tato metoda není přepsána, použije se výchozí logika zrušení pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="f198c-168">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="f198c-169">Výchozí zrušení je proces, který <xref:System.Activities.NativeActivity> probíhá pro <xref:System.Activities.NativeActivity.Cancel%2A> který nepřepíše metodu nebo jehož <xref:System.Activities.NativeActivity.Cancel%2A> metoda volá základní <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> metodu.</span><span class="sxs-lookup"><span data-stu-id="f198c-169">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="f198c-170">Když je aktivita zrušena, runtime označí aktivitu pro zrušení a automaticky zpracovává určité vyčištění.</span><span class="sxs-lookup"><span data-stu-id="f198c-170">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="f198c-171">Pokud má aktivita pouze nevyřízené záložky, budou záložky odstraněny <xref:System.Activities.ActivityInstanceState.Canceled>a aktivita bude označena jako .</span><span class="sxs-lookup"><span data-stu-id="f198c-171">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="f198c-172">Všechny nevyřízené podřízené aktivity zrušené aktivity budou zrušeny.</span><span class="sxs-lookup"><span data-stu-id="f198c-172">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="f198c-173">Jakýkoli pokus o naplánování dalších podřízených aktivit bude mít <xref:System.Activities.ActivityInstanceState.Canceled>za následek ignorování pokusu a aktivita bude označena jako .</span><span class="sxs-lookup"><span data-stu-id="f198c-173">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="f198c-174">Pokud se v or <xref:System.Activities.ActivityInstanceState.Canceled> <xref:System.Activities.ActivityInstanceState.Faulted> stavu dokončí jakákoli nevyřízená podřízená aktivita, bude aktivita označena jako <xref:System.Activities.ActivityInstanceState.Canceled>.</span><span class="sxs-lookup"><span data-stu-id="f198c-174">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="f198c-175">Všimněte si, že požadavek na zrušení lze ignorovat.</span><span class="sxs-lookup"><span data-stu-id="f198c-175">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="f198c-176">Pokud aktivita nemá žádné nevyřízené záložky nebo provádění podřízených aktivit a neplánuje žádné další pracovní položky po označení pro zrušení, bude úspěšně dokončena.</span><span class="sxs-lookup"><span data-stu-id="f198c-176">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="f198c-177">Toto výchozí zrušení stačí pro mnoho scénářů, ale pokud je potřeba další logiku zrušení, pak integrované aktivity zrušení nebo vlastní aktivity lze použít.</span><span class="sxs-lookup"><span data-stu-id="f198c-177">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="f198c-178">V následujícím příkladu <xref:System.Activities.NativeActivity.Cancel%2A> je definováno přepsání <xref:System.Activities.NativeActivity> vlastní `ParallelForEach` aktivity na základě.</span><span class="sxs-lookup"><span data-stu-id="f198c-178">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="f198c-179">Když je aktivita zrušena, toto přepsání zpracovává logiku zrušení aktivity.</span><span class="sxs-lookup"><span data-stu-id="f198c-179">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="f198c-180">Tento příklad je součástí [neobecné ParallelForEach](./samples/non-generic-parallelforeach.md) vzorku.</span><span class="sxs-lookup"><span data-stu-id="f198c-180">This example is part of the [Non-Generic ParallelForEach](./samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="f198c-181"><xref:System.Activities.NativeActivity>odvozené aktivity můžete určit, pokud zrušení <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> byla požadována kontrolou vlastnosti <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> a označit se jako zrušené voláním metody.</span><span class="sxs-lookup"><span data-stu-id="f198c-181"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="f198c-182">Volání <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> okamžitě nedokončí aktivitu.</span><span class="sxs-lookup"><span data-stu-id="f198c-182">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="f198c-183">Jako obvykle, runtime dokončí aktivitu, když nemá žádné <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> další vynikající práce, <xref:System.Activities.ActivityInstanceState.Canceled> ale <xref:System.Activities.ActivityInstanceState.Closed>pokud se nazývá konečný stav bude místo .</span><span class="sxs-lookup"><span data-stu-id="f198c-183">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="f198c-184">Zrušení pomocí AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="f198c-184">Cancellation using AsyncCodeActivity</span></span>  
 <span data-ttu-id="f198c-185"><xref:System.Activities.AsyncCodeActivity>založené aktivity mohou také poskytnout vlastní <xref:System.Activities.AsyncCodeActivity.Cancel%2A> logiku zrušení přepsáním metody.</span><span class="sxs-lookup"><span data-stu-id="f198c-185"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="f198c-186">Pokud tato metoda není přepsána, pak žádné zpracování zrušení se provádí, pokud je aktivita zrušena.</span><span class="sxs-lookup"><span data-stu-id="f198c-186">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="f198c-187">V následujícím příkladu <xref:System.Activities.AsyncCodeActivity.Cancel%2A> je definováno přepsání <xref:System.Activities.AsyncCodeActivity> vlastní `ExecutePowerShell` aktivity na základě.</span><span class="sxs-lookup"><span data-stu-id="f198c-187">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="f198c-188">Když je aktivita zrušena, provede požadované chování zrušení.</span><span class="sxs-lookup"><span data-stu-id="f198c-188">When the activity is canceled, it performs the desired cancellation behavior.</span></span>
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="f198c-189"><xref:System.Activities.AsyncCodeActivity>odvozené aktivity můžete určit, pokud zrušení <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> byla požadována kontrolou vlastnosti <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> a označit se jako zrušené voláním metody.</span><span class="sxs-lookup"><span data-stu-id="f198c-189"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>
