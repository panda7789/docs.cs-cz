---
title: Sada nástrojů pro externí sadu pravidel
ms.date: 03/30/2017
ms.assetid: a306d283-a031-475e-aa01-9ae86e7adcb0
ms.openlocfilehash: b07d2b63d9f3d98b8f08eb697a8d688d8fac1962
ms.sourcegitcommit: 5fb5b6520b06d7f5e6131ec2ad854da302a28f2e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/03/2019
ms.locfileid: "74710902"
---
# <a name="external-ruleset-toolkit"></a><span data-ttu-id="c0cc4-102">Sada nástrojů pro externí sadu pravidel</span><span class="sxs-lookup"><span data-stu-id="c0cc4-102">External Ruleset Toolkit</span></span>

<span data-ttu-id="c0cc4-103">Normálně při použití pravidel v rámci aplikace pracovního postupu jsou tato pravidla součástí sestavení.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-103">Normally when rules are used within a workflow application, the rules are part of the assembly.</span></span> <span data-ttu-id="c0cc4-104">V některých scénářích můžete chtít udržovat RuleSets odděleně od sestavení, aby bylo možné je aktualizovat bez opětovného sestavení a nasazení sestavení pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-104">In some scenarios, you may want to maintain the RuleSets separately from the assembly so that they can be updated without rebuilding and deploying the workflow assembly.</span></span> <span data-ttu-id="c0cc4-105">Tato ukázka vám umožní spravovat a upravovat RuleSets v databázi a přistupovat k nim z pracovního postupu za běhu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-105">This sample allows you to manage and edit RuleSets in a database and access those RuleSets from a workflow at runtime.</span></span> <span data-ttu-id="c0cc4-106">To umožňuje spuštěným instancím pracovních postupů automaticky začlenit RuleSet změny.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-106">This enables running workflow instances to automatically incorporate RuleSet changes.</span></span>

<span data-ttu-id="c0cc4-107">Ukázka externí sady nástrojů RuleSet obsahuje nástroj založený na model Windows Forms, který můžete použít ke správě a úpravám RuleSet verzí v databázi.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-107">The External RuleSet Toolkit sample contains a Windows Forms-based tool that you can use to manage and edit RuleSet versions in a database.</span></span> <span data-ttu-id="c0cc4-108">Zahrnuje také aktivitu a hostitelskou službu pro spouštění těchto pravidel.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-108">It also includes an activity and a host service for executing those rules.</span></span>

> [!NOTE]
> <span data-ttu-id="c0cc4-109">Tato ukázka vyžaduje [Microsoft SQL Server](https://go.microsoft.com/fwlink/?LinkId=96181).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-109">This sample requires [Microsoft SQL Server](https://go.microsoft.com/fwlink/?LinkId=96181).</span></span>

<span data-ttu-id="c0cc4-110">Visual Studio poskytuje editor RuleSet jako součást programovací model Windows Workflow Foundation (WF).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-110">Visual Studio provides a RuleSet editor as part of the Windows Workflow Foundation (WF).</span></span> <span data-ttu-id="c0cc4-111">Tento editor můžete spustit dvojitým kliknutím na aktivitu `Policy` v pracovním postupu. serializace definovaného objektu RuleSet do souboru. Rules přidruženého k pracovnímu postupu (aktivita `Policy` spouští instanci RuleSet v rámci pracovního postupu).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-111">You can start this editor by double-clicking the `Policy` activity in a workflow; it serializes the defined RuleSet object to the .rules file associated with the workflow (a `Policy` activity runs a RuleSet instance against the workflow).</span></span> <span data-ttu-id="c0cc4-112">Soubor. Rules je zkompilován do sestavení jako prostředek při sestavování projektu pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-112">The .rules file is compiled into the assembly as a resource when you build the workflow project.</span></span>

<span data-ttu-id="c0cc4-113">Mezi součásti této ukázky patří:</span><span class="sxs-lookup"><span data-stu-id="c0cc4-113">The components of this sample include:</span></span>

- <span data-ttu-id="c0cc4-114">Nástroj grafického uživatelského rozhraní RuleSet, pomocí kterého můžete upravovat a spravovat verze RuleSet v databázi.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-114">A RuleSet graphical user interface tool that you can use to edit and manage RuleSet versions in the database.</span></span>

- <span data-ttu-id="c0cc4-115">Služba RuleSet, která je nakonfigurovaná na hostitelské aplikaci a přistupuje k RuleSets z databáze.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-115">A RuleSet service that is configured on the host application and accesses RuleSets from the database.</span></span>

- <span data-ttu-id="c0cc4-116">Aktivita `ExternalPolicy`, která žádá o RuleSet ze služby RuleSet a spustí RuleSet v rámci pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-116">An `ExternalPolicy` activity that requests a RuleSet from the RuleSet service and runs the RuleSet against the workflow.</span></span>

<span data-ttu-id="c0cc4-117">Interakce komponent je znázorněna na následujícím obrázku.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-117">The interaction of the components is shown in the following image.</span></span> <span data-ttu-id="c0cc4-118">Následující části popisují jednotlivé součásti.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-118">The sections that follow describe each component.</span></span>

![Diagram znázorňující přehled ukázek externích RuleSet Toolkit.](./media/external-ruleset-toolkit/ruleset-toolkit-overview.gif)

> [!IMPORTANT]
> <span data-ttu-id="c0cc4-120">Ukázky už můžou být na vašem počítači nainstalované.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-120">The samples may already be installed on your machine.</span></span> <span data-ttu-id="c0cc4-121">Než budete pokračovat, vyhledejte následující (výchozí) adresář.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-121">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="c0cc4-122">Pokud tento adresář neexistuje, přečtěte si [ukázky Windows Communication Foundation (WCF) a programovací model Windows Workflow Foundation (WF) pro .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) ke stažení všech Windows Communication Foundation (WCF) a [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Samples.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-122">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="c0cc4-123">Tato ukázka se nachází v následujícím adresáři.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-123">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\ExternalRuleSetToolKit`

## <a name="ruleset-tool"></a><span data-ttu-id="c0cc4-124">Nástroj RuleSet</span><span class="sxs-lookup"><span data-stu-id="c0cc4-124">RuleSet Tool</span></span>

<span data-ttu-id="c0cc4-125">Následující obrázek je snímek obrazovky nástroje RuleSet.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-125">The following image is a screenshot of the RuleSet tool.</span></span> <span data-ttu-id="c0cc4-126">V nabídce **úložiště pravidla** můžete načíst dostupné RuleSets z databáze a uložit upravené RuleSets zpátky do úložiště.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-126">From the **Rule Store** menu, you can load the available RuleSets from the database and save modified RuleSets back to the store.</span></span> <span data-ttu-id="c0cc4-127">Konfigurační soubor aplikace poskytuje připojovací řetězec databáze pro databázi RuleSet.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-127">An application configuration file provides a database connection string for the RuleSet database.</span></span> <span data-ttu-id="c0cc4-128">Když nástroj spustíte, automaticky načte RuleSets z nakonfigurované databáze.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-128">When you start the tool, it automatically loads the RuleSets from the configured database.</span></span>

![Snímek obrazovky zobrazující prohlížeč RuleSet](./media/external-ruleset-toolkit/ruleset-browser-dialog.gif)

<span data-ttu-id="c0cc4-130">Nástroj RuleSet používá pro RuleSets hlavní a podverze čísla a umožňuje tak souběžně udržovat a ukládat více verzí (nástroj kromě možnosti správy verzí neposkytuje žádné uzamykání ani jiné funkce správy konfigurace).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-130">The RuleSet tool applies major and minor version numbers to the RuleSets, allowing you to simultaneously maintain and store multiple versions (the tool provides no locking or other configuration management features in addition to the versioning capability).</span></span> <span data-ttu-id="c0cc4-131">Pomocí tohoto nástroje můžete vytvořit nové verze RuleSet nebo odstranit existující verze.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-131">Using the tool, you can create new RuleSet versions or delete existing versions.</span></span> <span data-ttu-id="c0cc4-132">Když kliknete na **Nový**, nástroj vytvoří nový název RuleSet a použije verzi 1,0.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-132">When you click **New**, the tool creates a new RuleSet name and applies version 1.0.</span></span> <span data-ttu-id="c0cc4-133">Při kopírování verze nástroj vytvoří kopii vybrané verze RuleSet, včetně obsažených pravidel, a přiřadí nová a jedinečná čísla verzí.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-133">When you copy a version, the tool creates a copy of the selected RuleSet version, including the contained rules, and assigns new, unique version numbers.</span></span> <span data-ttu-id="c0cc4-134">Tato čísla verzí jsou založená na číslech verzí stávajícího RuleSets.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-134">These version numbers are based on the version numbers of existing RuleSets.</span></span> <span data-ttu-id="c0cc4-135">Můžete změnit název a číslo verze RuleSet pomocí přidružených polí ve formuláři.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-135">You can change the RuleSet name and version numbers using the associated fields on the form.</span></span>

<span data-ttu-id="c0cc4-136">Po kliknutí na **upravit pravidla**se spustí editor RuleSet, jak je znázorněno na následujícím obrázku:</span><span class="sxs-lookup"><span data-stu-id="c0cc4-136">When you click **Edit Rules**, the RuleSet editor starts, as shown in the following image:</span></span>

![Snímek obrazovky znázorňující Editor RuleSet](./media/external-ruleset-toolkit/ruleset-editor-dialog.gif)

<span data-ttu-id="c0cc4-138">Toto je opětovné hostování dialogového okna editoru, které je součástí programovací model Windows Workflow Foundationho doplňku sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-138">This is a re-hosting of the editor dialog that is part of the Windows Workflow Foundation Visual Studio add-in.</span></span> <span data-ttu-id="c0cc4-139">Nabízí stejné funkce, včetně podpory technologie IntelliSense.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-139">It provides the same functionality, including Intellisense support.</span></span> <span data-ttu-id="c0cc4-140">Pravidla jsou vytvořena proti cílovému typu (například pracovní postup), který je přidružen k RuleSet v nástroji. Když kliknete na **Procházet** v hlavním dialogovém okně nástroje, zobrazí se dialogové okno pro **Výběr pracovního postupu nebo typu** , jak je znázorněno na obrázku 4.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-140">The rules are authored against a target type (such as a workflow) that is associated with the RuleSet in the tool; when you click **Browse** in the main tool dialog, the **Workflow/Type Selector** dialog appears, as shown in Figure 4.</span></span>

<span data-ttu-id="c0cc4-141">![Výběr &#47;typu pracovního postupu](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span><span class="sxs-lookup"><span data-stu-id="c0cc4-141">![Workflow &#47;Type Selection](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span></span>

<span data-ttu-id="c0cc4-142">Obrázek 4: selektor pracovního postupu/typu</span><span class="sxs-lookup"><span data-stu-id="c0cc4-142">Figure 4: Workflow/Type Selector</span></span>

<span data-ttu-id="c0cc4-143">Můžete použít dialog pro **Výběr pracovního postupu nebo typu** k určení sestavení a konkrétního typu v rámci tohoto sestavení.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-143">You can use the **Workflow/Type Selector** dialog to specify an assembly and a specific type within that assembly.</span></span> <span data-ttu-id="c0cc4-144">Tento typ je cílový typ, proti kterému jsou pravidla vytvořená (a jsou spuštěná).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-144">This type is the target type against which the rules are authored (and run).</span></span> <span data-ttu-id="c0cc4-145">V mnoha případech je cílovým typem pracovní postup nebo nějaký jiný typ aktivity.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-145">In many cases, the target type is a workflow or some other activity type.</span></span> <span data-ttu-id="c0cc4-146">Můžete však spustit RuleSet proti libovolnému typu rozhraní .NET.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-146">However, you can run a RuleSet against any .NET type.</span></span>

<span data-ttu-id="c0cc4-147">Cesta k souboru sestavení a typ `name are stored with the` RuleSet v databázi, takže když je RuleSet načten z databáze, nástroj se pokusí automaticky načíst cílový typ.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-147">The path to the assembly file and the type `name are stored with the` RuleSet in the database, so that when the RuleSet is retrieved from the database, the tool attempts to automatically load the target type.</span></span>

<span data-ttu-id="c0cc4-148">Po kliknutí na tlačítko **OK** v dialogovém okně pro **Výběr pracovního postupu nebo typu** ověří vybraný typ proti RuleSet, aby se zajistilo, že cílový typ obsahuje všechny členy, na které odkazují pravidla.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-148">When you click **OK** in the **Workflow/Type Selector** dialog, it validates the selected type against the RuleSet, to ensure that the target type has all the members referenced by the rules.</span></span> <span data-ttu-id="c0cc4-149">Chyby se zobrazují v dialogovém okně **chyby ověřování** .</span><span class="sxs-lookup"><span data-stu-id="c0cc4-149">Errors are shown in a **Validation Errors** dialog.</span></span> <span data-ttu-id="c0cc4-150">Můžete se rozhodnout, že budete pokračovat v změně bez ohledu na chyby, nebo klikněte na **Zrušit**.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-150">You can choose to continue with the change despite the errors, or click **Cancel**.</span></span> <span data-ttu-id="c0cc4-151">V nabídce **nástroje** v hlavním dialogovém okně nástroje můžete kliknout na **ověřit** a znovu ověřit verzi RuleSet proti cílové aktivitě.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-151">From the **Tools** menu in the main tool dialog, you can click **Validate** to re-validate the RuleSet version against the target activity.</span></span>

![Snímek obrazovky zobrazující dialog chyby ověřování](./media/external-ruleset-toolkit/validation-errors-dialog.png)

<span data-ttu-id="c0cc4-153">Z nabídky **data** v nástroji můžete importovat a exportovat RuleSets.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-153">From the **Data** menu in the tool, you can import and export RuleSets.</span></span> <span data-ttu-id="c0cc4-154">Po kliknutí na **importovat**se zobrazí dialogové okno Výběr souboru, ve kterém můžete vybrat soubor. Rules.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-154">When you click **Import**, a file-chooser dialog appears, from which you can select a .rules file.</span></span> <span data-ttu-id="c0cc4-155">To může nebo nemusí být soubor, který byl původně vytvořen v aplikaci Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-155">This may or may not be a file initially created in Visual Studio.</span></span> <span data-ttu-id="c0cc4-156">Soubor. Rules by měl obsahovat serializovanou instanci `RuleDefinitions`, která obsahuje kolekci podmínek a kolekci RuleSets.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-156">The .rules file should contain a serialized `RuleDefinitions` instance that contains a collection of conditions and a collection of RuleSets.</span></span> <span data-ttu-id="c0cc4-157">Nástroj nepoužívá kolekci podmínek, ale používá formát `RuleDefinitions`. Rules k umožnění interakce s prostředím sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-157">The tool does not use the conditions collection, but it does use the `RuleDefinitions` .rules format to allow interaction with the Visual Studio environment.</span></span>

<span data-ttu-id="c0cc4-158">Po výběru souboru. Rules se zobrazí dialogové okno **RuleSet Selector** .</span><span class="sxs-lookup"><span data-stu-id="c0cc4-158">After selecting a .rules file, a **RuleSet Selector** dialog appears.</span></span> <span data-ttu-id="c0cc4-159">Pomocí dialogového okna můžete vybrat RuleSets ze souboru, který chcete importovat (výchozí nastavení určuje všechny RuleSets).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-159">You can use the dialog to select the RuleSets from the file that you want to import (the default specifies all RuleSets).</span></span> <span data-ttu-id="c0cc4-160">RuleSets v souboru. Rules nemají čísla verzí, protože jejich správa verzí v rámci projektu WF je stejná jako verze sestavení.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-160">RuleSets in the .rules file do not have version numbers, because their versioning within a WF project is the same as the version of the assembly.</span></span> <span data-ttu-id="c0cc4-161">Během procesu importu nástroj automaticky přiřadí další dostupné hlavní číslo verze (které můžete po importu změnit). v seznamu **selektoru RuleSet** můžete zobrazit čísla přiřazených verzí.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-161">During the importing process, the tool automatically assigns the next available major version number (which you can change after importing); you can see the assigned version numbers in the **RuleSet Selector** list.</span></span>

<span data-ttu-id="c0cc4-162">Pro každý RuleSet, který importuje, se nástroj pokusí najít přidružený typ ze složky bin\Debug v umístění souboru. Rules (pokud existuje) na základě členů použitých ve RuleSet.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-162">For each RuleSet it imports, the tool attempts to locate the associated type from the bin\Debug folder under the location of the .rules file (if it exists), based on the members used in the RuleSet.</span></span> <span data-ttu-id="c0cc4-163">Pokud nástroj najde více odpovídajících typů, pokusí se zvolit typ založený na shodě mezi názvem souboru. Rules a názvem typu (například `Workflow1` typ odpovídá Workflow1. Rules).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-163">If the tool finds multiple matching types, it attempts to choose a type based on a match between the .rules file name and the type name (for example, the `Workflow1` type corresponds to Workflow1.rules).</span></span> <span data-ttu-id="c0cc4-164">Pokud existuje více shod, budete vyzváni k výběru typu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-164">If multiple matches exist, you are prompted to select the type.</span></span> <span data-ttu-id="c0cc4-165">Pokud tento mechanismus automatického identifikace nenajde odpovídající sestavení nebo typ, potom po importu můžete kliknout na **Procházet** v hlavním dialogovém okně nástroje a přejít tak k přidruženému typu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-165">If this auto-identification mechanism fails to locate a matching assembly or type, then after importing you can click **Browse** on the main tool dialog to navigate to the associated type.</span></span> <span data-ttu-id="c0cc4-166">RuleSet selektor znázorňuje následující obrázek:</span><span class="sxs-lookup"><span data-stu-id="c0cc4-166">The following image shows the RuleSet Selector:</span></span>

![Snímek obrazovky s dialogovým oknem pro výběr RuleSet](./media/external-ruleset-toolkit/ruleset-selector-dialog.gif)

<span data-ttu-id="c0cc4-168">Když kliknete na **exportovat data** z hlavní nabídky nástroje, zobrazí se znovu dialog pro **Výběr RuleSet** , ze kterého můžete určit RuleSets z databáze, která se má exportovat.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-168">When you click **Data-Export** from the main tool menu, the **RuleSet Selector** dialog appears again, from which you can determine the RuleSets from the database that should be exported.</span></span> <span data-ttu-id="c0cc4-169">Po kliknutí na tlačítko **OK**se zobrazí dialogové okno **Uložit soubor** , ve kterém můžete zadat název a umístění výsledného souboru. Rules.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-169">When you click **OK**, a **Save File** dialog appears, in which you can specify the name and location of the resulting .rules file.</span></span> <span data-ttu-id="c0cc4-170">Vzhledem k tomu, že soubor. Rules neobsahuje informace o verzi, můžete vybrat pouze jednu verzi RuleSet s daným RuleSet názvem.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-170">Because the .rules file does not contain version information, you can only select one RuleSet version with a given RuleSet name.</span></span>

## <a name="policyfromservice-activity"></a><span data-ttu-id="c0cc4-171">Aktivita PolicyFromService</span><span class="sxs-lookup"><span data-stu-id="c0cc4-171">PolicyFromService Activity</span></span>

<span data-ttu-id="c0cc4-172">Kód aktivity `PolicyFromService` je jednoduchý.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-172">The code for the `PolicyFromService` activity is straightforward.</span></span> <span data-ttu-id="c0cc4-173">Funguje podobně jako aktivita `Policy` poskytovaná pomocí WF, ale místo načítání cílového RuleSet ze souboru. Rules volá hostitelskou službu, aby získala instanci RuleSet.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-173">It works much like the `Policy` activity provided with WF, but instead of retrieving the target RuleSet from the .rules file, it calls a host service to obtain the RuleSet instance.</span></span> <span data-ttu-id="c0cc4-174">Pak spustí RuleSet proti instanci aktivity kořenového pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-174">It then runs the RuleSet against the root workflow activity instance.</span></span>

<span data-ttu-id="c0cc4-175">Chcete-li použít aktivitu v pracovním postupu, přidejte odkaz na `PolicyActivities` a `RuleSetService` sestavení z projektu pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-175">To use the activity in a workflow, add a reference to the `PolicyActivities` and `RuleSetService` assemblies from your workflow project.</span></span> <span data-ttu-id="c0cc4-176">Diskuzi o tom, jak přidat aktivitu do sady nástrojů, najdete v postupu na konci tohoto tématu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-176">See the procedure at the end of this topic for a discussion of how to add the activity to the toolbox.</span></span>

<span data-ttu-id="c0cc4-177">Po umístění aktivity do pracovního postupu musíte zadat název RuleSet, který se má spustit.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-177">After placing the activity in your workflow, you must provide the name of the RuleSet to be run.</span></span> <span data-ttu-id="c0cc4-178">Název můžete zadat jako hodnotu literálu nebo vytvořit vazby na proměnnou pracovního postupu nebo vlastnost jiné aktivity.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-178">You can enter the name as a literal value, or bind to a workflow variable or property of another activity.</span></span> <span data-ttu-id="c0cc4-179">Volitelně můžete zadat čísla verzí pro konkrétní RuleSet, která se mají spustit.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-179">Optionally, you can enter version numbers for the specific RuleSet that should be run.</span></span> <span data-ttu-id="c0cc4-180">Pokud necháte výchozí hodnotu 0 pro čísla hlavní verze a podverze, bude se pro aktivitu automaticky poskytovat číslo nejnovější verze v databázi.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-180">If you leave the default value of 0 for the major and minor version numbers, the latest version number in the database is automatically provided for the activity.</span></span>

## <a name="ruleset-service"></a><span data-ttu-id="c0cc4-181">Služba RuleSet</span><span class="sxs-lookup"><span data-stu-id="c0cc4-181">RuleSet Service</span></span>

<span data-ttu-id="c0cc4-182">Služba zodpovídá za načtení zadané verze RuleSet z databáze a její vrácení do volající aktivity.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-182">The service is responsible for retrieving the specified RuleSet version from the database and returning it to the calling activity.</span></span> <span data-ttu-id="c0cc4-183">Jak je popsáno výše, pokud hodnoty hlavní a dílčí verze předané ve `GetRuleSet` volání jsou obě 0, služba načte nejnovější verzi.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-183">As previously discussed, if the major and minor version values passed in the `GetRuleSet` call are both 0, the service retrieves the latest version.</span></span> <span data-ttu-id="c0cc4-184">V tomto okamžiku není ukládání definic nebo instancí RuleSet do mezipaměti; Podobně nejsou k dispozici žádné funkce pro označení verzí RuleSet jako "nasazené", aby je bylo možné odlišit od probíhajících RuleSets.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-184">At this point, there is no caching of RuleSet definitions or instances; similarly, there are no features for marking RuleSet versions as "deployed" to differentiate them from in-progress RuleSets.</span></span>

<span data-ttu-id="c0cc4-185">Databáze, ke které má být služba k dispozici, by měla být nakonfigurovaná na hostiteli pomocí konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-185">The database to be accessed by the service should be configured on the host using an application configuration file.</span></span>

#### <a name="to-run-the-tool"></a><span data-ttu-id="c0cc4-186">Spuštění nástroje</span><span class="sxs-lookup"><span data-stu-id="c0cc4-186">To run the tool</span></span>

1. <span data-ttu-id="c0cc4-187">Složka, ve které se nastavuje tabulka RuleSet používaná nástrojem a službou, obsahuje soubor Setup. SQL.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-187">The folder that sets up the RuleSet table used by the tool and the service contains a Setup.sql file.</span></span> <span data-ttu-id="c0cc4-188">Spuštěním dávkového souboru Setup. cmd můžete vytvořit databázi pravidel v SQL Express a nastavit tabulku RuleSet.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-188">You can run the Setup.cmd batch file to create the Rules database on SQL Express and to set up the RuleSet table.</span></span>

2. <span data-ttu-id="c0cc4-189">Pokud soubor Batch nebo Setup. SQL upravíte a nechcete použít SQL Express nebo umístit tabulku do databáze s názvem jinou než `Rules`, konfigurační soubory aplikace v nástroji RuleSet a v projektech `UsageSample` by se měly upravovat se stejnými informacemi.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-189">If you edit the batch file or Setup.sql and specify not to use SQL Express or to place the table in a database named something other than `Rules`, the application configuration files in the RuleSet tool and `UsageSample` projects should be edited with the same information.</span></span>

3. <span data-ttu-id="c0cc4-190">Po spuštění skriptu Setup. SQL můžete sestavit `ExternalRuleSetToolkit` řešení a pak spustit nástroj RuleSet z projektu ExternalRuleSetTool.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-190">After you run the Setup.sql script, you can build the `ExternalRuleSetToolkit` solution and then launch the RuleSet tool from the ExternalRuleSetTool project.</span></span>

4. <span data-ttu-id="c0cc4-191">Řešení konzolové aplikace pro `RuleSetToolkitUsageSample` sekvenční pracovní postup obsahuje ukázkový pracovní postup.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-191">The `RuleSetToolkitUsageSample` Sequential Workflow Console Application solution includes a sample workflow.</span></span> <span data-ttu-id="c0cc4-192">Pracovní postup se skládá z aktivity `PolicyFromService` a dvou proměnných, `orderValue` a `discount`, proti kterým je cílový RuleSet spuštěn.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-192">The workflow consists of a `PolicyFromService` activity and two variables, `orderValue` and `discount`, against which the target RuleSet runs.</span></span>

5. <span data-ttu-id="c0cc4-193">Chcete-li použít ukázku, sestavte `RuleSetToolkitUsageSample` řešení.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-193">To use the sample, build the `RuleSetToolkitUsageSample` solution.</span></span> <span data-ttu-id="c0cc4-194">Pak z hlavní nabídky nástroje RuleSet klikněte na **data – importovat** a přejděte na soubor DiscountRuleSet. Rules ve složce RuleSetToolkitUsageSample.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-194">Then from the RuleSet tool main menu, click **Data-Import** and point to the DiscountRuleSet.rules file in the RuleSetToolkitUsageSample folder.</span></span> <span data-ttu-id="c0cc4-195">Kliknutím na možnost v nabídce **úložiště pravidla – Uložit** uložte importované RuleSet do databáze.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-195">Click the **Rule Store-Save** menu option to save the imported RuleSet to the database.</span></span>

6. <span data-ttu-id="c0cc4-196">Vzhledem k tomu, že `PolicyActivities` sestavení je odkazováno z ukázkového projektu pracovního postupu, aktivita `PolicyFromService` se zobrazí v pracovním postupu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-196">Because the `PolicyActivities` assembly is referenced from the sample workflow project, the `PolicyFromService` activity appears in the workflow.</span></span> <span data-ttu-id="c0cc4-197">Ve výchozím nastavení se ale nezobrazí v sadě nástrojů.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-197">It does not, however, appear in the toolbox by default.</span></span> <span data-ttu-id="c0cc4-198">Chcete-li jej přidat do sady nástrojů, postupujte následovně:</span><span class="sxs-lookup"><span data-stu-id="c0cc4-198">To add it to the toolbox, do the following:</span></span>

    - <span data-ttu-id="c0cc4-199">Klikněte pravým tlačítkem myši na panel nástrojů a vyberte možnost **zvolit položky** (Tato akce může chvíli trvat).</span><span class="sxs-lookup"><span data-stu-id="c0cc4-199">Right-click the toolbox and select **Choose Items** (this may take a while).</span></span>

    - <span data-ttu-id="c0cc4-200">Když se zobrazí dialogové okno **zvolit položky sady nástrojů** , klikněte na kartu **aktivity** .</span><span class="sxs-lookup"><span data-stu-id="c0cc4-200">When the **Choose Toolbox Items** dialog appears, click the **Activities** tab.</span></span>

    - <span data-ttu-id="c0cc4-201">V řešení `ExternalRuleSetToolkit` přejděte na `PolicyActivities` sestavení a klikněte na **otevřít**.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-201">Browse to the `PolicyActivities` assembly in the `ExternalRuleSetToolkit` solution and click **Open**.</span></span>

    - <span data-ttu-id="c0cc4-202">Zajistěte, aby byla v dialogovém okně **zvolit položky sady nástrojů** vybrána aktivita `PolicyFromService` a klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-202">Ensure that the `PolicyFromService` activity is selected in the **Choose Toolbox Items** dialog and then click **OK**.</span></span>

    - <span data-ttu-id="c0cc4-203">Tato aktivita by se teď měla zobrazit v sadě nástrojů v kategorii **komponent RuleSetToolkitUsageSample** .</span><span class="sxs-lookup"><span data-stu-id="c0cc4-203">The activity should now appear in the toolbox in the **RuleSetToolkitUsageSample Components** category.</span></span>

7. <span data-ttu-id="c0cc4-204">Služba RuleSet je už nakonfigurovaná na hostiteli konzolové aplikace pomocí následujícího příkazu v Program.cs.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-204">The RuleSet service is already configured on the console application host using the following statement in Program.cs.</span></span>

    ```csharp
    workflowRuntime.AddService(new RuleSetService());
    ```

8. <span data-ttu-id="c0cc4-205">Službu můžete na hostiteli nakonfigurovat taky pomocí konfiguračního souboru. Podrobnosti najdete v dokumentaci k sadě SDK.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-205">You can also configure the service on the host using a configuration file; see the SDK documentation for details.</span></span>

9. <span data-ttu-id="c0cc4-206">Do projektu pracovního postupu se přidá konfigurační soubor aplikace, který určuje připojovací řetězec pro databázi, kterou má služba používat.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-206">An application configuration file is added to the workflow project to specify the connection string for the database to be used by the service.</span></span> <span data-ttu-id="c0cc4-207">Mělo by se jednat o stejný připojovací řetězec, který používá nástroj RuleSet, který odkazuje na databázi, která obsahuje tabulku RuleSet.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-207">This should be the same connection string used by the RuleSet tool, which points to the database that contains the RuleSet table.</span></span>

10. <span data-ttu-id="c0cc4-208">Nyní můžete spustit projekt `RuleSetToolkitUsageSample` stejným způsobem jako jakékoli jiné konzolové aplikace pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-208">You can now run the `RuleSetToolkitUsageSample` project as you would any other workflow console application.</span></span> <span data-ttu-id="c0cc4-209">Stiskněte F5 nebo CTRL + F5 v sadě Visual Studio nebo spusťte soubor RuleSetToolkitUsageSample. exe přímo.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-209">Press F5 or Ctrl+F5 within Visual Studio or run the RuleSetToolkitUsageSample.exe file directly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c0cc4-210">Je nutné zavřít nástroj RuleSet pro rekompilaci ukázky použití, protože nástroj načte ukázkové sestavení pro použití.</span><span class="sxs-lookup"><span data-stu-id="c0cc4-210">You must close the RuleSet tool to recompile the usage sample, because the tool loads the usage sample assembly.</span></span>
