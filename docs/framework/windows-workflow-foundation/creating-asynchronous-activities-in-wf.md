---
title: Vytváření asynchronních aktivit v WF
description: Naučte se vytvářet vlastní asynchronní aktivity pomocí funkce AsyncCodeActivity, která umožňuje odvozeným aktivitám implementovat logiku asynchronního spuštění.
ms.date: 03/30/2017
ms.assetid: 497e81ed-5eef-460c-ba55-fae73c05824f
ms.openlocfilehash: f7ce0c0157791b34723feff185aed24bb56a4b3f
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/15/2020
ms.locfileid: "83421524"
---
# <a name="creating-asynchronous-activities-in-wf"></a><span data-ttu-id="2e200-103">Vytváření asynchronních aktivit v WF</span><span class="sxs-lookup"><span data-stu-id="2e200-103">Creating Asynchronous Activities in WF</span></span>
<span data-ttu-id="2e200-104"><xref:System.Activities.AsyncCodeActivity>poskytuje tvůrcům aktivity základní třídu pro použití, která umožňuje odvozeným aktivitám implementovat logiku asynchronního spuštění.</span><span class="sxs-lookup"><span data-stu-id="2e200-104"><xref:System.Activities.AsyncCodeActivity> provides activity authors a base class to use that enables derived activities to implement asynchronous execution logic.</span></span> <span data-ttu-id="2e200-105">To je užitečné pro vlastní aktivity, které musí provádět asynchronní práci bez podržení vlákna plánovače pracovních postupů a blokování všech aktivit, které mohou být schopny běžet paralelně.</span><span class="sxs-lookup"><span data-stu-id="2e200-105">This is useful for custom activities that must perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span> <span data-ttu-id="2e200-106">Toto téma poskytuje přehled o tom, jak vytvořit vlastní asynchronní aktivity pomocí nástroje <xref:System.Activities.AsyncCodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="2e200-106">This topic provides an overview of how to create custom asynchronous activities using <xref:System.Activities.AsyncCodeActivity>.</span></span>  
  
## <a name="using-asynccodeactivity"></a><span data-ttu-id="2e200-107">Použití funkce AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="2e200-107">Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="2e200-108"><xref:System.Activities?displayProperty=nameWithType>poskytuje vlastní autory aktivity s různými základními třídami pro různé požadavky na vytváření aktivit.</span><span class="sxs-lookup"><span data-stu-id="2e200-108"><xref:System.Activities?displayProperty=nameWithType> provides custom activity authors with different base classes for different activity authoring requirements.</span></span> <span data-ttu-id="2e200-109">Každá z nich má konkrétní sémantiku a poskytuje pracovní postup autora (a modulu runtime aktivit) odpovídající kontrakt.</span><span class="sxs-lookup"><span data-stu-id="2e200-109">Each one carries a particular semantic and provides a workflow author (and the activity runtime) a corresponding contract.</span></span> <span data-ttu-id="2e200-110"><xref:System.Activities.AsyncCodeActivity>Aktivita založená na aktivitě je aktivita, která provádí asynchronní práci vzhledem ke vláknu Scheduleru a jehož logika provádění je vyjádřena ve spravovaném kódu.</span><span class="sxs-lookup"><span data-stu-id="2e200-110">An <xref:System.Activities.AsyncCodeActivity> based activity is an activity that performs work asynchronously relative to the scheduler thread and whose execution logic is expressed in managed code.</span></span> <span data-ttu-id="2e200-111">V důsledku asynchronního řízení <xref:System.Activities.AsyncCodeActivity> může způsobit nečinný bod během provádění.</span><span class="sxs-lookup"><span data-stu-id="2e200-111">As a result of going asynchronous, an <xref:System.Activities.AsyncCodeActivity> may induce an idle point during execution.</span></span> <span data-ttu-id="2e200-112">Z důvodu nestálé povahy asynchronní práce <xref:System.Activities.AsyncCodeActivity> vždy vytvoří blok bez trvalého blokování po dobu trvání provádění aktivity.</span><span class="sxs-lookup"><span data-stu-id="2e200-112">Due to the volatile nature of asynchronous work, an <xref:System.Activities.AsyncCodeActivity> always creates a no persist block for the duration of the activity’s execution.</span></span> <span data-ttu-id="2e200-113">To zabrání modulu runtime pracovního postupu v zachování instance pracovního postupu uprostřed asynchronní práce a zároveň zabrání instanci pracovního postupu v uvolnění při provádění asynchronního kódu.</span><span class="sxs-lookup"><span data-stu-id="2e200-113">This prevents the workflow runtime from persisting the workflow instance in the middle of the asynchronous work, and also prevents the workflow instance from unloading while the asynchronous code is executing.</span></span>  
  
### <a name="asynccodeactivity-methods"></a><span data-ttu-id="2e200-114">Metody funkce AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="2e200-114">AsyncCodeActivity Methods</span></span>  
 <span data-ttu-id="2e200-115">Aktivity, které jsou odvozeny z <xref:System.Activities.AsyncCodeActivity> , mohou vytvořit logiku asynchronního spuštění přepsáním <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> metod a pomocí vlastního kódu.</span><span class="sxs-lookup"><span data-stu-id="2e200-115">Activities that derive from <xref:System.Activities.AsyncCodeActivity> can create asynchronous execution logic by overriding the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> methods with custom code.</span></span> <span data-ttu-id="2e200-116">Při volání do modulu runtime jsou tyto metody předány <xref:System.Activities.AsyncCodeActivityContext> .</span><span class="sxs-lookup"><span data-stu-id="2e200-116">When called by the runtime, these methods are passed an <xref:System.Activities.AsyncCodeActivityContext>.</span></span> <span data-ttu-id="2e200-117"><xref:System.Activities.AsyncCodeActivityContext>umožňuje autorovi aktivity poskytovat sdílený stav napříč <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> /  <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> v rámci vlastnosti daného kontextu <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> .</span><span class="sxs-lookup"><span data-stu-id="2e200-117"><xref:System.Activities.AsyncCodeActivityContext> allows the activity author to provide shared state across <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/ <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> in the context’s <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> property.</span></span> <span data-ttu-id="2e200-118">V následujícím příkladu `GenerateRandom` aktivita generuje náhodné číslo asynchronně.</span><span class="sxs-lookup"><span data-stu-id="2e200-118">In the following example, a `GenerateRandom` activity generates a random number asynchronously.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#8](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#8)]  
  
 <span data-ttu-id="2e200-119">Předchozí ukázková aktivita je odvozena z <xref:System.Activities.AsyncCodeActivity%601> a má pojmenovanou zvýšenou úroveň `OutArgument<int>` `Result` .</span><span class="sxs-lookup"><span data-stu-id="2e200-119">The previous example activity derives from <xref:System.Activities.AsyncCodeActivity%601>, and has an elevated `OutArgument<int>` named `Result`.</span></span> <span data-ttu-id="2e200-120">Hodnota vrácená `GetRandom` metodou je extrahována a vrácena <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> přepsáním a tato hodnota je nastavena jako `Result` hodnota.</span><span class="sxs-lookup"><span data-stu-id="2e200-120">The value returned by the `GetRandom` method is extracted and returned by the <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override, and this value is set as the `Result` value.</span></span> <span data-ttu-id="2e200-121">Asynchronní aktivity, které nevracejí výsledek, by měly být odvozeny z <xref:System.Activities.AsyncCodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="2e200-121">Asynchronous activities that do not return a result should derive from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="2e200-122">V následujícím příkladu `DisplayRandom` je definována aktivita, která je odvozena z <xref:System.Activities.AsyncCodeActivity> .</span><span class="sxs-lookup"><span data-stu-id="2e200-122">In the following example, a `DisplayRandom` activity is defined which derives from <xref:System.Activities.AsyncCodeActivity>.</span></span> <span data-ttu-id="2e200-123">Tato aktivita se podobá `GetRandom` aktivitě, ale místo vrácení výsledku se zobrazí zpráva do konzoly.</span><span class="sxs-lookup"><span data-stu-id="2e200-123">This activity is like the `GetRandom` activity but instead of returning a result it displays a message to the console.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#11](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#11)]  
  
 <span data-ttu-id="2e200-124">Všimněte si, že vzhledem k tomu, že není k dispozici žádná návratová hodnota, `DisplayRandom` používá <xref:System.Action> namísto <xref:System.Func%602> vyvolání delegáta a delegát nevrací žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="2e200-124">Note that because there is no return value, `DisplayRandom` uses an <xref:System.Action> instead of a <xref:System.Func%602> to invoke its delegate, and the delegate returns no value.</span></span>  
  
 <span data-ttu-id="2e200-125"><xref:System.Activities.AsyncCodeActivity>také poskytuje <xref:System.Activities.AsyncCodeActivity.Cancel%2A> přepsání.</span><span class="sxs-lookup"><span data-stu-id="2e200-125"><xref:System.Activities.AsyncCodeActivity> also provides a <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override.</span></span> <span data-ttu-id="2e200-126"><xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>I když <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> jsou vyžadované přepsání, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> je volitelné a lze je přepsat, aby aktivita vyčistila svůj nezpracovaný asynchronní stav při jeho zrušení nebo přerušení.</span><span class="sxs-lookup"><span data-stu-id="2e200-126">While <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> are required overrides, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> is optional, and can be overridden so the activity can clean up its outstanding asynchronous state when it is being canceled or aborted.</span></span> <span data-ttu-id="2e200-127">Pokud je to možné `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` `true` , musí aktivita zavolat <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> .</span><span class="sxs-lookup"><span data-stu-id="2e200-127">If clean up is possible and `AsyncCodeActivity.ExecutingActivityInstance.IsCancellationRequested` is `true`, the activity should call <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A>.</span></span> <span data-ttu-id="2e200-128">Jakékoli výjimky vyvolané z této metody jsou pro instanci pracovního postupu závažné.</span><span class="sxs-lookup"><span data-stu-id="2e200-128">Any exceptions thrown from this method are fatal to the workflow instance.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#10)]  
  
### <a name="invoking-asynchronous-methods-on-a-class"></a><span data-ttu-id="2e200-129">Vyvolání asynchronních metod pro třídu</span><span class="sxs-lookup"><span data-stu-id="2e200-129">Invoking Asynchronous Methods on a Class</span></span>  
 <span data-ttu-id="2e200-130">Mnoho tříd v .NET Framework poskytuje asynchronní funkce a tuto funkci lze asynchronně vyvolávat pomocí <xref:System.Activities.AsyncCodeActivity> aktivity založené na.</span><span class="sxs-lookup"><span data-stu-id="2e200-130">Many of the classes in the .NET Framework provide asynchronous functionality, and this functionality can be asynchronously invoked by using an <xref:System.Activities.AsyncCodeActivity> based activity.</span></span> <span data-ttu-id="2e200-131">V následujícím příkladu je vytvořena aktivita, která asynchronně vytvoří soubor pomocí <xref:System.IO.FileStream> třídy.</span><span class="sxs-lookup"><span data-stu-id="2e200-131">In the following example, an activity is created that asynchronously creates a file by using the <xref:System.IO.FileStream> class.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#12](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#12)]  
  
### <a name="sharing-state-between-the-beginexecute-and-endexecute-methods"></a><span data-ttu-id="2e200-132">Stav sdílení mezi metodami BeginExecute a EndExecute</span><span class="sxs-lookup"><span data-stu-id="2e200-132">Sharing State Between the BeginExecute and EndExecute Methods</span></span>  
 <span data-ttu-id="2e200-133">V předchozím příkladu <xref:System.IO.FileStream> byl objekt, který byl vytvořen v, <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> použit v <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> .</span><span class="sxs-lookup"><span data-stu-id="2e200-133">In the previous example, the <xref:System.IO.FileStream> object that was created in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> was accessed in the <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="2e200-134">To je možné, protože `file` Proměnná byla předána do <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> vlastnosti v <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> .</span><span class="sxs-lookup"><span data-stu-id="2e200-134">This is possible because the `file` variable was passed in the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A?displayProperty=nameWithType> property in <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="2e200-135">Toto je správná metoda pro stav sdílení mezi <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> .</span><span class="sxs-lookup"><span data-stu-id="2e200-135">This is the correct method for sharing state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="2e200-136">Je nesprávné použít členskou proměnnou v odvozené třídě ( `FileWriter` v tomto případě) ke sdílení stavu mezi <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> vzhledem k tomu, že na objekt aktivity může odkazovat více instancí aktivity.</span><span class="sxs-lookup"><span data-stu-id="2e200-136">It is incorrect to use a member variable in the derived class (`FileWriter` in this case) to share state between <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> because the activity object may be referenced by multiple activity instances.</span></span> <span data-ttu-id="2e200-137">Pokus o použití členské proměnné ke sdílení stavu může mít za následek hodnoty z jednoho <xref:System.Activities.ActivityInstance> přepsání nebo využívání hodnot z jiného <xref:System.Activities.ActivityInstance> .</span><span class="sxs-lookup"><span data-stu-id="2e200-137">Attempting to use a member variable to share state can result in values from one <xref:System.Activities.ActivityInstance> overwriting or consuming values from another <xref:System.Activities.ActivityInstance>.</span></span>  
  
### <a name="accessing-argument-values"></a><span data-ttu-id="2e200-138">Přístup k hodnotám argumentů</span><span class="sxs-lookup"><span data-stu-id="2e200-138">Accessing Argument Values</span></span>  
 <span data-ttu-id="2e200-139">Prostředí <xref:System.Activities.AsyncCodeActivity> se skládá z argumentů definovaných v aktivitě.</span><span class="sxs-lookup"><span data-stu-id="2e200-139">The environment of an <xref:System.Activities.AsyncCodeActivity> consists of the arguments defined on the activity.</span></span> <span data-ttu-id="2e200-140">K těmto argumentům lze z <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> / <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> přepsání použít <xref:System.Activities.AsyncCodeActivityContext> parametr.</span><span class="sxs-lookup"><span data-stu-id="2e200-140">These arguments can be accessed from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>/<xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides using the <xref:System.Activities.AsyncCodeActivityContext> parameter.</span></span> <span data-ttu-id="2e200-141">K argumentům není v delegátu možné přistupovat, ale hodnoty argumentů nebo jiná požadovaná data lze předat delegátovi pomocí jeho parametrů.</span><span class="sxs-lookup"><span data-stu-id="2e200-141">The arguments cannot be accessed in the delegate, but the argument values or any other desired data can be passed in to the delegate using its parameters.</span></span> <span data-ttu-id="2e200-142">V následujícím příkladu je definována náhodná aktivita generování čísel, která získá celkovou horní mez od svého `Max` argumentu.</span><span class="sxs-lookup"><span data-stu-id="2e200-142">In the following example, a random number-generating activity is defined that obtains the inclusive upper bound from its `Max` argument.</span></span> <span data-ttu-id="2e200-143">Hodnota argumentu je předána do asynchronního kódu, když je vyvolán delegát.</span><span class="sxs-lookup"><span data-stu-id="2e200-143">The value of the argument is passed in to the asynchronous code when the delegate is invoked.</span></span>  
  
 [!code-csharp[CFX_ActivityExample#9](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_ActivityExample/cs/Program.cs#9)]  
  
### <a name="scheduling-actions-or-child-activities-using-asynccodeactivity"></a><span data-ttu-id="2e200-144">Plánování akcí nebo podřízených aktivit pomocí funkce AsyncCodeActivity</span><span class="sxs-lookup"><span data-stu-id="2e200-144">Scheduling Actions or Child Activities Using AsyncCodeActivity</span></span>  
 <span data-ttu-id="2e200-145"><xref:System.Activities.AsyncCodeActivity>odvozené vlastní aktivity poskytují metodu pro asynchronní práci s ohledem na vlákno pracovního postupu, ale neposkytují možnost plánovat podřízené aktivity nebo akce.</span><span class="sxs-lookup"><span data-stu-id="2e200-145"><xref:System.Activities.AsyncCodeActivity> derived custom activities  provide a method for performing work asynchronously with regard to the workflow thread, but do not provide the ability to schedule child activities or actions.</span></span> <span data-ttu-id="2e200-146">Asynchronní chování se ale dá začlenit s plánováním podřízených aktivit prostřednictvím složení.</span><span class="sxs-lookup"><span data-stu-id="2e200-146">However, asynchronous behavior can be incorporated with scheduling of child activities through composition.</span></span> <span data-ttu-id="2e200-147">Lze vytvořit asynchronní aktivitu a následně složenou s <xref:System.Activities.Activity> nebo <xref:System.Activities.NativeActivity> odvozenou aktivitou, která poskytuje asynchronní chování a plánování podřízených aktivit nebo akcí.</span><span class="sxs-lookup"><span data-stu-id="2e200-147">An asynchronous activity can be created, and then composed with an <xref:System.Activities.Activity> or <xref:System.Activities.NativeActivity> derived activity to provide asynchronous behavior and scheduling of child activities or actions.</span></span> <span data-ttu-id="2e200-148">Například může být vytvořena aktivita, která je odvozena z <xref:System.Activities.Activity> a má jako její implementaci a <xref:System.Activities.Statements.Sequence> obsahující asynchronní aktivity, i další aktivity, které implementují logiku aktivity.</span><span class="sxs-lookup"><span data-stu-id="2e200-148">For example, an activity could be created that derives from <xref:System.Activities.Activity>, and has as its implementation a <xref:System.Activities.Statements.Sequence> containing the asynchronous activity as well the other activities that implement the logic of the activity.</span></span> <span data-ttu-id="2e200-149">Další příklady sestavování aktivit pomocí <xref:System.Activities.Activity> a <xref:System.Activities.NativeActivity> naleznete v tématu [How to: Create a Activity](how-to-create-an-activity.md) a [Authoring Options](activity-authoring-options-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="2e200-149">For more examples of composing activities using <xref:System.Activities.Activity> and <xref:System.Activities.NativeActivity>, see [How to: Create an Activity](how-to-create-an-activity.md) and [Activity Authoring Options](activity-authoring-options-in-wf.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2e200-150">Viz také</span><span class="sxs-lookup"><span data-stu-id="2e200-150">See also</span></span>

- <xref:System.Action>
- <xref:System.Func%602>
