---
title: Využívání kanálů OData z pracovního postupu – WF
ms.date: 03/30/2017
ms.assetid: 1b26617c-53e9-476a-81af-675c36d95919
ms.openlocfilehash: ceac2c2d07351fcb79e2345068f07fa22f356411
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/24/2020
ms.locfileid: "76743790"
---
# <a name="consuming-odata-feeds-from-a-workflow"></a><span data-ttu-id="71fbb-102">Využívání kanálů OData z pracovního postupu</span><span class="sxs-lookup"><span data-stu-id="71fbb-102">Consuming OData feeds from a workflow</span></span>

<span data-ttu-id="71fbb-103">WCF Data Services je součást .NET Framework, která umožňuje vytvořit služby, které používají protokol OData (Open Data Protocol) k vystavení a zpracování dat prostřednictvím webu nebo intranetu pomocí sémantiky opětovného přenosu stavu (REST).</span><span class="sxs-lookup"><span data-stu-id="71fbb-103">WCF Data Services is a component of the .NET Framework that enables you to create services that use the Open Data Protocol (OData) to expose and consume data over the Web or intranet by using the semantics of representational state transfer (REST).</span></span> <span data-ttu-id="71fbb-104">OData zpřístupňuje data jako prostředky, které jsou adresovatelné pomocí identifikátorů URI.</span><span class="sxs-lookup"><span data-stu-id="71fbb-104">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="71fbb-105">Každá aplikace může komunikovat s datovou službou OData, pokud může odeslat požadavek HTTP a zpracovat datový kanál OData, který vrátí datová služba.</span><span class="sxs-lookup"><span data-stu-id="71fbb-105">Any application can interact with an OData-based data service if it can send an HTTP request and process the OData feed that a data service returns.</span></span> <span data-ttu-id="71fbb-106">Kromě toho WCF Data Services obsahuje klientské knihovny, které poskytují bohatší programovací prostředí při využívání kanálů OData z aplikací .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="71fbb-106">In addition, WCF Data Services includes client libraries that provide a richer programming experience when you consume OData feeds from .NET Framework applications.</span></span> <span data-ttu-id="71fbb-107">Toto téma poskytuje přehled o tom, jak používat kanál OData v pracovním postupu s a bez použití klientských knihoven.</span><span class="sxs-lookup"><span data-stu-id="71fbb-107">This topic provides an overview of consuming an OData feed in a workflow with and without using the client libraries.</span></span>

## <a name="using-the-sample-northwind-odata-service"></a><span data-ttu-id="71fbb-108">Použití ukázkové služby OData Northwind</span><span class="sxs-lookup"><span data-stu-id="71fbb-108">Using the sample Northwind OData service</span></span>

<span data-ttu-id="71fbb-109">Příklady v tomto tématu používají ukázkovou datovou službu Northwind, která se nachází na <https://services.odata.org/Northwind/Northwind.svc/>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-109">The examples in this topic use the sample Northwind data service located at <https://services.odata.org/Northwind/Northwind.svc/>.</span></span> <span data-ttu-id="71fbb-110">Tato služba je k dispozici jako součást [sady OData SDK](https://www.odata.org/ecosystem/#sdk) a poskytuje přístup jen pro čtení k ukázkové databázi Northwind.</span><span class="sxs-lookup"><span data-stu-id="71fbb-110">This service is provided as part of the [OData SDK](https://www.odata.org/ecosystem/#sdk) and provides read-only access to the sample Northwind database.</span></span> <span data-ttu-id="71fbb-111">Pokud je požadován přístup pro zápis nebo pokud potřebujete místní datovou službu WCF, můžete postupovat podle kroků v [rychlém startu WCF Data Services](../data/wcf/quickstart-wcf-data-services.md) a vytvořit místní službu OData, která poskytuje přístup k databázi Northwind.</span><span class="sxs-lookup"><span data-stu-id="71fbb-111">If write access is desired, or if a local WCF Data Service is desired, you can follow the steps of the [WCF Data Services Quickstart](../data/wcf/quickstart-wcf-data-services.md) to create a local OData service that provides access to the Northwind database.</span></span> <span data-ttu-id="71fbb-112">Pokud budete postupovat podle pokynů v rychlém startu, nahraďte místní identifikátor URI pro ten, který je uveden v příkladu kódu v tomto tématu.</span><span class="sxs-lookup"><span data-stu-id="71fbb-112">If you follow the quickstart, substitute the local URI for the one provided in the example code in this topic.</span></span>

## <a name="consuming-an-odata-feed-using-the-client-libraries"></a><span data-ttu-id="71fbb-113">Spotřebovávání datového kanálu OData pomocí klientských knihoven</span><span class="sxs-lookup"><span data-stu-id="71fbb-113">Consuming an OData feed using the client libraries</span></span>

<span data-ttu-id="71fbb-114">WCF Data Services obsahuje klientské knihovny, které vám umožní snadněji využívat informační kanál OData z .NET Framework a klientských aplikací.</span><span class="sxs-lookup"><span data-stu-id="71fbb-114">WCF Data Services includes client libraries that enable you to more easily consume an OData feed from .NET Framework and client applications.</span></span> <span data-ttu-id="71fbb-115">Tyto knihovny zjednodušují posílání a přijímání zpráv HTTP.</span><span class="sxs-lookup"><span data-stu-id="71fbb-115">These libraries simplify sending and receiving HTTP messages.</span></span> <span data-ttu-id="71fbb-116">Také přeloží datovou část zprávy na objekty CLR, které představují data entity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-116">They also translate the message payload into CLR objects that represent entity data.</span></span> <span data-ttu-id="71fbb-117">Klientské knihovny nástroje jsou dvě základní třídy <xref:System.Data.Services.Client.DataServiceContext> a <xref:System.Data.Services.Client.DataServiceQuery%601>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-117">The client libraries feature the two core classes <xref:System.Data.Services.Client.DataServiceContext> and <xref:System.Data.Services.Client.DataServiceQuery%601>.</span></span> <span data-ttu-id="71fbb-118">Tyto třídy vám umožní dotazovat se na datovou službu a pak pracovat s vrácenými daty entity jako s objekty CLR.</span><span class="sxs-lookup"><span data-stu-id="71fbb-118">These classes enable you to query a data service and then work with the returned entity data as CLR objects.</span></span> <span data-ttu-id="71fbb-119">Tato část obsahuje dva přístupy k vytváření aktivit, které používají klientské knihovny.</span><span class="sxs-lookup"><span data-stu-id="71fbb-119">This section covers two approaches to creating activities that use the client libraries.</span></span>

### <a name="adding-a-service-reference-to-the-wcf-data-service"></a><span data-ttu-id="71fbb-120">Přidání odkazu na službu do datové služby WCF</span><span class="sxs-lookup"><span data-stu-id="71fbb-120">Adding a service reference to the WCF Data service</span></span>

<span data-ttu-id="71fbb-121">K vygenerování klientských knihoven Northwind můžete použít dialogové okno **Přidat odkaz na službu** v aplikaci Visual Studio 2012 k přidání odkazu na službu Northwind OData.</span><span class="sxs-lookup"><span data-stu-id="71fbb-121">To generate the Northwind client libraries, you can use the **Add Service Reference** dialog box in Visual Studio 2012 to add a reference to the Northwind OData service.</span></span>

![Snímek obrazovky zobrazující dialog Přidat odkaz na službu](./media/consuming-odata-feeds-from-a-workflow/add-service-reference-dialog.gif)

<span data-ttu-id="71fbb-123">Upozorňujeme, že služba nezveřejňuje žádné operace s službami a v seznamu **služeb** jsou položky, které představují entity vystavené službou Northwind data Service.</span><span class="sxs-lookup"><span data-stu-id="71fbb-123">Note that there are no service operations exposed by the service, and in the **Services** list there are items representing the entities exposed by the Northwind data service.</span></span> <span data-ttu-id="71fbb-124">Při přidání odkazu na službu se pro tyto entity vygenerují třídy a dají se použít v kódu klienta.</span><span class="sxs-lookup"><span data-stu-id="71fbb-124">When the service reference is added, classes will be generated for these entities and they can be used in the client code.</span></span> <span data-ttu-id="71fbb-125">Příklady v tomto tématu používají tyto třídy a třídu `NorthwindEntities` k provádění dotazů.</span><span class="sxs-lookup"><span data-stu-id="71fbb-125">The examples in this topic use these classes and the `NorthwindEntities` class to perform the queries.</span></span>

> [!NOTE]
> <span data-ttu-id="71fbb-126">Další informace naleznete v tématu [generování klientské knihovny datové služby (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="71fbb-126">For more information, see [Generating the Data Service Client Library (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span></span>

### <a name="using-asynchronous-methods"></a><span data-ttu-id="71fbb-127">Použití asynchronních metod</span><span class="sxs-lookup"><span data-stu-id="71fbb-127">Using asynchronous methods</span></span>

<span data-ttu-id="71fbb-128">Pro řešení možných potíží s latencí, ke kterým může dojít při přístupu k prostředkům přes web, doporučujeme WCF Data Services asynchronně přistupovat.</span><span class="sxs-lookup"><span data-stu-id="71fbb-128">To address possible latency issues that may occur when accessing resources over the Web, we recommend accessing WCF Data Services asynchronously.</span></span> <span data-ttu-id="71fbb-129">Klientské knihovny WCF Data Services zahrnují asynchronní metody pro vyvolání dotazů a programovací model Windows Workflow Foundation (WF) poskytuje třídu <xref:System.Activities.AsyncCodeActivity> pro vytváření asynchronních aktivit.</span><span class="sxs-lookup"><span data-stu-id="71fbb-129">The WCF Data Services client libraries include asynchronous methods for invoking queries, and Windows Workflow Foundation (WF) provides the <xref:System.Activities.AsyncCodeActivity> class for authoring asynchronous activities.</span></span> <span data-ttu-id="71fbb-130"><xref:System.Activities.AsyncCodeActivity> odvozené aktivity lze zapsat, chcete-li využít výhod .NET Frameworkch tříd, které mají asynchronní metody, nebo kód, který má být proveden asynchronně, lze převést do metody a vyvolat pomocí delegáta.</span><span class="sxs-lookup"><span data-stu-id="71fbb-130"><xref:System.Activities.AsyncCodeActivity> derived activities can be written to take advantage of .NET Framework classes that have asynchronous methods, or the code to be executed asynchronously can be put into a method and invoked by using a delegate.</span></span> <span data-ttu-id="71fbb-131">V této části najdete dva příklady <xref:System.Activities.AsyncCodeActivity> odvozené aktivity; ten, který používá asynchronní metody WCF Data Services klientských knihoven a druhý, který používá delegáta.</span><span class="sxs-lookup"><span data-stu-id="71fbb-131">This section provides two examples of an <xref:System.Activities.AsyncCodeActivity> derived activity; one that uses the asynchronous methods of the WCF Data Services client libraries and one that uses a delegate.</span></span>

> [!NOTE]
> <span data-ttu-id="71fbb-132">Další informace naleznete v tématu [asynchronní operace (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) a [Vytváření asynchronních aktivit](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="71fbb-132">For more information, see [Asynchronous Operations (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

### <a name="using-client-library-asynchronous-methods"></a><span data-ttu-id="71fbb-133">Použití asynchronních metod klientské knihovny</span><span class="sxs-lookup"><span data-stu-id="71fbb-133">Using client library asynchronous methods</span></span>

<span data-ttu-id="71fbb-134">Třída <xref:System.Data.Services.Client.DataServiceQuery%601> poskytuje metody <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> a <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> pro asynchronní dotazování služby OData.</span><span class="sxs-lookup"><span data-stu-id="71fbb-134">The <xref:System.Data.Services.Client.DataServiceQuery%601> class provides <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> and <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> methods for querying an OData service asynchronously.</span></span> <span data-ttu-id="71fbb-135">Tyto metody lze volat z <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> a <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> přepsání <xref:System.Activities.AsyncCodeActivity> odvozené třídy.</span><span class="sxs-lookup"><span data-stu-id="71fbb-135">These methods can be called from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides of an <xref:System.Activities.AsyncCodeActivity> derived class.</span></span> <span data-ttu-id="71fbb-136">Když se <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> přepsání vrátí, může pracovní postup přejít nečinný (ale ne zachovat) a po dokončení asynchronní práce, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> je vyvolána modulem runtime.</span><span class="sxs-lookup"><span data-stu-id="71fbb-136">When the <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override returns, the workflow can go idle (but not persist), and when the asynchronous work is completed, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> is invoked by the runtime.</span></span>

<span data-ttu-id="71fbb-137">V následujícím příkladu je definována aktivita `OrdersByCustomer`, která má dva vstupní argumenty.</span><span class="sxs-lookup"><span data-stu-id="71fbb-137">In the following example, an `OrdersByCustomer` activity is defined that has two input arguments.</span></span> <span data-ttu-id="71fbb-138">Argument `CustomerId` představuje zákazníka, který určuje, které objednávky se mají vrátit, a argument `ServiceUri` představuje identifikátor URI služby OData, ke které se má dotazovat.</span><span class="sxs-lookup"><span data-stu-id="71fbb-138">The `CustomerId` argument represents the customer who identifies which orders to return, and the `ServiceUri` argument represents the URI of the OData service to be queried.</span></span> <span data-ttu-id="71fbb-139">Vzhledem k tomu, že aktivita je odvozena z `AsyncCodeActivity<IEnumerable<Order>>` existuje také <xref:System.Activities.Activity%601.Result%2A> výstupní argument, který se používá k vrácení výsledků dotazu.</span><span class="sxs-lookup"><span data-stu-id="71fbb-139">Because the activity derives from `AsyncCodeActivity<IEnumerable<Order>>` there is also a <xref:System.Activities.Activity%601.Result%2A> output argument that is used to return the results of the query.</span></span> <span data-ttu-id="71fbb-140">Přepsání <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> vytvoří dotaz LINQ, který vybere všechny objednávky zadaného zákazníka.</span><span class="sxs-lookup"><span data-stu-id="71fbb-140">The <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override creates a LINQ query that selects all orders of the specified customer.</span></span> <span data-ttu-id="71fbb-141">Tento dotaz je zadán jako <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> předaného <xref:System.Activities.AsyncCodeActivityContext>a následně je volána metoda <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> dotazu.</span><span class="sxs-lookup"><span data-stu-id="71fbb-141">This query is specified as the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> of the passed <xref:System.Activities.AsyncCodeActivityContext>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> method is called.</span></span> <span data-ttu-id="71fbb-142">Všimněte si, že zpětné volání a stav, které jsou předány do <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> dotazů, jsou ty, které jsou předány metodě <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-142">Note that the callback and state that are passed into the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> are the ones that are passed in to the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method.</span></span> <span data-ttu-id="71fbb-143">Po dokončení zpracování dotazu je vyvolána metoda <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-143">When the query has finished executing, the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> method is invoked.</span></span> <span data-ttu-id="71fbb-144">Dotaz se načte z <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>a pak se zavolá metoda dotazu <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-144">The query is retrieved from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> method is called.</span></span> <span data-ttu-id="71fbb-145">Tato metoda vrací <xref:System.Collections.Generic.IEnumerable%601> zadaného typu entity. v tomto případě `Order`.</span><span class="sxs-lookup"><span data-stu-id="71fbb-145">This method returns an <xref:System.Collections.Generic.IEnumerable%601> of the specified entity type; in this case `Order`.</span></span> <span data-ttu-id="71fbb-146">Vzhledem k tomu, že `IEnumerable<Order>` je obecný typ <xref:System.Activities.AsyncCodeActivity%601>, je tato <xref:System.Collections.IEnumerable> nastavena jako <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-146">Since `IEnumerable<Order>` is the generic type of the <xref:System.Activities.AsyncCodeActivity%601>, this <xref:System.Collections.IEnumerable> is set as the <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> of the activity.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#100](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#100)]

<span data-ttu-id="71fbb-147">V následujícím příkladu aktivita `OrdersByCustomer` načte seznam objednávek pro zadaného zákazníka a potom aktivita <xref:System.Activities.Statements.ForEach%601> vytvoří výčet vrácených objednávek a zapíše datum jednotlivých objednávek do konzoly.</span><span class="sxs-lookup"><span data-stu-id="71fbb-147">In the following example, the `OrdersByCustomer` activity retrieves a list of orders for the specified customer, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates the returned orders and writes the date of each order to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#10)]

<span data-ttu-id="71fbb-148">Při vyvolání tohoto pracovního postupu jsou do konzoly zapsána následující data:</span><span class="sxs-lookup"><span data-stu-id="71fbb-148">When this workflow is invoked, the following data is written to the console:</span></span>

```console
Calling WCF Data Service...
8/25/1997
10/3/1997
10/13/1997
1/15/1998
3/16/1998
4/9/1998
```

> [!NOTE]
> <span data-ttu-id="71fbb-149">Pokud nelze navázat připojení k serveru OData, získáte výjimku podobnou této výjimce:</span><span class="sxs-lookup"><span data-stu-id="71fbb-149">If a connection to the OData server cannot be established, you will get an exception similar to the following exception:</span></span>
>
> <span data-ttu-id="71fbb-150">Neošetřená výjimka: System. InvalidOperationException: při zpracování této žádosti došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="71fbb-150">Unhandled Exception: System.InvalidOperationException: An error occurred while processing this request.</span></span> <span data-ttu-id="71fbb-151">---> System .NET. WebException: Nelze se připojit ke vzdálenému serveru---> System .NET. Sockets. SocketException: pokus o připojení se nezdařil, protože připojená strana nereagovala po určitém časovém intervalu správně nebo nebylo navázáno připojení. vzhledem k tomu, že připojení hostitele nedokázalo odpovědět.</span><span class="sxs-lookup"><span data-stu-id="71fbb-151">---> System.Net.WebException: Unable to connect to the remote server ---> System.Net.Sockets.SocketException: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span></span>

<span data-ttu-id="71fbb-152">Pokud je požadováno jakékoli další zpracování dat vrácených dotazem, je možné je provést v přepsání <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-152">If any additional processing of the data returned by the query is required, it can be done in the activity's <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override.</span></span> <span data-ttu-id="71fbb-153"><xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> i <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> jsou vyvolány pomocí vlákna pracovního postupu a jakýkoliv kód v těchto přepisech neběží asynchronně.</span><span class="sxs-lookup"><span data-stu-id="71fbb-153">Both <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> are invoked by using the workflow thread, and any code in these overrides does not run asynchronously.</span></span> <span data-ttu-id="71fbb-154">Pokud je další zpracování rozsáhlých nebo dlouhotrvajících, nebo jsou výsledky dotazu stránkované, měli byste zvážit přístup popsaný v následující části, který používá delegáta k provedení dotazu a asynchronní provádění dalších zpracování.</span><span class="sxs-lookup"><span data-stu-id="71fbb-154">If the additional processing is extensive or long-running, or the query results are paged, you should consider the approach discussed in the next section, which uses a delegate to execute the query and perform additional processing asynchronously.</span></span>

### <a name="using-a-delegate"></a><span data-ttu-id="71fbb-155">Použití delegáta</span><span class="sxs-lookup"><span data-stu-id="71fbb-155">Using a delegate</span></span>

<span data-ttu-id="71fbb-156">Kromě vyvolání asynchronní metody .NET Framework třídy může aktivita založená na <xref:System.Activities.AsyncCodeActivity>definovat také asynchronní logiku v jedné z jeho metod.</span><span class="sxs-lookup"><span data-stu-id="71fbb-156">In addition to invoking the asynchronous method of a .NET Framework class, an <xref:System.Activities.AsyncCodeActivity>-based activity can also define the asynchronous logic in one of its methods.</span></span> <span data-ttu-id="71fbb-157">Tato metoda je určena pomocí delegáta v přepsání <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-157">This method is specified by using a delegate in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="71fbb-158">Když se metoda vrátí, modul runtime vyvolá přepsání <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-158">When the method returns, the runtime invokes the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> override.</span></span> <span data-ttu-id="71fbb-159">Při volání služby OData z pracovního postupu lze tuto metodu použít k dotazování služby a k poskytnutí dalšího zpracování.</span><span class="sxs-lookup"><span data-stu-id="71fbb-159">When calling an OData service from a workflow, this method can be used to query the service and provide any additional processing.</span></span>

<span data-ttu-id="71fbb-160">V následujícím příkladu je definována aktivita `ListCustomers`.</span><span class="sxs-lookup"><span data-stu-id="71fbb-160">In the following example, a `ListCustomers` activity is defined.</span></span> <span data-ttu-id="71fbb-161">Tato aktivita se dotazuje na ukázkovou datovou službu Northwind a vrátí `List<Customer>`, která obsahuje všechny zákazníky v databázi Northwind.</span><span class="sxs-lookup"><span data-stu-id="71fbb-161">This activity queries the sample Northwind data service and returns a `List<Customer>` that contains all of the customers in the Northwind database.</span></span> <span data-ttu-id="71fbb-162">Asynchronní práci provádí metoda `GetCustomers`.</span><span class="sxs-lookup"><span data-stu-id="71fbb-162">The asynchronous work is performed by the `GetCustomers` method.</span></span> <span data-ttu-id="71fbb-163">Tato metoda se dotazuje služby pro všechny zákazníky a pak je zkopíruje do `List<Customer>`.</span><span class="sxs-lookup"><span data-stu-id="71fbb-163">This method queries the service for all customers, and then copies them into a `List<Customer>`.</span></span> <span data-ttu-id="71fbb-164">Pak zkontroluje, jestli jsou výsledky stránkované.</span><span class="sxs-lookup"><span data-stu-id="71fbb-164">It then checks to see if the results are paged.</span></span> <span data-ttu-id="71fbb-165">V takovém případě se dotazuje služby na další stránku výsledků, přidá je do seznamu a pokračuje, dokud nebudou načtena všechna zákaznická data.</span><span class="sxs-lookup"><span data-stu-id="71fbb-165">If so, it queries the service for the next page of results, adds them to the list, and continues until all of the customer data has been retrieved.</span></span>

> [!NOTE]
> <span data-ttu-id="71fbb-166">Další informace o stránkování v WCF Data Services naleznete v tématu [How to: Load pageed Results (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="71fbb-166">For more information about paging in WCF Data Services, see [How to: Load Paged Results (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>

<span data-ttu-id="71fbb-167">Po přidání všech zákazníků se seznam vrátí.</span><span class="sxs-lookup"><span data-stu-id="71fbb-167">Once all customers are added, the list is returned.</span></span> <span data-ttu-id="71fbb-168">Metoda `GetCustomers` je určena v přepsání <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-168">The `GetCustomers` method is specified in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="71fbb-169">Vzhledem k tomu, že metoda má návratovou hodnotu, je vytvořen `Func<string, List<Customer>>` pro určení metody.</span><span class="sxs-lookup"><span data-stu-id="71fbb-169">Since the method has a return value, a `Func<string, List<Customer>>` is created to specify the method.</span></span>

> [!NOTE]
> <span data-ttu-id="71fbb-170">Pokud metoda, která provádí asynchronní práci, nemá návratovou hodnotu, je místo <xref:System.Func%601>použita <xref:System.Action>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-170">If the method that performs the asynchronous work does not have a return value, an <xref:System.Action> is used instead of a <xref:System.Func%601>.</span></span> <span data-ttu-id="71fbb-171">Příklady vytvoření asynchronního příkladu pomocí obou přístupů naleznete v tématu [Vytváření asynchronních aktivit](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="71fbb-171">For examples of creating an asynchronous example using both approaches, see [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

<span data-ttu-id="71fbb-172">Tato <xref:System.Func%601> je přiřazena k <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>a je volána `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="71fbb-172">This <xref:System.Func%601> is assigned to the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then `BeginInvoke` is called.</span></span> <span data-ttu-id="71fbb-173">Vzhledem k tomu, že metoda, která má být vyvolána, nemá přístup k prostředí argumentů, hodnota argumentu `ServiceUri` je předána jako první parametr spolu se zpětným voláním a stavem, které byly předány do <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-173">Since the method to be invoked does not have access to the activity's environment of arguments, the value of the `ServiceUri` argument is passed as the first parameter, together with the callback and state that were passed into <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="71fbb-174">Když `GetCustomers` vrátí, modul runtime vyvolá <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-174">When `GetCustomers` returns, the runtime invokes <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="71fbb-175">Kód v <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> načte delegáta z <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, volá `EndInvoke`a vrátí výsledek, který je seznam zákazníků vrácených z metody `GetCustomers`.</span><span class="sxs-lookup"><span data-stu-id="71fbb-175">The code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> retrieves the delegate from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, calls `EndInvoke`, and returns the result, which is the list of customers returned from the `GetCustomers` method.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#200](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#200)]

<span data-ttu-id="71fbb-176">V následujícím příkladu aktivita `ListCustomers` načte seznam zákazníků a potom ji vytvoří <xref:System.Activities.Statements.ForEach%601> a zapíše název společnosti a kontaktní jméno každého zákazníka do konzoly.</span><span class="sxs-lookup"><span data-stu-id="71fbb-176">In the following example, the `ListCustomers` activity retrieves a list of customers, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates them and writes the company name and contact name of each customer to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#20](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#20)]

<span data-ttu-id="71fbb-177">Při vyvolání tohoto pracovního postupu se do konzoly zapisují následující data.</span><span class="sxs-lookup"><span data-stu-id="71fbb-177">When this workflow is invoked, the following data is written to the console.</span></span> <span data-ttu-id="71fbb-178">Vzhledem k tomu, že tento dotaz vrací mnoho zákazníků, zobrazí se zde pouze část výstupu.</span><span class="sxs-lookup"><span data-stu-id="71fbb-178">Since this query returns many customers, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Alfreds Futterkiste, Contact: Maria Anders
Ana Trujillo Emparedados y helados, Contact: Ana Trujillo
Antonio Moreno Taquería, Contact: Antonio Moreno
Around the Horn, Contact: Thomas Hardy
Berglunds snabbköp, Contact: Christina Berglund
...
```

## <a name="consuming-an-odata-feed-without-using-the-client-libraries"></a><span data-ttu-id="71fbb-179">Spotřebovávání datového kanálu OData bez použití klientských knihoven</span><span class="sxs-lookup"><span data-stu-id="71fbb-179">Consuming an OData feed without using the client libraries</span></span>

<span data-ttu-id="71fbb-180">OData zpřístupňuje data jako prostředky, které jsou adresovatelné pomocí identifikátorů URI.</span><span class="sxs-lookup"><span data-stu-id="71fbb-180">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="71fbb-181">Když použijete klientské knihovny, tyto identifikátory URI se vytvoří za vás, ale nemusíte používat klientské knihovny.</span><span class="sxs-lookup"><span data-stu-id="71fbb-181">When you use the client libraries these URIs are created for you, but you do not have to use the client libraries.</span></span> <span data-ttu-id="71fbb-182">V případě potřeby lze ke službě OData získat přímý pøístup bez použití klientských knihoven.</span><span class="sxs-lookup"><span data-stu-id="71fbb-182">If desired, OData services can be accessed directly without using the client libraries.</span></span> <span data-ttu-id="71fbb-183">Pokud nepoužíváte klientské knihovny, umístění služby a požadovaná data jsou určena identifikátorem URI a výsledky se vrátí v reakci na požadavek HTTP.</span><span class="sxs-lookup"><span data-stu-id="71fbb-183">When not using the client libraries the location of the service and the desired data are specified by the URI and the results are returned in the response to the HTTP request.</span></span> <span data-ttu-id="71fbb-184">Tato nezpracovaná data pak můžete zpracovat nebo manipulovat požadovaným způsobem.</span><span class="sxs-lookup"><span data-stu-id="71fbb-184">This raw data can then be processed or manipulated in the desired manner.</span></span> <span data-ttu-id="71fbb-185">Jedním ze způsobů, jak načíst výsledky dotazu OData, je použití třídy <xref:System.Net.WebClient>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-185">One way to retrieve the results of an OData query is by using the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="71fbb-186">V tomto příkladu se načte název kontaktu zákazníka reprezentovaný službou Key ALFKI.</span><span class="sxs-lookup"><span data-stu-id="71fbb-186">In this example, the contact name for the customer represented by the key ALFKI is retrieved.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#2)]

<span data-ttu-id="71fbb-187">Při spuštění tohoto kódu se v konzole zobrazí následující výstup:</span><span class="sxs-lookup"><span data-stu-id="71fbb-187">When this code is run, the following output is displayed to the console:</span></span>

```console
Raw data returned:
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<ContactName xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices">Maria Anders</ContactName>
```

<span data-ttu-id="71fbb-188">V pracovním postupu může být kód z tohoto příkladu začleněn do <xref:System.Activities.CodeActivity.Execute%2A> přepisu vlastní aktivity založené na <xref:System.Activities.CodeActivity>, ale stejné funkce lze také provést pomocí <xref:System.Activities.Expressions.InvokeMethod%601> aktivity.</span><span class="sxs-lookup"><span data-stu-id="71fbb-188">In a workflow, the code from this example could be incorporated into the <xref:System.Activities.CodeActivity.Execute%2A> override of a <xref:System.Activities.CodeActivity>-based custom activity, but the same functionality can also be accomplished by using the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="71fbb-189">Aktivita <xref:System.Activities.Expressions.InvokeMethod%601> umožňuje autorům pracovních postupů vyvolat statické a instanční metody třídy a má také možnost asynchronní vyvolání zadané metody.</span><span class="sxs-lookup"><span data-stu-id="71fbb-189">The <xref:System.Activities.Expressions.InvokeMethod%601> activity enables workflow authors to invoke static and instance methods of a class, and also has an option to invoke the specified method asynchronously.</span></span> <span data-ttu-id="71fbb-190">V následujícím příkladu je <xref:System.Activities.Expressions.InvokeMethod%601> aktivita nakonfigurována tak, aby volala metodu <xref:System.Net.WebClient.DownloadString%2A> třídy <xref:System.Net.WebClient> a vrátila seznam zákazníků.</span><span class="sxs-lookup"><span data-stu-id="71fbb-190">In the following example, an <xref:System.Activities.Expressions.InvokeMethod%601> activity is configured to call the <xref:System.Net.WebClient.DownloadString%2A> method of the <xref:System.Net.WebClient> class and return a list of customers.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#3)]

<span data-ttu-id="71fbb-191"><xref:System.Activities.Expressions.InvokeMethod%601> může volat statické a instanční metody třídy.</span><span class="sxs-lookup"><span data-stu-id="71fbb-191"><xref:System.Activities.Expressions.InvokeMethod%601> can call both static and instance methods of a class.</span></span> <span data-ttu-id="71fbb-192">Vzhledem k tomu, že <xref:System.Net.WebClient.DownloadString%2A> je metoda instance <xref:System.Net.WebClient> třídy, je pro <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>zadána nová instance třídy <xref:System.Net.WebClient>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-192">Since <xref:System.Net.WebClient.DownloadString%2A> is an instance method of the <xref:System.Net.WebClient> class, a new instance of the <xref:System.Net.WebClient> class is specified for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span></span> <span data-ttu-id="71fbb-193">`DownloadString` je zadán jako <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, identifikátor URI, který obsahuje dotaz, je určen v kolekci <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> a návratová hodnota je přiřazena k hodnotě <xref:System.Activities.Activity%601.Result%2A>.</span><span class="sxs-lookup"><span data-stu-id="71fbb-193">`DownloadString` is specified as the <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, the URI that contains the query is specified in the <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> collection, and the return value is assigned to the <xref:System.Activities.Activity%601.Result%2A> value.</span></span> <span data-ttu-id="71fbb-194">Hodnota <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> je nastavena na hodnotu `true`, což znamená, že volání metody bude spuštěno asynchronně s ohledem na pracovní postup.</span><span class="sxs-lookup"><span data-stu-id="71fbb-194">The <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> value is set to `true`, which means that the method invocation will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="71fbb-195">V následujícím příkladu je vytvořen pracovní postup, který používá aktivitu <xref:System.Activities.Expressions.InvokeMethod%601> k dotazování ukázkové služby dat Northwind na seznam objednávek pro konkrétního zákazníka a následně vracená data budou zapsána do konzoly.</span><span class="sxs-lookup"><span data-stu-id="71fbb-195">In the following example, a workflow is constructed that uses the <xref:System.Activities.Expressions.InvokeMethod%601> activity to query the sample Northwind data service for a list of orders for a specific customer, and then the returned data is written to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#1)]

<span data-ttu-id="71fbb-196">Při vyvolání tohoto pracovního postupu se do konzoly zobrazí následující výstup.</span><span class="sxs-lookup"><span data-stu-id="71fbb-196">When this workflow is invoked, the following output is displayed to the console.</span></span> <span data-ttu-id="71fbb-197">Vzhledem k tomu, že tento dotaz vrátí několik objednávek, zobrazí se zde pouze část výstupu.</span><span class="sxs-lookup"><span data-stu-id="71fbb-197">Since this query returns several orders, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Raw data returned:

<?xml version="1.0" encoding="utf-8" standalone="yes"?>*
<feed
xml:base="http://services.odata.org/Northwind/Northwind.svc/"
xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices"
xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
xmlns="http://www.w3.org/2005/Atom">
<title type="text">Orders\</title>
<id>http://services.odata.org/Northwind/Northwind.svc/Customers('ALFKI')/Orders\</id>
<updated>2010-05-19T19:37:07Z\</updated>
<link rel="self" title="Orders" href="Orders" />
<entry>
<id>http://services.odata.org/Northwind/Northwind.svc/Orders(10643)\</id>
<title type="text">\</title>
<updated>2010-05-19T19:37:07Z\</updated>
<author>
<name />
</author>
<link rel="edit" title="Order" href="Orders(10643)" />
<link rel="http://schemas.microsoft.com/ado/2007/08/dataservices/related/Customer" type="application/atom+xml;type=entry" title="Customer" href="Orders(10643)/Customer" />
...
```

<span data-ttu-id="71fbb-198">Tento příklad poskytuje jednu metodu, kterou autoři aplikace pracovní postupy můžou použít ke využívání nezpracovaných dat vrácených ze služby OData.</span><span class="sxs-lookup"><span data-stu-id="71fbb-198">This example provides one method that workflow application authors can use to consume the raw data returned from an OData service.</span></span> <span data-ttu-id="71fbb-199">Další informace o přístupu WCF Data Services pomocí identifikátorů URI najdete v tématu [přístup k konvencím prostředků datové služby (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) a [OData: URI](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="71fbb-199">For more information about accessing WCF Data Services using URIs, see [Accessing Data Service Resources (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) and [OData: URI Conventions](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>
