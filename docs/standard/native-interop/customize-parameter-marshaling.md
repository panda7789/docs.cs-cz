---
title: Přizpůsobení zařazování parametrů - .NET
description: Zjistěte, jak přizpůsobit, jak rozhraní .NET zařazuje parametry do nativní reprezentace.
ms.date: 01/18/2019
ms.openlocfilehash: ff646ad942cf051ce90cd75b24c8562e536182d9
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/14/2020
ms.locfileid: "79400363"
---
# <a name="customizing-parameter-marshaling"></a><span data-ttu-id="edd8e-103">Přizpůsobení zařazování parametrů</span><span class="sxs-lookup"><span data-stu-id="edd8e-103">Customizing parameter marshaling</span></span>

<span data-ttu-id="edd8e-104">Pokud chování zařazování výchozího parametru .NET runtime nefunguje, <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> co chcete, můžete pomocí atributu přizpůsobit způsob zařazování parametrů.</span><span class="sxs-lookup"><span data-stu-id="edd8e-104">When the .NET runtime's default parameter marshaling behavior doesn't do what you want, use can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> attribute to customize how your parameters are marshaled.</span></span>

## <a name="customizing-string-parameters"></a><span data-ttu-id="edd8e-105">Přizpůsobení parametrů řetězce</span><span class="sxs-lookup"><span data-stu-id="edd8e-105">Customizing string parameters</span></span>

<span data-ttu-id="edd8e-106">Rozhraní .NET má různé formáty pro zařazování řetězců.</span><span class="sxs-lookup"><span data-stu-id="edd8e-106">.NET has a variety of formats for marshaling strings.</span></span> <span data-ttu-id="edd8e-107">Tyto metody jsou rozděleny do různých oddílů na řetězce stylu C a formáty řetězců zaměřených na systém Windows.</span><span class="sxs-lookup"><span data-stu-id="edd8e-107">These methods are split into distinct sections on C-style strings and Windows-centric string formats.</span></span>

### <a name="c-style-strings"></a><span data-ttu-id="edd8e-108">Řetězce stylu C</span><span class="sxs-lookup"><span data-stu-id="edd8e-108">C-Style strings</span></span>

<span data-ttu-id="edd8e-109">Každý z těchto formátů předá nativnímu kódu řetězec s ukončeným hodnotou null.</span><span class="sxs-lookup"><span data-stu-id="edd8e-109">Each of these formats passes a null-terminated string to native code.</span></span> <span data-ttu-id="edd8e-110">Liší se kódováním nativního řetězce.</span><span class="sxs-lookup"><span data-stu-id="edd8e-110">They differ by the encoding of the native string.</span></span>

| <span data-ttu-id="edd8e-111">`System.Runtime.InteropServices.UnmanagedType`Hodnotu</span><span class="sxs-lookup"><span data-stu-id="edd8e-111">`System.Runtime.InteropServices.UnmanagedType` value</span></span> | <span data-ttu-id="edd8e-112">Kódování</span><span class="sxs-lookup"><span data-stu-id="edd8e-112">Encoding</span></span> |
|------------------------------------------------------|----------|
| <span data-ttu-id="edd8e-113">LPStr</span><span class="sxs-lookup"><span data-stu-id="edd8e-113">LPStr</span></span> | <span data-ttu-id="edd8e-114">ANSI</span><span class="sxs-lookup"><span data-stu-id="edd8e-114">ANSI</span></span> |
| <span data-ttu-id="edd8e-115">LPUTF8Str</span><span class="sxs-lookup"><span data-stu-id="edd8e-115">LPUTF8Str</span></span> | <span data-ttu-id="edd8e-116">UTF-8</span><span class="sxs-lookup"><span data-stu-id="edd8e-116">UTF-8</span></span> |
| <span data-ttu-id="edd8e-117">LPWStr</span><span class="sxs-lookup"><span data-stu-id="edd8e-117">LPWStr</span></span> | <span data-ttu-id="edd8e-118">UTF-16</span><span class="sxs-lookup"><span data-stu-id="edd8e-118">UTF-16</span></span> |
| <span data-ttu-id="edd8e-119">Lptstr</span><span class="sxs-lookup"><span data-stu-id="edd8e-119">LPTStr</span></span> | <span data-ttu-id="edd8e-120">UTF-16</span><span class="sxs-lookup"><span data-stu-id="edd8e-120">UTF-16</span></span> |

<span data-ttu-id="edd8e-121">Formát <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> je mírně odlišný.</span><span class="sxs-lookup"><span data-stu-id="edd8e-121">The <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> format is slightly different.</span></span> <span data-ttu-id="edd8e-122">Stejně jako `LPWStr`, zařazuje řetězec na nativní řetězec ve stylu C kódovaný v UTF-16.</span><span class="sxs-lookup"><span data-stu-id="edd8e-122">Like `LPWStr`, it marshals the string to a native C-style string encoded in UTF-16.</span></span> <span data-ttu-id="edd8e-123">Spravovaný podpis však má předáte v řetězci odkazem a odpovídající nativní podpis trvá řetězec podle hodnoty.</span><span class="sxs-lookup"><span data-stu-id="edd8e-123">However, the managed signature has you pass in the string by reference and the matching native signature takes the string by value.</span></span> <span data-ttu-id="edd8e-124">Toto rozlišení umožňuje použít nativní rozhraní API, které přebírá řetězec podle hodnoty a `StringBuilder`upravuje jej na místě bez nutnosti použití rozhraní .</span><span class="sxs-lookup"><span data-stu-id="edd8e-124">This distinction allows you to use a native API that takes a string by value and modifies it in-place without having to use a `StringBuilder`.</span></span> <span data-ttu-id="edd8e-125">Doporučujeme nepoužívat tento formát ručně, protože je náchylný k záměně s neodpovídajícími nativními a spravovanými podpisy.</span><span class="sxs-lookup"><span data-stu-id="edd8e-125">We recommend against manually using this format since it's prone to cause confusion with the mismatching native and managed signatures.</span></span>

### <a name="windows-centric-string-formats"></a><span data-ttu-id="edd8e-126">Formáty řetězců zaměřených na systém Windows</span><span class="sxs-lookup"><span data-stu-id="edd8e-126">Windows-centric string formats</span></span>

<span data-ttu-id="edd8e-127">Při interakci s rozhraními COM nebo OLE pravděpodobně zjistíte, že `BSTR` nativní funkce berou řetězce jako argumenty.</span><span class="sxs-lookup"><span data-stu-id="edd8e-127">When interacting with COM or OLE interfaces, you'll likely find that the native functions take strings as `BSTR` arguments.</span></span> <span data-ttu-id="edd8e-128"><xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> Nespravovaný typ můžete použít k `BSTR`zařazování řetězce jako .</span><span class="sxs-lookup"><span data-stu-id="edd8e-128">You can use the <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> unmanaged type to marshal a string as a `BSTR`.</span></span>

<span data-ttu-id="edd8e-129">Pokud pracujete s winrt api, můžete použít <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> formát zařazovat řetězec jako `HSTRING`.</span><span class="sxs-lookup"><span data-stu-id="edd8e-129">If you're interacting with WinRT APIs, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> format to marshal a string as an `HSTRING`.</span></span>

## <a name="customizing-array-parameters"></a><span data-ttu-id="edd8e-130">Přizpůsobení parametrů pole</span><span class="sxs-lookup"><span data-stu-id="edd8e-130">Customizing array parameters</span></span>

<span data-ttu-id="edd8e-131">Rozhraní .NET také poskytuje několik způsobů, jak zařadit parametry pole.</span><span class="sxs-lookup"><span data-stu-id="edd8e-131">.NET also provides you multiple ways to marshal array parameters.</span></span> <span data-ttu-id="edd8e-132">Pokud voláte rozhraní API, které přebírá pole ve <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> stylu C, použijte nespravovaný typ.</span><span class="sxs-lookup"><span data-stu-id="edd8e-132">If you're calling an API that takes a C-style array, use the <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="edd8e-133">Pokud hodnoty v poli potřebují vlastní zařazování, můžete použít <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> pole na `[MarshalAs]` atribut pro tento.</span><span class="sxs-lookup"><span data-stu-id="edd8e-133">If the values in the array need customized marshaling, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> field on the `[MarshalAs]` attribute for that.</span></span>

<span data-ttu-id="edd8e-134">Pokud používáte rozhraní API COM, budete pravděpodobně muset zařadit `SAFEARRAY*`parametry pole jako s.</span><span class="sxs-lookup"><span data-stu-id="edd8e-134">If you're using COM APIs, you'll likely have to marshal your array parameters as `SAFEARRAY*`s.</span></span> <span data-ttu-id="edd8e-135">Chcete-li tak učinit, <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> můžete použít nespravovaný typ.</span><span class="sxs-lookup"><span data-stu-id="edd8e-135">To do so, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="edd8e-136">Výchozí typ prvků prvků `SAFEARRAY` lze zobrazit v tabulce na [přizpůsobení `object` polí](./customize-struct-marshaling.md#marshaling-systemobjects).</span><span class="sxs-lookup"><span data-stu-id="edd8e-136">The default type of the elements of the `SAFEARRAY` can be seen in the table on [customizing `object` fields](./customize-struct-marshaling.md#marshaling-systemobjects).</span></span> <span data-ttu-id="edd8e-137">Pole <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> a <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> můžete použít k přizpůsobení přesného `SAFEARRAY`typu prvku rozhraní .</span><span class="sxs-lookup"><span data-stu-id="edd8e-137">You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> and <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> fields to customize the exact element type of the `SAFEARRAY`.</span></span>

## <a name="customizing-boolean-or-decimal-parameters"></a><span data-ttu-id="edd8e-138">Přizpůsobení logických nebo desetinných parametrů</span><span class="sxs-lookup"><span data-stu-id="edd8e-138">Customizing boolean or decimal parameters</span></span>

<span data-ttu-id="edd8e-139">Informace o zařazování logických nebo desítkových parametrů naleznete v [tématu Přizpůsobení zařazování struktury](customize-struct-marshaling.md).</span><span class="sxs-lookup"><span data-stu-id="edd8e-139">For information on marshaling boolean or decimal parameters, see [Customizing structure marshaling](customize-struct-marshaling.md).</span></span>

## <a name="customizing-object-parameters-windows-only"></a><span data-ttu-id="edd8e-140">Přizpůsobení parametrů objektu (pouze systém Windows)</span><span class="sxs-lookup"><span data-stu-id="edd8e-140">Customizing object parameters (Windows-only)</span></span>

<span data-ttu-id="edd8e-141">V systému Windows poskytuje běh .NET řadu různých způsobů, jak zařadit parametry objektu do nativního kódu.</span><span class="sxs-lookup"><span data-stu-id="edd8e-141">On Windows, the .NET runtime provides a number of different ways to marshal object parameters to native code.</span></span>

### <a name="marshaling-as-specific-com-interfaces"></a><span data-ttu-id="edd8e-142">Zařazování jako specifická rozhraní COM</span><span class="sxs-lookup"><span data-stu-id="edd8e-142">Marshaling as specific COM interfaces</span></span>

<span data-ttu-id="edd8e-143">Pokud vaše rozhraní API přebírá ukazatel na objekt COM, `UnmanagedType` můžete použít `object`některý z následujících formátů parametru -typed a sdělit rozhraní .NET jako zařazovací jako tato konkrétní rozhraní:</span><span class="sxs-lookup"><span data-stu-id="edd8e-143">If your API takes a pointer to a COM object, you can use any of the following `UnmanagedType` formats on an `object`-typed parameter to tell .NET to marshal as these specific interfaces:</span></span>

- `IUnknown`
- `IDispatch`
- `IInspectable`

<span data-ttu-id="edd8e-144">Navíc pokud je váš `[ComVisible(true)]` typ označen nebo `object` zařazujete <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> typ, můžete použít formát zařazovat objekt jako com volatelné obálky pro zobrazení COM vašeho typu.</span><span class="sxs-lookup"><span data-stu-id="edd8e-144">Additionally, if your type is marked `[ComVisible(true)]` or you're marshaling the `object` type, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> format to marshal your object as a COM callable wrapper for the COM view of your type.</span></span>

### <a name="marshaling-to-a-variant"></a><span data-ttu-id="edd8e-145">Zařazování do`VARIANT`</span><span class="sxs-lookup"><span data-stu-id="edd8e-145">Marshaling to a `VARIANT`</span></span>

<span data-ttu-id="edd8e-146">Pokud vaše nativní rozhraní `VARIANT`API trvá Win32 , můžete použít <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> formát na `object` parametr zařadit objekty jako `VARIANT`s.</span><span class="sxs-lookup"><span data-stu-id="edd8e-146">If your native API takes a Win32 `VARIANT`, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> format on your `object` parameter to marshal your objects as `VARIANT`s.</span></span> <span data-ttu-id="edd8e-147">V dokumentaci k [přizpůsobení `object` polí](customize-struct-marshaling.md#marshaling-systemobjects) pro mapování `VARIANT` mezi typy .NET a typy.</span><span class="sxs-lookup"><span data-stu-id="edd8e-147">See the documentation on [customizing `object` fields](customize-struct-marshaling.md#marshaling-systemobjects) for a mapping between .NET types and `VARIANT` types.</span></span>

### <a name="custom-marshalers"></a><span data-ttu-id="edd8e-148">Vlastní zařazovače</span><span class="sxs-lookup"><span data-stu-id="edd8e-148">Custom marshalers</span></span>

<span data-ttu-id="edd8e-149">Pokud chcete promítnout nativní rozhraní COM do jiného spravovaného `UnmanagedType.CustomMarshaler` <xref:System.Runtime.InteropServices.ICustomMarshaler> typu, můžete použít formát a implementaci poskytnout vlastní zařazovací kód.</span><span class="sxs-lookup"><span data-stu-id="edd8e-149">If you want to project a native COM interface into a different managed type, you can use the `UnmanagedType.CustomMarshaler` format and an implementation of <xref:System.Runtime.InteropServices.ICustomMarshaler> to provide your own custom marshaling code.</span></span>
