---
title: Obálka volatelná za běhu
description: CLR zpřístupňuje objekty COM prostřednictvím obálky s voláním pro spuštění, které spravuje volání mezi klientem .NET a objektem COM.
ms.date: 03/30/2017
helpviewer_keywords:
- COM interop, COM wrappers
- RCW
- COM wrappers
- runtime callable wrappers
- interoperation with unmanaged code, COM wrappers
ms.assetid: 7e542583-1e31-4e10-b523-8cf2f29cb4a4
ms.openlocfilehash: 6868c79791d960dd1ae55ab09d4ac3b40ce52655
ms.sourcegitcommit: 9a4488a3625866335e83a20da5e9c5286b1f034c
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/15/2020
ms.locfileid: "83420484"
---
# <a name="runtime-callable-wrapper"></a><span data-ttu-id="df0d0-103">Obálka volatelná za běhu</span><span class="sxs-lookup"><span data-stu-id="df0d0-103">Runtime Callable Wrapper</span></span>
<span data-ttu-id="df0d0-104">Modul CLR (Common Language Runtime) zpřístupňuje objekty COM prostřednictvím proxy s názvem obálka s voláním za běhu (RCW).</span><span class="sxs-lookup"><span data-stu-id="df0d0-104">The common language runtime exposes COM objects through a proxy called the runtime callable wrapper (RCW).</span></span> <span data-ttu-id="df0d0-105">I když se RCW jeví jako běžný objekt pro klienty rozhraní .NET, jeho primární funkce je zařazování volání mezi klientem rozhraní .NET a objektem COM.</span><span class="sxs-lookup"><span data-stu-id="df0d0-105">Although the RCW appears to be an ordinary object to .NET clients, its primary function is to marshal calls between a .NET client and a COM object.</span></span>  
  
 <span data-ttu-id="df0d0-106">Modul runtime vytváří přesně jeden RCW pro každý objekt modelu COM, bez ohledu na počet odkazů, které existují na daném objektu.</span><span class="sxs-lookup"><span data-stu-id="df0d0-106">The runtime creates exactly one RCW for each COM object, regardless of the number of references that exist on that object.</span></span> <span data-ttu-id="df0d0-107">Modul runtime udržuje jeden RCW na proces pro každý objekt.</span><span class="sxs-lookup"><span data-stu-id="df0d0-107">The runtime maintains a single RCW per process for each object.</span></span>  <span data-ttu-id="df0d0-108">Pokud vytvoříte RCW v jedné doméně aplikace nebo objektu apartment a potom předáte odkaz na jinou doménu aplikace nebo objekt Apartment, bude použit proxy server k prvnímu objektu.</span><span class="sxs-lookup"><span data-stu-id="df0d0-108">If you create an RCW in one application domain or apartment, and then pass a reference to another application domain or apartment, a proxy to the first object will be used.</span></span>  <span data-ttu-id="df0d0-109">Jak ukazuje následující obrázek, libovolný počet spravovaných klientů může obsahovat odkaz na objekty modelu COM, které zveřejňují rozhraní INew a INewer.</span><span class="sxs-lookup"><span data-stu-id="df0d0-109">As the following illustration shows, any number of managed clients can hold a reference to the COM objects that expose INew and INewer interfaces.</span></span>  

<span data-ttu-id="df0d0-110">Následující obrázek znázorňuje proces pro přístup k objektům modelu COM prostřednictvím obálky s možností přístupu za běhu:</span><span class="sxs-lookup"><span data-stu-id="df0d0-110">The following image shows the process for accessing COM objects through the runtime callable wrapper:</span></span>

 ![Proces pro přístup k objektům COM přes RCW.](./media/runtime-callable-wrapper/runtime-callable-wrapper.gif)  

 <span data-ttu-id="df0d0-112">Pomocí metadat odvozených z knihovny typů vytvoří modul runtime objekt COM, který je volán, a obal pro daný objekt.</span><span class="sxs-lookup"><span data-stu-id="df0d0-112">Using metadata derived from a type library, the runtime creates both the COM object being called and a wrapper for that object.</span></span> <span data-ttu-id="df0d0-113">Každý RCW udržuje mezipaměť ukazatelů rozhraní u objektu COM, který zabalí a uvolní svůj odkaz na objekt modelu COM, pokud RCW již není potřeba.</span><span class="sxs-lookup"><span data-stu-id="df0d0-113">Each RCW maintains a cache of interface pointers on the COM object it wraps and releases its reference on the COM object when the RCW is no longer needed.</span></span> <span data-ttu-id="df0d0-114">Modul runtime provádí uvolňování paměti v RCW.</span><span class="sxs-lookup"><span data-stu-id="df0d0-114">The runtime performs garbage collection on the RCW.</span></span>  
  
 <span data-ttu-id="df0d0-115">Mimo jiné činnosti RCW zařazování dat mezi spravovaným a nespravovaným kódem jménem zabaleného objektu.</span><span class="sxs-lookup"><span data-stu-id="df0d0-115">Among other activities, the RCW marshals data between managed and unmanaged code, on behalf of the wrapped object.</span></span> <span data-ttu-id="df0d0-116">Konkrétně RCW poskytuje zařazování pro argumenty metody a návratové hodnoty metody pokaždé, když klient a Server mají různá reprezentace dat předaná mezi nimi.</span><span class="sxs-lookup"><span data-stu-id="df0d0-116">Specifically, the RCW provides marshaling for method arguments and method return values whenever the client and server have different representations of the data passed between them.</span></span>  
  
 <span data-ttu-id="df0d0-117">Standardní obálka vynutila Vestavěná pravidla zařazování.</span><span class="sxs-lookup"><span data-stu-id="df0d0-117">The standard wrapper enforces built-in marshaling rules.</span></span> <span data-ttu-id="df0d0-118">Například když klient rozhraní .NET předává jako součást argumentu nespravovanému objektu typ String, obálka převede řetězec na typ BSTR.</span><span class="sxs-lookup"><span data-stu-id="df0d0-118">For example, when a .NET client passes a String type as part of an argument to an unmanaged object, the wrapper converts the string to a BSTR type.</span></span> <span data-ttu-id="df0d0-119">Pokud objekt COM vrátí BSTR ke svému spravovanému volajícímu, volající obdrží řetězec.</span><span class="sxs-lookup"><span data-stu-id="df0d0-119">Should the COM object return a BSTR to its managed caller, the caller receives a String.</span></span> <span data-ttu-id="df0d0-120">Jak klient, tak server odesílají a přijímají data, která jsou pro ně známa.</span><span class="sxs-lookup"><span data-stu-id="df0d0-120">Both the client and the server send and receive data that is familiar to them.</span></span> <span data-ttu-id="df0d0-121">Jiné typy nevyžadují konverzi.</span><span class="sxs-lookup"><span data-stu-id="df0d0-121">Other types require no conversion.</span></span> <span data-ttu-id="df0d0-122">Například standardní obálka vždy předá celé 4 bajty mezi spravovaným a nespravovaným kódem bez převodu typu.</span><span class="sxs-lookup"><span data-stu-id="df0d0-122">For instance, a standard wrapper will always pass a 4-byte integer between managed and unmanaged code without converting the type.</span></span>  
  
## <a name="marshaling-selected-interfaces"></a><span data-ttu-id="df0d0-123">Zařazování vybraných rozhraní</span><span class="sxs-lookup"><span data-stu-id="df0d0-123">Marshaling selected interfaces</span></span>  
 <span data-ttu-id="df0d0-124">Primárním cílem obálky s vyRCWelné [za běhu](runtime-callable-wrapper.md) je skrýt rozdíly mezi spravovanými a nespravovanými programovacími modely.</span><span class="sxs-lookup"><span data-stu-id="df0d0-124">The primary goal of the [runtime callable wrapper](runtime-callable-wrapper.md) (RCW) is to hide the differences between the managed and unmanaged programming models.</span></span> <span data-ttu-id="df0d0-125">Pro vytvoření bezproblémového přechodu RCW spotřebovává vybraná rozhraní COM bez jejich zveřejnění klientovi .NET, jak je znázorněno na následujícím obrázku.</span><span class="sxs-lookup"><span data-stu-id="df0d0-125">To create a seamless transition, the RCW consumes selected COM interfaces without exposing them to the .NET client, as shown in the following illustration.</span></span>

 <span data-ttu-id="df0d0-126">Následující obrázek ukazuje rozhraní COM a obálku s možností spuštění za běhu:</span><span class="sxs-lookup"><span data-stu-id="df0d0-126">The following image shows COM interfaces and the runtime callable wrapper:</span></span>
  
 ![Snímek obrazovky s vydanou obálkou za běhu s rozhraními](./media/runtime-callable-wrapper/runtime-callable-wrapper-interfaces.gif)  
  
 <span data-ttu-id="df0d0-128">Při vytvoření jako objektu s časnou vazbou je RCW konkrétním typem.</span><span class="sxs-lookup"><span data-stu-id="df0d0-128">When created as an early-bound object, the RCW is a specific type.</span></span> <span data-ttu-id="df0d0-129">Implementuje rozhraní, která objekt COM implementuje a zpřístupňuje metody, vlastnosti a události z rozhraní objektu.</span><span class="sxs-lookup"><span data-stu-id="df0d0-129">It implements the interfaces that the COM object implements and exposes the methods, properties, and events from the object's interfaces.</span></span> <span data-ttu-id="df0d0-130">Na ilustraci RCW zpřístupňuje rozhraní INew, ale spotřebovává rozhraní **IUnknown** a **IDispatch** .</span><span class="sxs-lookup"><span data-stu-id="df0d0-130">In the illustration, the RCW exposes the INew interface but consumes the **IUnknown** and **IDispatch** interfaces.</span></span> <span data-ttu-id="df0d0-131">Kromě toho RCW zpřístupňuje všechny členy rozhraní INew klientovi .NET.</span><span class="sxs-lookup"><span data-stu-id="df0d0-131">Further, the RCW exposes all members of the INew interface to the .NET client.</span></span>  
  
 <span data-ttu-id="df0d0-132">RCW spotřebovává rozhraní uvedená v následující tabulce, která jsou zpřístupněna objektem, který balí.</span><span class="sxs-lookup"><span data-stu-id="df0d0-132">The RCW consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="df0d0-133">Rozhraní</span><span class="sxs-lookup"><span data-stu-id="df0d0-133">Interface</span></span>|<span data-ttu-id="df0d0-134">Popis</span><span class="sxs-lookup"><span data-stu-id="df0d0-134">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="df0d0-135">**IDispatch**</span><span class="sxs-lookup"><span data-stu-id="df0d0-135">**IDispatch**</span></span>|<span data-ttu-id="df0d0-136">Pro pozdní vazbu k objektům modelu COM prostřednictvím reflexe.</span><span class="sxs-lookup"><span data-stu-id="df0d0-136">For late binding to COM objects through reflection.</span></span>|  
|<span data-ttu-id="df0d0-137">**IErrorInfo**</span><span class="sxs-lookup"><span data-stu-id="df0d0-137">**IErrorInfo**</span></span>|<span data-ttu-id="df0d0-138">Poskytuje textový popis chyby, její zdroj, soubor s nápovědu, kontext nápovědu a identifikátor GUID rozhraní, které definuje chybu (vždy **GUID_NULL** pro třídy rozhraní .NET).</span><span class="sxs-lookup"><span data-stu-id="df0d0-138">Provides a textual description of the error, its source, a Help file, Help context, and the GUID of the interface that defined the error (always **GUID_NULL** for .NET classes).</span></span>|  
|<span data-ttu-id="df0d0-139">**IProvideClassInfo**</span><span class="sxs-lookup"><span data-stu-id="df0d0-139">**IProvideClassInfo**</span></span>|<span data-ttu-id="df0d0-140">Pokud objekt modelu COM, který je zabalen, implementuje **IProvideClassInfo**, RCW extrahuje informace o typu z tohoto rozhraní za účelem poskytnutí lepší identity typu.</span><span class="sxs-lookup"><span data-stu-id="df0d0-140">If the COM object being wrapped implements **IProvideClassInfo**, the RCW extracts the type information from this interface to provide better type identity.</span></span>|  
|<span data-ttu-id="df0d0-141">**IUnknown**</span><span class="sxs-lookup"><span data-stu-id="df0d0-141">**IUnknown**</span></span>|<span data-ttu-id="df0d0-142">V případě identity objektu zadejte vynucení a správu životnosti:</span><span class="sxs-lookup"><span data-stu-id="df0d0-142">For object identity, type coercion, and lifetime management:</span></span><br /><br /> <span data-ttu-id="df0d0-143">– Identita objektu</span><span class="sxs-lookup"><span data-stu-id="df0d0-143">-   Object identity</span></span><br />     <span data-ttu-id="df0d0-144">Modul runtime rozlišuje objekty modelu COM porovnáním hodnoty rozhraní **IUnknown** pro každý objekt.</span><span class="sxs-lookup"><span data-stu-id="df0d0-144">The runtime distinguishes between COM objects by comparing the value of the **IUnknown** interface for each object.</span></span><br /><span data-ttu-id="df0d0-145">-Typ – konverze</span><span class="sxs-lookup"><span data-stu-id="df0d0-145">-   Type coercion</span></span><br />     <span data-ttu-id="df0d0-146">RCW rozpoznává zjišťování dynamického typu prováděného metodou **QueryInterface** .</span><span class="sxs-lookup"><span data-stu-id="df0d0-146">The RCW recognizes the dynamic type discovery performed by the **QueryInterface** method.</span></span><br /><span data-ttu-id="df0d0-147">– Správa životního cyklu</span><span class="sxs-lookup"><span data-stu-id="df0d0-147">-   Lifetime management</span></span><br />     <span data-ttu-id="df0d0-148">Pomocí metody **QueryInterface** získá RCW a obsahuje odkaz na nespravovaný objekt, dokud modul runtime neprovede uvolňování paměti na obálce, což uvolní nespravovaný objekt.</span><span class="sxs-lookup"><span data-stu-id="df0d0-148">Using the **QueryInterface** method, the RCW gets and holds a reference to an unmanaged object until the runtime performs garbage collection on the wrapper, which releases the unmanaged object.</span></span>|  
  
 <span data-ttu-id="df0d0-149">RCW volitelně spotřebovává rozhraní uvedená v následující tabulce, které jsou zpřístupněny objektem, který balí.</span><span class="sxs-lookup"><span data-stu-id="df0d0-149">The RCW optionally consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="df0d0-150">Rozhraní</span><span class="sxs-lookup"><span data-stu-id="df0d0-150">Interface</span></span>|<span data-ttu-id="df0d0-151">Popis</span><span class="sxs-lookup"><span data-stu-id="df0d0-151">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="df0d0-152">**IConnectionPoint** a **IConnectionPointContainer**</span><span class="sxs-lookup"><span data-stu-id="df0d0-152">**IConnectionPoint** and **IConnectionPointContainer**</span></span>|<span data-ttu-id="df0d0-153">RCW převede objekty, které zpřístupňují styl události spojovacího bodu, na události založené na delegování.</span><span class="sxs-lookup"><span data-stu-id="df0d0-153">The RCW converts objects that expose the connection-point event style to delegate-based events.</span></span>|  
|<span data-ttu-id="df0d0-154">**IDispatchEx –** (pouze .NET Framework)</span><span class="sxs-lookup"><span data-stu-id="df0d0-154">**IDispatchEx** (.NET Framework Only)</span></span> |<span data-ttu-id="df0d0-155">Pokud třída implementuje **IDispatchEx –**, RCW implementuje **IExpando**.</span><span class="sxs-lookup"><span data-stu-id="df0d0-155">If the class implements **IDispatchEx**, the RCW implements **IExpando**.</span></span> <span data-ttu-id="df0d0-156">Rozhraní **IDispatchEx –** je rozšíření rozhraní **IDispatch** , které na rozdíl od rozhraní **IDispatch**povoluje vyčíslení, sčítání, odstraňování a rozlišování velkých a malých písmen členů.</span><span class="sxs-lookup"><span data-stu-id="df0d0-156">The **IDispatchEx** interface is an extension of the **IDispatch** interface that, unlike **IDispatch**, enables enumeration, addition, deletion, and case-sensitive calling of members.</span></span>|  
|<span data-ttu-id="df0d0-157">**IEnumVARIANT**</span><span class="sxs-lookup"><span data-stu-id="df0d0-157">**IEnumVARIANT**</span></span>|<span data-ttu-id="df0d0-158">Povoluje, aby typy COM, které podporují výčty, byly zpracovány jako kolekce.</span><span class="sxs-lookup"><span data-stu-id="df0d0-158">Enables COM types that support enumerations to be treated as collections.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="df0d0-159">Viz také</span><span class="sxs-lookup"><span data-stu-id="df0d0-159">See also</span></span>

- [<span data-ttu-id="df0d0-160">Obálky COM</span><span class="sxs-lookup"><span data-stu-id="df0d0-160">COM Wrappers</span></span>](com-wrappers.md)
- [<span data-ttu-id="df0d0-161">Obálka volatelná aplikacemi COM</span><span class="sxs-lookup"><span data-stu-id="df0d0-161">COM Callable Wrapper</span></span>](com-callable-wrapper.md)
- <span data-ttu-id="df0d0-162">[Souhrn převodu knihovny typů na sestavení](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/k83zzh38(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="df0d0-162">[Type Library to Assembly Conversion Summary](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/k83zzh38(v=vs.100))</span></span>
- [<span data-ttu-id="df0d0-163">Import knihovny typů ve formě sestavení</span><span class="sxs-lookup"><span data-stu-id="df0d0-163">Importing a Type Library as an Assembly</span></span>](../../framework/interop/importing-a-type-library-as-an-assembly.md)
