---
title: 'Postupy: kontrola obsahu sestavení pomocí MetadataLoadContext'
description: Naučte se používat MetadataLoadContext, což je rozhraní API, které umožňuje načíst sestavení .NET pro účely kontroly.
author: MSDN-WhiteKnight
ms.date: 03/10/2020
ms.technology: dotnet-standard
ms.openlocfilehash: 90c84147c52199afc42a2efc297bc7fe40658ec7
ms.sourcegitcommit: 839777281a281684a7e2906dccb3acd7f6a32023
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/24/2020
ms.locfileid: "82141204"
---
# <a name="how-to-inspect-assembly-contents-using-metadataloadcontext"></a><span data-ttu-id="af8df-103">Postupy: kontrola obsahu sestavení pomocí MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="af8df-103">How to: Inspect assembly contents using MetadataLoadContext</span></span>

<span data-ttu-id="af8df-104">Rozhraní API pro reflexi v rozhraní .NET ve výchozím nastavení umožňuje vývojářům kontrolovat obsah sestavení načtených do hlavního prováděcího kontextu.</span><span class="sxs-lookup"><span data-stu-id="af8df-104">The reflection API in .NET by default enables developers to inspect the contents of assemblies loaded into the main execution context.</span></span> <span data-ttu-id="af8df-105">V některých případech však není možné načíst sestavení do kontextu spuštění, například protože byl zkompilován pro jinou architekturu platformy nebo procesoru, nebo se jedná o [referenční sestavení](reference-assemblies.md).</span><span class="sxs-lookup"><span data-stu-id="af8df-105">However, sometimes it isn't possible to load an assembly into the execution context, for example, because it was compiled for another platform or processor architecture, or it's a [reference assembly](reference-assemblies.md).</span></span> <span data-ttu-id="af8df-106"><xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> Rozhraní API umožňuje načíst a zkontrolovat taková sestavení.</span><span class="sxs-lookup"><span data-stu-id="af8df-106">The <xref:System.Reflection.MetadataLoadContext?displayProperty=fullName> API allows you to load and inspect such assemblies.</span></span> <span data-ttu-id="af8df-107">Sestavení načtená do <xref:System.Reflection.MetadataLoadContext> jsou zpracována pouze jako metadata, to znamená, že můžete prozkoumávat typy v sestavení, ale nelze spustit žádný kód obsažený v tomto sestavení.</span><span class="sxs-lookup"><span data-stu-id="af8df-107">Assemblies loaded into the <xref:System.Reflection.MetadataLoadContext> are treated only as metadata, that is, you can examine types in the assembly, but you can't execute any code contained in it.</span></span> <span data-ttu-id="af8df-108">Na <xref:System.Reflection.MetadataLoadContext> rozdíl od hlavního kontextu spuštění nenačítá automaticky závislosti z aktuálního adresáře. místo toho používá vlastní logiku vazby poskytnutou <xref:System.Reflection.MetadataAssemblyResolver> předaným do IT.</span><span class="sxs-lookup"><span data-stu-id="af8df-108">Unlike the main execution context, the <xref:System.Reflection.MetadataLoadContext> doesn't automatically load dependencies from the current directory; instead it uses the custom binding logic provided by the <xref:System.Reflection.MetadataAssemblyResolver> passed to it.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="af8df-109">Požadavky</span><span class="sxs-lookup"><span data-stu-id="af8df-109">Prerequisites</span></span>

<span data-ttu-id="af8df-110">Chcete- <xref:System.Reflection.MetadataLoadContext>li použít, nainstalujte balíček NuGet [System. Reflection. MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) .</span><span class="sxs-lookup"><span data-stu-id="af8df-110">To use <xref:System.Reflection.MetadataLoadContext>, install the [System.Reflection.MetadataLoadContext](https://www.nuget.org/packages/System.Reflection.MetadataLoadContext) NuGet package.</span></span> <span data-ttu-id="af8df-111">Podporuje se v jakémkoli cílovém rozhraní, které dodržuje .NET Standard 2,0, například .NET Core 2,0 nebo .NET Framework 4.6.1.</span><span class="sxs-lookup"><span data-stu-id="af8df-111">It is supported on any .NET Standard 2.0-compliant target framework, for example, .NET Core 2.0 or .NET Framework 4.6.1.</span></span>

## <a name="create-metadataassemblyresolver-for-metadataloadcontext"></a><span data-ttu-id="af8df-112">Vytvoření MetadataAssemblyResolver pro MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="af8df-112">Create MetadataAssemblyResolver for MetadataLoadContext</span></span>

<span data-ttu-id="af8df-113">Vytváření <xref:System.Reflection.MetadataLoadContext> vyžaduje poskytnutí instance <xref:System.Reflection.MetadataAssemblyResolver>.</span><span class="sxs-lookup"><span data-stu-id="af8df-113">Creating the <xref:System.Reflection.MetadataLoadContext> requires providing the instance of the <xref:System.Reflection.MetadataAssemblyResolver>.</span></span> <span data-ttu-id="af8df-114">Nejjednodušší způsob <xref:System.Reflection.PathAssemblyResolver>, jak jeden zadat, je použít, který překládá sestavení ze zadané kolekce řetězců cest sestavení.</span><span class="sxs-lookup"><span data-stu-id="af8df-114">The simplest way to provide one is to use the <xref:System.Reflection.PathAssemblyResolver>, which resolves assemblies from the given collection of assembly path strings.</span></span> <span data-ttu-id="af8df-115">Tato kolekce, kromě sestavení, která chcete přímo prozkoumat, by měla také zahrnovat všechny potřebné závislosti.</span><span class="sxs-lookup"><span data-stu-id="af8df-115">This collection, besides assemblies you want to inspect directly, should also include all needed dependencies.</span></span> <span data-ttu-id="af8df-116">Chcete-li například načíst vlastní atribut umístěný v externím sestavení, měli byste zahrnout toto sestavení, nebo bude vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="af8df-116">For example, to read the custom attribute located in an external assembly, you should include that assembly or an exception will be thrown.</span></span> <span data-ttu-id="af8df-117">Ve většině případů byste měli zahrnout alespoň *základní sestavení*, to znamená sestavení obsahující předdefinované systémové typy, například <xref:System.Object?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="af8df-117">In most cases, you should include at least the *core assembly*, that is, the assembly containing built-in system types, such as <xref:System.Object?displayProperty=nameWithType>.</span></span> <span data-ttu-id="af8df-118">Následující kód ukazuje, jak vytvořit <xref:System.Reflection.PathAssemblyResolver> pomocí kolekce sestávající z kontrolovaného sestavení a aktuálního základního sestavení modulu runtime:</span><span class="sxs-lookup"><span data-stu-id="af8df-118">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and the current runtime's core assembly:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CoreAssembly)]

<span data-ttu-id="af8df-119">Potřebujete-li přístup ke všem typům BCL, můžete do kolekce zahrnout všechna sestavení modulu runtime.</span><span class="sxs-lookup"><span data-stu-id="af8df-119">If you need access to all BCL types, you can include all runtime assemblies in the collection.</span></span> <span data-ttu-id="af8df-120">Následující kód ukazuje, jak vytvořit <xref:System.Reflection.PathAssemblyResolver> pomocí kolekce skládající se z kontrolovaného sestavení a všech sestavení aktuálního modulu runtime:</span><span class="sxs-lookup"><span data-stu-id="af8df-120">The following code shows how to create the <xref:System.Reflection.PathAssemblyResolver> using the collection consisting of the inspected assembly and all assemblies of the current runtime:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#RuntimeAssemblies)]

## <a name="create-metadataloadcontext"></a><span data-ttu-id="af8df-121">Vytvořit MetadataLoadContext</span><span class="sxs-lookup"><span data-stu-id="af8df-121">Create MetadataLoadContext</span></span>

<span data-ttu-id="af8df-122">Chcete-li <xref:System.Reflection.MetadataLoadContext>vytvořit, vyvolat jeho <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>konstruktor, předat dříve vytvořený <xref:System.Reflection.MetadataAssemblyResolver> jako první parametr a základní název sestavení jako druhý parametr.</span><span class="sxs-lookup"><span data-stu-id="af8df-122">To create the <xref:System.Reflection.MetadataLoadContext>, invoke its constructor <xref:System.Reflection.MetadataLoadContext.%23ctor%28System.Reflection.MetadataAssemblyResolver%2CSystem.String%29>, passing the previously created <xref:System.Reflection.MetadataAssemblyResolver> as the first parameter and the core assembly name as the second parameter.</span></span> <span data-ttu-id="af8df-123">Základní název sestavení můžete vynechat. v takovém případě se konstruktor pokusí použít výchozí názvy: "mscorlib", "System. Runtime" nebo "netstandard".</span><span class="sxs-lookup"><span data-stu-id="af8df-123">You can omit the core assembly name, in which case the constructor will attempt to use default names: "mscorlib", "System.Runtime", or "netstandard".</span></span>

<span data-ttu-id="af8df-124">Po vytvoření kontextu můžete do něj načíst sestavení pomocí metod, jako je například <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>.</span><span class="sxs-lookup"><span data-stu-id="af8df-124">After you've created the context, you can load assemblies into it using methods such as <xref:System.Reflection.MetadataLoadContext.LoadFromAssemblyPath%2A>.</span></span> <span data-ttu-id="af8df-125">Můžete použít všechna rozhraní API reflexe u načtených sestavení kromě těch, která zahrnují provádění kódu.</span><span class="sxs-lookup"><span data-stu-id="af8df-125">You can use all reflection APIs on loaded assemblies except ones that involve code execution.</span></span> <span data-ttu-id="af8df-126"><xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> Metoda zahrnuje spuštění konstruktorů, takže použijte <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> metodu místo toho, když potřebujete prošetřit vlastní atributy v <xref:System.Reflection.MetadataLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="af8df-126">The <xref:System.Reflection.MemberInfo.GetCustomAttributes%2A> method does involve the execution of constructors, so use the <xref:System.Reflection.MemberInfo.GetCustomAttributesData%2A> method instead when you need to examine custom attributes in the <xref:System.Reflection.MetadataLoadContext>.</span></span>

<span data-ttu-id="af8df-127">Následující ukázka kódu vytvoří <xref:System.Reflection.MetadataLoadContext>, načte do něj sestavení a výstupy atributů sestavení do konzoly:</span><span class="sxs-lookup"><span data-stu-id="af8df-127">The following code sample creates <xref:System.Reflection.MetadataLoadContext>, loads the assembly into it, and outputs assembly attributes into the console:</span></span>

[!code-csharp[](snippets/inspect-contents-using-metadataloadcontext/MetadataLoadContextSnippets.cs#CreateContext)]

## <a name="example"></a><span data-ttu-id="af8df-128">Příklad</span><span class="sxs-lookup"><span data-stu-id="af8df-128">Example</span></span>

<span data-ttu-id="af8df-129">Úplný příklad kódu naleznete v tématu [Kontrola obsahu sestavení pomocí MetadataLoadContext Sample](https://docs.microsoft.com/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span><span class="sxs-lookup"><span data-stu-id="af8df-129">For a complete code example, see the [Inspect assembly contents using MetadataLoadContext sample](https://docs.microsoft.com/samples/dotnet/samples/inspect-assembly-contents-using-metadataloadcontext/).</span></span>
