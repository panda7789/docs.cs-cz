---
title: Výjimky ve spravovaných vláknech
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- unhandled exceptions,in managed threads
- threading [.NET Framework],unhandled exceptions
- threading [.NET Framework],exceptions in managed threads
- managed threading
ms.assetid: 11294769-2e89-43cb-890e-ad4ad79cfbee
ms.openlocfilehash: 6c14c60b30f8f70aa5e888ed45d6f867154e18d8
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/15/2020
ms.locfileid: "78159647"
---
# <a name="exceptions-in-managed-threads"></a><span data-ttu-id="dca06-102">Výjimky ve spravovaných vláknech</span><span class="sxs-lookup"><span data-stu-id="dca06-102">Exceptions in Managed Threads</span></span>
<span data-ttu-id="dca06-103">Počínaje rozhraním .NET Framework verze 2.0 umožňuje běžný jazyk runtime většinu neošetřených výjimek ve vláknech přirozeně pokračovat.</span><span class="sxs-lookup"><span data-stu-id="dca06-103">Starting with the .NET Framework version 2.0, the common language runtime allows most unhandled exceptions in threads to proceed naturally.</span></span> <span data-ttu-id="dca06-104">Ve většině případů to znamená, že neošetřená výjimka způsobí ukončení aplikace.</span><span class="sxs-lookup"><span data-stu-id="dca06-104">In most cases this means that the unhandled exception causes the application to terminate.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="dca06-105">Jedná se o významnou změnu oproti rozhraní .NET Framework verze 1.0 a 1.1, které poskytují backstop pro mnoho neošetřených výjimek , například neošetřené výjimky ve vláknech fondu vláken.</span><span class="sxs-lookup"><span data-stu-id="dca06-105">This is a significant change from the .NET Framework versions 1.0 and 1.1, which provide a backstop for many unhandled exceptions — for example, unhandled exceptions in thread pool threads.</span></span> <span data-ttu-id="dca06-106">Viz [Změna z předchozích verzí](#ChangeFromPreviousVersions) dále v tomto tématu.</span><span class="sxs-lookup"><span data-stu-id="dca06-106">See [Change from Previous Versions](#ChangeFromPreviousVersions) later in this topic.</span></span>  
  
 <span data-ttu-id="dca06-107">Běžný jazyk runtime poskytuje backstop pro některé neošetřené výjimky, které se používají pro řízení toku programu:</span><span class="sxs-lookup"><span data-stu-id="dca06-107">The common language runtime provides a backstop for certain unhandled exceptions that are used for controlling program flow:</span></span>  
  
- <span data-ttu-id="dca06-108">A <xref:System.Threading.ThreadAbortException> je vyvolána ve <xref:System.Threading.Thread.Abort%2A> vlákně, protože byl volán.</span><span class="sxs-lookup"><span data-stu-id="dca06-108">A <xref:System.Threading.ThreadAbortException> is thrown in a thread because <xref:System.Threading.Thread.Abort%2A> was called.</span></span>  
  
- <span data-ttu-id="dca06-109">Je <xref:System.AppDomainUnloadedException> vyvolána ve vlákně, protože doména aplikace, ve kterém je vlákno provádění je uvolněna.</span><span class="sxs-lookup"><span data-stu-id="dca06-109">An <xref:System.AppDomainUnloadedException> is thrown in a thread because the application domain in which the thread is executing is being unloaded.</span></span>  
  
- <span data-ttu-id="dca06-110">Běžný jazyk runtime nebo hostitelský proces ukončí vlákno vyvoláním vnitřní výjimky.</span><span class="sxs-lookup"><span data-stu-id="dca06-110">The common language runtime or a host process terminates the thread by throwing an internal exception.</span></span>  
  
 <span data-ttu-id="dca06-111">Pokud některá z těchto výjimek nejsou zpracovány ve vláknech vytvořených běžným jazykem runtime, výjimka ukončí vlákno, ale běžný jazyk runtime neumožňuje výjimku pokračovat dále.</span><span class="sxs-lookup"><span data-stu-id="dca06-111">If any of these exceptions are unhandled in threads created by the common language runtime, the exception terminates the thread, but the common language runtime does not allow the exception to proceed further.</span></span>  
  
 <span data-ttu-id="dca06-112">Pokud tyto výjimky nejsou zpracovány v hlavním vlákně nebo ve vláknech, která zadala runtime z nespravovaného kódu, postupují normálně, což vede k ukončení aplikace.</span><span class="sxs-lookup"><span data-stu-id="dca06-112">If these exceptions are unhandled in the main thread, or in threads that entered the runtime from unmanaged code, they proceed normally, resulting in termination of the application.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="dca06-113">Je možné, že za běhu vyvolat neošetřenou výjimku před libovolný spravovaný kód měl možnost nainstalovat obslužnou rutinu výjimky.</span><span class="sxs-lookup"><span data-stu-id="dca06-113">It is possible for the runtime to throw an unhandled exception before any managed code has had a chance to install an exception handler.</span></span> <span data-ttu-id="dca06-114">I když spravovaný kód neměl šanci zpracovat takovou výjimku, výjimka může postupovat přirozeně.</span><span class="sxs-lookup"><span data-stu-id="dca06-114">Even though managed code had no chance to handle such an exception, the exception is allowed to proceed naturally.</span></span>  
  
## <a name="exposing-threading-problems-during-development"></a><span data-ttu-id="dca06-115">Odhalení problémů s vlákny během vývoje</span><span class="sxs-lookup"><span data-stu-id="dca06-115">Exposing Threading Problems During Development</span></span>  
 <span data-ttu-id="dca06-116">Pokud vlákna mohou selhat tiše, bez ukončení aplikace, vážné problémy s programováním může přejít nezjištěný.</span><span class="sxs-lookup"><span data-stu-id="dca06-116">When threads are allowed to fail silently, without terminating the application, serious programming problems can go undetected.</span></span> <span data-ttu-id="dca06-117">To je zvláštní problém pro služby a další aplikace, které běží po delší dobu.</span><span class="sxs-lookup"><span data-stu-id="dca06-117">This is a particular problem for services and other applications which run for extended periods.</span></span> <span data-ttu-id="dca06-118">Při selhání vláken se stav programu postupně poškodí.</span><span class="sxs-lookup"><span data-stu-id="dca06-118">As threads fail, program state gradually becomes corrupted.</span></span> <span data-ttu-id="dca06-119">Výkon aplikace může snížit nebo aplikace přestane odpovídat.</span><span class="sxs-lookup"><span data-stu-id="dca06-119">Application performance may degrade, or the application might become unresponsive.</span></span>  
  
 <span data-ttu-id="dca06-120">Povolení neošetřené výjimky ve vláknech postupovat přirozeně, dokud operační systém ukončí program, zpřístupňuje tyto problémy během vývoje a testování.</span><span class="sxs-lookup"><span data-stu-id="dca06-120">Allowing unhandled exceptions in threads to proceed naturally, until the operating system terminates the program, exposes such problems during development and testing.</span></span> <span data-ttu-id="dca06-121">Zprávy o chybách při ukončení programu podporují ladění.</span><span class="sxs-lookup"><span data-stu-id="dca06-121">Error reports on program terminations support debugging.</span></span>  
  
<a name="ChangeFromPreviousVersions"></a>
## <a name="change-from-previous-versions"></a><span data-ttu-id="dca06-122">Změna z předchozích verzí</span><span class="sxs-lookup"><span data-stu-id="dca06-122">Change from Previous Versions</span></span>  
 <span data-ttu-id="dca06-123">Nejvýznamnější změna se vměšuje do spravovaných vláken.</span><span class="sxs-lookup"><span data-stu-id="dca06-123">The most significant change pertains to managed threads.</span></span> <span data-ttu-id="dca06-124">V rozhraní .NET Framework verze 1.0 a 1.1, common language runtime poskytuje backstop pro neošetřené výjimky v následujících situacích:</span><span class="sxs-lookup"><span data-stu-id="dca06-124">In the .NET Framework versions 1.0 and 1.1, the common language runtime provides a backstop for unhandled exceptions in the following situations:</span></span>  
  
- <span data-ttu-id="dca06-125">Neexistuje žádná taková věc jako neošetřené výjimky ve vlákně fondu vláken.</span><span class="sxs-lookup"><span data-stu-id="dca06-125">There is no such thing as an unhandled exception on a thread pool thread.</span></span> <span data-ttu-id="dca06-126">Když úloha vyvolá výjimku, kterou nezpracovává, vytiskne runtime trasování zásobníku výjimek do konzoly a potom vrátí vlákno do fondu vláken.</span><span class="sxs-lookup"><span data-stu-id="dca06-126">When a task throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then returns the thread to the thread pool.</span></span>  
  
- <span data-ttu-id="dca06-127">Neexistuje žádná taková věc jako neošetřené výjimky <xref:System.Threading.Thread.Start%2A> na <xref:System.Threading.Thread> vlákno vytvořené metodou třídy.</span><span class="sxs-lookup"><span data-stu-id="dca06-127">There is no such thing as an unhandled exception on a thread created with the <xref:System.Threading.Thread.Start%2A> method of the <xref:System.Threading.Thread> class.</span></span> <span data-ttu-id="dca06-128">Když kód spuštěný v takovém vlákně vyvolá výjimku, kterou nezpracovává, vytiskne runtime trasování zásobníku výjimek do konzoly a potom řádně ukončí vlákno.</span><span class="sxs-lookup"><span data-stu-id="dca06-128">When code running on such a thread throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then gracefully terminates the thread.</span></span>  
  
- <span data-ttu-id="dca06-129">Neexistuje žádná taková věc jako neošetřené výjimky ve vlákně finalizační metody.</span><span class="sxs-lookup"><span data-stu-id="dca06-129">There is no such thing as an unhandled exception on the finalizer thread.</span></span> <span data-ttu-id="dca06-130">Když finalizační metoda vyvolá výjimku, kterou nezpracovává, vytiskne za běhu trasování zásobníku výjimek do konzoly a pak povolí finalizační podproces pokračovat ve spuštění finalizačních metod.</span><span class="sxs-lookup"><span data-stu-id="dca06-130">When a finalizer throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then allows the finalizer thread to resume running finalizers.</span></span>  
  
 <span data-ttu-id="dca06-131">Stav popředí nebo pozadí spravovaného vlákna nemá vliv na toto chování.</span><span class="sxs-lookup"><span data-stu-id="dca06-131">The foreground or background status of a managed thread does not affect this behavior.</span></span>  
  
 <span data-ttu-id="dca06-132">Pro neošetřené výjimky na vláknech pocházejících z nespravovaného kódu je rozdíl jemnější.</span><span class="sxs-lookup"><span data-stu-id="dca06-132">For unhandled exceptions on threads originating in unmanaged code, the difference is more subtle.</span></span> <span data-ttu-id="dca06-133">Dialogové okno připojit jit za běhu předcvrzuje dialogové okno operačního systému pro spravované výjimky nebo nativní výjimky ve vláknech, které prošly nativním kódem.</span><span class="sxs-lookup"><span data-stu-id="dca06-133">The runtime JIT-attach dialog preempts the operating system dialog for managed exceptions or native exceptions on threads that have passed through native code.</span></span> <span data-ttu-id="dca06-134">Proces bude ukončen ve všech případech.</span><span class="sxs-lookup"><span data-stu-id="dca06-134">The process terminates in all cases.</span></span>  
  
### <a name="migrating-code"></a><span data-ttu-id="dca06-135">Migrace kódu</span><span class="sxs-lookup"><span data-stu-id="dca06-135">Migrating Code</span></span>  
 <span data-ttu-id="dca06-136">Obecně platí, že změna bude vystavit dříve nerozpoznané problémy s programováním tak, aby mohly být opraveny.</span><span class="sxs-lookup"><span data-stu-id="dca06-136">In general, the change will expose previously unrecognized programming problems so that they can be fixed.</span></span> <span data-ttu-id="dca06-137">V některých případech však programátoři mohli využít backstop runtime, například ukončit podprocesy.</span><span class="sxs-lookup"><span data-stu-id="dca06-137">In some cases, however, programmers might have taken advantage of the runtime backstop, for example to terminate threads.</span></span> <span data-ttu-id="dca06-138">V závislosti na situaci by měli zvážit jednu z následujících strategií migrace:</span><span class="sxs-lookup"><span data-stu-id="dca06-138">Depending on the situation, they should consider one of the following migration strategies:</span></span>  
  
- <span data-ttu-id="dca06-139">Restrukturalizovat kód tak, aby vlákno ukončí řádně při přijetí signálu.</span><span class="sxs-lookup"><span data-stu-id="dca06-139">Restructure the code so the thread exits gracefully when a signal is received.</span></span>  
  
- <span data-ttu-id="dca06-140">Pomocí <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> metody přerušte vlákno.</span><span class="sxs-lookup"><span data-stu-id="dca06-140">Use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method to abort the thread.</span></span>  
  
- <span data-ttu-id="dca06-141">Pokud podproces musí být zastaven, aby ukončení procesu může pokračovat, aby vlákno podproces podproces na pozadí tak, aby je automaticky ukončena při ukončení procesu.</span><span class="sxs-lookup"><span data-stu-id="dca06-141">If a thread must be stopped so that process termination can proceed, make the thread a background thread so that it is automatically terminated on process exit.</span></span>  
  
 <span data-ttu-id="dca06-142">Ve všech případech by se strategie měla řídit pokyny pro návrh výjimek.</span><span class="sxs-lookup"><span data-stu-id="dca06-142">In all cases, the strategy should follow the design guidelines for exceptions.</span></span> <span data-ttu-id="dca06-143">Viz [Pokyny pro návrh výjimek](../../../docs/standard/design-guidelines/exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="dca06-143">See [Design Guidelines for Exceptions](../../../docs/standard/design-guidelines/exceptions.md).</span></span>  
  
### <a name="application-compatibility-flag"></a><span data-ttu-id="dca06-144">Příznak kompatibility aplikací</span><span class="sxs-lookup"><span data-stu-id="dca06-144">Application Compatibility Flag</span></span>  
 <span data-ttu-id="dca06-145">Jako dočasné opatření kompatibility mohou správci umístit `<runtime>` příznak kompatibility do části konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="dca06-145">As a temporary compatibility measure, administrators can place a compatibility flag in the `<runtime>` section of the application configuration file.</span></span> <span data-ttu-id="dca06-146">To způsobí, že běžný jazyk runtime vrátit k chování verze 1.0 a 1.1.</span><span class="sxs-lookup"><span data-stu-id="dca06-146">This causes the common language runtime to revert to the behavior of versions 1.0 and 1.1.</span></span>  
  
```xml  
<legacyUnhandledExceptionPolicy enabled="1"/>  
```  
  
## <a name="host-override"></a><span data-ttu-id="dca06-147">Přepsání hostitele</span><span class="sxs-lookup"><span data-stu-id="dca06-147">Host Override</span></span>  
 <span data-ttu-id="dca06-148">V rozhraní .NET Framework verze 2.0 může nespravovaný hostitel použít rozhraní [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) v hostitelském rozhraní API k přepsání výchozí zásady neošetřené výjimky modulu COMMON Language runtime.</span><span class="sxs-lookup"><span data-stu-id="dca06-148">In the .NET Framework version 2.0, an unmanaged host can use the [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) interface in the Hosting API to override the default unhandled exception policy of the common language runtime.</span></span> <span data-ttu-id="dca06-149">Funkce [ICLRPolicyManager::SetUnhandledExceptionPolicy](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) se používá k nastavení zásad pro neošetřené výjimky.</span><span class="sxs-lookup"><span data-stu-id="dca06-149">The [ICLRPolicyManager::SetUnhandledExceptionPolicy](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) function is used to set the policy for unhandled exceptions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dca06-150">Viz také</span><span class="sxs-lookup"><span data-stu-id="dca06-150">See also</span></span>

- [<span data-ttu-id="dca06-151">Základy dělení na spravovaná vlákna</span><span class="sxs-lookup"><span data-stu-id="dca06-151">Managed Threading Basics</span></span>](../../../docs/standard/threading/managed-threading-basics.md)
