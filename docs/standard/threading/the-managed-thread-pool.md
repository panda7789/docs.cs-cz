---
title: Spravovaný fond vláken
description: Informace o fondu vláken .NET, který poskytuje pracovní vlákna na pozadí
ms.date: 08/02/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- thread pooling [.NET]
- thread pools [.NET]
- threading [.NET], thread pool
- threading [.NET], pooling
ms.assetid: 2be05b06-a42e-4c9d-a739-96c21d673927
ms.openlocfilehash: 2671ce7c9721b15de8a3805da27040e973a62804
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/15/2020
ms.locfileid: "79400629"
---
# <a name="the-managed-thread-pool"></a><span data-ttu-id="491f7-103">Spravovaný fond vláken</span><span class="sxs-lookup"><span data-stu-id="491f7-103">The managed thread pool</span></span>

<span data-ttu-id="491f7-104">Třída <xref:System.Threading.ThreadPool?displayProperty=nameWithType> poskytuje vaší aplikaci fond pracovních podprocesů, které jsou spravovány systémem, což vám umožní soustředit se na úlohy aplikace spíše než na správu vláken.</span><span class="sxs-lookup"><span data-stu-id="491f7-104">The <xref:System.Threading.ThreadPool?displayProperty=nameWithType> class provides your application with a pool of worker threads that are managed by the system, allowing you to concentrate on application tasks rather than thread management.</span></span> <span data-ttu-id="491f7-105">Pokud máte krátké úkoly, které vyžadují zpracování na pozadí, fond spravovaných vláken je snadný způsob, jak využít výhod více vláken.</span><span class="sxs-lookup"><span data-stu-id="491f7-105">If you have short tasks that require background processing, the managed thread pool is an easy way to take advantage of multiple threads.</span></span> <span data-ttu-id="491f7-106">Použití fondu vláken je výrazně jednodušší v rámci 4 <xref:System.Threading.Tasks.Task> a <xref:System.Threading.Tasks.Task%601> novější, protože můžete vytvořit a objekty, které provádějí asynchronní úlohy ve vláknech fondu vláken.</span><span class="sxs-lookup"><span data-stu-id="491f7-106">Use of the thread pool is significantly easier in Framework 4 and later, since you can create <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects that perform asynchronous tasks on thread pool threads.</span></span>  
  
<span data-ttu-id="491f7-107">.NET používá vlákna fondu vláken pro mnoho účelů, včetně operací [paralelní knihovny úloh (TPL),](../parallel-programming/task-parallel-library-tpl.md) asynchronní vstupně-v.o dokončení, <xref:System.Net?displayProperty=nameWithType> [časovač](timers.md) zpětné volání, registrované operace čekání, volání asynchronní metody pomocí delegátů a připojení soketu.</span><span class="sxs-lookup"><span data-stu-id="491f7-107">.NET uses thread pool threads for many purposes, including [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) operations, asynchronous I/O completion, [timer](timers.md) callbacks, registered wait operations, asynchronous method calls using delegates, and <xref:System.Net?displayProperty=nameWithType> socket connections.</span></span>  

## <a name="thread-pool-characteristics"></a><span data-ttu-id="491f7-108">Charakteristiky fondu vláken</span><span class="sxs-lookup"><span data-stu-id="491f7-108">Thread pool characteristics</span></span>

<span data-ttu-id="491f7-109">Vlákna fondu vláken jsou vlákna [na pozadí.](foreground-and-background-threads.md)</span><span class="sxs-lookup"><span data-stu-id="491f7-109">Thread pool threads are [background](foreground-and-background-threads.md) threads.</span></span> <span data-ttu-id="491f7-110">Každé vlákno používá výchozí velikost zásobníku, běží na výchozí prioritu a je v apartment s více vlákny.</span><span class="sxs-lookup"><span data-stu-id="491f7-110">Each thread uses the default stack size, runs at the default priority, and is in the multithreaded apartment.</span></span> <span data-ttu-id="491f7-111">Jakmile vlákno ve fondu vláken dokončí svůj úkol, vrátí se do fronty čekajících vláken.</span><span class="sxs-lookup"><span data-stu-id="491f7-111">Once a thread in the thread pool completes its task, it's returned to a queue of waiting threads.</span></span> <span data-ttu-id="491f7-112">Od této chvíle může být znovu použit.</span><span class="sxs-lookup"><span data-stu-id="491f7-112">From this moment it can be reused.</span></span> <span data-ttu-id="491f7-113">Toto opakované použití umožňuje aplikacím vyhnout se nákladům na vytvoření nového vlákna pro každý úkol.</span><span class="sxs-lookup"><span data-stu-id="491f7-113">This reuse enables applications to avoid the cost of creating a new thread for each task.</span></span>
  
<span data-ttu-id="491f7-114">Na každý proces existuje pouze jeden fond vláken.</span><span class="sxs-lookup"><span data-stu-id="491f7-114">There is only one thread pool per process.</span></span>  
  
### <a name="exceptions-in-thread-pool-threads"></a><span data-ttu-id="491f7-115">Výjimky ve vláknech fondu vláken</span><span class="sxs-lookup"><span data-stu-id="491f7-115">Exceptions in thread pool threads</span></span>

<span data-ttu-id="491f7-116">Neošetřené výjimky ve vláknech fondu vláken ukončí proces.</span><span class="sxs-lookup"><span data-stu-id="491f7-116">Unhandled exceptions in thread pool threads terminate the process.</span></span> <span data-ttu-id="491f7-117">Existují tři výjimky z tohoto pravidla:</span><span class="sxs-lookup"><span data-stu-id="491f7-117">There are three exceptions to this rule:</span></span>  
  
- <span data-ttu-id="491f7-118">A <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> je vyvolána ve vlákně fondu vláken, protože <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> byl volán.</span><span class="sxs-lookup"><span data-stu-id="491f7-118">A <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> is thrown in a thread pool thread because <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> was called.</span></span>  
- <span data-ttu-id="491f7-119">A <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> je vyvolána ve vlákně fondu vláken, protože doména aplikace je uvolněna.</span><span class="sxs-lookup"><span data-stu-id="491f7-119">A <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> is thrown in a thread pool thread because the application domain is being unloaded.</span></span>  
- <span data-ttu-id="491f7-120">Běžný jazyk runtime nebo hostitelský proces ukončí vlákno.</span><span class="sxs-lookup"><span data-stu-id="491f7-120">The common language runtime or a host process terminates the thread.</span></span>  
  
<span data-ttu-id="491f7-121">Další informace naleznete [v tématu Výjimky ve spravovaných vláknech](exceptions-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="491f7-121">For more information, see [Exceptions in Managed Threads](exceptions-in-managed-threads.md).</span></span>  
  
### <a name="maximum-number-of-thread-pool-threads"></a><span data-ttu-id="491f7-122">Maximální počet vláken fondu vláken</span><span class="sxs-lookup"><span data-stu-id="491f7-122">Maximum number of thread pool threads</span></span>

<span data-ttu-id="491f7-123">Počet operací, které mohou být zařazeny do fondu vláken, je omezen pouze dostupnou pamětí.</span><span class="sxs-lookup"><span data-stu-id="491f7-123">The number of operations that can be queued to the thread pool is limited only by available memory.</span></span> <span data-ttu-id="491f7-124">Fond vláken však omezuje počet podprocesů, které mohou být aktivní v procesu současně.</span><span class="sxs-lookup"><span data-stu-id="491f7-124">However, the thread pool limits the number of threads that can be active in the process simultaneously.</span></span> <span data-ttu-id="491f7-125">Pokud jsou všechna vlákna fondu vláken zaneprázdněna, další pracovní položky jsou zařazeny do fronty, dokud nebudou k dispozici vlákna k jejich spuštění.</span><span class="sxs-lookup"><span data-stu-id="491f7-125">If all thread pool threads are busy, additional work items are queued until threads to execute them become available.</span></span> <span data-ttu-id="491f7-126">Počínaje rozhraním .NET Framework 4 závisí výchozí velikost fondu vláken pro proces na několika faktorech, jako je například velikost virtuálního adresového prostoru.</span><span class="sxs-lookup"><span data-stu-id="491f7-126">Beginning with the .NET Framework 4, the default size of the thread pool for a process depends on several factors, such as the size of the virtual address space.</span></span> <span data-ttu-id="491f7-127">Proces může volat <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> metodu k určení počtu podprocesů.</span><span class="sxs-lookup"><span data-stu-id="491f7-127">A process can call the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> method to determine the number of threads.</span></span>  
  
<span data-ttu-id="491f7-128">Můžete řídit maximální počet podprocesů pomocí <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType> metody a.</span><span class="sxs-lookup"><span data-stu-id="491f7-128">You can control the maximum number of threads by using the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType> methods.</span></span>  

> [!NOTE]
> <span data-ttu-id="491f7-129">Kód, který je hostitelem běžného jazyka [`ICorThreadpool::CorSetMaxThreads`](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) runtime můžete nastavit velikost pomocí metody.</span><span class="sxs-lookup"><span data-stu-id="491f7-129">Code that hosts the common language runtime can set the size using the [`ICorThreadpool::CorSetMaxThreads`](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) method.</span></span>  
  
### <a name="thread-pool-minimums"></a><span data-ttu-id="491f7-130">Minima fondu vláken</span><span class="sxs-lookup"><span data-stu-id="491f7-130">Thread pool minimums</span></span>

<span data-ttu-id="491f7-131">Fond vláken poskytuje nová pracovní vlákna nebo vstupně-tova dokončení podprocesů na vyžádání, dokud nedosáhne zadaného minima pro každou kategorii.</span><span class="sxs-lookup"><span data-stu-id="491f7-131">The thread pool provides new worker threads or I/O completion threads on demand until it reaches a specified minimum for each category.</span></span> <span data-ttu-id="491f7-132">Metodu <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> můžete použít k získání těchto minimálních hodnot.</span><span class="sxs-lookup"><span data-stu-id="491f7-132">You can use the <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> method to obtain these minimum values.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="491f7-133">Pokud je poptávka nízká, skutečný počet vláken fondu vláken může klesnout pod minimální hodnoty.</span><span class="sxs-lookup"><span data-stu-id="491f7-133">When demand is low, the actual number of thread pool threads can fall below the minimum values.</span></span>  
  
<span data-ttu-id="491f7-134">Po dosažení minima fondu vláken můžete vytvořit další vlákna nebo počkat, až některé úkoly dokončit.</span><span class="sxs-lookup"><span data-stu-id="491f7-134">When a minimum is reached, the thread pool can create additional threads or wait until some tasks complete.</span></span> <span data-ttu-id="491f7-135">Počínaje rozhraním .NET Framework 4 vytvoří fond vláken a zničí pracovní vlákna za účelem optimalizace propustnost, která je definována jako počet úkolů, které se dokončí za jednotku času.</span><span class="sxs-lookup"><span data-stu-id="491f7-135">Beginning with the .NET Framework 4, the thread pool creates and destroys worker threads in order to optimize throughput, which is defined as the number of tasks that complete per unit of time.</span></span> <span data-ttu-id="491f7-136">Příliš málo podprocesů nemusí optimálně využívat dostupné prostředky, zatímco příliš mnoho podprocesů může zvýšit konflikty prostředků.</span><span class="sxs-lookup"><span data-stu-id="491f7-136">Too few threads might not make optimal use of available resources, whereas too many threads could increase resource contention.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="491f7-137">Metodu <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> můžete použít ke zvýšení minimálního počtu nečinných podprocesů.</span><span class="sxs-lookup"><span data-stu-id="491f7-137">You can use the <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> method to increase the minimum number of idle threads.</span></span> <span data-ttu-id="491f7-138">Zbytečně zvýšení těchto hodnot však může způsobit problémy s výkonem.</span><span class="sxs-lookup"><span data-stu-id="491f7-138">However, unnecessarily increasing these values can cause performance problems.</span></span> <span data-ttu-id="491f7-139">Pokud příliš mnoho úkolů spustit ve stejnou dobu, všechny z nich se může zdát být pomalé.</span><span class="sxs-lookup"><span data-stu-id="491f7-139">If too many tasks start at the same time, all of them might appear to be slow.</span></span> <span data-ttu-id="491f7-140">Ve většině případů bude fond vláken fungovat lépe s vlastním algoritmem pro přidělování vláken.</span><span class="sxs-lookup"><span data-stu-id="491f7-140">In most cases the thread pool will perform better with its own algorithm for allocating threads.</span></span>  

## <a name="using-the-thread-pool"></a><span data-ttu-id="491f7-141">Použití fondu vláken</span><span class="sxs-lookup"><span data-stu-id="491f7-141">Using the thread pool</span></span>

<span data-ttu-id="491f7-142">Počínaje rozhraním .NET Framework 4 je nejjednodušším způsobem použití fondu vláken použití [paralelní knihovny úloh (TPL).](../parallel-programming/task-parallel-library-tpl.md)</span><span class="sxs-lookup"><span data-stu-id="491f7-142">Beginning with the .NET Framework 4, the easiest way to use the thread pool is to use the [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span> <span data-ttu-id="491f7-143">Ve výchozím nastavení typy <xref:System.Threading.Tasks.Task> <xref:System.Threading.Tasks.Task%601> TPL jako a používají vlákna fondu vláken ke spuštění úloh.</span><span class="sxs-lookup"><span data-stu-id="491f7-143">By default, TPL types like <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> use thread pool threads to run tasks.</span></span>

<span data-ttu-id="491f7-144">Fond vláken můžete také použít <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> voláním ze [`ICorThreadpool::CorQueueUserWorkItem`](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) spravovaného kódu (nebo <xref:System.Threading.WaitCallback?displayProperty=nameWithType> z nespravovaného kódu) a předáním delegáta představujícího metodu, která provádí úlohu.</span><span class="sxs-lookup"><span data-stu-id="491f7-144">You can also use the thread pool by calling <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> from managed code (or [`ICorThreadpool::CorQueueUserWorkItem`](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) from unmanaged code) and passing a <xref:System.Threading.WaitCallback?displayProperty=nameWithType> delegate representing the method that performs the task.</span></span>

<span data-ttu-id="491f7-145">Dalším způsobem, jak použít fond vláken je fronty pracovních položek, <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> které souvisejí <xref:System.Threading.WaitHandle?displayProperty=nameWithType> s operace čekání pomocí metody a předání, které <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType> při signalizaci nebo při vynechání časového režimu volá metodu reprezentovanou delegátem.</span><span class="sxs-lookup"><span data-stu-id="491f7-145">Another way to use the thread pool is to queue work items that are related to a wait operation by using the <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> method and passing a <xref:System.Threading.WaitHandle?displayProperty=nameWithType> that, when signaled or when timed out, calls the method represented by the <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType> delegate.</span></span> <span data-ttu-id="491f7-146">Vlákna fondu vláken se používají k vyvolání metod zpětného volání.</span><span class="sxs-lookup"><span data-stu-id="491f7-146">Thread pool threads are used to invoke callback methods.</span></span>  

<span data-ttu-id="491f7-147">Příklady najdete na odkazovaných stránkách rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="491f7-147">For the examples, check the referenced API pages.</span></span>
  
## <a name="skipping-security-checks"></a><span data-ttu-id="491f7-148">Přeskočení bezpečnostních kontrol</span><span class="sxs-lookup"><span data-stu-id="491f7-148">Skipping security checks</span></span>

<span data-ttu-id="491f7-149">Fond vláken také <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> poskytuje <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType> a metody.</span><span class="sxs-lookup"><span data-stu-id="491f7-149">The thread pool also provides the <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="491f7-150">Tyto metody použijte pouze v případě, že jste si jisti, že zásobník volajícího je irelevantní pro všechny kontroly zabezpečení provedené během provádění úlohy ve frontě.</span><span class="sxs-lookup"><span data-stu-id="491f7-150">Use these methods only when you are certain that the caller's stack is irrelevant to any security checks performed during the execution of the queued task.</span></span> <span data-ttu-id="491f7-151"><xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType>a <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> oba zachytit zásobníku volajícího, který je sloučen do zásobníku podprocesu fondu vláken, když vlákno začne provádět úlohu.</span><span class="sxs-lookup"><span data-stu-id="491f7-151"><xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> both capture the caller's stack, which is merged into the stack of the thread pool thread when the thread begins to execute a task.</span></span> <span data-ttu-id="491f7-152">Pokud je vyžadována kontrola zabezpečení, musí být zkontrolován celý zásobník.</span><span class="sxs-lookup"><span data-stu-id="491f7-152">If a security check is required, the entire stack must be checked.</span></span> <span data-ttu-id="491f7-153">I když kontrola poskytuje bezpečnost, má také náklady na výkon.</span><span class="sxs-lookup"><span data-stu-id="491f7-153">Although the check provides safety, it also has a performance cost.</span></span>  

## <a name="when-not-to-use-thread-pool-threads"></a><span data-ttu-id="491f7-154">Pokud nelze použít vlákna fondu vláken</span><span class="sxs-lookup"><span data-stu-id="491f7-154">When not to use thread pool threads</span></span>

<span data-ttu-id="491f7-155">Existuje několik scénářů, ve kterých je vhodné vytvořit a spravovat vlastní vlákna namísto použití vláken fondu vláken:</span><span class="sxs-lookup"><span data-stu-id="491f7-155">There are several scenarios in which it's appropriate to create and manage your own threads instead of using thread pool threads:</span></span>  
  
- <span data-ttu-id="491f7-156">Vyžadujete vlákno v popředí.</span><span class="sxs-lookup"><span data-stu-id="491f7-156">You require a foreground thread.</span></span>  
- <span data-ttu-id="491f7-157">Chcete-li mít určitou prioritu, potřebujete vlákno.</span><span class="sxs-lookup"><span data-stu-id="491f7-157">You require a thread to have a particular priority.</span></span>  
- <span data-ttu-id="491f7-158">Máte úkoly, které způsobují vlákno blokovat po dlouhou dobu.</span><span class="sxs-lookup"><span data-stu-id="491f7-158">You have tasks that cause the thread to block for long periods of time.</span></span> <span data-ttu-id="491f7-159">Fond vláken má maximální počet vláken, takže velký počet blokovaných vláken fondu vláken může zabránit spuštění úloh.</span><span class="sxs-lookup"><span data-stu-id="491f7-159">The thread pool has a maximum number of threads, so a large number of blocked thread pool threads might prevent tasks from starting.</span></span>  
- <span data-ttu-id="491f7-160">Musíte umístit nitě do bytu s jedním závitem.</span><span class="sxs-lookup"><span data-stu-id="491f7-160">You need to place threads into a single-threaded apartment.</span></span> <span data-ttu-id="491f7-161">Všechny <xref:System.Threading.ThreadPool> nitě jsou v bytě s více závity.</span><span class="sxs-lookup"><span data-stu-id="491f7-161">All <xref:System.Threading.ThreadPool> threads are in the multithreaded apartment.</span></span>  
- <span data-ttu-id="491f7-162">Musíte mít stabilní identitu přidruženou k vláknu nebo vyhradit vlákno úkolu.</span><span class="sxs-lookup"><span data-stu-id="491f7-162">You need to have a stable identity associated with the thread, or to dedicate a thread to a task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="491f7-163">Viz také</span><span class="sxs-lookup"><span data-stu-id="491f7-163">See also</span></span>

- <xref:System.Threading.ThreadPool?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>
- [<span data-ttu-id="491f7-164">Task Parallel Library (TPL)</span><span class="sxs-lookup"><span data-stu-id="491f7-164">Task Parallel Library (TPL)</span></span>](../parallel-programming/task-parallel-library-tpl.md)
- [<span data-ttu-id="491f7-165">Postupy: Vrácení hodnoty z úlohy</span><span class="sxs-lookup"><span data-stu-id="491f7-165">How to: Return a Value from a Task</span></span>](../parallel-programming/how-to-return-a-value-from-a-task.md)
- [<span data-ttu-id="491f7-166">Objekty a prvky zřetězení</span><span class="sxs-lookup"><span data-stu-id="491f7-166">Threading Objects and Features</span></span>](threading-objects-and-features.md)
- [<span data-ttu-id="491f7-167">Vlákna a dělení na vlákna</span><span class="sxs-lookup"><span data-stu-id="491f7-167">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="491f7-168">Asynchronní I/O soubory</span><span class="sxs-lookup"><span data-stu-id="491f7-168">Asynchronous File I/O</span></span>](../io/asynchronous-file-i-o.md)
- [<span data-ttu-id="491f7-169">Časovače</span><span class="sxs-lookup"><span data-stu-id="491f7-169">Timers</span></span>](timers.md)
