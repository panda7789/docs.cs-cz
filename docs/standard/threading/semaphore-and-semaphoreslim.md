---
title: Semafor a SemaphoreSlim
description: Přečtěte si o semaforu & SemaphoreSlim. Semafor třídy je tenká Obálka kolem objektu semaforu Win32. Třída SemaphoreSlim je rychlý odlehčený semafor.
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- counting semaphores
- semaphores
- threading [.NET Framework], cross-process synchronization
- Semaphore class, about Semaphore class
- SemaphoreSlim class, about SemaphoreSlim class
- threading [.NET Framework], Semaphore class
ms.assetid: 7722a333-b974-47a2-a7c0-f09097fb644e
ms.openlocfilehash: 21f0d7e3fb446a7b750c45cfe8ef3f087a77888a
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 06/09/2020
ms.locfileid: "84600448"
---
# <a name="semaphore-and-semaphoreslim"></a><span data-ttu-id="e8e61-105">Semafor a SemaphoreSlim</span><span class="sxs-lookup"><span data-stu-id="e8e61-105">Semaphore and SemaphoreSlim</span></span>
<span data-ttu-id="e8e61-106"><xref:System.Threading.Semaphore?displayProperty=nameWithType>Třída představuje pojmenovaný (systémové) nebo místní semafor.</span><span class="sxs-lookup"><span data-stu-id="e8e61-106">The <xref:System.Threading.Semaphore?displayProperty=nameWithType> class represents a named (systemwide) or local semaphore.</span></span> <span data-ttu-id="e8e61-107">Je to tenké Obálka kolem objektu semaforu Win32.</span><span class="sxs-lookup"><span data-stu-id="e8e61-107">It is a thin wrapper around the Win32 semaphore object.</span></span> <span data-ttu-id="e8e61-108">Semafory Win32 počítají semafory, které je možné použít k řízení přístupu k fondu prostředků.</span><span class="sxs-lookup"><span data-stu-id="e8e61-108">Win32 semaphores are counting semaphores, which can be used to control access to a pool of resources.</span></span>  
  
 <span data-ttu-id="e8e61-109"><xref:System.Threading.SemaphoreSlim>Třída představuje odlehčený a rychlý semafor, který lze použít pro čekání v rámci jednoho procesu, pokud se očekává, že časy čekání budou velmi krátké.</span><span class="sxs-lookup"><span data-stu-id="e8e61-109">The <xref:System.Threading.SemaphoreSlim> class represents a lightweight, fast semaphore that can be used for waiting within a single process when wait times are expected to be very short.</span></span> <span data-ttu-id="e8e61-110"><xref:System.Threading.SemaphoreSlim>spoléhá co nejvíce na prvky synchronizace poskytované modulem CLR (Common Language Runtime).</span><span class="sxs-lookup"><span data-stu-id="e8e61-110"><xref:System.Threading.SemaphoreSlim> relies as much as possible on synchronization primitives provided by the common language runtime (CLR).</span></span> <span data-ttu-id="e8e61-111">Nicméně také poskytuje laxně vytvářená inicializovaných obslužných rutin na bázi jádra, které jsou potřeba pro podporu čekání na více semaforů.</span><span class="sxs-lookup"><span data-stu-id="e8e61-111">However, it also provides lazily initialized, kernel-based wait handles as necessary to support waiting on multiple semaphores.</span></span> <span data-ttu-id="e8e61-112"><xref:System.Threading.SemaphoreSlim>podporuje také použití tokenů zrušení, ale nepodporuje pojmenované semafory nebo použití popisovače čekání pro synchronizaci.</span><span class="sxs-lookup"><span data-stu-id="e8e61-112"><xref:System.Threading.SemaphoreSlim> also supports the use of cancellation tokens, but it does not support named semaphores or the use of a wait handle for synchronization.</span></span>  
  
## <a name="managing-a-limited-resource"></a><span data-ttu-id="e8e61-113">Správa omezeného prostředku</span><span class="sxs-lookup"><span data-stu-id="e8e61-113">Managing a Limited Resource</span></span>  
 <span data-ttu-id="e8e61-114">Vlákna vstupují semafor voláním <xref:System.Threading.WaitHandle.WaitOne%2A> metody, která je zděděna ze <xref:System.Threading.WaitHandle> třídy, v případě <xref:System.Threading.Semaphore?displayProperty=nameWithType> objektu nebo <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType> <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType> metody nebo, v případě <xref:System.Threading.SemaphoreSlim> objektu.</span><span class="sxs-lookup"><span data-stu-id="e8e61-114">Threads enter the semaphore by calling the <xref:System.Threading.WaitHandle.WaitOne%2A> method, which is inherited from the <xref:System.Threading.WaitHandle> class, in the case of a <xref:System.Threading.Semaphore?displayProperty=nameWithType> object, or the <xref:System.Threading.SemaphoreSlim.Wait%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.WaitAsync%2A?displayProperty=nameWithType> method, in the case of a <xref:System.Threading.SemaphoreSlim> object.</span></span> <span data-ttu-id="e8e61-115">Když se volání vrátí, bude snížen počet semaforu.</span><span class="sxs-lookup"><span data-stu-id="e8e61-115">When the call returns, the count on the semaphore is decremented.</span></span> <span data-ttu-id="e8e61-116">V případě, že je položka žádosti o vlákno a počet rovna nule, vlákno blokuje.</span><span class="sxs-lookup"><span data-stu-id="e8e61-116">When a thread requests entry and the count is zero, the thread blocks.</span></span> <span data-ttu-id="e8e61-117">Jak vlákna uvolní semafor voláním <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType> <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> metody nebo, jsou povoleny blokované vlákna.</span><span class="sxs-lookup"><span data-stu-id="e8e61-117">As threads release the semaphore by calling the <xref:System.Threading.Semaphore.Release%2A?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> method, blocked threads are allowed to enter.</span></span> <span data-ttu-id="e8e61-118">Neexistuje žádné zaručené pořadí, například First-in, First-out (FIFO) nebo Last-in a First-out (LIFO) pro zablokované vlákno pro vstup do semaforu.</span><span class="sxs-lookup"><span data-stu-id="e8e61-118">There is no guaranteed order, such as first-in, first-out (FIFO) or last-in, first-out (LIFO), for blocked threads to enter the semaphore.</span></span>  
  
 <span data-ttu-id="e8e61-119">Vlákno může vstup semaforu víckrát zadat voláním <xref:System.Threading.Semaphore?displayProperty=nameWithType> <xref:System.Threading.WaitHandle.WaitOne%2A> metody objektu nebo <xref:System.Threading.SemaphoreSlim> <xref:System.Threading.SemaphoreSlim.Wait%2A> opakované metody objektu.</span><span class="sxs-lookup"><span data-stu-id="e8e61-119">A thread can enter the semaphore multiple times by calling the <xref:System.Threading.Semaphore?displayProperty=nameWithType> object's <xref:System.Threading.WaitHandle.WaitOne%2A> method or the  <xref:System.Threading.SemaphoreSlim> object's <xref:System.Threading.SemaphoreSlim.Wait%2A> method repeatedly.</span></span> <span data-ttu-id="e8e61-120">Chcete-li uvolnit semafor, vlákno může buď zavolat <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType> metodu nebo <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType> přetížení metody, nebo volat <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType> <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType> přetížení metody nebo a zadat počet položek, které budou uvolněny.</span><span class="sxs-lookup"><span data-stu-id="e8e61-120">To release the semaphore, the thread can either call the <xref:System.Threading.Semaphore.Release?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release?displayProperty=nameWithType> method overload the same number of times, or call the <xref:System.Threading.Semaphore.Release%28System.Int32%29?displayProperty=nameWithType> or <xref:System.Threading.SemaphoreSlim.Release%28System.Int32%29?displayProperty=nameWithType> method overload and specify the number of entries to be released.</span></span>  
  
### <a name="semaphores-and-thread-identity"></a><span data-ttu-id="e8e61-121">Semafory a identita vlákna</span><span class="sxs-lookup"><span data-stu-id="e8e61-121">Semaphores and Thread Identity</span></span>  
 <span data-ttu-id="e8e61-122">Tyto dva typy semaforu vynutily identitu vlákna při volání <xref:System.Threading.WaitHandle.WaitOne%2A> <xref:System.Threading.SemaphoreSlim.Wait%2A> metod,, <xref:System.Threading.Semaphore.Release%2A> a <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="e8e61-122">The two semaphore types do not enforce thread identity on calls to the <xref:System.Threading.WaitHandle.WaitOne%2A>, <xref:System.Threading.SemaphoreSlim.Wait%2A>, <xref:System.Threading.Semaphore.Release%2A>, and <xref:System.Threading.SemaphoreSlim.Release%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="e8e61-123">Například běžný scénář použití pro semafory zahrnuje vlákno producenta a uživatelské vlákno, přičemž jedno vlákno vždy zvyšuje počet semaforu a druhý vždy snižuje.</span><span class="sxs-lookup"><span data-stu-id="e8e61-123">For example, a common usage scenario for semaphores involves a producer thread and a consumer thread, with one thread always incrementing the semaphore count and the other always decrementing it.</span></span>  
  
 <span data-ttu-id="e8e61-124">Je zodpovědností programátora, aby bylo zajištěno, že vlákno neuvolní semafor příliš mnohokrát.</span><span class="sxs-lookup"><span data-stu-id="e8e61-124">It is the programmer's responsibility to ensure that a thread does not release the semaphore too many times.</span></span> <span data-ttu-id="e8e61-125">Předpokládejme například, že semafor má maximální počet dvou a že vlákno a a vlákno B zadávají semafor.</span><span class="sxs-lookup"><span data-stu-id="e8e61-125">For example, suppose a semaphore has a maximum count of two, and that thread A and thread B both enter the semaphore.</span></span> <span data-ttu-id="e8e61-126">Pokud chyba programátora v vláknu B způsobí, že volání `Release` proběhne dvakrát, obě volání budou úspěšná.</span><span class="sxs-lookup"><span data-stu-id="e8e61-126">If a programming error in thread B causes it to call  `Release` twice, both calls succeed.</span></span> <span data-ttu-id="e8e61-127">Počet v semaforu je plný a když vlákno A nakonec volá `Release` , <xref:System.Threading.SemaphoreFullException> je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="e8e61-127">The count on the semaphore is full, and when thread A eventually calls `Release`, a <xref:System.Threading.SemaphoreFullException> is thrown.</span></span>  
  
## <a name="named-semaphores"></a><span data-ttu-id="e8e61-128">Pojmenované semafory</span><span class="sxs-lookup"><span data-stu-id="e8e61-128">Named Semaphores</span></span>  
 <span data-ttu-id="e8e61-129">Operační systém Windows umožňuje semaforům mít názvy.</span><span class="sxs-lookup"><span data-stu-id="e8e61-129">The Windows operating system allows semaphores to have names.</span></span> <span data-ttu-id="e8e61-130">Pojmenovaný semafor je napříč systémem.</span><span class="sxs-lookup"><span data-stu-id="e8e61-130">A named semaphore is system wide.</span></span> <span data-ttu-id="e8e61-131">To znamená, že jakmile je pojmenovaný semafor vytvořen, je viditelný pro všechna vlákna ve všech procesech.</span><span class="sxs-lookup"><span data-stu-id="e8e61-131">That is, once the named semaphore is created, it is visible to all threads in all processes.</span></span> <span data-ttu-id="e8e61-132">Pojmenovaný semafor se proto dá použít k synchronizaci aktivit procesů i vláken.</span><span class="sxs-lookup"><span data-stu-id="e8e61-132">Thus, named semaphore can be used to synchronize the activities of processes as well as threads.</span></span>  
  
 <span data-ttu-id="e8e61-133">Můžete vytvořit <xref:System.Threading.Semaphore> objekt, který představuje pojmenovaný systémový semafor pomocí jednoho z konstruktorů, které určují název.</span><span class="sxs-lookup"><span data-stu-id="e8e61-133">You can create a <xref:System.Threading.Semaphore> object that represents a named system semaphore by using one of the constructors that specifies a name.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="e8e61-134">Vzhledem k tomu, že pojmenované semafory jsou napříč systémem, je možné mít více <xref:System.Threading.Semaphore> objektů, které představují stejný pojmenovaný semafor.</span><span class="sxs-lookup"><span data-stu-id="e8e61-134">Because named semaphores are system wide, it is possible to have multiple <xref:System.Threading.Semaphore> objects that represent the same named semaphore.</span></span> <span data-ttu-id="e8e61-135">Pokaždé, když zavoláte konstruktor nebo <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType> metodu, vytvoří <xref:System.Threading.Semaphore> se nový objekt.</span><span class="sxs-lookup"><span data-stu-id="e8e61-135">Each time you call a constructor or the <xref:System.Threading.Semaphore.OpenExisting%2A?displayProperty=nameWithType> method, a new <xref:System.Threading.Semaphore> object is created.</span></span> <span data-ttu-id="e8e61-136">Zadáním stejného názvu opakovaně vytvoříte více objektů, které reprezentují stejný pojmenovaný semafor.</span><span class="sxs-lookup"><span data-stu-id="e8e61-136">Specifying the same name repeatedly creates multiple objects that represent the same named semaphore.</span></span>  
  
 <span data-ttu-id="e8e61-137">Buďte opatrní při použití pojmenovaných semaforů.</span><span class="sxs-lookup"><span data-stu-id="e8e61-137">Be careful when you use named semaphores.</span></span> <span data-ttu-id="e8e61-138">Vzhledem k tomu, že se jedná o systém, může váš semafor neočekávaně zadat jiný proces, který používá stejný název.</span><span class="sxs-lookup"><span data-stu-id="e8e61-138">Because they are system wide, another process that uses the same name can enter your semaphore unexpectedly.</span></span> <span data-ttu-id="e8e61-139">Škodlivý kód spuštěný ve stejném počítači může použít tento způsob útoku DOS (Denial of Service).</span><span class="sxs-lookup"><span data-stu-id="e8e61-139">Malicious code executing on the same computer could use this as the basis of a denial-of-service attack.</span></span>  
  
 <span data-ttu-id="e8e61-140">Použijte zabezpečení řízení přístupu k ochraně <xref:System.Threading.Semaphore> objektu, který představuje pojmenovaný semafor, nejlépe pomocí konstruktoru, který určuje <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType> objekt.</span><span class="sxs-lookup"><span data-stu-id="e8e61-140">Use access control security to protect a <xref:System.Threading.Semaphore> object that represents a named semaphore, preferably by using a constructor that specifies a <xref:System.Security.AccessControl.SemaphoreSecurity?displayProperty=nameWithType> object.</span></span> <span data-ttu-id="e8e61-141">Můžete také použít zabezpečení řízení přístupu pomocí <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType> metody, ale to zachová okno chyby zabezpečení mezi časem vytvoření semaforu a časem, který je chráněn.</span><span class="sxs-lookup"><span data-stu-id="e8e61-141">You can also apply access control security using the <xref:System.Threading.Semaphore.SetAccessControl%2A?displayProperty=nameWithType> method, but this leaves a window of vulnerability between the time the semaphore is created and the time it is protected.</span></span> <span data-ttu-id="e8e61-142">Ochrana semaforů pomocí zabezpečení řízení přístupu pomáhá zabránit škodlivým útokům, ale neřeší problém kolizí neúmyslného názvu.</span><span class="sxs-lookup"><span data-stu-id="e8e61-142">Protecting semaphores with access control security helps prevent malicious attacks, but does not solve the problem of unintentional name collisions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e8e61-143">Viz také</span><span class="sxs-lookup"><span data-stu-id="e8e61-143">See also</span></span>

- <xref:System.Threading.Semaphore>
- <xref:System.Threading.SemaphoreSlim>
- [<span data-ttu-id="e8e61-144">Dělení objektů a funkcí</span><span class="sxs-lookup"><span data-stu-id="e8e61-144">Threading Objects and Features</span></span>](threading-objects-and-features.md)
