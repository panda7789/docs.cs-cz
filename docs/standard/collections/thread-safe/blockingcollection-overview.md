---
title: BlockingCollection – přehled
description: Přečtěte si o blokující <T> kolekci, třídy kolekce bezpečné pro přístup z více vláken v rozhraní .NET. Tato třída nabízí funkce, jako je souběžné přidávání & přebírání položek z mnoha vláken.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- BlockingCollection, overview
ms.assetid: 987ea3d7-0ad5-4238-8b64-331ce4eb3f0b
ms.openlocfilehash: fc11f6c28a551e56d3bac4c5be9c08a396c0c6b1
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 06/09/2020
ms.locfileid: "84600799"
---
# <a name="blockingcollection-overview"></a><span data-ttu-id="2bf5b-104">BlockingCollection – přehled</span><span class="sxs-lookup"><span data-stu-id="2bf5b-104">BlockingCollection Overview</span></span>
<span data-ttu-id="2bf5b-105"><xref:System.Collections.Concurrent.BlockingCollection%601>je třída kolekce bezpečná pro přístup z více vláken, která poskytuje následující funkce:</span><span class="sxs-lookup"><span data-stu-id="2bf5b-105"><xref:System.Collections.Concurrent.BlockingCollection%601> is a thread-safe collection class that provides the following features:</span></span>  
  
- <span data-ttu-id="2bf5b-106">Implementace vzoru producent-příjemce.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-106">An implementation of the Producer-Consumer pattern.</span></span>  
  
- <span data-ttu-id="2bf5b-107">Souběžné přidávání a přebírání položek z více vláken.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-107">Concurrent adding and taking of items from multiple threads.</span></span>  
  
- <span data-ttu-id="2bf5b-108">Volitelná maximální kapacita</span><span class="sxs-lookup"><span data-stu-id="2bf5b-108">Optional maximum capacity.</span></span>  
  
- <span data-ttu-id="2bf5b-109">Operace vložení a odebrání, které blokují, když je kolekce prázdná nebo plná</span><span class="sxs-lookup"><span data-stu-id="2bf5b-109">Insertion and removal operations that block when collection is empty or full.</span></span>  
  
- <span data-ttu-id="2bf5b-110">Vložení a odebrání operací "Try", které neblokují nebo zablokují do zadaného časového období.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-110">Insertion and removal "try" operations that do not block or that block up to a specified period of time.</span></span>  
  
- <span data-ttu-id="2bf5b-111">Zapouzdřuje libovolný typ kolekce, který implementuje<xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span><span class="sxs-lookup"><span data-stu-id="2bf5b-111">Encapsulates any collection type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span></span>  
  
- <span data-ttu-id="2bf5b-112">Zrušení s tokeny zrušení</span><span class="sxs-lookup"><span data-stu-id="2bf5b-112">Cancellation with cancellation tokens.</span></span>  
  
- <span data-ttu-id="2bf5b-113">Dva druhy výčtu s `foreach` ( `For Each` v Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="2bf5b-113">Two kinds of enumeration with `foreach` (`For Each` in Visual Basic):</span></span>  
  
    1. <span data-ttu-id="2bf5b-114">Výčet jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-114">Read-only enumeration.</span></span>  
  
    2. <span data-ttu-id="2bf5b-115">Výčet, který odebere položky při vytváření výčtu.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-115">Enumeration that removes items as they are enumerated.</span></span>  
  
## <a name="bounding-and-blocking-support"></a><span data-ttu-id="2bf5b-116">Podpora ohraničování a blokování</span><span class="sxs-lookup"><span data-stu-id="2bf5b-116">Bounding and Blocking Support</span></span>  
 <span data-ttu-id="2bf5b-117"><xref:System.Collections.Concurrent.BlockingCollection%601>podporuje ohraničování a blokování.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-117"><xref:System.Collections.Concurrent.BlockingCollection%601> supports bounding and blocking.</span></span> <span data-ttu-id="2bf5b-118">Ohraničování znamená, že můžete nastavit maximální kapacitu kolekce.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-118">Bounding means you can set the maximum capacity of the collection.</span></span> <span data-ttu-id="2bf5b-119">Ohraničování je důležité v určitých situacích, protože umožňuje řídit maximální velikost kolekce v paměti a brání v tom, aby vyráběná vlákna byla přetažena příliš daleko před náročnými vlákny.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-119">Bounding is important in certain scenarios because it enables you to control the maximum size of the collection in memory, and it prevents the producing threads from moving too far ahead of the consuming threads.</span></span>  
  
 <span data-ttu-id="2bf5b-120">Více vláken nebo úkolů může do kolekce současně přidávat položky a pokud kolekce dosáhne zadané maximální kapacity, výrobní vlákna zablokuje, dokud nebude položka odebrána.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-120">Multiple threads or tasks can add items to the collection concurrently, and if the collection reaches its specified maximum capacity, the producing threads will block until an item is removed.</span></span> <span data-ttu-id="2bf5b-121">Více příjemců může odebírat položky souběžně, a pokud je kolekce prázdná, budou spotřebovávat vlákna zablokovat, dokud producent nepřidá položku.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-121">Multiple consumers can remove items concurrently, and if the collection becomes empty, the consuming threads will block until a producer adds an item.</span></span> <span data-ttu-id="2bf5b-122">Produkující vlákno může zavolat <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> , aby označovalo, že nebudou přidány žádné další položky.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-122">A producing thread can call <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> to indicate that no more items will be added.</span></span> <span data-ttu-id="2bf5b-123">Příjemci monitorují <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> vlastnost, aby věděli, že je kolekce prázdná a nepřidaly se žádné další položky.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-123">Consumers monitor the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property to know when the collection is empty and no more items will be added.</span></span> <span data-ttu-id="2bf5b-124">Následující příklad ukazuje jednoduchou Blokujícícollection s ohraničenou kapacitou 100.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-124">The following example shows a simple BlockingCollection with a bounded capacity of 100.</span></span> <span data-ttu-id="2bf5b-125">Úkol výrobce přidá položky do kolekce, pokud je některá externí podmínka pravdivá a pak volá <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> .</span><span class="sxs-lookup"><span data-stu-id="2bf5b-125">A producer task adds items to the collection as long as some external condition is true, and then calls <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span></span> <span data-ttu-id="2bf5b-126">Úkol příjemce přijímá položky, dokud vlastnost nevrátí <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-126">The consumer task takes items until the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property is true.</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#04)]
 [!code-vb[CDS_BlockingCollection#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#04)]  
  
 <span data-ttu-id="2bf5b-127">Úplný příklad naleznete v tématu [How to: Add and přebírat Items from a BlockingCollection](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="2bf5b-127">For a complete example, see [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="timed-blocking-operations"></a><span data-ttu-id="2bf5b-128">Časované operace blokování</span><span class="sxs-lookup"><span data-stu-id="2bf5b-128">Timed Blocking Operations</span></span>  
 <span data-ttu-id="2bf5b-129">V případě časovaného blokování <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> a <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operací u ohraničených kolekcí se metoda pokusí přidat nebo převzít položku.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-129">In timed blocking <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operations on bounded collections, the method tries to add or take an item.</span></span> <span data-ttu-id="2bf5b-130">Pokud je položka k dispozici, je umístěna do proměnné, která byla předána odkazem, a metoda vrátí hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-130">If an item is available it is placed into the variable that was passed in by reference, and the method returns true.</span></span> <span data-ttu-id="2bf5b-131">Pokud po zadaném časovém limitu není načtena žádná položka, vrátí metoda hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-131">If no item is retrieved after a specified time-out period the method returns false.</span></span> <span data-ttu-id="2bf5b-132">Vlákno je pak zdarma, aby před dalším pokusem o přístup k této kolekci provede nějakou další užitečnou práci.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-132">The thread is then free to do some other useful work before trying again to access the collection.</span></span> <span data-ttu-id="2bf5b-133">Příklad časovaného blokování přístupu naleznete v druhém příkladu v tématu [Postupy: Přidání a převzetí položek jednotlivě z blokující kolekce](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="2bf5b-133">For an example of timed blocking access, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="cancelling-add-and-take-operations"></a><span data-ttu-id="2bf5b-134">Rušení přidání a provedení operací</span><span class="sxs-lookup"><span data-stu-id="2bf5b-134">Cancelling Add and Take Operations</span></span>  
 <span data-ttu-id="2bf5b-135">Operace přidání a provedení operací se obvykle provádějí ve smyčce.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-135">Add and Take operations are typically performed in a loop.</span></span> <span data-ttu-id="2bf5b-136">Smyčku můžete zrušit předáním do <xref:System.Threading.CancellationToken> <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> metody nebo a následnou kontrolou hodnoty vlastnosti tokenu <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> u každé iterace.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-136">You can cancel a loop by passing in a <xref:System.Threading.CancellationToken> to the <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> or <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> method, and then checking the value of the token's <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on each iteration.</span></span> <span data-ttu-id="2bf5b-137">Pokud je hodnota true, pak je až na to, abyste odpověděli na žádost o zrušení vyčištěním všech prostředků a ukončením smyčky.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-137">If the value is true, then it is up to you to respond the cancellation request by cleaning up any resources and exiting the loop.</span></span> <span data-ttu-id="2bf5b-138">Následující příklad ukazuje přetížení <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> , které přijímá token zrušení a kód, který ho používá:</span><span class="sxs-lookup"><span data-stu-id="2bf5b-138">The following example shows an overload of <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> that takes a cancellation token, and the code that uses it:</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#05](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#05)]
 [!code-vb[CDS_BlockingCollection#05](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#05)]  
  
 <span data-ttu-id="2bf5b-139">Příklad, jak přidat podporu zrušení, naleznete v druhém příkladu v tématu [Postupy: Přidání a převzetí položek jednotlivě z blokující kolekce](how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="2bf5b-139">For an example of how to add cancellation support, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](how-to-add-and-take-items.md).</span></span>  
  
## <a name="specifying-the-collection-type"></a><span data-ttu-id="2bf5b-140">Určení typu kolekce</span><span class="sxs-lookup"><span data-stu-id="2bf5b-140">Specifying the Collection Type</span></span>  
 <span data-ttu-id="2bf5b-141">Když vytvoříte <xref:System.Collections.Concurrent.BlockingCollection%601> , můžete zadat nejen ohraničenou kapacitu, ale také typ kolekce, která se má použít.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-141">When you create a <xref:System.Collections.Concurrent.BlockingCollection%601>, you can specify not only the bounded capacity but also the type of collection to use.</span></span> <span data-ttu-id="2bf5b-142">Můžete například určit, že se má použít jako <xref:System.Collections.Concurrent.ConcurrentQueue%601> první (in-first out), nebo <xref:System.Collections.Concurrent.ConcurrentStack%601> pro chování Last in-first out (LIFO).</span><span class="sxs-lookup"><span data-stu-id="2bf5b-142">For example, you could specify a <xref:System.Collections.Concurrent.ConcurrentQueue%601> for first in-first out (FIFO) behavior, or a <xref:System.Collections.Concurrent.ConcurrentStack%601> for last in-first out (LIFO) behavior.</span></span> <span data-ttu-id="2bf5b-143">Můžete použít libovolnou třídu kolekce, která implementuje <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-143">You can use any collection class that implements the <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interface.</span></span> <span data-ttu-id="2bf5b-144">Výchozí typ kolekce pro <xref:System.Collections.Concurrent.BlockingCollection%601> je <xref:System.Collections.Concurrent.ConcurrentQueue%601> .</span><span class="sxs-lookup"><span data-stu-id="2bf5b-144">The default collection type for <xref:System.Collections.Concurrent.BlockingCollection%601> is <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span></span> <span data-ttu-id="2bf5b-145">Následující příklad kódu ukazuje, jak vytvořit řetězce s <xref:System.Collections.Concurrent.BlockingCollection%601> kapacitou 1000 a používá <xref:System.Collections.Concurrent.ConcurrentBag%601> :</span><span class="sxs-lookup"><span data-stu-id="2bf5b-145">The following code example shows how to create a <xref:System.Collections.Concurrent.BlockingCollection%601> of strings that has a capacity of 1000 and uses a <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span></span>  
  
```vb  
Dim bc = New BlockingCollection(Of String)(New ConcurrentBag(Of String()), 1000)  
```  
  
```csharp  
BlockingCollection<string> bc = new BlockingCollection<string>(new ConcurrentBag<string>(), 1000 );  
```  
  
 <span data-ttu-id="2bf5b-146">Další informace najdete v tématu [Postup: Přidání ohraničování a blokování funkcí do kolekce](how-to-add-bounding-and-blocking.md).</span><span class="sxs-lookup"><span data-stu-id="2bf5b-146">For more information, see [How to: Add Bounding and Blocking Functionality to a Collection](how-to-add-bounding-and-blocking.md).</span></span>  
  
## <a name="ienumerable-support"></a><span data-ttu-id="2bf5b-147">Podpora IEnumerable</span><span class="sxs-lookup"><span data-stu-id="2bf5b-147">IEnumerable Support</span></span>  
 <span data-ttu-id="2bf5b-148"><xref:System.Collections.Concurrent.BlockingCollection%601>poskytuje <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> metodu, která umožňuje příjemcům použít `foreach` ( `For Each` v Visual Basic) k odebrání položek do doby, než je kolekce dokončena, což znamená, že je prázdná a nebudou přidány žádné další položky.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-148"><xref:System.Collections.Concurrent.BlockingCollection%601> provides a <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> method that enables consumers to use `foreach` (`For Each` in Visual Basic) to remove items until the collection is completed, which means it is empty and no more items will be added.</span></span> <span data-ttu-id="2bf5b-149">Další informace naleznete v tématu [Postupy: použití příkazu foreach k odebrání položek v blokujícícollection](how-to-use-foreach-to-remove.md).</span><span class="sxs-lookup"><span data-stu-id="2bf5b-149">For more information, see [How to: Use ForEach to Remove Items in a BlockingCollection](how-to-use-foreach-to-remove.md).</span></span>  
  
## <a name="using-many-blockingcollections-as-one"></a><span data-ttu-id="2bf5b-150">Použití mnoha BlockingCollections jako jednoho</span><span class="sxs-lookup"><span data-stu-id="2bf5b-150">Using Many BlockingCollections As One</span></span>  
 <span data-ttu-id="2bf5b-151">Pro scénáře, ve kterých musí příjemce převzít položky z více kolekcí současně, můžete vytvořit pole <xref:System.Collections.Concurrent.BlockingCollection%601> a použít statické metody, jako například <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> a <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> , které budou přidány nebo přebírat ze všech kolekcí v poli.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-151">For scenarios in which a consumer needs to take items from multiple collections simultaneously, you can create arrays of <xref:System.Collections.Concurrent.BlockingCollection%601> and use the static methods such as <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> that will add to or take from any of the collections in the array.</span></span> <span data-ttu-id="2bf5b-152">Pokud je jedna kolekce blokována, metoda se okamžitě pokusí o další, dokud nenajde tu, která může provést operaci.</span><span class="sxs-lookup"><span data-stu-id="2bf5b-152">If one collection is blocking, the method immediately tries another until it finds one that can perform the operation.</span></span> <span data-ttu-id="2bf5b-153">Další informace najdete v tématu [How to: use Arrays Blocking Collections in a Pipeline](how-to-use-arrays-of-blockingcollections.md).</span><span class="sxs-lookup"><span data-stu-id="2bf5b-153">For more information, see [How to: Use Arrays of Blocking Collections in a Pipeline](how-to-use-arrays-of-blockingcollections.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="2bf5b-154">Viz také</span><span class="sxs-lookup"><span data-stu-id="2bf5b-154">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>
- [<span data-ttu-id="2bf5b-155">Kolekce a datové struktury</span><span class="sxs-lookup"><span data-stu-id="2bf5b-155">Collections and Data Structures</span></span>](../index.md)
- [<span data-ttu-id="2bf5b-156">Kolekce bezpečné pro přístup z více vláken</span><span class="sxs-lookup"><span data-stu-id="2bf5b-156">Thread-Safe Collections</span></span>](index.md)
