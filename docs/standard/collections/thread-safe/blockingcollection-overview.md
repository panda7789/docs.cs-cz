---
title: BlockingCollection – přehled
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- BlockingCollection, overview
ms.assetid: 987ea3d7-0ad5-4238-8b64-331ce4eb3f0b
ms.openlocfilehash: fb01d29c723962e28d8ec4afc984cb4d6c48f9b5
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/15/2020
ms.locfileid: "75711321"
---
# <a name="blockingcollection-overview"></a><span data-ttu-id="bc024-102">BlockingCollection – přehled</span><span class="sxs-lookup"><span data-stu-id="bc024-102">BlockingCollection Overview</span></span>
<span data-ttu-id="bc024-103"><xref:System.Collections.Concurrent.BlockingCollection%601>je třída kolekce bezpečná pro přístup z více vláken, která poskytuje následující funkce:</span><span class="sxs-lookup"><span data-stu-id="bc024-103"><xref:System.Collections.Concurrent.BlockingCollection%601> is a thread-safe collection class that provides the following features:</span></span>  
  
- <span data-ttu-id="bc024-104">Implementace vzoru výrobce a spotřebitele.</span><span class="sxs-lookup"><span data-stu-id="bc024-104">An implementation of the Producer-Consumer pattern.</span></span>  
  
- <span data-ttu-id="bc024-105">Souběžné přidávání a přijímání položek z více vláken.</span><span class="sxs-lookup"><span data-stu-id="bc024-105">Concurrent adding and taking of items from multiple threads.</span></span>  
  
- <span data-ttu-id="bc024-106">Volitelná maximální kapacita.</span><span class="sxs-lookup"><span data-stu-id="bc024-106">Optional maximum capacity.</span></span>  
  
- <span data-ttu-id="bc024-107">Operace vkládání a odebrání, které blokují, když je kolekce prázdná nebo plná.</span><span class="sxs-lookup"><span data-stu-id="bc024-107">Insertion and removal operations that block when collection is empty or full.</span></span>  
  
- <span data-ttu-id="bc024-108">Vložení a odebrání "zkuste" operace, které neblokují nebo které blokují až do zadaného časového období.</span><span class="sxs-lookup"><span data-stu-id="bc024-108">Insertion and removal "try" operations that do not block or that block up to a specified period of time.</span></span>  
  
- <span data-ttu-id="bc024-109">Zapouzdřuje libovolný typ kolekce, který implementuje<xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span><span class="sxs-lookup"><span data-stu-id="bc024-109">Encapsulates any collection type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span></span>  
  
- <span data-ttu-id="bc024-110">Zrušení s tokeny zrušení.</span><span class="sxs-lookup"><span data-stu-id="bc024-110">Cancellation with cancellation tokens.</span></span>  
  
- <span data-ttu-id="bc024-111">Dva druhy výčtu `foreach` `For Each` s ( v jazyce Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="bc024-111">Two kinds of enumeration with `foreach` (`For Each` in Visual Basic):</span></span>  
  
    1. <span data-ttu-id="bc024-112">Výčet jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="bc024-112">Read-only enumeration.</span></span>  
  
    2. <span data-ttu-id="bc024-113">Výčet, který odebere položky, jak jsou uvedeny.</span><span class="sxs-lookup"><span data-stu-id="bc024-113">Enumeration that removes items as they are enumerated.</span></span>  
  
## <a name="bounding-and-blocking-support"></a><span data-ttu-id="bc024-114">Podpora ohraničování a blokování</span><span class="sxs-lookup"><span data-stu-id="bc024-114">Bounding and Blocking Support</span></span>  
 <span data-ttu-id="bc024-115"><xref:System.Collections.Concurrent.BlockingCollection%601>podporuje ohraničování a blokování.</span><span class="sxs-lookup"><span data-stu-id="bc024-115"><xref:System.Collections.Concurrent.BlockingCollection%601> supports bounding and blocking.</span></span> <span data-ttu-id="bc024-116">Ohraničující znamená, že můžete nastavit maximální kapacitu kolekce.</span><span class="sxs-lookup"><span data-stu-id="bc024-116">Bounding means you can set the maximum capacity of the collection.</span></span> <span data-ttu-id="bc024-117">Ohraničování je důležité v určitých scénářích, protože umožňuje řídit maximální velikost kolekce v paměti a zabraňuje vytváření podprocesů z přesunutí příliš daleko před náročné podprocesů.</span><span class="sxs-lookup"><span data-stu-id="bc024-117">Bounding is important in certain scenarios because it enables you to control the maximum size of the collection in memory, and it prevents the producing threads from moving too far ahead of the consuming threads.</span></span>  
  
 <span data-ttu-id="bc024-118">Více podprocesů nebo úkolů můžete přidat položky do kolekce souběžně a pokud kolekce dosáhne své zadané maximální kapacitu, bude produkovat podprocesů blokovat, dokud je odebrána položka.</span><span class="sxs-lookup"><span data-stu-id="bc024-118">Multiple threads or tasks can add items to the collection concurrently, and if the collection reaches its specified maximum capacity, the producing threads will block until an item is removed.</span></span> <span data-ttu-id="bc024-119">Více spotřebitelů můžete odebrat položky současně a pokud kolekce stane prázdný, náročné podprocesy bude blokovat, dokud výrobce přidá položku.</span><span class="sxs-lookup"><span data-stu-id="bc024-119">Multiple consumers can remove items concurrently, and if the collection becomes empty, the consuming threads will block until a producer adds an item.</span></span> <span data-ttu-id="bc024-120">Produkující vlákno může <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> volat označující, že nebudou přidány žádné další položky.</span><span class="sxs-lookup"><span data-stu-id="bc024-120">A producing thread can call <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> to indicate that no more items will be added.</span></span> <span data-ttu-id="bc024-121">Spotřebitelé sledovat <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> vlastnost vědět, kdy je prázdná kolekce a žádné další položky budou přidány.</span><span class="sxs-lookup"><span data-stu-id="bc024-121">Consumers monitor the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property to know when the collection is empty and no more items will be added.</span></span> <span data-ttu-id="bc024-122">Následující příklad ukazuje jednoduchý BlockingCollection s ohraničenou kapacitou 100.</span><span class="sxs-lookup"><span data-stu-id="bc024-122">The following example shows a simple BlockingCollection with a bounded capacity of 100.</span></span> <span data-ttu-id="bc024-123">Úloha výrobce přidá položky do kolekce tak dlouho, dokud <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>některé externí podmínku je true a potom volání .</span><span class="sxs-lookup"><span data-stu-id="bc024-123">A producer task adds items to the collection as long as some external condition is true, and then calls <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span></span> <span data-ttu-id="bc024-124">Úloha příjemce trvá <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> položky, dokud je vlastnost true.</span><span class="sxs-lookup"><span data-stu-id="bc024-124">The consumer task takes items until the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property is true.</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#04)]
 [!code-vb[CDS_BlockingCollection#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#04)]  
  
 <span data-ttu-id="bc024-125">Úplný příklad najdete v [tématu Jak: Přidat a přijmout položky jednotlivě z BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="bc024-125">For a complete example, see [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="timed-blocking-operations"></a><span data-ttu-id="bc024-126">Časované blokovací operace</span><span class="sxs-lookup"><span data-stu-id="bc024-126">Timed Blocking Operations</span></span>  
 <span data-ttu-id="bc024-127">V časované <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> blokování a operace na ohraničené kolekce, metoda se pokusí přidat nebo přijmout položku.</span><span class="sxs-lookup"><span data-stu-id="bc024-127">In timed blocking <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operations on bounded collections, the method tries to add or take an item.</span></span> <span data-ttu-id="bc024-128">Pokud je položka k dispozici, je umístěna do proměnné, která byla předána odkazem a metoda vrátí hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="bc024-128">If an item is available it is placed into the variable that was passed in by reference, and the method returns true.</span></span> <span data-ttu-id="bc024-129">Pokud žádná položka je načten po zadaném časovém období, metoda vrátí false.</span><span class="sxs-lookup"><span data-stu-id="bc024-129">If no item is retrieved after a specified time-out period the method returns false.</span></span> <span data-ttu-id="bc024-130">Vlákno je pak zdarma provést některé další užitečné práce před pokusem znovu získat přístup ke kolekci.</span><span class="sxs-lookup"><span data-stu-id="bc024-130">The thread is then free to do some other useful work before trying again to access the collection.</span></span> <span data-ttu-id="bc024-131">Příklad časovanéblokování přístupu naleznete v druhém příkladu v [How to: Přidat a vzít položky jednotlivě z BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="bc024-131">For an example of timed blocking access, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="cancelling-add-and-take-operations"></a><span data-ttu-id="bc024-132">Zrušení operací přidání a převzetí</span><span class="sxs-lookup"><span data-stu-id="bc024-132">Cancelling Add and Take Operations</span></span>  
 <span data-ttu-id="bc024-133">Přidat a přijmout operace jsou obvykle prováděny ve smyčce.</span><span class="sxs-lookup"><span data-stu-id="bc024-133">Add and Take operations are typically performed in a loop.</span></span> <span data-ttu-id="bc024-134">Můžete zrušit smyčku předáním <xref:System.Threading.CancellationToken> <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> do <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> metody nebo a potom zkontrolujte hodnotu <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> vlastnosti tokenu v každé iteraci.</span><span class="sxs-lookup"><span data-stu-id="bc024-134">You can cancel a loop by passing in a <xref:System.Threading.CancellationToken> to the <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> or <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> method, and then checking the value of the token's <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on each iteration.</span></span> <span data-ttu-id="bc024-135">Pokud je hodnota true, pak je na vás reagovat na požadavek na zrušení vyčištěním všech prostředků a ukončení smyčky.</span><span class="sxs-lookup"><span data-stu-id="bc024-135">If the value is true, then it is up to you to respond the cancellation request by cleaning up any resources and exiting the loop.</span></span> <span data-ttu-id="bc024-136">Následující příklad ukazuje <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> přetížení, které trvá zrušení tokena a kód, který jej používá:</span><span class="sxs-lookup"><span data-stu-id="bc024-136">The following example shows an overload of <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> that takes a cancellation token, and the code that uses it:</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#05](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#05)]
 [!code-vb[CDS_BlockingCollection#05](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#05)]  
  
 <span data-ttu-id="bc024-137">Příklad, jak přidat podporu zrušení, naleznete v druhém příkladu v [How to: Add and Take Items Jednotlivě z BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="bc024-137">For an example of how to add cancellation support, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="specifying-the-collection-type"></a><span data-ttu-id="bc024-138">Určení typu kolekce</span><span class="sxs-lookup"><span data-stu-id="bc024-138">Specifying the Collection Type</span></span>  
 <span data-ttu-id="bc024-139">Při vytváření <xref:System.Collections.Concurrent.BlockingCollection%601>můžete zadat nejen ohraničenou kapacitu, ale také typ kolekce, která se má použít.</span><span class="sxs-lookup"><span data-stu-id="bc024-139">When you create a <xref:System.Collections.Concurrent.BlockingCollection%601>, you can specify not only the bounded capacity but also the type of collection to use.</span></span> <span data-ttu-id="bc024-140">Můžete například zadat <xref:System.Collections.Concurrent.ConcurrentQueue%601> chování pro první in-first out (FIFO) nebo <xref:System.Collections.Concurrent.ConcurrentStack%601> pro chování poslední in-first out (LIFO).</span><span class="sxs-lookup"><span data-stu-id="bc024-140">For example, you could specify a <xref:System.Collections.Concurrent.ConcurrentQueue%601> for first in-first out (FIFO) behavior, or a <xref:System.Collections.Concurrent.ConcurrentStack%601> for last in-first out (LIFO) behavior.</span></span> <span data-ttu-id="bc024-141">Můžete použít libovolnou třídu <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> kolekce, která implementuje rozhraní.</span><span class="sxs-lookup"><span data-stu-id="bc024-141">You can use any collection class that implements the <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interface.</span></span> <span data-ttu-id="bc024-142">Výchozí typ kolekce <xref:System.Collections.Concurrent.BlockingCollection%601> <xref:System.Collections.Concurrent.ConcurrentQueue%601>pro je .</span><span class="sxs-lookup"><span data-stu-id="bc024-142">The default collection type for <xref:System.Collections.Concurrent.BlockingCollection%601> is <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span></span> <span data-ttu-id="bc024-143">Následující příklad kódu ukazuje, <xref:System.Collections.Concurrent.BlockingCollection%601> jak vytvořit řetězce, které má kapacitu 1000 a používá <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span><span class="sxs-lookup"><span data-stu-id="bc024-143">The following code example shows how to create a <xref:System.Collections.Concurrent.BlockingCollection%601> of strings that has a capacity of 1000 and uses a <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span></span>  
  
```vb  
Dim bc = New BlockingCollection(Of String)(New ConcurrentBag(Of String()), 1000)  
```  
  
```csharp  
BlockingCollection<string> bc = new BlockingCollection<string>(new ConcurrentBag<string>(), 1000 );  
```  
  
 <span data-ttu-id="bc024-144">Další informace naleznete v [tématu How to: Add Bounding and Blocking Functionality to a Collection](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span><span class="sxs-lookup"><span data-stu-id="bc024-144">For more information, see [How to: Add Bounding and Blocking Functionality to a Collection](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span></span>  
  
## <a name="ienumerable-support"></a><span data-ttu-id="bc024-145">Podpora iEnumerable</span><span class="sxs-lookup"><span data-stu-id="bc024-145">IEnumerable Support</span></span>  
 <span data-ttu-id="bc024-146"><xref:System.Collections.Concurrent.BlockingCollection%601>poskytuje <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> metodu, která `foreach` umožňuje`For Each` spotřebitelům použít (v jazyce Visual Basic) odebrat položky, dokud není dokončena kolekce, což znamená, že je prázdný a žádné další položky budou přidány.</span><span class="sxs-lookup"><span data-stu-id="bc024-146"><xref:System.Collections.Concurrent.BlockingCollection%601> provides a <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> method that enables consumers to use `foreach` (`For Each` in Visual Basic) to remove items until the collection is completed, which means it is empty and no more items will be added.</span></span> <span data-ttu-id="bc024-147">Další informace naleznete v [tématu How to: Use ForEach to Remove Items in a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span><span class="sxs-lookup"><span data-stu-id="bc024-147">For more information, see [How to: Use ForEach to Remove Items in a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span></span>  
  
## <a name="using-many-blockingcollections-as-one"></a><span data-ttu-id="bc024-148">Použití mnoho BlockingCollections jako jeden</span><span class="sxs-lookup"><span data-stu-id="bc024-148">Using Many BlockingCollections As One</span></span>  
 <span data-ttu-id="bc024-149">Pro scénáře, ve kterých spotřebitel potřebuje přijmout položky z více <xref:System.Collections.Concurrent.BlockingCollection%601> kolekcí současně, můžete <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> vytvořit pole a použít statické metody, jako je například a které budou přidávat nebo trvat z některé z kolekcí v poli.</span><span class="sxs-lookup"><span data-stu-id="bc024-149">For scenarios in which a consumer needs to take items from multiple collections simultaneously, you can create arrays of <xref:System.Collections.Concurrent.BlockingCollection%601> and use the static methods such as <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> that will add to or take from any of the collections in the array.</span></span> <span data-ttu-id="bc024-150">Pokud jedna kolekce je blokování, metoda okamžitě pokusí jiný, dokud nenajde ten, který může provést operaci.</span><span class="sxs-lookup"><span data-stu-id="bc024-150">If one collection is blocking, the method immediately tries another until it finds one that can perform the operation.</span></span> <span data-ttu-id="bc024-151">Další informace naleznete v [tématu How to: Use Arrays of Blocking Collections in a Pipeline](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span><span class="sxs-lookup"><span data-stu-id="bc024-151">For more information, see [How to: Use Arrays of Blocking Collections in a Pipeline](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bc024-152">Viz také</span><span class="sxs-lookup"><span data-stu-id="bc024-152">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>
- [<span data-ttu-id="bc024-153">Kolekce a datové struktury</span><span class="sxs-lookup"><span data-stu-id="bc024-153">Collections and Data Structures</span></span>](../../../../docs/standard/collections/index.md)
- [<span data-ttu-id="bc024-154">Kolekce se zabezpečenými vlákny</span><span class="sxs-lookup"><span data-stu-id="bc024-154">Thread-Safe Collections</span></span>](../../../../docs/standard/collections/thread-safe/index.md)
