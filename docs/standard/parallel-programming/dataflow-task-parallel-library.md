---
title: Tok dat (Task Parallel Library)
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library
ms.assetid: 643575d0-d26d-4c35-8de7-a9c403e97dd6
ms.openlocfilehash: 6c589e85a0bbfb3f0b5858698ffb2a294ff88cf2
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/15/2020
ms.locfileid: "73973783"
---
# <a name="dataflow-task-parallel-library"></a>Tok dat (Task Parallel Library)
Paralelní knihovna úloh (TPL) poskytuje součásti toku dat, které pomáhají zvýšit robustnost aplikací s podporou souběžnosti. Tyto součásti toku dat jsou souhrnně označovány jako *Knihovna toku dat TPL*. Tento model toku dat podporuje programování založené na objektu actor tím, že poskytuje v procesu předávání zpráv pro hrubozrnné tok dat a pipelining úkoly. Součásti toku dat se staví na typech a plánování infrastruktury TPL a integrují se s podporou jazyka C#, Visual Basic a F# pro asynchronní programování. Tyto součásti toku dat jsou užitečné, pokud máte více operací, které musí komunikovat mezi sebou asynchronně nebo pokud chcete zpracovávat data, jakmile budou k dispozici. Zvažte například aplikaci, která zpracovává obrazová data z webové kamery. Pomocí modelu toku dat může aplikace zpracovat obrazové rámce tak, jak jsou k dispozici. Pokud aplikace vylepšuje obrazové rámečky, například provedením korekce světla nebo redukce červených očí, můžete vytvořit *kanál* komponent toku dat. Každá fáze kanálu může používat více hrubozrnné funkce paralelismu, jako je například funkce poskytované TPL, transformovat image.  
  
 Tento dokument poskytuje přehled knihovny Toků dat TPL. Popisuje programovací model, předdefinované typy bloků toku dat a jak nakonfigurovat bloky toku dat tak, aby splňovaly specifické požadavky vašich aplikací.  

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="programming-model"></a>Programovací model
 Knihovna Toku dat TPL poskytuje základ pro předávání zpráv a paralelizaci aplikací náročných na procesor a vstupně-výstupních aplikací, které mají vysokou propustnost a nízkou latenci. Poskytuje také explicitní kontrolu nad tím, jak jsou data uložena do vyrovnávací paměti a pohybuje se po celém systému. Chcete-li lépe porozumět programovacímu modelu toku dat, zvažte aplikaci, která asynchronně načte obrazy z disku a vytvoří složený z těchto bitových kopií. Tradiční programovací modely obvykle vyžadují použití zpětná volání a synchronizační objekty, jako jsou zámky, ke koordinaci úkolů a přístup ke sdíleným datům. Pomocí programovacího modelu toku dat můžete vytvořit objekty toku dat, které zpracovávají obrazy při čtení z disku. V rámci modelu toku dat deklarujete, jak jsou data zpracována, jakmile budou k dispozici, a také všechny závislosti mezi daty. Vzhledem k tomu, že modul runtime spravuje závislosti mezi daty, můžete se často vyhnout požadavku na synchronizaci přístupu ke sdíleným datům. Navíc vzhledem k tomu, že plány modulu runtime fungují na základě asynchronního příchodu dat, může tok dat zlepšit odezvu a propustnost efektivní správou podkladových vláken. Příklad, který používá programovací model toku dat k implementaci zpracování obrazu v aplikaci Windows Forms, naleznete v [tématu Návod: Použití toku dat v aplikaci Windows Forms](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).  
  
### <a name="sources-and-targets"></a>Zdroje a cíle  
 Knihovna toku dat TPL se skládá z *bloků toku dat*, což jsou datové struktury, které ukládají do vyrovnávací paměti a zpracovávají data. TPL definuje tři druhy bloků toku dat: *zdrojové bloky*, *cílové bloky*a *bloky propagátorů*. Zdrojový blok funguje jako zdroj dat a lze z nich číst. Cílový blok funguje jako příjemce dat a může být zapsán do. Blok propagátoru funguje jako zdrojový blok i cílový blok a lze jej číst a zapisovat do ní. TPL definuje <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601?displayProperty=nameWithType> rozhraní představující zdroje, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601?displayProperty=nameWithType> představují cíle <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602?displayProperty=nameWithType> a představují množitelé. <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602>dědí z <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>obou <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>a .  
  
 Knihovna toku dat TPL poskytuje několik předdefinovaných <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>typů <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> bloků toku dat, které implementují <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>rozhraní , a rozhraní. Tyto typy bloků toku dat jsou popsány v tomto dokumentu v části [Předdefinované typy bloků datového toku](#predefined-dataflow-block-types).  
  
### <a name="connecting-blocks"></a>Spojovací bloky  
 Bloky toku dat můžete připojit k *potrubím*, což jsou lineární sekvence bloků toku dat nebo *sítí*, což jsou grafy bloků toku dat. Kanál je jedna forma sítě. V kanálu nebo v síti zdroje asynchronně mažit data na cíle, jakmile tato data k dispozici. Metoda <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> propojuje zdrojový blok toku dat s cílovým blokem. Zdroj lze propojit s nulou nebo více cíli; cíle mohou být propojeny z nuly nebo z více zdrojů. Bloky toku dat můžete přidávat nebo odebírat do kanálu nebo sítě nebo z něj současně. Předdefinované typy bloků toku dat zpracovávají všechny aspekty bezpečnosti vláken propojování a odpojování.  
  
 Příklad, který spojuje bloky toku dat k vytvoření základního kanálu, najdete v [tématu Návod: Vytvoření kanálu toku dat](../../../docs/standard/parallel-programming/walkthrough-creating-a-dataflow-pipeline.md). Příklad, který spojuje bloky toku dat a tvoří složitější síť, najdete v [tématu Návod: Použití toku dat v aplikaci Windows Forms](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md). Příklad, který odpojuje cíl od zdroje poté, co zdroj nabídne cílovou zprávu, najdete v tématu [Jak zrušit propojení bloků toku dat](../../../docs/standard/parallel-programming/how-to-unlink-dataflow-blocks.md).  
  
#### <a name="filtering"></a>Filtrování  
 Při volání <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A?displayProperty=nameWithType> metody propojit zdroj s cílem, můžete zadat delegáta, který určuje, zda cílový blok přijme nebo odmítne zprávu na základě hodnoty této zprávy. Tento mechanismus filtrování je užitečný způsob, jak zaručit, že blok toku dat obdrží pouze určité hodnoty. Pro většinu předdefinovaných typů bloků toku dat, pokud je zdrojový blok připojen k více cílovým blokům, když cílový blok odmítne zprávu, zdroj nabídne tuto zprávu dalšímu cíli. Pořadí, ve kterém zdroj nabízí zprávy cílům, je definováno zdrojem a může se lišit podle typu zdroje. Většina typů zdrojových bloků přestane nabízet zprávu poté, co jeden cíl tuto zprávu přijme. Jednou výjimkou z tohoto <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> pravidla je třída, která nabízí každou zprávu všem cílům, i když některé cíle zprávu odmítnou. Příklad, který používá filtrování ke zpracování pouze určitých zpráv, naleznete [v tématu Návod: Použití toku dat v aplikaci Windows Forms .](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md)  
  
> [!IMPORTANT]
> Vzhledem k tomu, že každý předdefinovaný typ bloku zdrojového toku dat zaručuje, že zprávy jsou šířeny v pořadí, ve kterém jsou přijímány, musí být každá zpráva přečtena ze zdrojového bloku předtím, než zdrojový blok může zpracovat další zprávu. Proto při použití filtrování připojit více cílů ke zdroji, ujistěte se, že alespoň jeden cílový blok obdrží každou zprávu. V opačném případě může zablokování aplikace.  
  
### <a name="message-passing"></a>Předání zprávy  
 Programovací model toku dat souvisí s konceptem *předávání zpráv*, kde nezávislé součásti programu vzájemně komunikují odesíláním zpráv. Jedním ze způsobů, jak šířit zprávy mezi <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> součástmi aplikace, je volání <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> a<xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A> metody pro odesílání zpráv do cílových bloků toku dat post ( funguje synchronně; <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A> asynchronně) a <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A>a <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A> metody pro příjem zpráv ze zdrojových bloků. Tyto metody můžete kombinovat s kanály toku dat nebo sítě odesláním vstupních dat do hlavního uzlu (cílový blok) a příjem výstupních dat z terminálového uzlu kanálu nebo terminálových uzlů sítě (jeden nebo více zdrojových bloků). Metodu <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Choose%2A> můžete také použít ke čtení z prvního z poskytnutých zdrojů, který má k dispozici data a provést akci na tato data.  
  
 Zdrojové bloky nabízejí data cílovým blokům voláním <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A?displayProperty=nameWithType> metody. Cílový blok reaguje na nabízenou zprávu jedním ze tří způsobů: může zprávu přijmout, zprávu odmítnout nebo zprávu odložit. Když cíl přijme zprávu, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> metoda <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Accepted>vrátí . Když cíl odmítne zprávu, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> metoda <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Declined>vrátí . Pokud cíl vyžaduje, aby již nepřijímá žádné <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> zprávy <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.DecliningPermanently>ze zdroje, vrátí . Předdefinované typy zdrojových bloků nenabízejí zprávy propojeným cílům po přijetí takové vrácené hodnoty a automaticky se od těchto cílů odpojí.  
  
 Když cílový blok odloží zprávu pro <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601.OfferMessage%2A> pozdější <xref:System.Threading.Tasks.Dataflow.DataflowMessageStatus.Postponed>použití, metoda vrátí . Cílový blok, který odkládá zprávu <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReserveMessage%2A?displayProperty=nameWithType> může později volat metodu a pokusit se rezervovat nabízené zprávy. V tomto okamžiku je zpráva stále k dispozici a může být použita cílovým blokem nebo byla přijata jiným cílem. Pokud cílový blok později vyžaduje zprávu nebo již nepotřebuje <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ReleaseReservation%2A> zprávu, volá metodu nebo, resp. Rezervace zpráv se obvykle používá typy bloků toku dat, které pracují v nechamtivém režimu. Nechamtivý režim je vysvětlen dále v tomto dokumentu. Místo vyhrazení odložené zprávy, cílový blok můžete <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.ConsumeMessage%2A?displayProperty=nameWithType> také použít metodu k pokusu přímo využívat odložené zprávy.  
  
### <a name="dataflow-block-completion"></a>Dokončení bloku toku dat  
 Bloky toku dat také podporují koncepci *dokončení*. Blok toku dat, který je v dokončeném stavu neprovede žádnou další práci. Každý blok toku <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> dat má přidružený objekt, označovaný jako *úkol dokončení*, který představuje stav dokončení bloku. Vzhledem k tomu, že můžete čekat na dokončení objektu <xref:System.Threading.Tasks.Task> pomocí úloh dokončení, můžete počkat na dokončení jednoho nebo více terminálových uzlů sítě toku dat. Rozhraní <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> definuje metodu, <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> která informuje blok toku dat o dokončení požadavku <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> a vlastnost, která vrátí úkol dokončení pro blok toku dat. Oba <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> a <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> zdědit rozhraní.  
  
 Existují dva způsoby, jak zjistit, zda blok toku dat dokončena bez chyby, došlo k jedné nebo více chyb nebo byla zrušena. Prvním způsobem je volání <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> metody na dokončení `try` - `catch` úkolu`Try` - `Catch` v bloku (v jazyce Visual Basic). Následující příklad vytvoří <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objekt, <xref:System.ArgumentOutOfRangeException> který vyvolá, pokud jeho vstupní hodnota je menší než nula. <xref:System.AggregateException>je vyvolána, když <xref:System.Threading.Tasks.Task.Wait%2A> tento příklad volá na dokončení úkolu. Je <xref:System.ArgumentOutOfRangeException> přístupný prostřednictvím <xref:System.AggregateException.InnerExceptions%2A> vlastnosti <xref:System.AggregateException> objektu.  
  
 [!code-csharp[TPLDataflow_Overview#10](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#10)]
 [!code-vb[TPLDataflow_Overview#10](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#10)]  
  
 Tento příklad ukazuje případ, ve kterém výjimka přejde neošetřené v delegáta bloku toku dat spuštění. Doporučujeme, abyste zpracovat výjimky v tělech těchto bloků. Pokud se vám to však nedaří, blok se chová, jako by byl zrušen, a nezpracovává příchozí zprávy.  
  
 Při explicitně zrušit blok toku <xref:System.AggregateException> dat, objekt obsahuje <xref:System.OperationCanceledException> ve vlastnosti. <xref:System.AggregateException.InnerExceptions%2A> Další informace o zrušení toku dat naleznete v části [Povolení zrušení.](#enabling-cancellation)  
  
 Druhým způsobem, jak určit stav dokončení bloku toku dat, je použít pokračování úlohy dokončení nebo použít funkce asynchronního jazyka c# a visual basic asynchronně čekat na dokončení úlohy. Delegát, který zadáte <xref:System.Threading.Tasks.Task.ContinueWith%2A?displayProperty=nameWithType> metodě <xref:System.Threading.Tasks.Task> trvá objekt, který představuje předchozí úkol. V případě vlastnosti <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> delegát pro pokračování přebírá dokončení úkolu sám. Následující příklad se podobá předchozí, s tím <xref:System.Threading.Tasks.Task.ContinueWith%2A> rozdílem, že také používá metodu k vytvoření úlohy pokračování, která vytiskne stav celkové operace toku dat.  
  
 [!code-csharp[TPLDataflow_Overview#11](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#11)]
 [!code-vb[TPLDataflow_Overview#11](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#11)]  
  
 Můžete také použít vlastnosti, například <xref:System.Threading.Tasks.Task.IsCanceled%2A> v těle úlohy pokračování k určení další informace o stavu dokončení bloku toku dat. Další informace o úkolech pokračování a jejich vztahu ke zrušení a zpracování chyb naleznete [v tématu Řetězení úkolů pomocí úloh pokračování](../../../docs/standard/parallel-programming/chaining-tasks-by-using-continuation-tasks.md), Zrušení [úloh](../../../docs/standard/parallel-programming/task-cancellation.md)a [Zpracování výjimek](../../../docs/standard/parallel-programming/exception-handling-task-parallel-library.md).  

## <a name="predefined-dataflow-block-types"></a>Předdefinované typy bloků toku dat  
 Knihovna toku dat TPL poskytuje několik předdefinovaných typů bloků toku dat. Tyto typy jsou rozděleny do tří kategorií: *ukládání bloků do vyrovnávací paměti*, bloky *spuštění*a *bloky seskupení*. Následující části popisují typy bloků, které tvoří tyto kategorie.  
  
### <a name="buffering-blocks"></a>Ukládání bloků do vyrovnávací paměti  
 Ukládání bloků do vyrovnávací paměti uchovává data pro spotřebitele dat. Knihovna toku dat TPL poskytuje <xref:System.Threading.Tasks.Dataflow.BufferBlock%601?displayProperty=nameWithType>tři <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601?displayProperty=nameWithType>typy <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601?displayProperty=nameWithType>bloků vyrovnávací paměti: , , a .  
  
#### <a name="bufferblockt"></a>Nárazníkový blok(T)  
 Třída <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> představuje obecnou strukturu asynchronního zasílání zpráv. Tato třída ukládá první in, first out (FIFO) fronty zpráv, které mohou být zapsány do více zdrojů nebo číst z více cílů. Když cíl obdrží zprávu z <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> objektu, tato zpráva je odebrána z fronty zpráv. Proto i <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> když objekt může mít více cílů, pouze jeden cíl obdrží každou zprávu. Třída <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> je užitečná, pokud chcete předat více zpráv jiné součásti a tato součást musí přijímat každou zprávu.  
  
 Následující základní příklad <xref:System.Int32> odešle <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> několik hodnot do objektu a potom přečte tyto hodnoty zpět z tohoto objektu.  
  
 [!code-csharp[TPLDataflow_Overview#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#1)]
 [!code-vb[TPLDataflow_Overview#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#1)]  
  
 Úplný příklad, který ukazuje, jak psát zprávy a <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> číst zprávy z objektu, naleznete v tématu [How to: Write Messages to and Read Messages from a Dataflow Block](../../../docs/standard/parallel-programming/how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md).  
  
#### <a name="broadcastblockt"></a>Vysílací blok(T)  
 Třída <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> je užitečná, pokud je nutné předat více zpráv jiné součásti, ale tato součást potřebuje pouze nejnovější hodnotu. Tato třída je také užitečná, pokud chcete vysílat zprávu více součástem.  
  
 Následující základní příklad <xref:System.Double> zaúčtuje <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> hodnotu objektu a potom tuto hodnotu několikrát přečte zpět z tohoto objektu. Vzhledem k tomu, že hodnoty nejsou odebrány z <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> objektů po jejich čtení, je vždy k dispozici stejná hodnota.  
  
 [!code-csharp[TPLDataflow_Overview#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#2)]
 [!code-vb[TPLDataflow_Overview#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#2)]  
  
 Úplný příklad, který ukazuje, <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> jak použít k vysílání zprávy do více cílových bloků, najdete v [tématu Postup: Zadání plánovače úloh v bloku toku dat](../../../docs/standard/parallel-programming/how-to-specify-a-task-scheduler-in-a-dataflow-block.md).  
  
#### <a name="writeonceblockt"></a>WriteOnceBlock(T)  
 Třída <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> se podobá <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> třídě, s <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> tím rozdílem, že objekt lze zapsat pouze jednou. Můžete si <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> představit, že je podobný c# [jen pro čtení](../../csharp/language-reference/keywords/readonly.md) [(ReadOnly](../../visual-basic/language-reference/modifiers/readonly.md) v jazyce Visual Basic) klíčové slovo, s tím rozdílem, <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> že objekt stane neměnné poté, co obdrží hodnotu namísto na konstrukci. Stejně <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> jako třída, když cíl obdrží <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> zprávu z objektu, tato zpráva není odebrána z tohoto objektu. Proto více cílů obdrží kopii zprávy. Třída <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> je užitečná, pokud chcete šířit pouze první z více zpráv.  
  
 Následující základní příklad <xref:System.String> odešle <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> do objektu více hodnot a potom přečte hodnotu zpět z tohoto objektu. Vzhledem <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> k tomu, že objekt lze <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> zapsat pouze jednou, poté, co objekt obdrží zprávu, zahodí následné zprávy.  
  
 [!code-csharp[TPLDataflow_Overview#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#3)]
 [!code-vb[TPLDataflow_Overview#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#3)]  
  
 Úplný příklad, který ukazuje, <xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601> jak použít k získání hodnoty první operace, která skončí, naleznete v [tématu How to: Unlink Dataflow Blocks](../../../docs/standard/parallel-programming/how-to-unlink-dataflow-blocks.md).  
  
### <a name="execution-blocks"></a>Bloky spuštění  
 Bloky spuštění volání uživatelem zapředpokladu delegáta pro každou část přijatých dat. Knihovna toku dat TPL poskytuje <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> <xref:System.Threading.Tasks.Dataflow.TransformBlock%602?displayProperty=nameWithType>tři <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602?displayProperty=nameWithType>typy bloků spuštění: , a .  
  
#### <a name="actionblockt"></a>ActionBlock(T)  
 Třída <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> je cílový blok, který volá delegáta, když přijímá data. Představte <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> si objekt jako delegáta, který běží asynchronně, když jsou k dispozici data. Delegát, který zadáte <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objektu může <xref:System.Action%601> být `System.Func<TInput, Task>`typu nebo typu . Při použití <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objektu <xref:System.Action%601>s , zpracování každého vstupního prvku je považováno za dokončené při delegáta vrátí. Při použití <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objektu `System.Func<TInput, Task>`s , zpracování každého vstupního prvku <xref:System.Threading.Tasks.Task> je považováno za dokončené pouze po dokončení vráceného objektu. Pomocí těchto dvou mechanismů můžete <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> použít pro synchronní i asynchronní zpracování každého vstupního prvku.  
  
 Následující základní příklad <xref:System.Int32> odešle <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> do objektu více hodnot. Objekt <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> vytiskne tyto hodnoty do konzoly. Tento příklad pak nastaví blok do dokončeného stavu a čeká na dokončení všech úloh toku dat.  
  
 [!code-csharp[TPLDataflow_Overview#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#4)]
 [!code-vb[TPLDataflow_Overview#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#4)]  
  
 Úplné příklady, které ukazují, jak <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> používat delegáty s třídou, najdete v [tématu Jak: Provést akci při přijetí bloku toku dat přijímá data](../../../docs/standard/parallel-programming/how-to-perform-action-when-a-dataflow-block-receives-data.md).  
  
#### <a name="transformblocktinput-toutput"></a>TransformBlock(TInput, TOutput)  
 Třída <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> se podobá <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> třídy, s tím rozdílem, že funguje jako zdroj a jako cíl. Delegát, který předáte <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> objektu, vrátí `TOutput`hodnotu typu . Delegát, který zadáte <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> objektu může `System.Func<TInput, TOutput>` být `System.Func<TInput, Task<TOutput>>`typu nebo typu . Při použití <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> objektu `System.Func<TInput, TOutput>`s , zpracování každého vstupního prvku je považováno za dokončené při delegáta vrátí. Při použití <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> objektu `System.Func<TInput, Task<TOutput>>`použitého s , zpracování každého vstupního <xref:System.Threading.Tasks.Task%601> prvku je považováno za dokončené pouze po dokončení vráceného objektu. Stejně <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>jako u , pomocí těchto <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> dvou mechanismů, můžete použít pro synchronní i asynchronní zpracování každého vstupního prvku.  
  
 Následující základní příklad <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> vytvoří objekt, který vypočítá druhou odmocninu jeho vstupu. Objekt <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> přebírá <xref:System.Int32> hodnoty jako vstup <xref:System.Double> a vytváří hodnoty jako výstup.  
  
 [!code-csharp[TPLDataflow_Overview#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#5)]
 [!code-vb[TPLDataflow_Overview#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#5)]  
  
 Úplné příklady, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> které se používají v síti bloků toku dat, která provádí zpracování obrazu v aplikaci Windows Forms, naleznete [v tématu Návod: Použití toku dat v aplikaci Windows Forms](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).  
  
#### <a name="transformmanyblocktinput-toutput"></a>TransformManyBlock(TInput, TOutput)  
 Třída <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> se podobá <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> třídě, <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> s tím rozdílem, že produkuje nula nebo více výstupních hodnot pro každou vstupní hodnotu, namísto pouze jednu výstupní hodnotu pro každou vstupní hodnotu. Delegát, který zadáte <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> objektu může `System.Func<TInput, IEnumerable<TOutput>>` být `System.Func<TInput, Task<IEnumerable<TOutput>>>`typu nebo typu . Při použití <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> objektu `System.Func<TInput, IEnumerable<TOutput>>`s , zpracování každého vstupního prvku je považováno za dokončené při delegáta vrátí. Při použití <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> objektu `System.Func<TInput, Task<IEnumerable<TOutput>>>`s , zpracování každého vstupního prvku `System.Threading.Tasks.Task<IEnumerable<TOutput>>` je považováno za úplné pouze po dokončení vráceného objektu.  
  
 Následující základní příklad <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> vytvoří objekt, který rozdělí řetězce do jejich jednotlivých sekvencí znaků. Objekt <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> přebírá <xref:System.String> hodnoty jako vstup <xref:System.Char> a vytváří hodnoty jako výstup.  
  
 [!code-csharp[TPLDataflow_Overview#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#6)]
 [!code-vb[TPLDataflow_Overview#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#6)]  
  
 Úplné příklady, <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> které slouží k vytvoření více nezávislých výstupů pro každý vstup v kanálu toku dat, naleznete v [tématu Návod: Vytvoření kanálu toku dat](../../../docs/standard/parallel-programming/walkthrough-creating-a-dataflow-pipeline.md).  
  
#### <a name="degree-of-parallelism"></a>Stupeň paralelismu  
 Každý <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>, <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> a objekt vyrovnávací paměti vstupní zprávy, dokud blok je připraven ke zpracování. Ve výchozím nastavení tyto třídy zpracovávají zprávy v pořadí, ve kterém jsou přijímány, jednu zprávu najednou. Můžete také určit stupeň paralelismu, <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> který má být povolen <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>, a objekty pro zpracování více zpráv současně. Další informace o souběžném provádění naleznete v části Určení stupně paralelismu dále v tomto dokumentu. Příklad, který nastavuje stupeň paralelismu, aby blok toku dat spuštění mohl zpracovat více než jednu zprávu najednou, najdete v tématu [How to: Specify the Degree of Parallelism in a Dataflow Block](../../../docs/standard/parallel-programming/how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).  
  
#### <a name="summary-of-delegate-types"></a>Souhrn typů delegátů  
 Následující tabulka shrnuje typy delegátů, <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>které <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>můžete <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> poskytnout , a objekty. Tato tabulka také určuje, zda typ delegáta pracuje synchronně nebo asynchronně.  
  
|Typ|Synchronní typ delegáta|Asynchronní typ delegáta|  
|----------|-------------------------------|--------------------------------|  
|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|`System.Action`|`System.Func<TInput, Task>`|  
|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|`System.Func<TInput, TOutput>`|`System.Func<TInput, Task<TOutput>>`|  
|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|`System.Func<TInput, IEnumerable<TOutput>>`|`System.Func<TInput, Task<IEnumerable<TOutput>>>`|  
  
 Výrazy lambda můžete také použít při práci s typy bloků spuštění. Příklad, který ukazuje, jak používat výraz lambda s blokem spuštění, najdete v tématu [How to: Perform Action When a Dataflow Block Receives Data](../../../docs/standard/parallel-programming/how-to-perform-action-when-a-dataflow-block-receives-data.md).  
  
### <a name="grouping-blocks"></a>Seskupování bloků  
 Seskupování bloků kombinuje data z jednoho nebo více zdrojů a pod různými omezeními. Knihovna toku dat TPL poskytuje <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>tři <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>typy spojů: , a .  
  
#### <a name="batchblockt"></a>BatchBlock(T)  
 Třída <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> kombinuje sady vstupních dat, které jsou známé jako dávky, do polí výstupních dat. Při vytváření objektu <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> určíte velikost každé dávky. Když <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> objekt obdrží zadaný počet vstupních prvků, asynchronně rozšíří pole, které obsahuje tyto prvky. Pokud <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> je objekt nastaven na dokončený stav, ale neobsahuje dostatek prvků k vytvoření dávky, rozšíří konečné pole, které obsahuje zbývající vstupní prvky.  
  
 Třída <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> pracuje v *hladové* nebo *non-chamtivý* režimu. V nenasytném režimu, <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> který je výchozí, objekt přijme každou zprávu, která je nabízena a rozšíří pole po obdrží zadaný počet prvků. V nechamtivém režimu <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> objekt odloží všechny příchozí zprávy, dokud dostatek zdrojů nenabídne zprávy bloku k vytvoření dávky. Hladový režim obvykle funguje lépe než nechamtivý režim, protože vyžaduje menší režii zpracování. Však můžete použít nechamtivý režim, když je nutné koordinovat spotřebu z více zdrojů atomickým způsobem. Zadejte nechamtivý <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> `False` režim `dataflowBlockOptions` nastavením <xref:System.Threading.Tasks.Dataflow.BatchBlock%601.%23ctor%2A> v parametru v konstruktoru.  
  
 Následující základní příklad <xref:System.Int32> zaúčtuje <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> několik hodnot do objektu, který obsahuje deset prvků v dávce. Chcete-li zaručit, že všechny <xref:System.Threading.Tasks.Dataflow.BatchBlock%601>hodnoty šířit z <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> , tento příklad volá metodu. Metoda <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A> nastaví <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> objekt do stavu dokončena <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> a proto objekt rozšíří všechny zbývající prvky jako konečnou dávku.  
  
 [!code-csharp[TPLDataflow_Overview#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#7)]
 [!code-vb[TPLDataflow_Overview#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#7)]  
  
 Úplný příklad, který <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> se používá ke zlepšení efektivity operací vkládání databáze, naleznete [v návodu: Použití BatchBlock a BatchedJoinBlock pro zlepšení efektivity](../../../docs/standard/parallel-programming/walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).  
  
#### <a name="joinblockt1-t2-"></a>JoinBlock(T1, T2, ...)  
 A <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> třídy sbírat vstupní prvky a šířit ven <xref:System.Tuple%602?displayProperty=nameWithType> nebo <xref:System.Tuple%603?displayProperty=nameWithType> objekty, které obsahují tyto prvky. <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> Třídy <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> a nedědí z <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>. Místo toho poskytují <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target1%2A>vlastnosti , <xref:System.Threading.Tasks.Dataflow.JoinBlock%602.Target2%2A>, a <xref:System.Threading.Tasks.Dataflow.JoinBlock%603.Target3%2A>, které implementují <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>.  
  
 Like <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> , <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> a pracovat buď v chamtivý nebo non-chamtivý režimu. V nenasytný režim, <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> který <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> je výchozí, nebo objekt přijme každou zprávu, která je nabízena a rozšíří z řazené kolekce členů po každý z jeho cílů obdrží alespoň jednu zprávu. V nehladovém režimu <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> objekt nebo objekt odloží všechny příchozí zprávy, dokud nebudou nabídnuta data, která jsou potřebná k vytvoření řazené kolekce členů. V tomto okamžiku blok zapojí do protokolu dvoufázového potvrzení atomicky načíst všechny požadované položky ze zdrojů. Toto odložení umožňuje jiné entitě mezitím využívat data, aby celkový systém mohl pokročit vpřed.  
  
 Následující základní příklad ukazuje případ, <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> ve kterém objekt vyžaduje více dat k výpočtu hodnoty. Tento příklad <xref:System.Threading.Tasks.Dataflow.JoinBlock%603> vytvoří objekt, <xref:System.Int32> který <xref:System.Char> vyžaduje dvě hodnoty a hodnotu k provedení aritmetické operace.  
  
 [!code-csharp[TPLDataflow_Overview#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#8)]
 [!code-vb[TPLDataflow_Overview#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#8)]  
  
 Úplný příklad, který <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> používá objekty v nechamtivém režimu ke spolupráci s prostředky, najdete v tématu [How to: Use JoinBlock to Read Data from Multiple Sources](../../../docs/standard/parallel-programming/how-to-use-joinblock-to-read-data-from-multiple-sources.md).  
  
#### <a name="batchedjoinblockt1-t2-"></a>BatchedJoinBlock(T1, T2, ...)  
 A <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%603> třídy sbírat dávky vstupní prvky a šířit ven `System.Tuple(IList(T1), IList(T2))` nebo `System.Tuple(IList(T1), IList(T2), IList(T3))` objekty, které obsahují tyto prvky. Myslete <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> na jako <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>kombinace a . Určete velikost každé dávky <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> při vytváření objektu. <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>poskytuje také <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> vlastnosti <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A>a <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>, které implementují . Když zadaný počet vstupních prvků jsou přijaty z napříč všemi <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> cíli, objekt asynchronně rozšíří `System.Tuple(IList(T1), IList(T2))` objekt, který obsahuje tyto prvky.  
  
 Následující základní příklad <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> vytvoří objekt, <xref:System.Int32> který obsahuje výsledky, <xref:System.Exception> hodnoty a chyby, které jsou objekty. Tento příklad provádí více operací <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target1%2A> a zapisuje výsledky do vlastnosti a chyby <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602.Target2%2A> do vlastnosti objektu. <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> Vzhledem k tomu, že počet úspěšných <xref:System.Collections.Generic.IList%601> a neúspěšných operací není předem znám, umožňují objekty každému cíli přijímat nulové nebo více hodnot.  
  
 [!code-csharp[TPLDataflow_Overview#9](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_overview/cs/program.cs#9)]
 [!code-vb[TPLDataflow_Overview#9](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_overview/vb/program.vb#9)]  
  
 Úplný příklad, který <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> používá k zachycení výsledků a všech výjimek, ke kterým dochází při čtení programu z databáze, naleznete [v tématu Návod: Použití BatchBlock a BatchedJoinBlock pro zlepšení efektivity](../../../docs/standard/parallel-programming/walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md).  

## <a name="configuring-dataflow--block-behavior"></a>Konfigurace chování bloku toku dat  
 Můžete povolit další možnosti poskytnutím objektu <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType> konstruktoru typů bloků toku dat. Tyto možnosti řídí chování, jako je plánovač, který spravuje základní úkol a stupeň paralelismu. Také <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions> má odvozené typy, které určují chování, které je specifické pro určité typy bloků toku dat. Následující tabulka shrnuje, který typ možností je přidružen ke každému typu bloku toku dat.  
  
|Typ bloku toku dat|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>Typ|  
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|  
|<xref:System.Threading.Tasks.Dataflow.BufferBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.WriteOnceBlock%601>|<xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|<xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BatchBlock%601>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.JoinBlock%602>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
|<xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602>|<xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>|  
  
 Následující části obsahují další informace o důležitých typech možností <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions?displayProperty=nameWithType>bloků <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions?displayProperty=nameWithType>toku dat, které jsou k dispozici prostřednictvím , a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions?displayProperty=nameWithType> tříd.  
  
### <a name="specifying-the-task-scheduler"></a>Určení plánovače úloh  
 Každý předdefinovaný blok toku dat používá mechanismus plánování úloh TPL k provádění činností, jako je šíření dat do cíle, příjem dat ze zdroje a spuštění uživatelem definovaných delegátů, když jsou data k dispozici. <xref:System.Threading.Tasks.TaskScheduler>je abstraktní třída, která představuje plánovač úloh, který zařadí úkoly do podprocesů. Výchozí plánovač úloh <xref:System.Threading.Tasks.TaskScheduler.Default%2A>, používá <xref:System.Threading.ThreadPool> třídu k zařazení do fronty a provádění prací. Výchozí plánovač úloh můžete přepsat nastavením <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> vlastnosti při vytváření objektu bloku toku dat.  
  
 Když stejný plánovač úloh spravuje více bloků toku dat, může vynutit zásady napříč nimi. Například pokud více bloků toku dat jsou nakonfigurovány <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> tak, aby cílí na výhradní plánovač stejného objektu, všechny práce, které běží přes tyto bloky serializovat. Podobně pokud tyto bloky jsou nakonfigurovány tak, aby <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> cílí na souběžný plánovač stejného objektu a tento plánovač je nakonfigurován tak, aby měl maximální úroveň souběžnosti, veškerá práce z těchto bloků je omezena na tento počet souběžných operací. Příklad, který používá <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> třídu k povolení operací čtení provádět paralelně, ale zápis operace dojít výhradně všechny ostatní operace, naleznete v tématu [Jak: Zadat plánovač úloh v bloku toku dat](../../../docs/standard/parallel-programming/how-to-specify-a-task-scheduler-in-a-dataflow-block.md). Další informace o plánovačích úloh v TPL naleznete v tématu <xref:System.Threading.Tasks.TaskScheduler> třídy.  
  
### <a name="specifying-the-degree-of-parallelism"></a>Určení stupně paralelismu  
 Ve výchozím nastavení tři typy bloků spuštění, které <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>knihovna toku dat TPL poskytuje, , <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>, zpracovat jednu zprávu najednou. Tyto typy bloků toku dat také zpracovávají zprávy v pořadí, ve kterém jsou přijímány. Chcete-li povolit tyto bloky toku dat <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A?displayProperty=nameWithType> pro zpracování zpráv souběžně, nastavte vlastnost při vytváření objektu bloku toku dat.  
  
 Výchozí hodnota <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> je 1, která zaručuje, že blok toku dat zpracovává jednu zprávu najednou. Nastavení této vlastnosti na hodnotu, která je větší než 1 umožňuje bloku toku dat ke zpracování více zpráv současně. Nastavení této <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType> vlastnosti umožňuje základní plánovač úloh spravovat maximální stupeň souběžnosti.  
  
> [!IMPORTANT]
> Zadáte-li maximální stupeň paralelismu, který je větší než 1, více zpráv jsou zpracovány současně a proto zprávy nemusí být zpracovány v pořadí, ve kterém jsou přijímány. Pořadí, ve kterém jsou zprávy výstup z bloku je však stejný, ve kterém jsou přijaty.  
  
 Vzhledem <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> k tomu, že vlastnost představuje maximální stupeň paralelismu, blok toku dat může spustit s menším stupněm paralelismu, než zadáte. Blok toku dat může použít menší stupeň paralelismu ke splnění jeho funkční požadavky nebo proto, že je nedostatek dostupných systémových prostředků. Blok toku dat nikdy nezvolí více paralelismu, než zadáte.  
  
 Hodnota vlastnosti <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> je výhradní pro každý objekt bloku toku dat. Například pokud čtyři objekty bloku toku dat každý zadat 1 pro maximální stupeň paralelismu, všechny čtyři objekty bloku toku dat může potenciálně spustit paralelně.  
  
 Příklad, který nastavuje maximální stupeň paralelismu, aby bylo možné provádět zdlouhavé operace paralelně, naleznete v tématu [How to: Specify the Degree of Parallelism in a Dataflow Block](../../../docs/standard/parallel-programming/how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md).  
  
### <a name="specifying-the-number-of-messages-per-task"></a>Určení počtu zpráv na úkol  
 Předdefinované typy bloků toku dat používají úlohy ke zpracování více vstupních prvků. To pomáhá minimalizovat počet objektů úloh, které jsou nutné ke zpracování dat, což umožňuje aplikacím pracovat efektivněji. Však při úkoly z jedné sady bloků toku dat jsou zpracování dat, úkoly z jiných bloků toku dat může být nutné čekat na dobu zpracování do fronty zpráv. Chcete-li povolit lepší spravedlnost mezi <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> úlohami toku dat, nastavte vlastnost. Pokud <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> je <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded?displayProperty=nameWithType>nastavena na , což je výchozí, úloha používaná blokem toku dat zpracovává tolik zpráv, kolik je k dispozici. Pokud <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> je nastavena na <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.Unbounded>jinou hodnotu než , blok <xref:System.Threading.Tasks.Task> toku dat zpracovává maximálně tento počet zpráv na objekt. Přestože <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.MaxMessagesPerTask%2A> nastavení vlastnosti může zvýšit spravedlnost mezi úkoly, může způsobit, že systém vytvořit více úkolů, než je nezbytné, což může snížit výkon.  
  
### <a name="enabling-cancellation"></a>Povolení zrušení  
 TPL poskytuje mechanismus, který umožňuje úkolům koordinovat zrušení kooperativním způsobem. Chcete-li povolit bloky toku dat <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.CancellationToken%2A> k účasti v tomto mechanismu zrušení, nastavte vlastnost. Pokud <xref:System.Threading.CancellationToken> je tento objekt nastaven na zrušený stav, všechny bloky toku dat, které sledují provádění tohoto tokenu dokončení jejich aktuální položky, ale nespustí zpracování následných položek. Tyto bloky toku dat také vymazat všechny zprávy ve vyrovnávací paměti, uvolnění připojení k libovolnému zdroji a cílové bloky a přechod do zrušeného stavu. Přechodem do zrušeného stavu <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Completion%2A> má vlastnost <xref:System.Threading.Tasks.Task.Status%2A> nastavenou <xref:System.Threading.Tasks.TaskStatus.Canceled>na , pokud během zpracování nedošlo k výjimce. V takovém <xref:System.Threading.Tasks.Task.Status%2A> případě je <xref:System.Threading.Tasks.TaskStatus.Faulted>nastavena na .  
  
 Příklad, který ukazuje, jak používat zrušení v aplikaci Windows Forms, naleznete v tématu [How to: Cancel a Dataflow Block](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md). Další informace o zrušení v TPL naleznete v tématu [Zrušení úkolu](../../../docs/standard/parallel-programming/task-cancellation.md).  
  
### <a name="specifying-greedy-versus-non-greedy-behavior"></a>Určení nenasytného versus nechamtivého chování  
 Několik typů seskupení datový tok bloku může pracovat v *hladové* nebo *ne-chamtivý* režimu. Ve výchozím nastavení předdefinované typy bloků toku dat pracují v chamtivém režimu.  
  
 Pro typy bloků <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>spojení, jako je například, chamtivý režim znamená, že blok okamžitě přijímá data i v případě, že odpovídající data, s nimiž se připojit ještě není k dispozici. Nechamtivý režim znamená, že blok odloží všechny příchozí zprávy, dokud jeden je k dispozici na každém z jeho cílů k dokončení spojení. Pokud některá z odložených zpráv již nejsou k dispozici, blok spojení uvolní všechny odložené zprávy a restartuje proces. Pro <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> třídu, hladové a non-chamtivý chování je podobné, s <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> tím rozdílem, že v režimu non-hladový objekt odkládá všechny příchozí zprávy, dokud dost jsou k dispozici z různých zdrojů k dokončení dávky.  
  
 Chcete-li určit nechamtivý režim <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> pro `False`blok toku dat, nastavte na . Příklad, který ukazuje, jak použít nechamtivý režim k povolení více bloků spojení pro efektivnější sdílení zdroje dat, naleznete v [tématu How to: Use JoinBlock to Read Data from Multiple Sources](../../../docs/standard/parallel-programming/how-to-use-joinblock-to-read-data-from-multiple-sources.md).

## <a name="custom-dataflow-blocks"></a>Vlastní bloky toku dat  
 Přestože knihovna toku dat TPL poskytuje mnoho předdefinovaných typů bloků, můžete vytvořit další typy bloků, které provádějí vlastní chování. Implementujte <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> rozhraní nebo přímo <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> nebo použijte metodu k vytvoření komplexního bloku, který zapouzdřuje chování existujících typů bloků. Příklady, které ukazují, jak implementovat vlastní funkce bloku toku dat, naleznete [v tématu Návod: Vytvoření vlastního typu bloku toku dat](../../../docs/standard/parallel-programming/walkthrough-creating-a-custom-dataflow-block-type.md).

## <a name="related-topics"></a>Související témata  
  
|Nadpis|Popis|  
|-----------|-----------------|  
|[Postupy: Zápis zpráv do bloku toku dat a čtení zpráv z bloku toku dat](../../../docs/standard/parallel-programming/how-to-write-messages-to-and-read-messages-from-a-dataflow-block.md)|Ukazuje, jak psát zprávy a číst <xref:System.Threading.Tasks.Dataflow.BufferBlock%601> zprávy z objektu.|  
|[Postupy: Implementace vzoru toku dat producent–příjemce](../../../docs/standard/parallel-programming/how-to-implement-a-producer-consumer-dataflow-pattern.md)|Popisuje, jak pomocí modelu toku dat implementovat vzor výrobce a spotřebitele, kde výrobce odesílá zprávy do bloku toku dat a příjemce čte zprávy z tohoto bloku.|  
|[Postupy: Provádění akcí po přijetí dat do bloku toku dat](../../../docs/standard/parallel-programming/how-to-perform-action-when-a-dataflow-block-receives-data.md)|Popisuje, jak poskytnout delegáty typy bloků <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>toku dat spuštění , , <xref:System.Threading.Tasks.Dataflow.TransformBlock%602>a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>.|  
|[Návod: Vytvoření kanálu toku dat](../../../docs/standard/parallel-programming/walkthrough-creating-a-dataflow-pipeline.md)|Popisuje, jak vytvořit kanál toku dat, který stahuje text z webu a provádí operace s tímto textem.|  
|[Postupy: Zrušení propojení bloků toku dat](../../../docs/standard/parallel-programming/how-to-unlink-dataflow-blocks.md)|Ukazuje, jak použít <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601.LinkTo%2A> metodu k odpojení cílového bloku od jeho zdroje poté, co zdroj nabídne zprávu cíli.|  
|[Návod: Použití toku dat v aplikaci Windows Forms](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md)|Ukazuje, jak vytvořit síť bloků toku dat, které provádějí zpracování obrazu v aplikaci Windows Forms.|  
|[Postupy: Zrušení bloku toku dat](../../../docs/standard/parallel-programming/how-to-cancel-a-dataflow-block.md)|Ukazuje, jak používat zrušení v aplikaci Windows Forms.|  
|[Postupy: Načítání dat z více zdrojů pomocí třídy JoinBlock](../../../docs/standard/parallel-programming/how-to-use-joinblock-to-read-data-from-multiple-sources.md)|Vysvětluje, jak použít <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> třídu k provedení operace, pokud jsou data k dispozici z více zdrojů, a jak použít nechamtivý režim, aby bylo možné efektivněji sdílet zdroj dat více bloků spojení.|  
|[Postupy: Určení stupně paralelního zpracování v bloku toku dat](../../../docs/standard/parallel-programming/how-to-specify-the-degree-of-parallelism-in-a-dataflow-block.md)|Popisuje, jak nastavit <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions.MaxDegreeOfParallelism%2A> vlastnost povolit spuštění bloku toku dat pro zpracování více než jednu zprávu najednou.|  
|[Postupy: Určení plánovače úloh v bloku toku dat](../../../docs/standard/parallel-programming/how-to-specify-a-task-scheduler-in-a-dataflow-block.md)|Ukazuje, jak přidružit konkrétní plánovač úloh při použití toku dat v aplikaci.|  
|[Návod: Zvýšení efektivity díky použití tříd BatchBlock a BatchedJoinBlock](../../../docs/standard/parallel-programming/walkthrough-using-batchblock-and-batchedjoinblock-to-improve-efficiency.md)|Popisuje, jak pomocí <xref:System.Threading.Tasks.Dataflow.BatchBlock%601> třídy ke zlepšení efektivity operací vkládání <xref:System.Threading.Tasks.Dataflow.BatchedJoinBlock%602> databáze a jak použít třídu k zachycení výsledků a všech výjimek, ke kterým dochází při čtení programu z databáze.|  
|[Návod: Vytvoření bloku toku dat vlastního typu](../../../docs/standard/parallel-programming/walkthrough-creating-a-custom-dataflow-block-type.md)|Ukazuje dva způsoby, jak vytvořit typ bloku toku dat, který implementuje vlastní chování.|  
|[Task Parallel Library (TPL)](../../../docs/standard/parallel-programming/task-parallel-library-tpl.md)|Zavádí TPL, knihovnu, která zjednodušuje paralelní a souběžné programování v aplikacích rozhraní .NET Framework.|
