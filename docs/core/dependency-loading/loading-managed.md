---
title: Algoritmus načítání spravovaného sestavení – .NET Core
description: Popis podrobností algoritmu načítání spravovaného sestavení v rozhraní .NET Core
ms.date: 08/09/2019
author: sdmaclea
ms.author: stmaclea
ms.openlocfilehash: 312a320676be6eb453697e0704ab771a6707618b
ms.sourcegitcommit: f348c84443380a1959294cdf12babcb804cfa987
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/12/2019
ms.locfileid: "73973502"
---
# <a name="managed-assembly-loading-algorithm"></a><span data-ttu-id="d7a77-103">Algoritmus načítání spravovaného sestavení</span><span class="sxs-lookup"><span data-stu-id="d7a77-103">Managed assembly loading algorithm</span></span>

<span data-ttu-id="d7a77-104">Spravovaná sestavení se nacházejí a načítají pomocí algoritmu zahrnujícího různé fáze.</span><span class="sxs-lookup"><span data-stu-id="d7a77-104">Managed assemblies are located and loaded with an algorithm involving various stages.</span></span>

<span data-ttu-id="d7a77-105">Všechna spravovaná sestavení s výjimkou satelitních sestavení a `WinRT` sestavení používají stejný algoritmus.</span><span class="sxs-lookup"><span data-stu-id="d7a77-105">All managed assemblies except satellite assemblies and `WinRT` assemblies use the same algorithm.</span></span>

## <a name="when-are-managed-assemblies-loaded"></a><span data-ttu-id="d7a77-106">Kdy jsou spravovaná sestavení načtena?</span><span class="sxs-lookup"><span data-stu-id="d7a77-106">When are managed assemblies loaded?</span></span>

<span data-ttu-id="d7a77-107">Nejběžnějším mechanismem pro aktivaci spravovaného zatížení sestavení je statický odkaz na sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-107">The most common mechanism to trigger a managed assembly load is a static assembly reference.</span></span> <span data-ttu-id="d7a77-108">Tyto odkazy jsou vloženy kompilátorem vždy, když kód používá typ definovaný v jiném sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-108">These references are inserted by the compiler whenever code uses a type defined in another assembly.</span></span> <span data-ttu-id="d7a77-109">Tato sestavení jsou načtena (`load-by-name`) podle potřeby modulem runtime.</span><span class="sxs-lookup"><span data-stu-id="d7a77-109">These assemblies are loaded (`load-by-name`) as needed by the runtime.</span></span>

<span data-ttu-id="d7a77-110">Přímé použití specifických rozhraní API také spustí načítání:</span><span class="sxs-lookup"><span data-stu-id="d7a77-110">The direct use of specific APIs will also trigger loads:</span></span>

|<span data-ttu-id="d7a77-111">rozhraní API</span><span class="sxs-lookup"><span data-stu-id="d7a77-111">API</span></span>  |<span data-ttu-id="d7a77-112">Popis</span><span class="sxs-lookup"><span data-stu-id="d7a77-112">Description</span></span>  |<span data-ttu-id="d7a77-113">`Active`<xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="d7a77-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span></span> |
|---------|---------|---------|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyName%2A?displayProperty=nameWithType>|`Load-by-name`|<span data-ttu-id="d7a77-114">[Tato](../../csharp/language-reference/keywords/this.md) instance.</span><span class="sxs-lookup"><span data-stu-id="d7a77-114">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyPath%2A?displayProperty=nameWithType><p><xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromNativeImagePath%2A?displayProperty=nameWithType>|<span data-ttu-id="d7a77-115">Načtení z cesty</span><span class="sxs-lookup"><span data-stu-id="d7a77-115">Load from path.</span></span>|<span data-ttu-id="d7a77-116">[Tato](../../csharp/language-reference/keywords/this.md) instance.</span><span class="sxs-lookup"><span data-stu-id="d7a77-116">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromStream%2A?displayProperty=nameWithType>|<span data-ttu-id="d7a77-117">Načíst z objektu.</span><span class="sxs-lookup"><span data-stu-id="d7a77-117">Load from object.</span></span>|<span data-ttu-id="d7a77-118">[Tato](../../csharp/language-reference/keywords/this.md) instance.</span><span class="sxs-lookup"><span data-stu-id="d7a77-118">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Reflection.Assembly.LoadFile%2A?displayProperty=nameWithType>|<span data-ttu-id="d7a77-119">Načtení z cesty v nové instanci <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="d7a77-119">Load from path in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance</span></span>|<span data-ttu-id="d7a77-120">Nová instance <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-120">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType>|<span data-ttu-id="d7a77-121">Načtení z cesty v instanci <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-121">Load from path in the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span><p><span data-ttu-id="d7a77-122">Přidá obslužnou rutinu <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> k <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-122">Adds a <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> handler to <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="d7a77-123">Obslužná rutina načte závislosti sestavení z jeho adresáře.</span><span class="sxs-lookup"><span data-stu-id="d7a77-123">The handler will load the assembly's dependencies from its directory.</span></span>|<span data-ttu-id="d7a77-124">Instance <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-124">The <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Reflection.AssemblyName)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.String)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.LoadWithPartialName%2A?displayProperty=nameWithType>|<span data-ttu-id="d7a77-125">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="d7a77-125">`Load-by-name`.</span></span>|<span data-ttu-id="d7a77-126">Odvozeno od volajícího.</span><span class="sxs-lookup"><span data-stu-id="d7a77-126">Inferred from caller.</span></span><p><span data-ttu-id="d7a77-127">Preferovat <xref:System.Runtime.Loader.AssemblyLoadContext> metody.</span><span class="sxs-lookup"><span data-stu-id="d7a77-127">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Byte[])?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.Byte[],System.Byte[])?displayProperty=nameWithType>|<span data-ttu-id="d7a77-128">Načtení z objektu v nové instanci <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-128">Load from object in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|<span data-ttu-id="d7a77-129">Nová instance <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-129">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Type.GetType(System.String)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean,System.Boolean)?displayProperty=nameWithType>|<span data-ttu-id="d7a77-130">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="d7a77-130">`Load-by-name`.</span></span>|<span data-ttu-id="d7a77-131">Odvozeno od volajícího.</span><span class="sxs-lookup"><span data-stu-id="d7a77-131">Inferred from caller.</span></span><p><span data-ttu-id="d7a77-132">Preferovat <xref:System.Type.GetType%2A?displayProperty=nameWithType> metody pomocí argumentu `assemblyResolver`.</span><span class="sxs-lookup"><span data-stu-id="d7a77-132">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> methods with an `assemblyResolver` argument.</span></span>|
<xref:System.Reflection.Assembly.GetType%2A?displayProperty=nameWithType>|<span data-ttu-id="d7a77-133">Pokud typ `name` popisuje kvalifikovaný obecný typ sestavení, aktivujte `Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="d7a77-133">If type `name` describes an assembly qualified generic type, trigger a `Load-by-name`.</span></span>|<span data-ttu-id="d7a77-134">Odvozeno od volajícího.</span><span class="sxs-lookup"><span data-stu-id="d7a77-134">Inferred from caller.</span></span><p><span data-ttu-id="d7a77-135">Preferovat <xref:System.Type.GetType%2A?displayProperty=nameWithType> při použití kvalifikovaného názvu typu sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-135">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> when using assembly qualified type names.</span></span>|
<xref:System.Activator.CreateInstance(System.String,System.String)?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Object[])?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Boolean,System.Reflection.BindingFlags,System.Reflection.Binder,System.Object[],System.Globalization.CultureInfo,System.Object[])?displayProperty=nameWithType>|<span data-ttu-id="d7a77-136">`Load-by-name`.</span><span class="sxs-lookup"><span data-stu-id="d7a77-136">`Load-by-name`.</span></span>|<span data-ttu-id="d7a77-137">Odvozeno od volajícího.</span><span class="sxs-lookup"><span data-stu-id="d7a77-137">Inferred from caller.</span></span><p><span data-ttu-id="d7a77-138">Dáváte přednost <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> metodám, které přebírají argument <xref:System.Type>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-138">Prefer <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> methods taking a <xref:System.Type> argument.</span></span>|

## <a name="algorithm"></a><span data-ttu-id="d7a77-139">Algoritmus</span><span class="sxs-lookup"><span data-stu-id="d7a77-139">Algorithm</span></span>

<span data-ttu-id="d7a77-140">Následující algoritmus popisuje, jak modul runtime načítá spravované sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-140">The following algorithm describes how the runtime loads a managed assembly.</span></span>

1. <span data-ttu-id="d7a77-141">Určete `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-141">Determine the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

    - <span data-ttu-id="d7a77-142">Pro statický odkaz na sestavení je `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instance, která načte odkazující sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-142">For a static assembly reference, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> is the instance that loaded the referring assembly.</span></span>
    - <span data-ttu-id="d7a77-143">Upřednostňovaná rozhraní API nastaví `active` <xref:System.Runtime.Loader.AssemblyLoadContext> explicitní.</span><span class="sxs-lookup"><span data-stu-id="d7a77-143">Preferred APIs make the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> explicit.</span></span>
    - <span data-ttu-id="d7a77-144">Jiná rozhraní API odvozují `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-144">Other APIs infer the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span> <span data-ttu-id="d7a77-145">Pro tato rozhraní API se použije vlastnost <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-145">For these APIs, the <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> property is used.</span></span> <span data-ttu-id="d7a77-146">Je-li jeho hodnota `null`, je použita odvozená instance <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-146">If its value is `null`, then the inferred <xref:System.Runtime.Loader.AssemblyLoadContext> instance is used.</span></span>
    - <span data-ttu-id="d7a77-147">Viz tabulka výše.</span><span class="sxs-lookup"><span data-stu-id="d7a77-147">See table above.</span></span>

2. <span data-ttu-id="d7a77-148">Pro `Load-by-name` metody načte aktivní <xref:System.Runtime.Loader.AssemblyLoadContext> sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-148">For the `Load-by-name` methods, the active <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="d7a77-149">V pořadí podle priority podle:</span><span class="sxs-lookup"><span data-stu-id="d7a77-149">In priority order by:</span></span>
    - <span data-ttu-id="d7a77-150">Probíhá kontrola `cache-by-name`.</span><span class="sxs-lookup"><span data-stu-id="d7a77-150">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="d7a77-151">Volání funkce <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-151">Calling the <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> function.</span></span>

    - <span data-ttu-id="d7a77-152">Kontroluje se mezipaměť instancí <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> a spouští se [výchozí logika pro zjišťování spravovaného sestavení](default-probing.md#managed-assembly-default-probing) .</span><span class="sxs-lookup"><span data-stu-id="d7a77-152">Checking the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instances' cache and running [managed assembly default probing](default-probing.md#managed-assembly-default-probing) logic.</span></span>

    - <span data-ttu-id="d7a77-153">Vyvolává se událost <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> pro aktivní AssemblyLoadContext.</span><span class="sxs-lookup"><span data-stu-id="d7a77-153">Raising the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event for the active AssemblyLoadContext.</span></span>

    - <span data-ttu-id="d7a77-154">Vyvolává se událost <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-154">Raising the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

3. <span data-ttu-id="d7a77-155">Pro ostatní typy načtení `active` <xref:System.Runtime.Loader.AssemblyLoadContext> načte sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-155">For the other types of loads, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="d7a77-156">V pořadí podle priority podle:</span><span class="sxs-lookup"><span data-stu-id="d7a77-156">In priority order by:</span></span>
    - <span data-ttu-id="d7a77-157">Probíhá kontrola `cache-by-name`.</span><span class="sxs-lookup"><span data-stu-id="d7a77-157">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="d7a77-158">Načítání ze zadané cesty nebo nezpracovaného objektu sestavení.</span><span class="sxs-lookup"><span data-stu-id="d7a77-158">Loading from the specified path or raw assembly object.</span></span>

4. <span data-ttu-id="d7a77-159">V obou případech, pokud je sestavení nově načteno, pak:</span><span class="sxs-lookup"><span data-stu-id="d7a77-159">In either case, if an assembly is newly loaded, then:</span></span>
   - <span data-ttu-id="d7a77-160">Vyvolá se událost <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-160">The <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> event is raised.</span></span>
   - <span data-ttu-id="d7a77-161">Do `cache-by-name`<xref:System.Runtime.Loader.AssemblyLoadContext> instance sestavení se přidá odkaz.</span><span class="sxs-lookup"><span data-stu-id="d7a77-161">A reference is added to the assembly's <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

5. <span data-ttu-id="d7a77-162">Pokud je sestavení nalezeno, přidá se podle potřeby odkaz na `cache-by-name`instance `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span><span class="sxs-lookup"><span data-stu-id="d7a77-162">If the assembly is found, a reference is added as needed to the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>
