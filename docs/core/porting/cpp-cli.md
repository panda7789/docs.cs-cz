---
title: Migrace projektů C++/CLI do jádra .NET
description: Další informace o přenesení projektů C++/CLI do jádra .NET.
author: mjrousos
ms.date: 01/10/2020
ms.openlocfilehash: eb03f2a5ff42e8279fd3ebd6ee6fb6d955f6798d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/14/2020
ms.locfileid: "75964928"
---
# <a name="how-to-port-a-ccli-project-to-net-core"></a><span data-ttu-id="aedf7-103">Jak portovat projekt C++/CLI do jádra .NET Core</span><span class="sxs-lookup"><span data-stu-id="aedf7-103">How to port a C++/CLI project to .NET Core</span></span>

<span data-ttu-id="aedf7-104">Počínaje .NET Core 3.1 a Visual Studio 2019 verze 16.4, [C++/CLI projekty](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) mohou cílit na .NET Core.</span><span class="sxs-lookup"><span data-stu-id="aedf7-104">Beginning with .NET Core 3.1 and Visual Studio 2019 version 16.4, [C++/CLI projects](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) can target .NET Core.</span></span> <span data-ttu-id="aedf7-105">Tato podpora umožňuje portovat desktopové aplikace systému Windows s vrstvami interop c++/CLI do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="aedf7-105">This support makes it possible to port Windows desktop applications with C++/CLI interop layers to .NET Core.</span></span> <span data-ttu-id="aedf7-106">Tento článek popisuje, jak portovat projekty C++/CLI z rozhraní .NET Framework do rozhraní .NET Core 3.1.</span><span class="sxs-lookup"><span data-stu-id="aedf7-106">This article describes how to port C++/CLI projects from .NET Framework to .NET Core 3.1.</span></span>

## <a name="ccli-net-core-limitations"></a><span data-ttu-id="aedf7-107">Omezení jádra jazyka C++/CLI .NET</span><span class="sxs-lookup"><span data-stu-id="aedf7-107">C++/CLI .NET Core limitations</span></span>

<span data-ttu-id="aedf7-108">Existují některá důležitá omezení pro přenesení projektů C++/CLI na .NET Core ve srovnání s jinými jazyky:</span><span class="sxs-lookup"><span data-stu-id="aedf7-108">There are some important limitations to porting C++/CLI projects to .NET Core compared to other languages:</span></span>

* <span data-ttu-id="aedf7-109">Podpora rozhraní C++/CLI pro rozhraní .NET Core je pouze pro Windows.</span><span class="sxs-lookup"><span data-stu-id="aedf7-109">C++/CLI support for .NET Core is Windows only.</span></span>
* <span data-ttu-id="aedf7-110">Projekty jazyka C++/CLI nemohou cílit na standard .NET, pouze na jádro .NET (nebo rozhraní .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="aedf7-110">C++/CLI projects can't target .NET Standard, only .NET Core (or .NET Framework).</span></span>
* <span data-ttu-id="aedf7-111">Projekty jazyka C++/CLI nepodporují nový formát souboru projektu ve stylu sady SDK.</span><span class="sxs-lookup"><span data-stu-id="aedf7-111">C++/CLI projects don't support the new SDK-style project file format.</span></span> <span data-ttu-id="aedf7-112">Místo toho i při cílení na .NET Core, C++/CLI projekty používají existující formát souboru vcxproj.</span><span class="sxs-lookup"><span data-stu-id="aedf7-112">Instead, even when targeting .NET Core, C++/CLI projects use the existing vcxproj file format.</span></span>
* <span data-ttu-id="aedf7-113">Projekty c++/CLI nemohou vícecílit na více platforem .NET.</span><span class="sxs-lookup"><span data-stu-id="aedf7-113">C++/CLI projects can't multitarget multiple .NET platforms.</span></span> <span data-ttu-id="aedf7-114">Pokud potřebujete vytvořit projekt C++/CLI pro rozhraní .NET Framework i .NET Core, použijte samostatné soubory projektu.</span><span class="sxs-lookup"><span data-stu-id="aedf7-114">If you need to build a C++/CLI project for both .NET Framework and .NET Core, use separate project files.</span></span>
* <span data-ttu-id="aedf7-115">.NET Core nepodporuje `-clr:pure` `-clr:safe` ani kompilace, `-clr:netcore` pouze nová možnost `-clr` (což je ekvivalentní pro rozhraní .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="aedf7-115">.NET Core doesn't support `-clr:pure` or `-clr:safe` compilation, only the new `-clr:netcore` option (which is equivalent to `-clr` for .NET Framework).</span></span>

## <a name="port-a-ccli-project"></a><span data-ttu-id="aedf7-116">Port projektu C++/CLI</span><span class="sxs-lookup"><span data-stu-id="aedf7-116">Port a C++/CLI project</span></span>

<span data-ttu-id="aedf7-117">Chcete-li portovat projekt C++/CLI do jádra .NET Core, proveďte následující změny v souboru vcxproj.</span><span class="sxs-lookup"><span data-stu-id="aedf7-117">To port a C++/CLI project to .NET Core, make the following changes to the vcxproj file.</span></span> <span data-ttu-id="aedf7-118">Tyto kroky migrace se liší od kroků potřebných pro jiné typy projektů, protože projekty C++/CLI nepoužívají soubory projektu ve stylu sady SDK.</span><span class="sxs-lookup"><span data-stu-id="aedf7-118">These migration steps differ from the steps needed for other project types because C++/CLI projects don't use SDK-style project files.</span></span>

1. <span data-ttu-id="aedf7-119">`<CLRSupport>true</CLRSupport>` Nahraďte `<CLRSupport>NetCore</CLRSupport>`vlastnosti .</span><span class="sxs-lookup"><span data-stu-id="aedf7-119">Replace `<CLRSupport>true</CLRSupport>` properties with `<CLRSupport>NetCore</CLRSupport>`.</span></span> <span data-ttu-id="aedf7-120">Tato vlastnost je často ve skupinách vlastností specifických pro konfiguraci, takže ji možná budete muset nahradit na více místech.</span><span class="sxs-lookup"><span data-stu-id="aedf7-120">This property is often in configuration-specific property groups, so you may need to replace it in multiple places.</span></span>
2. <span data-ttu-id="aedf7-121">`<TargetFrameworkVersion>` Nahraďte `<TargetFramework>netcoreapp3.1</TargetFramework>`vlastnosti .</span><span class="sxs-lookup"><span data-stu-id="aedf7-121">Replace `<TargetFrameworkVersion>` properties with `<TargetFramework>netcoreapp3.1</TargetFramework>`.</span></span>
3. <span data-ttu-id="aedf7-122">Odeberte všechny odkazy rozhraní `<Reference Include="System" />`.NET Framework (například ).</span><span class="sxs-lookup"><span data-stu-id="aedf7-122">Remove any .NET Framework references (like `<Reference Include="System" />`).</span></span> <span data-ttu-id="aedf7-123">Sestavení sady .NET Core SDK jsou `<CLRSupport>NetCore</CLRSupport>`při použití automaticky odkazována .</span><span class="sxs-lookup"><span data-stu-id="aedf7-123">.NET Core SDK assemblies are automatically referenced when using `<CLRSupport>NetCore</CLRSupport>`.</span></span>
4. <span data-ttu-id="aedf7-124">Podle potřeby aktualizujte využití rozhraní API v souborech CPP a odeberte rozhraní API, která nejsou k dispozici pro jádro .NET Core.</span><span class="sxs-lookup"><span data-stu-id="aedf7-124">Update API usage in cpp files, as necessary, to remove APIs unavailable to .NET Core.</span></span> <span data-ttu-id="aedf7-125">Vzhledem k tomu, že projekty Jazyka C++/CLI mají tendenci být poměrně tenké vrstvy interop, často není potřeba mnoho změn.</span><span class="sxs-lookup"><span data-stu-id="aedf7-125">Because C++/CLI projects tend to be fairly thin interop layers, there are often not many changes needed.</span></span> <span data-ttu-id="aedf7-126">[Analyzátor přenosovatelnosti rozhraní .NET](../../standard/analyzers/portability-analyzer.md) lze použít k identifikaci nepodporovaných rozhraní API rozhraní .NET používaných binárními soubory jazyka C++/CLI stejně jako u čistě spravovaných binárních souborů.</span><span class="sxs-lookup"><span data-stu-id="aedf7-126">The [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) can be used to identify unsupported .NET APIs used by C++/CLI binaries just as with purely managed binaries.</span></span> <span data-ttu-id="aedf7-127">Pokyny pro určení přenositelnosti kódu a aktualizaci projektů pro práci s rozhraními API .NET Core jsou k dispozici v [pokynech pro přenos portů knihovny](./libraries.md#determine-portability).</span><span class="sxs-lookup"><span data-stu-id="aedf7-127">Guidelines for determining code portability and updating projects to work with .NET Core APIs are available in the [library porting guidance](./libraries.md#determine-portability).</span></span>

### <a name="wpf-and-windows-forms-usage"></a><span data-ttu-id="aedf7-128">WPF a Windows Forms použití</span><span class="sxs-lookup"><span data-stu-id="aedf7-128">WPF and Windows Forms usage</span></span>

<span data-ttu-id="aedf7-129">Projekty rozhraní .NET Core C++/CLI mohou používat rozhraní API systému Windows a WPF.</span><span class="sxs-lookup"><span data-stu-id="aedf7-129">.NET Core C++/CLI projects can use Windows Forms and WPF APIs.</span></span> <span data-ttu-id="aedf7-130">Chcete-li použít tato rozhraní API plochy systému Windows, je třeba přidat explicitní odkazy na rozhraní do knihoven uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="aedf7-130">To use these Windows desktop APIs, you need to add explicit framework references to the UI libraries.</span></span> <span data-ttu-id="aedf7-131">Projekty ve stylu sady SDK, které používají rozhraní API `Microsoft.NET.Sdk.WindowsDesktop` plochy systému Windows, automaticky odkazují na nezbytné knihovny architektury pomocí sady SDK.</span><span class="sxs-lookup"><span data-stu-id="aedf7-131">SDK-style projects that use Windows desktop APIs reference the necessary framework libraries automatically by using the `Microsoft.NET.Sdk.WindowsDesktop` SDK.</span></span> <span data-ttu-id="aedf7-132">Vzhledem k tomu, že projekty jazyka C++/CLI nepoužívají formát projektu ve stylu sady SDK, je třeba při cílení na jádro .NET přidat explicitní odkazy na rozhraní Framework.</span><span class="sxs-lookup"><span data-stu-id="aedf7-132">Because C++/CLI projects don't use the SDK-style project format, they need to add explicit framework references when targeting .NET Core.</span></span>

<span data-ttu-id="aedf7-133">Chcete-li použít soubory API pro formuláře systému Windows, přidejte tento odkaz do souboru vcxproj:</span><span class="sxs-lookup"><span data-stu-id="aedf7-133">To use Windows Forms APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of Windows Forms -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WindowsForms" />
```

<span data-ttu-id="aedf7-134">Chcete-li použít wpf api, přidejte tento odkaz do souboru vcxproj:</span><span class="sxs-lookup"><span data-stu-id="aedf7-134">To use WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of WPF -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WPF" />
```

<span data-ttu-id="aedf7-135">Chcete-li použít windows forms i wpf api, přidejte tento odkaz do souboru vcxproj:</span><span class="sxs-lookup"><span data-stu-id="aedf7-135">To use both Windows Forms and WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference the entirety of the Windows desktop framework:
     Windows Forms, WPF, and the types that provide integration between them -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App" />
```

<span data-ttu-id="aedf7-136">V současné době není možné přidat tyto odkazy pomocí správce odkazů sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="aedf7-136">Currently, it's not possible to add these references using Visual Studio's reference manager.</span></span> <span data-ttu-id="aedf7-137">Místo toho aktualizujte soubor projektu ručně.</span><span class="sxs-lookup"><span data-stu-id="aedf7-137">Instead, update the project file manually.</span></span> <span data-ttu-id="aedf7-138">Tuto aktualizaci lze provést v sadě Visual Studio uvolněním projektu a úpravou souboru projektu.</span><span class="sxs-lookup"><span data-stu-id="aedf7-138">This update can be done in Visual Studio by unloading the project and then editing the project file.</span></span> <span data-ttu-id="aedf7-139">Můžete také použít jiný editor, jako je VS Code.</span><span class="sxs-lookup"><span data-stu-id="aedf7-139">You can also use another editor like VS Code.</span></span>

## <a name="build-without-msbuild"></a><span data-ttu-id="aedf7-140">Sestavení bez MSBuild</span><span class="sxs-lookup"><span data-stu-id="aedf7-140">Build without MSBuild</span></span>

<span data-ttu-id="aedf7-141">Je také možné vytvářet projekty C++/CLI bez použití MSBuild.</span><span class="sxs-lookup"><span data-stu-id="aedf7-141">It's also possible to build C++/CLI projects without using MSBuild.</span></span> <span data-ttu-id="aedf7-142">Následujícím postupem vytvořte projekt C++/CLI pro jazyk .NET Core přímo pomocí *cl.exe* a *link.exe*:</span><span class="sxs-lookup"><span data-stu-id="aedf7-142">Follow these steps to build a C++/CLI project for .NET Core directly with *cl.exe* and *link.exe*:</span></span>

1. <span data-ttu-id="aedf7-143">Při kompilaci přejděte `-clr:netcore` na *cl.exe*.</span><span class="sxs-lookup"><span data-stu-id="aedf7-143">When compiling, pass `-clr:netcore` to *cl.exe*.</span></span>
2. <span data-ttu-id="aedf7-144">Odkaz na nezbytné sestavení odkazů .NET Core.</span><span class="sxs-lookup"><span data-stu-id="aedf7-144">Reference necessary .NET Core reference assemblies.</span></span>
3. <span data-ttu-id="aedf7-145">Při propojování zadejte adresář hostitele `LibPath` aplikace .NET Core jako adresář (aby bylo možné nalézt *soubor ijwhost.lib).*</span><span class="sxs-lookup"><span data-stu-id="aedf7-145">When linking, provide the .NET Core app host directory as a `LibPath` (so that *ijwhost.lib* can be found).</span></span>
4. <span data-ttu-id="aedf7-146">Zkopírujte *soubor ijwhost.dll* (z adresáře hostitele aplikace .NET Core) do výstupního adresáře projektu.</span><span class="sxs-lookup"><span data-stu-id="aedf7-146">Copy *ijwhost.dll* (from the .NET Core app host directory) to the project's output directory.</span></span>
5. <span data-ttu-id="aedf7-147">Ujistěte se, že pro první součást aplikace, která bude spuštěn spravovaný kód, existuje soubor [runtimeconfig.json.](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md)</span><span class="sxs-lookup"><span data-stu-id="aedf7-147">Make sure a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file exists for the first component of the application that will run managed code.</span></span> <span data-ttu-id="aedf7-148">Pokud má aplikace spravovaný `runtime.config` vstupní bod, soubor se vytvoří a zkopíruje automaticky.</span><span class="sxs-lookup"><span data-stu-id="aedf7-148">If the application has a managed entry point, a `runtime.config` file will be created and copied automatically.</span></span> <span data-ttu-id="aedf7-149">Pokud má aplikace nativní vstupní bod, musíte `runtimeconfig.json` vytvořit soubor pro první knihovnu C++/CLI, abyste použili runtime .NET Core.</span><span class="sxs-lookup"><span data-stu-id="aedf7-149">If the application has a native entry point, though, you need to create a `runtimeconfig.json` file for the first C++/CLI library to use the .NET Core runtime.</span></span>

## <a name="known-issues"></a><span data-ttu-id="aedf7-150">Známé problémy</span><span class="sxs-lookup"><span data-stu-id="aedf7-150">Known issues</span></span>

<span data-ttu-id="aedf7-151">Existuje několik známých problémů, na které je třeba dávat pozor při práci s projekty C++/CLI zaměřenými na .NET Core.</span><span class="sxs-lookup"><span data-stu-id="aedf7-151">There are a couple known issues to look out for when working with C++/CLI projects targeting .NET Core.</span></span>

* <span data-ttu-id="aedf7-152">WPF odkaz na architekturu v projektech .NET Core C++/CLI aktuálně způsobuje některé nadbytečné upozornění o tom, že nelze importovat symboly.</span><span class="sxs-lookup"><span data-stu-id="aedf7-152">A WPF framework reference in .NET Core C++/CLI projects currently causes some extraneous warnings about being unable to import symbols.</span></span> <span data-ttu-id="aedf7-153">Tato upozornění mohou být bezpečně ignorována a měla by být brzy opravena.</span><span class="sxs-lookup"><span data-stu-id="aedf7-153">These warnings can be safely ignored and should be fixed soon.</span></span>
* <span data-ttu-id="aedf7-154">Pokud má aplikace nativní vstupní bod, potřebuje knihovna C++/CLI, která nejprve spustí spravovaný kód, soubor [runtimeconfig.json.](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md)</span><span class="sxs-lookup"><span data-stu-id="aedf7-154">If the application has a native entry point, the C++/CLI library that first executes managed code needs a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file.</span></span> <span data-ttu-id="aedf7-155">Tento konfigurační soubor se používá při spuštění runtime jádra .NET.</span><span class="sxs-lookup"><span data-stu-id="aedf7-155">This config file is used when the .NET Core runtime starts.</span></span> <span data-ttu-id="aedf7-156">Projekty C++/CLI ještě `runtimeconfig.json` nevytvářejí soubory automaticky v době sestavení, takže soubor musí být generován ručně.</span><span class="sxs-lookup"><span data-stu-id="aedf7-156">C++/CLI projects don't create `runtimeconfig.json` files automatically at build time yet, so the file must be generated manually.</span></span> <span data-ttu-id="aedf7-157">Pokud je knihovna C++/CLI volána ze spravovaného vstupního bodu, pak knihovna C++/CLI nepotřebuje `runtimeconfig.json` soubor (protože sestavení vstupního bodu bude mít ten, který se používá při spuštění běhu).</span><span class="sxs-lookup"><span data-stu-id="aedf7-157">If a C++/CLI library is called from a managed entry point, then the C++/CLI library doesn't need a `runtimeconfig.json` file (since the entry point assembly will have one that is used when starting the runtime).</span></span> <span data-ttu-id="aedf7-158">Jednoduchý ukázkový `runtimeconfig.json` soubor je uveden níže.</span><span class="sxs-lookup"><span data-stu-id="aedf7-158">A simple sample `runtimeconfig.json` file is shown below.</span></span> <span data-ttu-id="aedf7-159">Další informace naleznete v [spec na GitHubu](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span><span class="sxs-lookup"><span data-stu-id="aedf7-159">For more information, see the [spec on GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span></span>

    ```json
    {
          "runtimeOptions": {
             "tfm": "netcoreapp3.1",
             "framework": {
                "name": "Microsoft.NETCore.App",
                "version": "3.1.0"
             }
          }
    }
    ```
